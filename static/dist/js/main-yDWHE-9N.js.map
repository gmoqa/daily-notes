{"version":3,"file":"main-yDWHE-9N.js","sources":["../../../src/utils/state.ts","../../../src/utils/cache.ts","../../../src/utils/events.ts","../../../src/services/api.ts","../../../src/services/auth.ts","../../../src/services/notes.ts","../../../src/services/contexts.ts","../../../src/components/Calendar.ts","../../../src/components/Editor.ts","../../../src/components/Notifications.ts","../../../src/components/UI.ts","../../../src/main.ts"],"sourcesContent":["/**\n * Mini State Manager\n * Simple reactive state management without a framework\n */\n\nimport type { User, UserSettings, Context, Note } from '@/types'\n\ninterface AppState {\n  // User state\n  currentUser: User | null\n  userSettings: UserSettings\n\n  // Selection state\n  selectedContext: string | null\n  selectedDate: string | null\n\n  // Data state\n  contexts: Context[]\n  notes: Note[]\n  notesWithDates: string[]\n\n  // Calendar state\n  currentCalendarMonth: number\n  currentCalendarYear: number\n\n  // UI state\n  isLoggingOut: boolean\n  syncStatus: { pending: number; syncing: boolean }\n\n  // Time\n  serverTimeOffset: number\n}\n\ntype StateKey = keyof AppState\ntype StateListener<K extends StateKey> = (newValue: AppState[K], oldValue: AppState[K]) => void\ntype WildcardListener = (key: StateKey, newValue: any, oldValue: any) => void\ntype ComputedFn<T> = (state: AppState) => T\n\nclass StateManager {\n  private _state: AppState\n  private _listeners: Map<StateKey | '*', Set<StateListener<any> | WildcardListener>>\n  private _computed: Map<string, ComputedFn<any>>\n\n  constructor() {\n    this._state = {\n      // User state\n      currentUser: null,\n      userSettings: {\n        theme: 'dark',\n        weekStart: 0,\n        timezone: 'UTC',\n        dateFormat: 'DD-MM-YY',\n        uniqueContextMode: false,\n        showBreadcrumb: false,\n        showMarkdownEditor: false,\n        hideNewContextButton: false\n      },\n\n      // Selection state\n      selectedContext: null,\n      selectedDate: null,\n\n      // Data state\n      contexts: [],\n      notes: [],\n      notesWithDates: [],\n\n      // Calendar state\n      currentCalendarMonth: new Date().getMonth(),\n      currentCalendarYear: new Date().getFullYear(),\n\n      // UI state\n      isLoggingOut: false,\n      syncStatus: { pending: 0, syncing: false },\n\n      // Time\n      serverTimeOffset: 0\n    }\n\n    this._listeners = new Map()\n    this._computed = new Map()\n  }\n\n  /**\n   * Get state value\n   */\n  get<K extends StateKey>(key: K): AppState[K]\n  get(key: string): any {\n    if (this._computed.has(key)) {\n      return this._computed.get(key)!(this._state)\n    }\n    return this._state[key as StateKey]\n  }\n\n  /**\n   * Set state value and notify listeners\n   */\n  set<K extends StateKey>(key: K, value: AppState[K]): void {\n    const oldValue = this._state[key]\n    if (oldValue === value) return\n\n    this._state[key] = value\n    this._notify(key, value, oldValue)\n  }\n\n  /**\n   * Update multiple state values at once\n   */\n  update(changes: Partial<AppState>): void {\n    Object.entries(changes).forEach(([key, value]) => {\n      this.set(key as StateKey, value)\n    })\n  }\n\n  /**\n   * Subscribe to state changes\n   */\n  subscribe<K extends StateKey>(key: K, callback: StateListener<K>): () => void\n  subscribe(key: '*', callback: WildcardListener): () => void\n  subscribe(key: StateKey | '*', callback: any): () => void {\n    if (!this._listeners.has(key)) {\n      this._listeners.set(key, new Set())\n    }\n    this._listeners.get(key)!.add(callback)\n\n    // Return unsubscribe function\n    return () => {\n      const listeners = this._listeners.get(key)\n      if (listeners) {\n        listeners.delete(callback)\n      }\n    }\n  }\n\n  /**\n   * Subscribe to multiple keys\n   */\n  subscribeMany(keys: StateKey[], callback: WildcardListener): () => void {\n    const unsubscribers = keys.map(key => this.subscribe(key, callback as any))\n    return () => unsubscribers.forEach(unsub => unsub())\n  }\n\n  /**\n   * Define computed property\n   */\n  computed<T>(key: string, fn: ComputedFn<T>): void {\n    this._computed.set(key, fn)\n  }\n\n  /**\n   * Get entire state (for debugging)\n   */\n  getState(): AppState {\n    return { ...this._state }\n  }\n\n  /**\n   * Notify listeners of change\n   */\n  private _notify<K extends StateKey>(key: K, newValue: AppState[K], oldValue: AppState[K]): void {\n    const listeners = this._listeners.get(key)\n    if (listeners) {\n      listeners.forEach(callback => {\n        try {\n          ;(callback as StateListener<K>)(newValue, oldValue)\n        } catch (error) {\n          console.error(`Error in state listener for \"${key}\":`, error)\n        }\n      })\n    }\n\n    // Notify wildcard listeners (*)\n    const wildcardListeners = this._listeners.get('*')\n    if (wildcardListeners) {\n      wildcardListeners.forEach(callback => {\n        try {\n          ;(callback as WildcardListener)(key, newValue as any, oldValue)\n        } catch (error) {\n          console.error('Error in wildcard state listener:', error)\n        }\n      })\n    }\n  }\n}\n\n// Create singleton instance\nexport const state = new StateManager()\n\n// Setup computed properties\nstate.computed('today', (s) => {\n  const timezone = s.userSettings.timezone || 'UTC'\n  const now = new Date(Date.now() + s.serverTimeOffset)\n\n  const formatter = new Intl.DateTimeFormat('en-US', {\n    timeZone: timezone,\n    year: 'numeric',\n    month: '2-digit',\n    day: '2-digit'\n  })\n\n  const parts = formatter.formatToParts(now)\n  const year = parts.find(p => p.type === 'year')!.value\n  const month = parts.find(p => p.type === 'month')!.value\n  const day = parts.find(p => p.type === 'day')!.value\n\n  return `${year}-${month}-${day}`\n})\n\n// Debug helper\nif (typeof window !== 'undefined') {\n  ;(window as any).__STATE__ = state\n}\n","/**\n * Local Cache Module\n * IndexedDB-based offline storage for notes and contexts\n */\n\nimport type { Note, Context } from '@/types'\n\ninterface CachedNote extends Note {\n  id: string\n  _localTimestamp: number\n  _cachedAt: number\n}\n\ninterface CachedContext extends Context {\n  _localTimestamp: number\n}\n\nexport class LocalCache {\n  private db: IDBDatabase | null = null\n  private dbName = 'DailyNotesDB'\n  private version = 1\n\n  // Batch write optimization\n  private pendingWrites = new Map<string, CachedNote>()\n  private writeTimer: number | null = null\n  private readonly BATCH_DELAY = 500 // ms\n\n  async init(): Promise<void> {\n    return new Promise((resolve, reject) => {\n      const request = indexedDB.open(this.dbName, this.version)\n\n      request.onerror = () => reject(request.error)\n\n      request.onsuccess = () => {\n        this.db = request.result\n        resolve()\n      }\n\n      request.onupgradeneeded = (e) => {\n        const db = (e.target as IDBOpenDBRequest).result\n\n        if (!db.objectStoreNames.contains('notes')) {\n          db.createObjectStore('notes', { keyPath: 'id' })\n        }\n\n        if (!db.objectStoreNames.contains('contexts')) {\n          db.createObjectStore('contexts', { keyPath: 'id' })\n        }\n      }\n    })\n  }\n\n  async saveNote(note: Note): Promise<void> {\n    if (!this.db) return\n\n    const id = `${note.context}-${note.date}`\n\n    // Add to pending writes (batching)\n    this.pendingWrites.set(id, {\n      ...note,\n      id,\n      _localTimestamp: Date.now(),\n      _cachedAt: Date.now(),\n      updated_at: note.updated_at || new Date().toISOString()\n    })\n\n    // Schedule batch write\n    this.scheduleBatchWrite()\n  }\n\n  private scheduleBatchWrite(): void {\n    if (this.writeTimer) {\n      clearTimeout(this.writeTimer)\n    }\n\n    this.writeTimer = window.setTimeout(() => {\n      this.flushPendingWrites()\n    }, this.BATCH_DELAY)\n  }\n\n  private async flushPendingWrites(): Promise<void> {\n    if (!this.db || this.pendingWrites.size === 0) return\n\n    const notesToWrite = Array.from(this.pendingWrites.values())\n    this.pendingWrites.clear()\n\n    const tx = this.db.transaction(['notes'], 'readwrite')\n    const store = tx.objectStore('notes')\n\n    notesToWrite.forEach(note => {\n      store.put(note)\n    })\n\n    return new Promise((resolve, reject) => {\n      tx.oncomplete = () => {\n        console.log(`[Cache] Batch wrote ${notesToWrite.length} note(s)`)\n        resolve()\n      }\n      tx.onerror = () => reject(tx.error)\n    })\n  }\n\n  // Force immediate write (for critical operations)\n  async saveNoteImmediate(note: Note): Promise<void> {\n    if (!this.db) return\n\n    const tx = this.db.transaction(['notes'], 'readwrite')\n    const store = tx.objectStore('notes')\n    const id = `${note.context}-${note.date}`\n\n    store.put({\n      ...note,\n      id,\n      _localTimestamp: Date.now(),\n      _cachedAt: Date.now(),\n      updated_at: note.updated_at || new Date().toISOString()\n    })\n\n    return new Promise((resolve, reject) => {\n      tx.oncomplete = () => resolve()\n      tx.onerror = () => reject(tx.error)\n    })\n  }\n\n  async getNote(context: string, date: string): Promise<CachedNote | null> {\n    if (!this.db) return null\n\n    const tx = this.db.transaction(['notes'], 'readonly')\n    const store = tx.objectStore('notes')\n    const id = `${context}-${date}`\n\n    return new Promise((resolve) => {\n      const request = store.get(id)\n      request.onsuccess = () => resolve(request.result || null)\n      request.onerror = () => resolve(null)\n    })\n  }\n\n  async saveNotes(notes: Note[]): Promise<void> {\n    if (!this.db) return\n\n    const tx = this.db.transaction(['notes'], 'readwrite')\n    const store = tx.objectStore('notes')\n    const now = Date.now()\n\n    notes.forEach(note => {\n      const id = `${note.context}-${note.date}`\n      store.put({\n        ...note,\n        id,\n        _localTimestamp: now,\n        _cachedAt: now,\n        updated_at: note.updated_at || new Date().toISOString()\n      })\n    })\n\n    return new Promise((resolve, reject) => {\n      tx.oncomplete = () => resolve()\n      tx.onerror = () => reject(tx.error)\n    })\n  }\n\n  async getNotesByContext(context: string): Promise<CachedNote[]> {\n    if (!this.db) return []\n\n    const tx = this.db.transaction(['notes'], 'readonly')\n    const store = tx.objectStore('notes')\n\n    return new Promise((resolve) => {\n      const request = store.getAll()\n      request.onsuccess = () => {\n        const allNotes = request.result || []\n        resolve(allNotes.filter(n => n.context === context))\n      }\n      request.onerror = () => resolve([])\n    })\n  }\n\n  async saveContexts(contexts: Context[] | null | undefined): Promise<void> {\n    if (!this.db) return\n\n    // Handle null/undefined contexts\n    if (!contexts || !Array.isArray(contexts)) {\n      console.warn('[Cache] saveContexts called with invalid contexts:', contexts)\n      return\n    }\n\n    const tx = this.db.transaction(['contexts'], 'readwrite')\n    const store = tx.objectStore('contexts')\n\n    contexts.forEach(ctx => {\n      store.put({\n        ...ctx,\n        _localTimestamp: Date.now()\n      })\n    })\n\n    return new Promise((resolve, reject) => {\n      tx.oncomplete = () => resolve()\n      tx.onerror = () => reject(tx.error)\n    })\n  }\n\n  async getContexts(): Promise<CachedContext[]> {\n    if (!this.db) return []\n\n    const tx = this.db.transaction(['contexts'], 'readonly')\n    const store = tx.objectStore('contexts')\n\n    return new Promise((resolve) => {\n      const request = store.getAll()\n      request.onsuccess = () => resolve(request.result || [])\n      request.onerror = () => resolve([])\n    })\n  }\n\n  async deleteNote(context: string, date: string): Promise<void> {\n    if (!this.db) return\n\n    const id = `${context}-${date}`\n\n    // Remove from pending writes if it's there\n    this.pendingWrites.delete(id)\n\n    const tx = this.db.transaction(['notes'], 'readwrite')\n    const store = tx.objectStore('notes')\n\n    store.delete(id)\n\n    return new Promise((resolve, reject) => {\n      tx.oncomplete = () => {\n        console.log(`[Cache] Deleted note: ${id}`)\n        resolve()\n      }\n      tx.onerror = () => reject(tx.error)\n    })\n  }\n\n  async clear(): Promise<void> {\n    if (!this.db) return\n\n    const tx = this.db.transaction(['notes', 'contexts'], 'readwrite')\n\n    tx.objectStore('notes').clear()\n    tx.objectStore('contexts').clear()\n\n    return new Promise((resolve, reject) => {\n      tx.oncomplete = () => resolve()\n      tx.onerror = () => reject(tx.error)\n    })\n  }\n}\n\n// Create singleton instance\nexport const cache = new LocalCache()\n","/**\n * Event Bus\n * Central event system for app-wide communication\n */\n\n// Event detail types\ninterface NoteEventDetail {\n  context: string\n  date: string\n  content?: string\n}\n\ninterface SyncStatusDetail {\n  pending: number\n  syncing: boolean\n}\n\ninterface ErrorEventDetail {\n  message: string\n  error?: Error\n}\n\ninterface SuccessEventDetail {\n  message: string\n}\n\n// Event type mapping\ninterface EventTypeMap {\n  // Notes\n  'note-cached': NoteEventDetail\n  'note-loaded': NoteEventDetail\n  'note-saved': NoteEventDetail\n  'note-changed': NoteEventDetail\n\n  // Sync\n  'sync-status': SyncStatusDetail\n  'operation-synced': { operationId: string }\n  'sync-error': ErrorEventDetail\n\n  // Context\n  'context-changed': { context: string | null }\n  'contexts-loaded': { contexts: any[] }\n\n  // Date\n  'date-changed': { date: string }\n\n  // UI\n  'show-error': ErrorEventDetail\n  'show-success': SuccessEventDetail\n}\n\ntype EventName = keyof EventTypeMap\ntype EventDetail<T extends EventName> = EventTypeMap[T]\n\nclass EventBus extends EventTarget {\n  /**\n   * Emit a typed event\n   */\n  emit<T extends EventName>(eventName: T, detail: EventDetail<T>): void {\n    this.dispatchEvent(new CustomEvent(eventName, { detail }))\n  }\n\n  /**\n   * Listen to a typed event\n   */\n  on<T extends EventName>(\n    eventName: T,\n    callback: (event: CustomEvent<EventDetail<T>>) => void\n  ): () => void {\n    const listener = callback as EventListener\n    this.addEventListener(eventName, listener)\n    return () => this.removeEventListener(eventName, listener)\n  }\n\n  /**\n   * Listen to an event once\n   */\n  once<T extends EventName>(\n    eventName: T,\n    callback: (event: CustomEvent<EventDetail<T>>) => void\n  ): () => void {\n    const listener = callback as EventListener\n    const handler = (event: Event) => {\n      listener(event)\n      this.removeEventListener(eventName, handler)\n    }\n    this.addEventListener(eventName, handler)\n    return () => this.removeEventListener(eventName, handler)\n  }\n}\n\nexport const events = new EventBus()\n\n// Event names for easy reference and autocomplete\nexport const EVENT = {\n  // Notes\n  NOTE_CACHED: 'note-cached' as const,\n  NOTE_LOADED: 'note-loaded' as const,\n  NOTE_SAVED: 'note-saved' as const,\n  NOTE_CHANGED: 'note-changed' as const,\n\n  // Sync\n  SYNC_STATUS: 'sync-status' as const,\n  OPERATION_SYNCED: 'operation-synced' as const,\n  SYNC_ERROR: 'sync-error' as const,\n\n  // Context\n  CONTEXT_CHANGED: 'context-changed' as const,\n  CONTEXTS_LOADED: 'contexts-loaded' as const,\n\n  // Date\n  DATE_CHANGED: 'date-changed' as const,\n\n  // UI\n  SHOW_ERROR: 'show-error' as const,\n  SHOW_SUCCESS: 'show-success' as const\n} as const\n","/**\n * API Client Module\n * Handles all backend communication\n */\n\nimport { state } from '@/utils/state'\nimport { events, EVENT } from '@/utils/events'\nimport type { User, Context, Note, UserSettings } from '@/types'\n\ninterface AuthResponse {\n  authenticated: boolean\n  user?: User\n}\n\ninterface LoginResponse {\n  success: boolean\n  user?: User\n  error?: string\n}\n\ninterface NoteResponse {\n  note: Note\n}\n\ninterface NotesListResponse {\n  notes: Note[]\n  total?: number\n}\n\ninterface ContextsResponse {\n  contexts: Context[]\n}\n\ninterface ServerTimeResponse {\n  serverTime: string\n  offset: number\n}\n\nexport class APIClient {\n  // Base URL is empty string since we use relative paths\n  // private baseUrl = ''\n\n  async request<T = any>(endpoint: string, options: RequestInit = {}): Promise<T> {\n    try {\n      const response = await fetch(endpoint, {\n        ...options,\n        headers: {\n          ...options.headers,\n          'Content-Type': 'application/json'\n        },\n        credentials: 'same-origin'\n      })\n\n      if (!response.ok) {\n        const data = await response.json().catch(() => ({})) as { error?: string }\n\n        if (response.status === 401 || response.status === 403) {\n          if (!state.get('isLoggingOut')) {\n            // Check if this is a note-related request\n            const isNoteRequest = endpoint.includes('/api/notes')\n            const message = isNoteRequest\n              ? 'Session expired. Your notes are saved locally and will sync when you sign in again.'\n              : 'Session expired. Please login again.'\n\n            events.emit(EVENT.SHOW_ERROR, { message })\n            events.emit('session-expired' as any, { isNoteRequest })\n          }\n          state.set('currentUser', null)\n          throw new Error('Session expired')\n        }\n\n        throw new Error(data.error || `Request failed with status ${response.status}`)\n      }\n\n      return await response.json()\n    } catch (error) {\n      if (!state.get('isLoggingOut')) {\n        // Don't show error notification if it's already been handled\n        if (error instanceof Error && !error.message.includes('Session expired')) {\n          events.emit(EVENT.SHOW_ERROR, {\n            message: error.message || 'An error occurred'\n          })\n        }\n      }\n      throw error\n    }\n  }\n\n  // Auth endpoints\n  async checkAuth(): Promise<AuthResponse> {\n    try {\n      const response = await fetch('/api/auth/me')\n      const data = await response.json()\n      return data\n    } catch (error) {\n      console.error('Auth check failed:', error)\n      return { authenticated: false }\n    }\n  }\n\n  async login(accessToken: string, expiresIn?: number): Promise<LoginResponse> {\n    return await this.request<LoginResponse>('/api/auth/login', {\n      method: 'POST',\n      body: JSON.stringify({\n        access_token: accessToken,\n        expires_in: expiresIn || 3600\n      })\n    })\n  }\n\n  async loginWithCode(code: string): Promise<LoginResponse> {\n    return await this.request<LoginResponse>('/api/auth/login', {\n      method: 'POST',\n      body: JSON.stringify({ code })\n    })\n  }\n\n  async logout(): Promise<void> {\n    await this.request('/api/auth/logout', {\n      method: 'POST'\n    })\n  }\n\n  // Contexts endpoints\n  async getContexts(): Promise<ContextsResponse> {\n    return await this.request<ContextsResponse>('/api/contexts')\n  }\n\n  async createContext(data: { name: string; color?: string }): Promise<Context> {\n    return await this.request<Context>('/api/contexts', {\n      method: 'POST',\n      body: JSON.stringify(data)\n    })\n  }\n\n  async updateContext(id: string, data: { name?: string; color?: string }): Promise<Context> {\n    return await this.request<Context>(`/api/contexts/${id}`, {\n      method: 'PUT',\n      body: JSON.stringify(data)\n    })\n  }\n\n  async deleteContext(id: string): Promise<void> {\n    await this.request(`/api/contexts/${id}`, {\n      method: 'DELETE'\n    })\n  }\n\n  // Notes endpoints\n  async getNote(context: string, date: string): Promise<NoteResponse> {\n    return await this.request<NoteResponse>(\n      `/api/notes?context=${encodeURIComponent(context)}&date=${date}`\n    )\n  }\n\n  async saveNote(data: { context: string; date: string; content: string; updated_at?: string }): Promise<Note> {\n    return await this.request<Note>('/api/notes', {\n      method: 'POST',\n      body: JSON.stringify(data)\n    })\n  }\n\n  async getNotesList(context: string, limit = 50, offset = 0): Promise<NotesListResponse> {\n    return await this.request<NotesListResponse>(\n      `/api/notes/list?context=${encodeURIComponent(context)}&limit=${limit}&offset=${offset}`\n    )\n  }\n\n  async deleteNote(context: string, date: string): Promise<void> {\n    const encodedContext = encodeURIComponent(context)\n    const encodedDate = encodeURIComponent(date)\n\n    await this.request(`/api/notes/${encodedContext}/${encodedDate}`, {\n      method: 'DELETE'\n    })\n  }\n\n  // Settings endpoints\n  async updateSettings(settings: Partial<UserSettings>): Promise<UserSettings> {\n    return await this.request<UserSettings>('/api/settings', {\n      method: 'PUT',\n      body: JSON.stringify(settings)\n    })\n  }\n\n  // Time sync\n  async getServerTime(timezone: string): Promise<ServerTimeResponse> {\n    const response = await fetch(`/api/time?timezone=${encodeURIComponent(timezone)}`)\n    return await response.json()\n  }\n}\n\nexport const api = new APIClient()\n","/**\n * Authentication Module\n * Handles Google OAuth and session management\n */\n\nimport { state } from '@/utils/state'\nimport { api } from './api'\nimport { events, EVENT } from '@/utils/events'\n\n// Google OAuth types\ndeclare global {\n  interface Window {\n    google?: {\n      accounts: {\n        oauth2: {\n          initCodeClient: (config: {\n            client_id: string\n            scope: string\n            ux_mode: string\n            callback: (response: { code?: string; error?: string }) => void\n          }) => {\n            requestCode: () => void\n          }\n        }\n      }\n    }\n  }\n}\n\ninterface CodeClient {\n  requestCode: () => void\n}\n\ninterface AuthCodeResponse {\n  code?: string\n  error?: string\n}\n\nclass AuthManager {\n  private codeClient: CodeClient | null = null\n  private initializationPromise: Promise<void> | null = null\n\n  async checkAuth(): Promise<boolean> {\n    const data = await api.checkAuth()\n\n    if (data.authenticated && data.user) {\n      state.update({\n        currentUser: data.user,\n        userSettings: data.user.settings || {\n          theme: 'dark',\n          weekStart: 0,\n          timezone: 'UTC',\n          dateFormat: 'DD-MM-YY',\n          uniqueContextMode: false,\n          showBreadcrumb: false,\n          showMarkdownEditor: false,\n          hideNewContextButton: false\n        }\n      })\n      return true\n    }\n\n    return false\n  }\n\n  async initGoogleClient(clientId: string): Promise<void> {\n    // Return existing initialization promise if already in progress\n    if (this.initializationPromise) {\n      return this.initializationPromise\n    }\n\n    // Return immediately if already initialized\n    if (this.codeClient) {\n      return Promise.resolve()\n    }\n\n    // Create initialization promise\n    this.initializationPromise = new Promise((resolve, reject) => {\n      // Wait for Google API to be loaded\n      const checkGoogleLoaded = () => {\n        if (window.google?.accounts?.oauth2) {\n          try {\n            // Use initCodeClient to get authorization code (which provides refresh token)\n            this.codeClient = window.google.accounts.oauth2.initCodeClient({\n              client_id: clientId,\n              scope: 'https://www.googleapis.com/auth/drive.file https://www.googleapis.com/auth/userinfo.email',\n              ux_mode: 'popup',\n              callback: (response) => this.handleAuthCodeResponse(response)\n            })\n            console.log('[AUTH] Google code client initialized successfully')\n            resolve()\n          } catch (error) {\n            console.error('[AUTH] Failed to initialize Google client:', error)\n            reject(error)\n          }\n        } else {\n          // Retry after a short delay\n          setTimeout(checkGoogleLoaded, 100)\n        }\n      }\n\n      // Start checking\n      checkGoogleLoaded()\n\n      // Set a timeout to prevent infinite waiting\n      setTimeout(() => {\n        if (!this.codeClient) {\n          reject(new Error('Google API failed to load within timeout'))\n        }\n      }, 10000) // 10 second timeout\n    })\n\n    return this.initializationPromise\n  }\n\n  async handleAuthCodeResponse(response: AuthCodeResponse): Promise<void> {\n    const loader = document.getElementById('landing-loader')\n\n    if (response.error) {\n      if (loader) loader.classList.remove('visible')\n      events.emit(EVENT.SHOW_ERROR, {\n        message: 'OAuth failed: ' + response.error\n      })\n      return\n    }\n\n    if (!response.code) {\n      if (loader) loader.classList.remove('visible')\n      events.emit(EVENT.SHOW_ERROR, {\n        message: 'OAuth failed: No code received'\n      })\n      return\n    }\n\n    try {\n      // Send authorization code to backend to exchange for tokens\n      const data = await api.loginWithCode(response.code)\n\n      if (data.success && data.user) {\n        console.log('[AUTH] Login successful, updating state')\n        console.log('[AUTH] Received hasNoContexts:', (data.user as any).hasNoContexts)\n\n        state.update({\n          currentUser: data.user,\n          userSettings: data.user.settings || {\n            theme: 'dark',\n            weekStart: 0,\n            timezone: 'UTC',\n            dateFormat: 'DD-MM-YY',\n            uniqueContextMode: false,\n            showBreadcrumb: false,\n            showMarkdownEditor: false,\n            hideNewContextButton: false\n          }\n        })\n\n        console.log('[AUTH] Emitting auth-success event')\n        // Emit event for UI to react (loader will be hidden by showApp)\n        events.emit('auth-success' as any, {})\n      } else {\n        if (loader) loader.classList.remove('visible')\n        events.emit(EVENT.SHOW_ERROR, {\n          message: data.error || 'Login failed'\n        })\n      }\n    } catch (error) {\n      if (loader) loader.classList.remove('visible')\n      const message = error instanceof Error ? error.message : 'Unknown error'\n      events.emit(EVENT.SHOW_ERROR, {\n        message: 'Login failed: ' + message\n      })\n    }\n  }\n\n  async signIn(): Promise<void> {\n    // Show loading indicator immediately\n    const loader = document.getElementById('landing-loader')\n    if (loader) loader.classList.add('visible')\n\n    try {\n      // Wait for initialization to complete if not already done\n      await this.initializationPromise\n\n      if (!this.codeClient) {\n        throw new Error('Google client not initialized')\n      }\n\n      // Request authorization code (will trigger popup)\n      this.codeClient.requestCode()\n    } catch (error) {\n      console.error('[AUTH] Sign in failed:', error)\n      if (loader) loader.classList.remove('visible')\n      events.emit(EVENT.SHOW_ERROR, {\n        message: 'Failed to initialize Google sign-in. Please refresh the page.'\n      })\n    }\n  }\n\n  signOut(): void {\n    console.log('[AUTH] Starting logout...')\n\n    // Call logout endpoint (don't wait for response)\n    fetch('/api/auth/logout', {\n      method: 'POST',\n      credentials: 'same-origin'\n    })\n      .then(() => {\n        console.log('[AUTH] Logout endpoint called')\n      })\n      .catch(err => {\n        console.error('[AUTH] Logout endpoint error:', err)\n      })\n\n    // Clear localStorage and sessionStorage\n    console.log('[AUTH] Clearing storage...')\n    try {\n      localStorage.clear()\n      sessionStorage.clear()\n    } catch (e) {\n      console.error('[AUTH] Storage clear error:', e)\n    }\n\n    // Force reload immediately\n    console.log('[AUTH] Forcing reload...')\n    setTimeout(() => {\n      window.location.href = '/'\n      // Fallback in case href doesn't work\n      setTimeout(() => window.location.reload(), 100)\n    }, 50)\n  }\n\n  async clearAllCaches(): Promise<void> {\n    try {\n      // Clear IndexedDB\n      const dbName = 'DailyNotesDB'\n      const deleteRequest = indexedDB.deleteDatabase(dbName)\n\n      await new Promise<void>((resolve) => {\n        deleteRequest.onsuccess = () => {\n          console.log('[AUTH] IndexedDB cleared')\n          resolve()\n        }\n        deleteRequest.onerror = () => {\n          console.warn('[AUTH] Failed to clear IndexedDB')\n          resolve() // Continue even if this fails\n        }\n      })\n\n      // Clear all Service Worker caches\n      if ('caches' in window) {\n        const cacheNames = await caches.keys()\n        await Promise.all(\n          cacheNames.map(cacheName => {\n            console.log('[AUTH] Deleting cache:', cacheName)\n            return caches.delete(cacheName)\n          })\n        )\n        console.log('[AUTH] All Service Worker caches cleared')\n      }\n\n      // Clear localStorage and sessionStorage\n      localStorage.clear()\n      sessionStorage.clear()\n      console.log('[AUTH] Storage cleared')\n    } catch (error) {\n      console.error('[AUTH] Error clearing caches:', error)\n      // Don't throw - we still want to complete logout\n    }\n  }\n}\n\nexport const auth = new AuthManager()\n\n// Expose auth functions globally for onclick handlers in HTML\nif (typeof window !== 'undefined') {\n  (window as any).signInWithGoogle = () => auth.signIn()\n}\n","/**\n * Notes Module\n * Handles note loading, saving, and listing\n */\n\nimport { state } from '@/utils/state'\nimport { api } from './api'\nimport { cache } from '@/utils/cache'\nimport { events, EVENT } from '@/utils/events'\nimport type { Note } from '@/types'\n\nclass NotesManager {\n  private saveTimeout: number | null = null\n  private currentNoteContent = ''\n  private currentLoadToken = 0 // Token to cancel old load operations\n  private currentSelectToken = 0 // Token to cancel old date selection operations\n\n  async loadNote(context: string, date: string): Promise<Note | null> {\n    if (!context || !date) {\n      return null\n    }\n\n    // Increment token to cancel any previous load operations\n    const loadToken = ++this.currentLoadToken\n    console.log(`[Notes] loadNote started - token: ${loadToken}, context: ${context}, date: ${date}`)\n\n    // Try local cache first (instant load)\n    const cachedNote = await cache.getNote(context, date)\n\n    // Validate token before emitting cached content\n    if (loadToken !== this.currentLoadToken) {\n      console.log(`[Notes] Load cancelled (cache) - token ${loadToken} is stale`)\n      return null\n    }\n\n    if (cachedNote && cachedNote.content) {\n      // Only emit if cache has actual content\n      this.currentNoteContent = cachedNote.content\n      events.emit(EVENT.NOTE_LOADED, {\n        context,\n        date,\n        content: this.currentNoteContent\n      })\n    } else {\n      // No cached note or empty content - show blank editor immediately\n      this.currentNoteContent = ''\n      events.emit(EVENT.NOTE_LOADED, {\n        context,\n        date,\n        content: ''\n      })\n    }\n\n    // Then load from server in background\n    try {\n      const { note } = await api.getNote(context, date)\n\n      // Validate token before applying server data\n      if (loadToken !== this.currentLoadToken) {\n        console.log(`[Notes] Load cancelled (server) - token ${loadToken} is stale`)\n        return null\n      }\n\n      // Determine which version is more recent\n      const serverUpdatedAt = note.updated_at ? new Date(note.updated_at).getTime() : 0\n      const cachedUpdatedAt = cachedNote?.updated_at ? new Date(cachedNote.updated_at).getTime() : 0\n\n      // Only update if server has newer content OR cache is empty\n      const shouldUpdateFromServer =\n        !cachedNote ||\n        serverUpdatedAt > cachedUpdatedAt ||\n        (note.content && !cachedNote.content)\n\n      if (shouldUpdateFromServer) {\n        this.currentNoteContent = note.content || ''\n\n        // Update cache with server data\n        await cache.saveNote({\n          ...note,\n          context,\n          date,\n          content: note.content,\n          updated_at: note.updated_at\n        })\n\n        // Only emit if content actually changed\n        if (!cachedNote || cachedNote.content !== note.content) {\n          events.emit(EVENT.NOTE_LOADED, {\n            context,\n            date,\n            content: this.currentNoteContent\n          })\n        }\n      } else {\n        console.log('[Notes] Cache is newer than server, keeping cached version')\n      }\n\n      return note\n    } catch (error) {\n      // Validate token before handling error\n      if (loadToken !== this.currentLoadToken) {\n        console.log(`[Notes] Load cancelled (error) - token ${loadToken} is stale`)\n        return null\n      }\n\n      // If cached version exists, user already sees it\n      if (!cachedNote) {\n        console.error('Failed to load note:', error)\n        events.emit(EVENT.SHOW_ERROR, {\n          message: 'Failed to load note. Working offline.'\n        })\n      } else {\n        console.warn('[Notes] Server unavailable, using cached version')\n      }\n      return cachedNote\n    }\n  }\n\n  async saveNote(context: string, date: string, content: string): Promise<void> {\n    if (!context || !date) return\n\n    console.log(`[Notes] saveNote called - context: ${context}, date: ${date}, content length: ${content.length}`)\n\n    const now = new Date().toISOString()\n    const note = {\n      context,\n      date,\n      content,\n      updated_at: now\n    }\n\n    // 1. Save to local cache immediately (optimistic)\n    await cache.saveNote(note as Note)\n    this.currentNoteContent = content\n\n    console.log(`[Notes] Saved to cache and updated currentNoteContent`)\n\n    events.emit(EVENT.NOTE_SAVED, { context, date, content })\n\n    // 2. Update note in the list (update content, keep position)\n    this.updateNoteInList(context, date, content)\n\n    // 3. Sync to server immediately (backend will handle Drive sync)\n    console.log(`[Notes] Syncing to server - content length: ${content.length}`)\n    try {\n      await api.saveNote({ context, date, content, updated_at: now })\n      console.log(`[Notes] Successfully synced to server`)\n    } catch (error) {\n      console.error('[Notes] Failed to sync to server:', error)\n      // Note is still saved locally in cache, will retry on next app load\n    }\n  }\n\n  async loadNotesList(context: string, limit = 50, offset = 0): Promise<Note[]> {\n    if (!context) {\n      state.update({\n        notes: [],\n        notesWithDates: []\n      })\n      return []\n    }\n\n    try {\n      const data = await api.getNotesList(context, limit, offset)\n      const serverNotes = data.notes || []\n\n      // Get cached notes from IndexedDB for this context\n      const cachedNotes = await cache.getNotesByContext(context)\n\n      // Merge: prioritize server notes, but include cached notes not on server\n      const noteMap = new Map<string, Note>()\n\n      // Add all server notes first (authoritative)\n      serverNotes.forEach(note => {\n        noteMap.set(note.date, note)\n      })\n\n      // Add cached notes that don't exist on server (local-only or pending sync)\n      cachedNotes.forEach(note => {\n        if (!noteMap.has(note.date)) {\n          noteMap.set(note.date, note)\n        }\n      })\n\n      // Convert back to array and sort by date (newest first)\n      const mergedNotes = Array.from(noteMap.values()).sort((a, b) => {\n        return b.date.localeCompare(a.date)\n      })\n\n      const notesWithDates = mergedNotes.map(note => note.date)\n\n      state.update({\n        notes: mergedNotes,\n        notesWithDates\n      })\n\n      return mergedNotes\n    } catch (error) {\n      console.error('Failed to load notes list:', error)\n      return []\n    }\n  }\n\n  async refreshNotesList(context: string): Promise<void> {\n    await this.loadNotesList(context)\n  }\n\n  updateNoteInList(context: string, date: string, content: string): void {\n    const notes = state.get('notes')\n\n    // Find and update the note\n    const updatedNotes = notes.map(note => {\n      if (note.date === date && note.context === context) {\n        return {\n          ...note,\n          content: content,\n          updated_at: new Date().toISOString()\n        }\n      }\n      return note\n    })\n\n    // Update state\n    state.set('notes', updatedNotes)\n  }\n\n  ensureNoteInList(context: string, date: string): void {\n    const notes = state.get('notes')\n    const notesWithDates = state.get('notesWithDates')\n\n    // Check if note already exists in the list\n    const noteExists = notes.some(note => note.date === date)\n\n    if (!noteExists) {\n      // Create a placeholder note in the list\n      const newNote: Note = {\n        id: `temp-${context}-${date}`,\n        user_id: state.get('currentUser')?.id || '',\n        context: context,\n        date: date,\n        content: '',\n        created_at: new Date().toISOString(),\n        updated_at: new Date().toISOString()\n      }\n\n      // Add to notes list and sort by date (newest first)\n      const updatedNotes = [...notes, newNote].sort((a, b) => {\n        return b.date.localeCompare(a.date)\n      })\n\n      // Add to dates list\n      const updatedNotesWithDates = [...notesWithDates, date]\n\n      // Update state\n      state.update({\n        notes: updatedNotes,\n        notesWithDates: updatedNotesWithDates\n      })\n    }\n  }\n\n  handleNoteInput(content: string): void {\n    if (this.saveTimeout) {\n      clearTimeout(this.saveTimeout)\n    }\n\n    // Update current content IMMEDIATELY to track user input\n    this.currentNoteContent = content\n\n    // Capture current context and date at the time of input\n    const capturedContext = state.get('selectedContext')\n    const capturedDate = state.get('selectedDate')\n\n    if (!capturedContext || !capturedDate) return\n\n    // Debounce save - reduced from 1000ms to 500ms for better UX\n    this.saveTimeout = window.setTimeout(() => {\n      // Re-validate that context and date haven't changed\n      const currentContext = state.get('selectedContext')\n      const currentDate = state.get('selectedDate')\n\n      // Only save if context/date haven't changed\n      // We don't check content anymore because currentNoteContent is updated immediately\n      if (currentContext === capturedContext && currentDate === capturedDate) {\n        console.log(`[Notes] Saving note - context: ${capturedContext}, date: ${capturedDate}`)\n        // Use the LATEST content from currentNoteContent, not the captured one\n        this.saveNote(capturedContext, capturedDate, this.currentNoteContent)\n      } else {\n        console.log(\n          `[Notes] Save cancelled - context/date changed from ${capturedContext}/${capturedDate} to ${currentContext}/${currentDate}`\n        )\n      }\n    }, 500)\n  }\n\n  async selectDate(dateStr: string): Promise<void> {\n    // Increment token to cancel any previous select operations\n    const selectToken = ++this.currentSelectToken\n    console.log(`[Notes] selectDate started - token: ${selectToken}, date: ${dateStr}`)\n\n    const context = state.get('selectedContext')\n\n    // Parse the date\n    const dateParts = dateStr.split('-')\n    const year = parseInt(dateParts[0])\n    const month = parseInt(dateParts[1]) - 1\n\n    // Update calendar month to show the selected date\n    state.update({\n      selectedDate: dateStr,\n      currentCalendarMonth: month,\n      currentCalendarYear: year\n    })\n\n    // Validate token before proceeding\n    if (selectToken !== this.currentSelectToken) {\n      console.log(`[Notes] selectDate cancelled - token ${selectToken} is stale`)\n      return\n    }\n\n    events.emit(EVENT.DATE_CHANGED, { date: dateStr })\n\n    // Load note for this date\n    if (context) {\n      // Validate token again before loading\n      if (selectToken !== this.currentSelectToken) {\n        console.log(`[Notes] selectDate cancelled before load - token ${selectToken} is stale`)\n        return\n      }\n\n      // Create note in local list immediately if it doesn't exist\n      this.ensureNoteInList(context, dateStr)\n      await this.loadNote(context, dateStr)\n    }\n  }\n\n  setTodayDate(): void {\n    const dateStr = (state as any).get('today') as string\n    const [year, month] = dateStr.split('-').map(Number)\n\n    state.update({\n      selectedDate: dateStr,\n      currentCalendarMonth: month - 1,\n      currentCalendarYear: year\n    })\n  }\n\n  getCurrentNoteContent(): string {\n    return this.currentNoteContent\n  }\n\n  async deleteNote(context: string, date: string): Promise<void> {\n    if (!context || !date) return\n\n    console.log(`[Notes] Deleting note - context: ${context}, date: ${date}`)\n\n    // Cancel any pending save operations for this note\n    if (this.saveTimeout) {\n      clearTimeout(this.saveTimeout)\n      this.saveTimeout = null\n      console.log('[Notes] Cancelled pending save operation')\n    }\n\n    // 1. Remove from local cache immediately (optimistic)\n    await cache.deleteNote(context, date)\n\n    // 2. Remove from the notes list in state\n    const notes = state.get('notes')\n    const updatedNotes = notes.filter(note => !(note.date === date && note.context === context))\n\n    const notesWithDates = state.get('notesWithDates')\n    const updatedNotesWithDates = notesWithDates.filter(d => d !== date)\n\n    state.update({\n      notes: updatedNotes,\n      notesWithDates: updatedNotesWithDates\n    })\n\n    // 3. If the deleted note was currently selected, clear the editor and select another note\n    const selectedDate = state.get('selectedDate')\n    if (selectedDate === date) {\n      // Clear current note content IMMEDIATELY to prevent race conditions\n      this.currentNoteContent = ''\n\n      // Select the most recent note or today\n      if (updatedNotes.length > 0) {\n        // Select the first note (most recent)\n        const nextNote = updatedNotes[0]\n        await this.selectDate(nextNote.date)\n      } else {\n        // No notes left, select today and clear editor\n        this.setTodayDate()\n        events.emit(EVENT.NOTE_LOADED, {\n          context,\n          date,\n          content: ''\n        })\n      }\n    }\n\n    // 4. Sync deletion to server immediately (backend will handle Drive sync)\n    try {\n      await api.deleteNote(context, date)\n      console.log('[Notes] Note deleted from server')\n    } catch (error) {\n      console.error('[Notes] Failed to delete note from server:', error)\n      // Note is still deleted locally, server will sync on next app load\n    }\n\n    console.log('[Notes] Note deleted locally and synced')\n  }\n}\n\nexport const notes = new NotesManager()\n","/**\n * Contexts Module\n * Handles context (project) management\n */\n\nimport { state } from '@/utils/state'\nimport { api } from './api'\nimport { cache } from '@/utils/cache'\nimport { events, EVENT } from '@/utils/events'\nimport type { Context } from '@/types'\n\nclass ContextsManager {\n  async loadContexts(): Promise<void> {\n    // Try local cache first (instant)\n    const cachedContexts = await cache.getContexts()\n    console.log('[CONTEXTS] Cached contexts:', cachedContexts)\n    if (cachedContexts.length > 0) {\n      state.set('contexts', cachedContexts)\n    }\n\n    // Load from server in background\n    try {\n      console.log('[CONTEXTS] Fetching contexts from server...')\n      const response = await api.getContexts()\n      console.log('[CONTEXTS] Server response:', response)\n      // Handle null/undefined contexts gracefully\n      const contexts = response?.contexts || []\n      console.log('[CONTEXTS] Parsed contexts:', contexts)\n      await cache.saveContexts(contexts)\n      state.set('contexts', contexts)\n      events.emit(EVENT.CONTEXTS_LOADED, { contexts })\n    } catch (error) {\n      console.error('[CONTEXTS] Failed to load contexts from server:', error)\n      // Only show error if we have no contexts at all AND it's a real network error\n      if (cachedContexts.length === 0 && !navigator.onLine) {\n        events.emit(EVENT.SHOW_ERROR, {\n          message: 'Failed to load contexts. Working offline.'\n        })\n      }\n      // If online but failed, don't show error - user might just have 0 contexts\n    }\n  }\n\n  async createContext(name: string, color?: string): Promise<Context> {\n    const newContext: Context = {\n      id: `temp-${Date.now()}`,\n      user_id: state.get('currentUser')?.id || '',\n      name,\n      color: color || 'primary',\n      created_at: new Date().toISOString()\n    }\n\n    // 1. Update UI immediately (optimistic)\n    const currentContexts = state.get('contexts')\n    const updatedContexts = [...currentContexts, newContext]\n\n    await cache.saveContexts(updatedContexts)\n    state.set('contexts', updatedContexts)\n    state.set('selectedContext', name)\n\n    // 2. Sync to server immediately\n    try {\n      await api.createContext({ name, color })\n      console.log('[CONTEXTS] Successfully synced new context to server')\n      // Reload contexts to get server-assigned ID\n      await this.loadContexts()\n    } catch (error) {\n      console.error('[CONTEXTS] Failed to sync context to server:', error)\n      // Context is still saved locally, will retry on next app load\n    }\n\n    return newContext\n  }\n\n  async updateContext(contextId: string, name: string, color: string): Promise<boolean> {\n    try {\n      await api.updateContext(contextId, { name, color })\n\n      // Update local state\n      const currentContexts = state.get('contexts')\n      const updatedContexts = currentContexts.map(c => (c.id === contextId ? { ...c, name, color } : c))\n\n      await cache.saveContexts(updatedContexts)\n      state.set('contexts', updatedContexts)\n\n      // Update selected context if it was the one being edited\n      const selectedContext = state.get('selectedContext')\n      const oldContext = currentContexts.find(c => c.id === contextId)\n      if (selectedContext === oldContext?.name) {\n        state.set('selectedContext', name)\n        localStorage.setItem('lastContext', name)\n      }\n\n      events.emit(EVENT.SHOW_SUCCESS, { message: 'Context updated successfully' })\n      return true\n    } catch (error) {\n      events.emit(EVENT.SHOW_ERROR, { message: 'Failed to update context' })\n      return false\n    }\n  }\n\n  async deleteContext(contextId: string): Promise<void> {\n    try {\n      await api.deleteContext(contextId)\n\n      const currentContexts = state.get('contexts')\n      const updatedContexts = currentContexts.filter(c => c.id !== contextId)\n\n      await cache.saveContexts(updatedContexts)\n      state.set('contexts', updatedContexts)\n\n      events.emit(EVENT.SHOW_SUCCESS, { message: 'Context deleted successfully' })\n    } catch (error) {\n      events.emit(EVENT.SHOW_ERROR, { message: 'Failed to delete context' })\n    }\n  }\n\n  selectContext(contextName: string | null): void {\n    state.set('selectedContext', contextName)\n    events.emit(EVENT.CONTEXT_CHANGED, { context: contextName })\n\n    // Save last used context to localStorage\n    if (contextName) {\n      localStorage.setItem('lastContext', contextName)\n    }\n  }\n\n  getSelectedContext(): string | null {\n    return state.get('selectedContext')\n  }\n\n  getContextColor(contextName: string): string {\n    const contexts = state.get('contexts')\n    const context = contexts.find(c => c.name === contextName)\n    // Normalize old hex colors\n    const color = context?.color || 'primary'\n    const bulmaColors = ['text', 'link', 'primary', 'info', 'success', 'warning', 'danger']\n    return bulmaColors.includes(color) ? color : 'primary'\n  }\n\n  restoreLastContext(): string | null {\n    const contexts = state.get('contexts')\n    const settings = state.get('userSettings')\n    const uniqueContextMode = settings.uniqueContextMode || false\n\n    console.log('[CONTEXTS] restoreLastContext - contexts:', contexts)\n    console.log('[CONTEXTS] uniqueContextMode:', uniqueContextMode)\n\n    // If no contexts available, return null\n    if (!contexts || contexts.length === 0) {\n      console.log('[CONTEXTS] No contexts available')\n      return null\n    }\n\n    // If unique context mode is enabled, always select first context\n    if (uniqueContextMode) {\n      const firstContext = contexts[0].name\n      console.log('[CONTEXTS] Unique context mode - selecting first context:', firstContext)\n      this.selectContext(firstContext)\n      return firstContext\n    }\n\n    const lastContext = localStorage.getItem('lastContext')\n    console.log('[CONTEXTS] lastContext from localStorage:', lastContext)\n\n    // Try to restore last used context\n    if (lastContext) {\n      const contextExists = contexts.some(c => c.name === lastContext)\n      console.log('[CONTEXTS] lastContext exists?', contextExists)\n      if (contextExists) {\n        console.log('[CONTEXTS] Selecting last context:', lastContext)\n        this.selectContext(lastContext)\n        return lastContext\n      }\n    }\n\n    // If no last context or it doesn't exist, select first context\n    const firstContext = contexts[0].name\n    console.log('[CONTEXTS] Selecting first context:', firstContext)\n    this.selectContext(firstContext)\n    return firstContext\n  }\n}\n\nexport const contexts = new ContextsManager()\n","/**\n * Calendar Module\n * Handles calendar rendering and navigation\n */\n\nimport { state } from '@/utils/state'\nimport { notes } from '@/services/notes'\n\nclass Calendar {\n  private monthNames = [\n    'January',\n    'February',\n    'March',\n    'April',\n    'May',\n    'June',\n    'July',\n    'August',\n    'September',\n    'October',\n    'November',\n    'December'\n  ]\n  private dayNamesDefault = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat']\n\n  render(): void {\n    const settings = state.get('userSettings')\n    const weekStart = settings.weekStart || 0\n    const month = state.get('currentCalendarMonth')\n    const year = state.get('currentCalendarYear')\n    const selectedDate = state.get('selectedDate')\n    const today = (state as any).get('today') as string\n    const notesWithDates = state.get('notesWithDates')\n\n    const dayNames = [\n      ...this.dayNamesDefault.slice(weekStart),\n      ...this.dayNamesDefault.slice(0, weekStart)\n    ]\n\n    const monthYearEl = document.getElementById('calendar-month-year')\n    if (monthYearEl) {\n      monthYearEl.textContent = `${this.monthNames[month]} ${year}`\n    }\n\n    const firstDayOfMonth = new Date(year, month, 1).getDay()\n    const adjustedFirstDay = (firstDayOfMonth - weekStart + 7) % 7\n    const daysInMonth = new Date(year, month + 1, 0).getDate()\n    const daysInPrevMonth = new Date(year, month, 0).getDate()\n\n    const grid = document.getElementById('calendar-grid')\n    if (!grid) return\n\n    // Render day headers\n    let html = dayNames.map(day => `<div class=\"calendar-day-header\">${day}</div>`).join('')\n\n    // Render previous month's trailing days\n    for (let i = adjustedFirstDay - 1; i >= 0; i--) {\n      const day = daysInPrevMonth - i\n      html += `<div class=\"calendar-day other-month\">${day}</div>`\n    }\n\n    // Render current month's days\n    for (let day = 1; day <= daysInMonth; day++) {\n      const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`\n      const classes = ['calendar-day']\n\n      if (dateStr === today) classes.push('today')\n      if (dateStr === selectedDate) classes.push('selected')\n      if (notesWithDates.includes(dateStr)) classes.push('has-note')\n\n      html += `<div class=\"${classes.join(' ')}\" data-date=\"${dateStr}\">${day}</div>`\n    }\n\n    // Render next month's leading days\n    const totalCells = adjustedFirstDay + daysInMonth\n    const remainingCells = totalCells % 7 === 0 ? 0 : 7 - (totalCells % 7)\n    for (let day = 1; day <= remainingCells; day++) {\n      html += `<div class=\"calendar-day other-month\">${day}</div>`\n    }\n\n    grid.innerHTML = html\n\n    // Add click handlers\n    grid.querySelectorAll('.calendar-day:not(.other-month)').forEach(dayEl => {\n      dayEl.addEventListener('click', () => {\n        const dateStr = (dayEl as HTMLElement).dataset.date\n        if (dateStr) {\n          notes.selectDate(dateStr)\n        }\n      })\n    })\n  }\n\n  prevMonth(): void {\n    let month = state.get('currentCalendarMonth')\n    let year = state.get('currentCalendarYear')\n\n    month--\n    if (month < 0) {\n      month = 11\n      year--\n    }\n\n    state.update({\n      currentCalendarMonth: month,\n      currentCalendarYear: year\n    })\n\n    this.render()\n  }\n\n  nextMonth(): void {\n    let month = state.get('currentCalendarMonth')\n    let year = state.get('currentCalendarYear')\n\n    month++\n    if (month > 11) {\n      month = 0\n      year++\n    }\n\n    state.update({\n      currentCalendarMonth: month,\n      currentCalendarYear: year\n    })\n\n    this.render()\n  }\n\n  goToToday(): void {\n    const today = (state as any).get('today') as string\n    notes.selectDate(today)\n  }\n}\n\nexport const calendar = new Calendar()\n","/**\n * Markdown Editor Module\n * Modern WYSIWYG markdown editor using Quill\n */\n\nimport { state } from '@/utils/state'\n\n// Quill types\ndeclare global {\n  interface Window {\n    Quill?: any\n  }\n}\n\ninterface QuillDelta {\n  ops: QuillOp[]\n}\n\ninterface QuillOp {\n  insert: string | object\n  attributes?: Record<string, any>\n}\n\nclass MarkdownEditor {\n  private container: HTMLElement | null = null\n  private editor: any = null\n  private editorElement: HTMLElement | null = null\n  private onChangeCallback: ((content: string) => void) | null = null\n  private isUpdating = false\n  private currentNoteContent = ''\n  private updateTimeout: number | null = null\n  private contentVersion = 0 // Track version to ignore stale events\n\n  async init(containerId: string, onChange: (content: string) => void): Promise<void> {\n    this.container = document.getElementById(containerId)\n    if (!this.container) {\n      console.error('[MarkdownEditor] Container not found:', containerId)\n      return\n    }\n\n    this.onChangeCallback = onChange\n\n    // Don't load Quill yet - wait until actually needed (lazy loading)\n    // This saves ~300KB on initial page load\n    this.container.innerHTML =\n      '<div style=\"padding: 1rem; color: var(--bulma-text-light); opacity: 0.6;\">Editor loading...</div>'\n  }\n\n  async ensureQuillLoaded(): Promise<void> {\n    // Only load Quill when first needed\n    if (!this.editor) {\n      await this.loadQuill()\n      this.render()\n      this.initQuill()\n    }\n  }\n\n  private async loadQuill(): Promise<void> {\n    if (window.Quill) return\n\n    // Load Quill CSS locally\n    const css = document.createElement('link')\n    css.rel = 'stylesheet'\n    css.href = '/static/vendor/quill/quill.snow.css'\n    document.head.appendChild(css)\n\n    // Load Quill JS locally\n    const script = document.createElement('script')\n    script.src = '/static/vendor/quill/quill.min.js'\n    document.head.appendChild(script)\n\n    // Wait for Quill to load\n    await new Promise<void>(resolve => {\n      script.onload = () => resolve()\n    })\n  }\n\n  private render(): void {\n    if (!this.container) return\n\n    this.container.innerHTML = `\n      <div class=\"quill-editor-wrapper\">\n        <div id=\"quill-editor\"></div>\n      </div>\n    `\n\n    this.editorElement = document.getElementById('quill-editor')\n  }\n\n  private initQuill(): void {\n    if (!window.Quill) {\n      console.error('[MarkdownEditor] Quill not loaded')\n      return\n    }\n\n    try {\n      this.editor = new window.Quill(this.editorElement, {\n        theme: 'snow',\n        modules: {\n          toolbar: [\n            [{ header: [1, 2, 3, false] }],\n            ['bold', 'italic', 'strike'],\n            [{ list: 'ordered' }, { list: 'bullet' }],\n            ['blockquote', 'code-block'],\n            ['link'],\n            ['clean']\n          ]\n        },\n        placeholder: 'Start writing your notes...',\n        formats: ['bold', 'italic', 'strike', 'header', 'list', 'code-block', 'blockquote', 'link']\n      })\n\n      // Listen for text changes\n      this.editor.on('text-change', () => {\n        if (this.isUpdating) return\n\n        if (this.onChangeCallback) {\n          const markdown = this.getMarkdown()\n          this.onChangeCallback(markdown)\n        }\n      })\n\n      // Force placeholder to hide on focus when editor is empty\n      this.editor.root.addEventListener('focus', () => {\n        if (this.editor.getText().trim() === '') {\n          this.editor.root.dataset.placeholder = ''\n        }\n      })\n\n      // Restore placeholder on blur if editor is still empty\n      this.editor.root.addEventListener('blur', () => {\n        if (this.editor.getText().trim() === '') {\n          this.editor.root.dataset.placeholder = 'Start writing your notes...'\n        }\n      })\n\n      // Apply toolbar visibility based on user settings after initialization\n      this.applyToolbarVisibility()\n    } catch (error) {\n      console.error('[MarkdownEditor] Error initializing editor:', error)\n    }\n  }\n\n  private applyToolbarVisibility(): void {\n    const settings = state.get('userSettings')\n    const showMarkdownEditor = settings.showMarkdownEditor === true\n\n    const toolbar = this.container?.querySelector('.ql-toolbar') as HTMLElement\n    if (toolbar) {\n      toolbar.style.display = showMarkdownEditor ? '' : 'none'\n    }\n\n    // Editor enabled state should be based on context selection only\n    // Toolbar visibility is separate from editor interactivity\n    if (this.editor) {\n      const context = state.get('selectedContext')\n      this.editor.enable(context ? true : false)\n    }\n  }\n\n  private getMarkdown(): string {\n    if (!this.editor) return ''\n\n    const delta = this.editor.getContents()\n    let markdown = ''\n    let currentList: string | null = null\n    let listCounter = 0\n\n    delta.ops.forEach((op: QuillOp) => {\n      if (!op.insert) return\n\n      const text = typeof op.insert === 'string' ? op.insert : ''\n      const attrs = op.attributes || {}\n\n      // Handle newlines with formatting\n      if (text === '\\n') {\n        // Check for headers\n        if (attrs.header) {\n          markdown = markdown.trimEnd()\n          markdown = '#'.repeat(attrs.header) + ' ' + markdown.split('\\n').pop()\n          markdown += '\\n\\n'\n        }\n        // Check for lists\n        else if (attrs.list) {\n          if (attrs.list !== currentList) {\n            currentList = attrs.list\n            listCounter = 1\n          }\n          const line = markdown.split('\\n').pop()!\n          markdown = markdown.substring(0, markdown.lastIndexOf('\\n') + 1)\n\n          if (attrs.list === 'ordered') {\n            markdown += `${listCounter++}. ${line}\\n`\n          } else if (attrs.list === 'bullet') {\n            markdown += `- ${line}\\n`\n          } else if (attrs.list === 'check') {\n            markdown += `- [ ] ${line}\\n`\n          }\n        } else {\n          currentList = null\n          listCounter = 0\n          if (attrs.blockquote) {\n            const line = markdown.split('\\n').pop()!\n            markdown = markdown.substring(0, markdown.lastIndexOf('\\n') + 1)\n            markdown += `> ${line}\\n`\n          } else if (attrs['code-block']) {\n            markdown += '\\n```\\n'\n          } else {\n            markdown += '\\n'\n          }\n        }\n      } else {\n        let formattedText = text\n\n        // Apply inline formatting\n        if (attrs.bold) {\n          formattedText = `**${formattedText}**`\n        }\n        if (attrs.italic) {\n          formattedText = `*${formattedText}*`\n        }\n        if (attrs.strike) {\n          formattedText = `~~${formattedText}~~`\n        }\n        if (attrs.code) {\n          formattedText = `\\`${formattedText}\\``\n        }\n        if (attrs.link) {\n          formattedText = `[${formattedText}](${attrs.link})`\n        }\n\n        markdown += formattedText\n      }\n    })\n\n    return markdown.trim()\n  }\n\n  async setContent(content: string): Promise<void> {\n    // Lazy load Quill when content is set\n    await this.ensureQuillLoaded()\n\n    if (!this.editor) return\n\n    // Increment version to invalidate any pending events from previous setContent calls\n    this.contentVersion++\n    const currentVersion = this.contentVersion\n    console.log('[Editor] setContent called - version:', currentVersion, 'content length:', content.length)\n\n    // Clear any pending update timeout\n    if (this.updateTimeout) {\n      clearTimeout(this.updateTimeout)\n      this.updateTimeout = null\n    }\n\n    // CRITICAL: Disable the editor completely to prevent ANY text-change events\n    // This is more robust than just setting a flag\n    this.editor.disable()\n    this.isUpdating = true\n\n    try {\n      if (!content) {\n        this.editor.setText('')\n        this.currentNoteContent = ''\n      } else {\n        // Convert markdown to Quill Delta\n        const delta = this.markdownToDelta(content)\n        this.editor.setContents(delta)\n\n        // Track the current content for comparison\n        this.currentNoteContent = content\n      }\n    } finally {\n      // Re-enable editor after a delay to ensure all Quill internal events complete\n      this.updateTimeout = window.setTimeout(() => {\n        console.log('[Editor] Unlocking editor - version:', currentVersion)\n        this.isUpdating = false\n        this.updateTimeout = null\n\n        // Only re-enable if we have a context\n        const context = state.get('selectedContext')\n        if (context && this.editor) {\n          this.editor.enable(true)\n        }\n      }, 600)\n    }\n  }\n\n  private markdownToDelta(markdown: string): QuillDelta {\n    const ops: QuillOp[] = []\n    const lines = markdown.split('\\n')\n\n    lines.forEach((line, index) => {\n      // Headers\n      const headerMatch = line.match(/^(#{1,3})\\s+(.+)$/)\n      if (headerMatch) {\n        const level = headerMatch[1].length\n        ops.push({ insert: headerMatch[2] })\n        ops.push({ insert: '\\n', attributes: { header: level } })\n        return\n      }\n\n      // Bullet list\n      const bulletMatch = line.match(/^-\\s+(.+)$/)\n      if (bulletMatch) {\n        const text = this.parseInlineMarkdown(bulletMatch[1])\n        ops.push(...text)\n        ops.push({ insert: '\\n', attributes: { list: 'bullet' } })\n        return\n      }\n\n      // Numbered list\n      const numberedMatch = line.match(/^\\d+\\.\\s+(.+)$/)\n      if (numberedMatch) {\n        const text = this.parseInlineMarkdown(numberedMatch[1])\n        ops.push(...text)\n        ops.push({ insert: '\\n', attributes: { list: 'ordered' } })\n        return\n      }\n\n      // Task list\n      const taskMatch = line.match(/^-\\s+\\[([ x])\\]\\s+(.+)$/)\n      if (taskMatch) {\n        const text = this.parseInlineMarkdown(taskMatch[2])\n        ops.push(...text)\n        ops.push({ insert: '\\n', attributes: { list: 'check' } })\n        return\n      }\n\n      // Blockquote\n      const quoteMatch = line.match(/^>\\s+(.+)$/)\n      if (quoteMatch) {\n        const text = this.parseInlineMarkdown(quoteMatch[1])\n        ops.push(...text)\n        ops.push({ insert: '\\n', attributes: { blockquote: true } })\n        return\n      }\n\n      // Code block\n      if (line.startsWith('```')) {\n        ops.push({ insert: '\\n', attributes: { 'code-block': true } })\n        return\n      }\n\n      // Regular text with inline formatting\n      if (line.trim()) {\n        const text = this.parseInlineMarkdown(line)\n        ops.push(...text)\n      }\n\n      // Add newline if not last line\n      if (index < lines.length - 1) {\n        ops.push({ insert: '\\n' })\n      }\n    })\n\n    return { ops }\n  }\n\n  private parseInlineMarkdown(text: string): QuillOp[] {\n    const ops: QuillOp[] = []\n\n    // Parse inline formatting: bold, italic, strike, code, links\n    const regex = /(\\*\\*([^*]+)\\*\\*)|(\\*([^*]+)\\*)|(~~([^~]+)~~)|(`([^`]+)`)|(\\[([^\\]]+)\\]\\(([^)]+)\\))/g\n    let lastIndex = 0\n    let match: RegExpExecArray | null\n\n    while ((match = regex.exec(text)) !== null) {\n      // Add text before match\n      if (match.index > lastIndex) {\n        ops.push({ insert: text.substring(lastIndex, match.index) })\n      }\n\n      // Bold\n      if (match[1]) {\n        ops.push({ insert: match[2], attributes: { bold: true } })\n      }\n      // Italic\n      else if (match[3]) {\n        ops.push({ insert: match[4], attributes: { italic: true } })\n      }\n      // Strike\n      else if (match[5]) {\n        ops.push({ insert: match[6], attributes: { strike: true } })\n      }\n      // Code\n      else if (match[7]) {\n        ops.push({ insert: match[8], attributes: { code: true } })\n      }\n      // Link\n      else if (match[9]) {\n        ops.push({ insert: match[10], attributes: { link: match[11] } })\n      }\n\n      lastIndex = regex.lastIndex\n    }\n\n    // Add remaining text\n    if (lastIndex < text.length) {\n      ops.push({ insert: text.substring(lastIndex) })\n    }\n\n    return ops.length > 0 ? ops : [{ insert: text }]\n  }\n\n  getContent(): string {\n    return this.getMarkdown()\n  }\n\n  async setDisabled(disabled: boolean): Promise<void> {\n    // Only load editor if we're enabling it\n    if (!disabled) {\n      await this.ensureQuillLoaded()\n    }\n\n    if (!this.editor) return\n    this.editor.enable(!disabled)\n\n    const toolbar = this.container?.querySelector('.ql-toolbar') as HTMLElement\n    if (toolbar) {\n      toolbar.style.pointerEvents = disabled ? 'none' : 'auto'\n      toolbar.style.opacity = disabled ? '0.5' : '1'\n    }\n\n    // Update placeholder based on disabled state\n    const editorRoot = this.editor.root\n    if (editorRoot && disabled) {\n      editorRoot.dataset.placeholder = 'Select a context to start writing...'\n    } else if (editorRoot) {\n      editorRoot.dataset.placeholder = 'Start writing your notes...'\n    }\n  }\n\n  setPlaceholderMessage(message: string): void {\n    // Ensure Quill is loaded first\n    this.ensureQuillLoaded().then(() => {\n      if (!this.editor) return\n\n      const editorRoot = this.editor.root\n      if (editorRoot) {\n        editorRoot.dataset.placeholder = message\n      }\n    })\n  }\n\n  focus(): void {\n    if (this.editor) {\n      this.editor.focus()\n    }\n  }\n\n  /**\n   * Force flush any pending changes immediately\n   * Used before context/date changes to prevent data loss\n   */\n  forceFlush(): void {\n    if (!this.editor || this.isUpdating) return\n\n    const markdown = this.getMarkdown()\n\n    // Clear any pending debounced save\n    if (this.onChangeCallback) {\n      this.onChangeCallback(markdown)\n    }\n  }\n\n  /**\n   * Check if there are pending changes\n   */\n  hasPendingChanges(): boolean {\n    // If there's no editor, no pending changes\n    if (!this.editor) return false\n\n    const currentContent = this.getMarkdown()\n    return currentContent !== this.currentNoteContent\n  }\n}\n\nexport const markdownEditor = new MarkdownEditor()\n","/**\n * Professional Notification System\n * Handles toast notifications with queuing, stacking, and animations\n */\n\ninterface NotificationOptions {\n  type?: 'success' | 'error' | 'warning' | 'info'\n  title?: string\n  message: string\n  duration?: number\n  dismissible?: boolean\n  onAction?: () => void\n  actionLabel?: string\n}\n\ninterface Notification extends NotificationOptions {\n  id: string\n  element: HTMLElement | null\n  timeout?: number\n}\n\nclass NotificationManager {\n  private container: HTMLElement\n  private notifications = new Map<string, Notification>()\n  private queue: Notification[] = []\n  private readonly maxVisible = 3\n  private readonly defaultDuration = 5000\n\n  constructor() {\n    this.container = this.init()\n  }\n\n  private init(): HTMLElement {\n    // Create notification container\n    const container = document.createElement('div')\n    container.id = 'notification-container'\n    container.className = 'notification-container'\n    container.setAttribute('role', 'region')\n    container.setAttribute('aria-label', 'Notifications')\n    document.body.appendChild(container)\n    return container\n  }\n\n  /**\n   * Show a notification\n   */\n  show(options: NotificationOptions): string {\n    const {\n      type = 'info',\n      title,\n      message,\n      duration = this.defaultDuration,\n      dismissible = true,\n      onAction,\n      actionLabel = 'Action'\n    } = options\n\n    const id = `notification-${Date.now()}-${Math.random()}`\n\n    const notification: Notification = {\n      id,\n      type,\n      title,\n      message,\n      duration,\n      dismissible,\n      onAction,\n      actionLabel,\n      element: null\n    }\n\n    // Add to queue if at max capacity\n    const visibleCount = this.container.children.length\n    if (visibleCount >= this.maxVisible) {\n      this.queue.push(notification)\n      return id\n    }\n\n    this.render(notification)\n    return id\n  }\n\n  private render(notification: Notification): void {\n    const { id, type, title, message, duration, dismissible, onAction, actionLabel } = notification\n\n    // Create notification element\n    const element = document.createElement('div')\n    element.className = `notification-toast notification-${type}`\n    element.setAttribute('role', 'alert')\n    element.setAttribute('aria-live', type === 'error' ? 'assertive' : 'polite')\n    element.dataset.id = id\n\n    // Icon mapping\n    const icons = {\n      success: 'check_circle',\n      error: 'error',\n      warning: 'warning',\n      info: 'info'\n    }\n\n    // Build HTML\n    element.innerHTML = `\n      <div class=\"notification-icon\">\n        <span class=\"material-symbols-outlined\">${icons[type!]}</span>\n      </div>\n      <div class=\"notification-content\">\n        ${title ? `<div class=\"notification-title\">${this.escapeHtml(title)}</div>` : ''}\n        <div class=\"notification-message\">${this.escapeHtml(message)}</div>\n      </div>\n      ${\n        onAction\n          ? `\n        <button class=\"notification-action\" aria-label=\"${actionLabel}\">\n          ${actionLabel}\n        </button>\n      `\n          : ''\n      }\n      ${\n        dismissible\n          ? `\n        <button class=\"notification-close\" aria-label=\"Close notification\">\n          <span class=\"material-symbols-outlined\">close</span>\n        </button>\n      `\n          : ''\n      }\n    `\n\n    // Add event listeners\n    if (dismissible) {\n      const closeBtn = element.querySelector('.notification-close')\n      closeBtn?.addEventListener('click', () => this.dismiss(id))\n    }\n\n    if (onAction) {\n      const actionBtn = element.querySelector('.notification-action')\n      actionBtn?.addEventListener('click', () => {\n        onAction()\n        this.dismiss(id)\n      })\n    }\n\n    // Add to DOM with animation\n    this.container.appendChild(element)\n    notification.element = element\n    this.notifications.set(id, notification)\n\n    // Trigger animation\n    requestAnimationFrame(() => {\n      element.classList.add('notification-visible')\n    })\n\n    // Auto-dismiss after duration\n    if (duration && duration > 0) {\n      notification.timeout = window.setTimeout(() => {\n        this.dismiss(id)\n      }, duration)\n    }\n  }\n\n  dismiss(id: string): void {\n    const notification = this.notifications.get(id)\n    if (!notification) return\n\n    const { element, timeout } = notification\n\n    // Clear timeout\n    if (timeout) {\n      clearTimeout(timeout)\n    }\n\n    // Animate out\n    element?.classList.remove('notification-visible')\n    element?.classList.add('notification-hiding')\n\n    // Remove from DOM after animation\n    setTimeout(() => {\n      if (element?.parentNode) {\n        element.parentNode.removeChild(element)\n      }\n      this.notifications.delete(id)\n\n      // Show next queued notification\n      this.processQueue()\n    }, 300)\n  }\n\n  private processQueue(): void {\n    const visibleCount = this.container.children.length\n    if (this.queue.length > 0 && visibleCount < this.maxVisible) {\n      const next = this.queue.shift()\n      if (next) {\n        this.render(next)\n      }\n    }\n  }\n\n  // Convenience methods\n  success(message: string, options: Partial<NotificationOptions> = {}): string {\n    return this.show({ type: 'success', message, title: 'Success', ...options })\n  }\n\n  error(message: string, options: Partial<NotificationOptions> = {}): string {\n    return this.show({\n      type: 'error',\n      message,\n      title: 'Error',\n      duration: 7000, // Longer for errors\n      ...options\n    })\n  }\n\n  warning(message: string, options: Partial<NotificationOptions> = {}): string {\n    return this.show({ type: 'warning', message, title: 'Warning', ...options })\n  }\n\n  info(message: string, options: Partial<NotificationOptions> = {}): string {\n    return this.show({ type: 'info', message, ...options })\n  }\n\n  // Clear all notifications\n  clearAll(): void {\n    this.notifications.forEach(notification => {\n      this.dismiss(notification.id)\n    })\n    this.queue = []\n  }\n\n  // Utility: Escape HTML\n  private escapeHtml(text: string): string {\n    const div = document.createElement('div')\n    div.textContent = text\n    return div.innerHTML\n  }\n}\n\n// Create singleton instance\nexport const notifications = new NotificationManager()\n","/**\n * UI Module\n * Handles all UI rendering and user interactions\n */\n\nimport { state } from '@/utils/state';\nimport { contexts } from '@/services/contexts';\nimport { calendar } from '@/components/Calendar';\nimport { notes } from '@/services/notes';\nimport { events } from '@/utils/events';\nimport { api } from '@/services/api';\nimport { notifications } from '@/components/Notifications';\nimport { markdownEditor } from '@/components/Editor';\nimport { auth } from '@/services/auth';\n\ninterface UIElements {\n    // Sections\n    authSection: HTMLElement | null;\n    appSection: HTMLElement | null;\n\n    // Context\n    contextSelect: HTMLSelectElement | null;\n    contextColorIndicator: HTMLElement | null;\n\n    // Mobile context\n    mobileContextSelect: HTMLSelectElement | null;\n    mobileContextColorIndicator: HTMLElement | null;\n\n    // Date\n    datePicker: HTMLInputElement | null;\n\n    // Breadcrumb\n    breadcrumbContextName: HTMLElement | null;\n    breadcrumbDateName: HTMLElement | null;\n\n    // Editor\n    markdownEditorContainer: HTMLElement | null;\n    saveIndicator: HTMLElement | null;\n\n    // Notes list\n    notesList: HTMLElement | null;\n\n    // User\n    userEmail: HTMLElement | null;\n\n    // Time\n    currentTime: HTMLElement | null;\n    currentDate: HTMLElement | null;\n\n    // Modals\n    contextModal: HTMLElement | null;\n    settingsModal: HTMLElement | null;\n    onboardingModal: HTMLElement | null;\n\n    // Sync status\n    syncStatus: HTMLElement | null;\n    syncStatusText: HTMLElement | null;\n\n    // Theme\n    themeToggleMenu: HTMLElement | null;\n    themeToggleSwitch: HTMLInputElement | null;\n\n    // Settings\n    weekStartSelect: HTMLSelectElement | null;\n    timezoneSelect: HTMLSelectElement | null;\n\n    // Mobile navigation\n    mobileNotesToggle: HTMLElement | null;\n    mobileCalendarToggle: HTMLElement | null;\n    sidebar: HTMLElement | null;\n    calendarPanel: HTMLElement | null;\n    sidebarOverlay: HTMLElement | null;\n    calendarOverlay: HTMLElement | null;\n    sidebarClose: HTMLElement | null;\n    calendarClose: HTMLElement | null;\n}\n\ninterface SyncStatusOptions {\n    pending: number;\n    syncing: boolean;\n}\n\ninterface NotificationOptions {\n    title?: string;\n    duration?: number;\n}\n\nexport class UIManager {\n    elements: UIElements;\n    lastKnownDate: string | null;\n    INITIAL_RENDER_COUNT: number;\n    renderedNotesCount: number;\n\n    constructor() {\n        this.elements = {} as UIElements;\n        this.lastKnownDate = null;\n        // Virtual scrolling optimization\n        this.INITIAL_RENDER_COUNT = 50; // Only render first 50 notes initially\n        this.renderedNotesCount = this.INITIAL_RENDER_COUNT;\n    }\n\n    init(): void {\n        this.cacheElements();\n        this.setupEventListeners();\n        this.setupStateSubscriptions();\n        this.setupUserDropdown();\n        this.setupMobileNavigation();\n        this.startClock();\n    }\n\n    cacheElements(): void {\n        this.elements = {\n            // Sections\n            authSection: document.getElementById('auth-section'),\n            appSection: document.getElementById('app-section'),\n\n            // Context\n            contextSelect: document.getElementById('context-select') as HTMLSelectElement | null,\n            contextColorIndicator: document.getElementById('context-color-indicator'),\n\n            // Mobile context\n            mobileContextSelect: document.getElementById('mobile-context-select') as HTMLSelectElement | null,\n            mobileContextColorIndicator: document.getElementById('mobile-context-color-indicator'),\n\n            // Date\n            datePicker: document.getElementById('date-picker') as HTMLInputElement | null,\n\n            // Breadcrumb\n            breadcrumbContextName: document.getElementById('breadcrumb-context-name'),\n            breadcrumbDateName: document.getElementById('breadcrumb-date-name'),\n\n            // Editor\n            markdownEditorContainer: document.getElementById('markdown-editor-container'),\n            saveIndicator: document.getElementById('save-indicator'),\n\n            // Notes list\n            notesList: document.getElementById('notes-list'),\n\n            // User\n            userEmail: document.getElementById('user-email'),\n\n            // Time\n            currentTime: document.getElementById('current-time'),\n            currentDate: document.getElementById('current-date'),\n\n            // Modals\n            contextModal: document.getElementById('context-modal'),\n            settingsModal: document.getElementById('settings-modal'),\n            onboardingModal: document.getElementById('onboarding-modal'),\n\n            // Sync status\n            syncStatus: document.getElementById('sync-status'),\n            syncStatusText: document.getElementById('sync-status-text'),\n\n            // Theme\n            themeToggleMenu: document.getElementById('theme-toggle-menu'),\n            themeToggleSwitch: document.getElementById('theme-toggle-switch') as HTMLInputElement | null,\n\n            // Settings\n            weekStartSelect: document.getElementById('week-start-select') as HTMLSelectElement | null,\n            timezoneSelect: document.getElementById('timezone-select') as HTMLSelectElement | null,\n\n            // Mobile navigation\n            mobileNotesToggle: document.getElementById('mobile-notes-toggle'),\n            mobileCalendarToggle: document.getElementById('mobile-calendar-toggle'),\n            sidebar: document.querySelector('.sidebar') as HTMLElement | null,\n            calendarPanel: document.querySelector('.calendar-panel') as HTMLElement | null,\n            sidebarOverlay: document.getElementById('sidebar-overlay'),\n            calendarOverlay: document.getElementById('calendar-overlay'),\n            sidebarClose: document.getElementById('sidebar-close'),\n            calendarClose: document.getElementById('calendar-close'),\n        };\n    }\n\n    setupEventListeners(): void {\n        // Editor fullscreen button\n        const editorFullscreenBtn = document.getElementById('editor-fullscreen-btn');\n        if (editorFullscreenBtn) {\n            editorFullscreenBtn.addEventListener('click', () => {\n                this.openFullscreenNote();\n            });\n        }\n\n        // Editor delete button\n        const editorDeleteBtn = document.getElementById('editor-delete-note-btn');\n        if (editorDeleteBtn) {\n            editorDeleteBtn.addEventListener('click', () => {\n                const context = state.get('selectedContext');\n                const dateStr = state.get('selectedDate');\n\n                if (context && dateStr) {\n                    // Get formatted date for display\n                    const settings = state.get('userSettings');\n                    const timezone = settings.timezone || 'UTC';\n                    const dateFormat = settings.dateFormat || 'DD-MM-YY';\n\n                    const [year, month, day] = dateStr.split('-').map(Number);\n                    const dateObj = new Date(year, month - 1, day);\n\n                    // Get the day name\n                    const dayName = dateObj.toLocaleDateString('en-US', {\n                        weekday: 'long',\n                        timeZone: timezone\n                    });\n\n                    // Format date\n                    const yy = String(year).substring(2);\n                    const mm = String(month).padStart(2, '0');\n                    const dd = String(day).padStart(2, '0');\n\n                    let formattedDateStr: string;\n                    if (dateFormat === 'MM-DD-YY') {\n                        formattedDateStr = `${mm}-${dd}-${yy}`;\n                    } else {\n                        formattedDateStr = `${dd}-${mm}-${yy}`;\n                    }\n\n                    const formattedDate = `${dayName}, ${formattedDateStr}`;\n\n                    // Show modal\n                    this.showDeleteNoteModal(context, dateStr, formattedDate);\n                }\n            });\n        }\n\n        // Context selection (desktop)\n        // Just update state - the CONTEXT_CHANGED event handler will do the rest\n        this.elements.contextSelect?.addEventListener('change', (e) => {\n            const context = (e.target as HTMLSelectElement).value;\n            console.log('[UI] Desktop context selector changed:', context);\n            contexts.selectContext(context);\n        });\n\n        // Context selection (mobile)\n        // Just update state - the CONTEXT_CHANGED event handler will do the rest\n        this.elements.mobileContextSelect?.addEventListener('change', (e) => {\n            const context = (e.target as HTMLSelectElement).value;\n            console.log('[UI] Mobile context selector changed:', context);\n            contexts.selectContext(context);\n        });\n\n        // Date picker\n        this.elements.datePicker?.addEventListener('change', async (e) => {\n            const dateStr = (e.target as HTMLInputElement).value;\n            // Check if this date is already selected\n            const currentDate = state.get('selectedDate');\n            if (currentDate === dateStr) {\n                console.log('[UI] Date picker: date already selected, skipping:', dateStr);\n                return;\n            }\n            await notes.selectDate(dateStr);\n        });\n\n        // Calendar navigation\n        document.getElementById('prev-month')?.addEventListener('click', () => {\n            calendar.prevMonth();\n        });\n\n        document.getElementById('next-month')?.addEventListener('click', () => {\n            calendar.nextMonth();\n        });\n\n        // Theme toggle\n        this.elements.themeToggleMenu?.addEventListener('click', async (e) => {\n            e.preventDefault();\n            const currentTheme = document.documentElement.getAttribute('data-theme');\n            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';\n            this.setTheme(newTheme);\n\n            const settings = state.get('userSettings');\n            state.set('userSettings', { ...settings, theme: newTheme });\n\n            try {\n                await api.updateSettings({ ...settings, theme: newTheme });\n            } catch (err) {\n                console.error('Failed to save theme:', err);\n            }\n        });\n\n        this.elements.themeToggleSwitch?.addEventListener('change', (e) => {\n            this.setTheme((e.target as HTMLInputElement).checked ? 'dark' : 'light');\n        });\n\n        // Keyboard shortcuts\n        this.setupKeyboardShortcuts();\n    }\n\n    setupKeyboardShortcuts(): void {\n        document.addEventListener('keydown', (e) => {\n            const isMac = navigator.platform.toUpperCase().indexOf('MAC') >= 0;\n            const modKey = isMac ? e.metaKey : e.ctrlKey;\n\n            // Cmd/Ctrl+K: Focus context selector\n            if (modKey && e.key === 'k') {\n                e.preventDefault();\n                this.elements.contextSelect?.focus();\n                return;\n            }\n\n            // Cmd/Ctrl+S: Force sync\n            if (modKey && e.key === 's') {\n                e.preventDefault();\n                events.emit('sync-force' as any, undefined);\n                return;\n            }\n\n            // Cmd/Ctrl+/: Focus editor (handled by markdown editor)\n            if (modKey && e.key === '/') {\n                e.preventDefault();\n                return;\n            }\n\n            // Escape: Close modals\n            if (e.key === 'Escape') {\n                // Check if delete modal is open (highest priority)\n                const deleteModal = document.getElementById('delete-note-modal');\n                if (deleteModal?.classList.contains('is-active')) {\n                    this.closeDeleteNoteModal();\n                    return;\n                }\n\n                this.closeAllModals();\n                return;\n            }\n        });\n    }\n\n    setupUserDropdown(): void {\n        const userDropdown = document.getElementById('user-dropdown');\n        const userDropdownButton = document.getElementById('user-dropdown-button');\n        const settingsMenuItem = document.getElementById('settings-menu-item');\n        const signoutMenuItem = document.getElementById('signout-menu-item');\n\n        if (!userDropdown || !userDropdownButton) return;\n\n        // Toggle dropdown\n        userDropdownButton.addEventListener('click', (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            userDropdown.classList.toggle('is-active');\n        });\n\n        // Settings click\n        settingsMenuItem?.addEventListener('click', (e) => {\n            e.preventDefault();\n            userDropdown.classList.remove('is-active');\n            this.showSettingsModal();\n        });\n\n        // Sign out click\n        signoutMenuItem?.addEventListener('click', (e) => {\n            e.preventDefault();\n            userDropdown.classList.remove('is-active');\n            auth.signOut();\n        });\n\n        // Close when clicking outside\n        document.addEventListener('click', (e) => {\n            if (!userDropdown.contains(e.target as Node)) {\n                userDropdown.classList.remove('is-active');\n            }\n        });\n\n        // Close on escape\n        document.addEventListener('keydown', (e) => {\n            if (e.key === 'Escape' && userDropdown.classList.contains('is-active')) {\n                userDropdown.classList.remove('is-active');\n            }\n        });\n    }\n\n    setupStateSubscriptions(): void {\n        // Re-render UI when contexts change\n        state.subscribe('contexts', () => {\n            this.renderContextsSelect();\n        });\n\n        // Update calendar when month/year changes\n        state.subscribeMany(['currentCalendarMonth', 'currentCalendarYear'], () => {\n            calendar.render();\n        });\n\n        // Update UI when notes list changes\n        state.subscribe('notes', () => {\n            this.renderNotesList();\n            calendar.render();\n        });\n\n        // Update breadcrumb when context changes\n        state.subscribe('selectedContext', (_context) => {\n            this.updateBreadcrumb();\n            // Reset virtual scrolling when switching contexts\n            this.renderedNotesCount = this.INITIAL_RENDER_COUNT;\n        });\n\n        // Update date picker when selected date changes\n        state.subscribe('selectedDate', (newDate) => {\n            if (this.elements.datePicker && newDate) {\n                this.elements.datePicker.value = newDate as string;\n                this.updateDatePickerDisplay(newDate as string);\n            }\n            this.renderNotesList(); // Update active state\n            calendar.render();\n            this.updateBreadcrumb();\n            this.updateEditorDeleteButton(); // Update delete button visibility\n        });\n\n        // Update date picker display when date format changes\n        state.subscribe('userSettings', () => {\n            const selectedDate = state.get('selectedDate');\n            if (selectedDate) {\n                this.updateDatePickerDisplay(selectedDate);\n            }\n            this.updateBreadcrumb();\n        });\n\n        // Update context indicator when selected context changes\n        state.subscribe('selectedContext', (selectedContext) => {\n            // Update the select dropdown values (both desktop and mobile)\n            if (this.elements.contextSelect && selectedContext) {\n                this.elements.contextSelect.value = selectedContext;\n            }\n            if (this.elements.mobileContextSelect && selectedContext) {\n                this.elements.mobileContextSelect.value = selectedContext;\n            }\n            this.updateContextIndicator();\n            this.updateEditorState();\n        });\n\n        // Update user email when user changes\n        state.subscribe('currentUser', (user) => {\n            if (this.elements.userEmail && user) {\n                this.elements.userEmail.textContent = user.email || '';\n            }\n        });\n\n        // Update theme when settings change\n        state.subscribe('userSettings', (settings) => {\n            if (settings.theme) {\n                this.setTheme(settings.theme);\n            }\n            // Update context selector visibility based on uniqueContextMode\n            this.updateContextSelectorVisibility();\n            // Update breadcrumb visibility\n            this.updateBreadcrumbVisibility();\n            // Update markdown editor visibility\n            this.updateMarkdownEditorVisibility();\n            // Update new context button visibility\n            this.updateNewContextButtonVisibility();\n        });\n    }\n\n    renderContextsSelect(): void {\n        const contextsList = state.get('contexts');\n        const selectedContext = state.get('selectedContext');\n\n        const optionsHTML = '<option value=\"\">Select context...</option>' +\n            contextsList.map(c =>\n                `<option value=\"${c.name}\" data-color=\"${c.color || 'primary'}\">${c.name}</option>`\n            ).join('');\n\n        // Update desktop selector\n        if (this.elements.contextSelect) {\n            this.elements.contextSelect.innerHTML = optionsHTML;\n            if (selectedContext) {\n                this.elements.contextSelect.value = selectedContext;\n            }\n        }\n\n        // Update mobile selector\n        if (this.elements.mobileContextSelect) {\n            this.elements.mobileContextSelect.innerHTML = optionsHTML;\n            if (selectedContext) {\n                this.elements.mobileContextSelect.value = selectedContext;\n            }\n        }\n\n        this.updateContextIndicator();\n    }\n\n    updateContextIndicator(): void {\n        // Update desktop indicator\n        if (this.elements.contextSelect && this.elements.contextColorIndicator) {\n            const opt = this.elements.contextSelect.options[this.elements.contextSelect.selectedIndex] as HTMLOptionElement;\n\n            if (opt?.dataset.color && opt.value !== '') {\n                const normalizedColor = this.normalizeToBulmaColor(opt.dataset.color);\n                this.elements.contextColorIndicator.style.background = `var(--bulma-${normalizedColor})`;\n                this.elements.contextColorIndicator.style.opacity = '1';\n            } else {\n                this.elements.contextColorIndicator.style.background = 'var(--bulma-grey-light)';\n                this.elements.contextColorIndicator.style.opacity = '0.3';\n            }\n        }\n\n        // Update mobile indicator\n        if (this.elements.mobileContextSelect && this.elements.mobileContextColorIndicator) {\n            const opt = this.elements.mobileContextSelect.options[this.elements.mobileContextSelect.selectedIndex] as HTMLOptionElement;\n\n            if (opt?.dataset.color && opt.value !== '') {\n                const normalizedColor = this.normalizeToBulmaColor(opt.dataset.color);\n                this.elements.mobileContextColorIndicator.style.background = `var(--bulma-${normalizedColor})`;\n                this.elements.mobileContextColorIndicator.style.opacity = '1';\n            } else {\n                this.elements.mobileContextColorIndicator.style.background = 'var(--bulma-grey-light)';\n                this.elements.mobileContextColorIndicator.style.opacity = '0.3';\n            }\n        }\n    }\n\n    renderNotesList(): void {\n        const notesList = state.get('notes');\n        const selectedDate = state.get('selectedDate');\n        const settings = state.get('userSettings');\n        const timezone = settings.timezone || 'UTC';\n        const dateFormat = settings.dateFormat || 'DD-MM-YY';\n\n        if (!this.elements.notesList) return;\n\n        if (notesList.length === 0) {\n            this.elements.notesList.innerHTML = '<li class=\"has-text-centered py-6 has-text-grey-light\">No notes yet</li>';\n            return;\n        }\n\n        // Virtual scrolling: only render visible notes\n        const notesToRender = notesList.slice(0, this.renderedNotesCount);\n        const hasMore = notesList.length > this.renderedNotesCount;\n\n        this.elements.notesList.innerHTML = notesToRender.map(note => {\n            const [year, month, day] = note.date.split('-').map(Number);\n            const dateObj = new Date(year, month - 1, day);\n\n            // Get the day name in English\n            const dayName = dateObj.toLocaleDateString('en-US', {\n                weekday: 'long',\n                timeZone: timezone\n            });\n\n            // Format date based on user preference\n            const yy = String(year).substring(2); // Get last 2 digits of year\n            const mm = String(month).padStart(2, '0');\n            const dd = String(day).padStart(2, '0');\n\n            let dateStr: string;\n            if (dateFormat === 'MM-DD-YY') {\n                dateStr = `${mm}-${dd}-${yy}`;\n            } else {\n                dateStr = `${dd}-${mm}-${yy}`;\n            }\n\n            // Format: \"Monday, 24-10-25.md\" or \"Monday, 10-24-25.md\" depending on dateFormat\n            const formattedDate = `${dayName}, ${dateStr}.md`;\n\n            const isActive = note.date === selectedDate;\n\n            return `\n                <li>\n                    <a\n                        class=\"${isActive ? 'is-active' : ''}\"\n                        data-date=\"${note.date}\"\n                    >\n                        ${formattedDate}\n                    </a>\n                </li>\n            `;\n        }).join('');\n\n        // Add \"Load More\" button if there are more notes\n        if (hasMore) {\n            this.elements.notesList.innerHTML += `\n                <li class=\"has-text-centered py-3\">\n                    <button class=\"button is-small is-ghost\" id=\"load-more-notes\" style=\"opacity: 0.7;\">\n                        <span class=\"icon\">\n                            <span class=\"material-symbols-outlined\">expand_more</span>\n                        </span>\n                        <span>Load ${Math.min(50, notesList.length - this.renderedNotesCount)} more</span>\n                    </button>\n                </li>\n            `;\n        }\n\n        // Add click handlers for notes\n        this.elements.notesList.querySelectorAll('a[data-date]').forEach(link => {\n            link.addEventListener('click', async (e) => {\n                e.preventDefault(); // Prevent default link behavior\n                const dateStr = (link as HTMLElement).dataset.date;\n                if (dateStr) {\n                    // Check if this date is already selected\n                    const currentDate = state.get('selectedDate');\n                    if (currentDate === dateStr) {\n                        console.log('[UI] Date already selected, skipping:', dateStr);\n                        return;\n                    }\n                    await notes.selectDate(dateStr);\n                }\n            });\n        });\n\n        // Add click handler for \"Load More\" button\n        const loadMoreBtn = document.getElementById('load-more-notes');\n        if (loadMoreBtn) {\n            loadMoreBtn.addEventListener('click', () => {\n                this.renderedNotesCount += 50;\n                this.renderNotesList();\n            });\n        }\n    }\n\n    updateEditorState(): void {\n        // Editor state is now managed by the markdown editor module\n        const context = state.get('selectedContext');\n        const contextsList = state.get('contexts') || [];\n\n        // Update editor state based on context\n        if (context) {\n            markdownEditor.setDisabled(false);\n        } else {\n            // First ensure Quill is loaded before setting placeholder\n            markdownEditor.ensureQuillLoaded().then(() => {\n                markdownEditor.setDisabled(true);\n                markdownEditor.setContent('');\n\n                // If there are no contexts at all, show a message to create the first one\n                if (contextsList.length === 0) {\n                    // Wait a bit to ensure setDisabled has applied\n                    setTimeout(() => {\n                        markdownEditor.setPlaceholderMessage('Click \"New Context\" to create your first context and start writing notes');\n                    }, 100);\n                }\n            });\n        }\n\n        // Show/hide delete button based on context\n        this.updateEditorDeleteButton();\n    }\n\n    updateEditorDeleteButton(): void {\n        const editorDeleteBtn = document.getElementById('editor-delete-note-btn');\n        const editorFullscreenBtn = document.getElementById('editor-fullscreen-btn');\n\n        const context = state.get('selectedContext');\n        const selectedDate = state.get('selectedDate');\n\n        // Show buttons only if we have both context and selected date\n        if (context && selectedDate) {\n            if (editorDeleteBtn) editorDeleteBtn.style.display = 'flex';\n            if (editorFullscreenBtn) editorFullscreenBtn.style.display = 'flex';\n        } else {\n            if (editorDeleteBtn) editorDeleteBtn.style.display = 'none';\n            if (editorFullscreenBtn) editorFullscreenBtn.style.display = 'none';\n        }\n    }\n\n    updateSaveIndicator(status: string): void {\n        if (!this.elements.saveIndicator) return;\n\n        this.elements.saveIndicator.className = `save-indicator ${status}`;\n\n        if (status === 'saved') {\n            this.elements.saveIndicator.textContent = 'Saved locally ';\n            setTimeout(() => {\n                if (this.elements.saveIndicator) {\n                    this.elements.saveIndicator.textContent = '';\n                }\n            }, 2000);\n        } else {\n            this.elements.saveIndicator.textContent = '';\n        }\n    }\n\n    updateSyncStatus({ pending, syncing }: SyncStatusOptions): void {\n        if (!this.elements.syncStatus || !this.elements.syncStatusText) return;\n\n        // Show sync indicator when there are pending operations or actively syncing\n        if (pending > 0 || syncing) {\n            this.elements.syncStatus.style.display = 'flex';\n\n            if (syncing) {\n                this.elements.syncStatusText.textContent = `Syncing ${pending} note${pending !== 1 ? 's' : ''}...`;\n                this.elements.syncStatus.classList.add('is-syncing');\n                this.elements.syncStatus.classList.remove('is-pending');\n            } else {\n                this.elements.syncStatusText.textContent = `${pending} note${pending !== 1 ? 's' : ''} pending sync`;\n                this.elements.syncStatus.classList.add('is-pending');\n                this.elements.syncStatus.classList.remove('is-syncing');\n            }\n        } else {\n            // Hide after successful sync with a brief delay\n            setTimeout(() => {\n                if (this.elements.syncStatus) {\n                    this.elements.syncStatus.style.display = 'none';\n                    this.elements.syncStatus.classList.remove('is-syncing', 'is-pending');\n                }\n            }, 1000);\n        }\n    }\n\n    setTheme(theme: string): void {\n        document.documentElement.setAttribute('data-theme', theme);\n        if (this.elements.themeToggleSwitch) {\n            this.elements.themeToggleSwitch.checked = theme === 'dark';\n        }\n        this.updateThemeIcon();\n        localStorage.setItem('theme', theme);\n    }\n\n    updateThemeIcon(): void {\n        const theme = document.documentElement.getAttribute('data-theme');\n        const themeIcon = this.elements.themeToggleMenu?.querySelector('.material-symbols-outlined');\n        if (themeIcon) {\n            themeIcon.textContent = theme === 'dark' ? 'light_mode' : 'dark_mode';\n        }\n    }\n\n    showApp(_skipAnimation: boolean = false): void {\n        console.log('[UI] showApp called');\n        console.log('[UI] authSection:', this.elements.authSection);\n        console.log('[UI] appSection:', this.elements.appSection);\n\n        if (!this.elements.authSection || !this.elements.appSection) {\n            console.error('[UI] Missing elements!');\n            return;\n        }\n\n        // Hide loader if visible\n        const loader = document.getElementById('landing-loader');\n        if (loader) {\n            console.log('[UI] Hiding loader');\n            loader.classList.remove('visible');\n        }\n\n        // Simple: hide auth, show app\n        console.log('[UI] Hiding auth section');\n        this.elements.authSection.classList.remove('visible');\n\n        console.log('[UI] Showing app section');\n        this.elements.appSection.classList.add('visible');\n\n        console.log('[UI] App section display:', window.getComputedStyle(this.elements.appSection).display);\n\n        // Update context selector visibility based on settings\n        this.updateContextSelectorVisibility();\n\n        // Update breadcrumb and markdown editor visibility\n        this.updateBreadcrumbVisibility();\n        this.updateMarkdownEditorVisibility();\n\n        // Update new context button visibility\n        this.updateNewContextButtonVisibility();\n\n        // Check if user has no contexts (new user or deleted all contexts)\n        // We use hasNoContexts from the backend response, NOT from local state\n        // because local state might not be loaded yet\n        const hasNoContexts = (state as any).get('hasNoContexts');\n        const isDevelopment = (window as any).__ENV__ === 'development';\n\n        console.log('[UI] showApp - hasNoContexts:', hasNoContexts, 'isDevelopment:', isDevelopment);\n\n        // Show onboarding modal when user has no contexts\n        // This happens when:\n        // - New user (never created a context)\n        // - User deleted all their contexts\n        // We ONLY check hasNoContexts from backend, not local contexts state\n        if (isDevelopment || hasNoContexts) {\n            console.log('[UI] Showing onboarding modal');\n            setTimeout(() => {\n                this.elements.onboardingModal?.classList.add('is-active');\n            }, 500);\n        } else {\n            console.log('[UI] NOT showing onboarding modal');\n        }\n    }\n\n    hideApp(): void {\n        if (!this.elements.authSection || !this.elements.appSection) return;\n\n        // Simple: hide app, show auth\n        this.elements.appSection.classList.remove('visible');\n        this.elements.authSection.classList.add('visible');\n    }\n\n    showError(message: string | { title?: string; message?: string; duration?: number }, options: NotificationOptions = {}): void {\n        // Handle different error types\n        let title = 'Error';\n        let duration = 7000;\n        let msg = '';\n\n        if (typeof message === 'object') {\n            // Structured error\n            title = message.title || 'Error';\n            msg = message.message || 'An error occurred';\n            duration = message.duration || 7000;\n        } else {\n            msg = message;\n        }\n\n        // Check if it's a network error\n        if (msg.includes('network') || msg.includes('offline')) {\n            title = 'Connection Error';\n            duration = 10000; // Longer for network issues\n        }\n\n        notifications.error(msg, { title, duration, ...options });\n    }\n\n    showSuccess(message: string, options: NotificationOptions = {}): void {\n        notifications.success(message, { duration: 3000, ...options });\n    }\n\n    showWarning(message: string, options: NotificationOptions = {}): void {\n        notifications.warning(message, { duration: 5000, ...options });\n    }\n\n    showInfo(message: string, options: NotificationOptions = {}): void {\n        notifications.info(message, { duration: 4000, ...options });\n    }\n\n    // Modal methods\n    showContextModal(): void {\n        this.elements.contextModal?.classList.add('is-active');\n        const nameInput = document.getElementById('context-name') as HTMLInputElement | null;\n        const colorInput = document.getElementById('context-color') as HTMLInputElement | null;\n        if (nameInput) nameInput.value = '';\n        if (colorInput) colorInput.value = 'primary';\n\n        // Setup color buttons handlers\n        this.setupColorButtons();\n\n        // Reset to primary\n        this.selectColorButton('primary');\n\n        nameInput?.focus();\n    }\n\n    closeContextModal(): void {\n        this.elements.contextModal?.classList.remove('is-active');\n    }\n\n    showSettingsModal(): void {\n        const settings = state.get('userSettings');\n\n        if (this.elements.weekStartSelect) {\n            this.elements.weekStartSelect.value = String(settings.weekStart);\n        }\n        if (this.elements.timezoneSelect) {\n            this.elements.timezoneSelect.value = settings.timezone;\n        }\n        const dateFormatSelect = document.getElementById('date-format-select') as HTMLSelectElement | null;\n        if (dateFormatSelect) {\n            dateFormatSelect.value = settings.dateFormat || 'DD-MM-YY';\n        }\n        const uniqueContextModeSwitch = document.getElementById('unique-context-mode-switch') as HTMLInputElement | null;\n        if (uniqueContextModeSwitch) {\n            uniqueContextModeSwitch.checked = settings.uniqueContextMode || false;\n        }\n        const showBreadcrumbSwitch = document.getElementById('show-breadcrumb-switch') as HTMLInputElement | null;\n        if (showBreadcrumbSwitch) {\n            showBreadcrumbSwitch.checked = settings.showBreadcrumb === true;\n        }\n        const showMarkdownEditorSwitch = document.getElementById('show-markdown-editor-switch') as HTMLInputElement | null;\n        if (showMarkdownEditorSwitch) {\n            showMarkdownEditorSwitch.checked = settings.showMarkdownEditor === true;\n        }\n        const hideNewContextButtonSwitch = document.getElementById('hide-new-context-button-switch') as HTMLInputElement | null;\n        if (hideNewContextButtonSwitch) {\n            hideNewContextButtonSwitch.checked = settings.hideNewContextButton === true;\n        }\n\n        // Reset accordion to collapsed state\n        const accordionContent = document.getElementById('contexts-accordion-content') as HTMLElement | null;\n        const accordionIcon = document.getElementById('contexts-accordion-icon');\n        if (accordionContent) {\n            accordionContent.style.display = 'none';\n            accordionContent.style.opacity = '1'; // Reset opacity\n        }\n        if (accordionIcon) {\n            const iconElement = accordionIcon.querySelector('.material-symbols-outlined');\n            if (iconElement) iconElement.textContent = 'expand_more';\n        }\n\n        // Render contexts list\n        this.renderContextsEditList();\n\n        // Reset save button state\n        const saveBtn = document.getElementById('settings-save-btn') as HTMLButtonElement | null;\n        const saveIcon = document.getElementById('settings-save-icon');\n        const saveSpinner = document.getElementById('settings-save-spinner') as HTMLElement | null;\n        const saveText = document.getElementById('settings-save-text');\n\n        if (saveBtn) saveBtn.disabled = false;\n        if (saveIcon) {\n            saveIcon.style.display = 'inline-flex';\n            const iconElement = saveIcon.querySelector('.material-symbols-outlined');\n            if (iconElement) iconElement.textContent = 'check';\n        }\n        if (saveSpinner) saveSpinner.style.display = 'none';\n        if (saveText) saveText.textContent = 'Save';\n\n        this.elements.settingsModal?.classList.add('is-active');\n    }\n\n    closeSettingsModal(): void {\n        // Reset accordion to collapsed state before closing\n        const accordionContent = document.getElementById('contexts-accordion-content') as HTMLElement | null;\n        const accordionIcon = document.getElementById('contexts-accordion-icon');\n        if (accordionContent) {\n            accordionContent.style.display = 'none';\n            accordionContent.style.opacity = '1'; // Reset opacity\n        }\n        if (accordionIcon) {\n            const iconElement = accordionIcon.querySelector('.material-symbols-outlined');\n            if (iconElement) iconElement.textContent = 'expand_more';\n        }\n\n        this.elements.settingsModal?.classList.remove('is-active');\n    }\n\n    closeOnboardingModal(): void {\n        this.elements.onboardingModal?.classList.remove('is-active');\n        // No need to store in localStorage anymore since we use backend isFirstLogin flag\n    }\n\n    showDeleteNoteModal(context: string, date: string, formattedDate: string): void {\n        const modal = document.getElementById('delete-note-modal') as HTMLElement & { dataset: { context?: string; date?: string } } | null;\n        const message = document.getElementById('delete-note-message');\n\n        if (modal && message) {\n            // Store the note info for later use\n            modal.dataset.context = context;\n            modal.dataset.date = date;\n\n            // Update message with formatted date\n            message.textContent = `Are you sure you want to delete the note for ${formattedDate}?`;\n\n            modal.classList.add('is-active');\n        }\n    }\n\n    closeDeleteNoteModal(): void {\n        const modal = document.getElementById('delete-note-modal') as HTMLElement & { dataset: { context?: string; date?: string } } | null;\n        if (modal) {\n            modal.classList.remove('is-active');\n            delete modal.dataset.context;\n            delete modal.dataset.date;\n        }\n    }\n\n    closeAllModals(): void {\n        this.closeContextModal();\n        this.closeSettingsModal();\n        this.closeOnboardingModal();\n        this.closeDeleteNoteModal();\n    }\n\n    // Clock\n    startClock(): void {\n        this.updateCurrentDateTime();\n        setInterval(() => this.updateCurrentDateTime(), 1000);\n    }\n\n    updateCurrentDateTime(): void {\n        const settings = state.get('userSettings');\n        const timezone = settings.timezone || 'UTC';\n        const serverTimeOffset = state.get('serverTimeOffset');\n        const now = new Date(Date.now() + serverTimeOffset);\n\n        const timeOptions: Intl.DateTimeFormatOptions = {\n            hour: '2-digit',\n            minute: '2-digit',\n            second: '2-digit',\n            hour12: false,\n            timeZone: timezone\n        };\n\n        const dateOptions: Intl.DateTimeFormatOptions = {\n            weekday: 'long',\n            year: 'numeric',\n            month: 'long',\n            day: 'numeric',\n            timeZone: timezone\n        };\n\n        const timeString = now.toLocaleTimeString('en-US', timeOptions);\n        const dateString = now.toLocaleDateString('en-US', dateOptions);\n\n        if (this.elements.currentTime) {\n            this.elements.currentTime.textContent = timeString;\n        }\n        if (this.elements.currentDate) {\n            this.elements.currentDate.textContent = dateString;\n        }\n\n        // Check if day changed and update calendar\n        const currentDate = (state as any).get('today') as string;\n        if (this.lastKnownDate && this.lastKnownDate !== currentDate) {\n            calendar.render();\n        }\n        this.lastKnownDate = currentDate as string | null;\n    }\n\n    updateDatePickerDisplay(dateStr: string): void {\n        const displayElement = document.getElementById('date-picker-display');\n        if (!displayElement || !dateStr) return;\n\n        const settings = state.get('userSettings');\n        const dateFormat = settings.dateFormat || 'DD-MM-YY';\n\n        const [year, month, day] = dateStr.split('-').map(Number);\n\n        // Format date based on user preference\n        const yy = String(year).substring(2); // Get last 2 digits of year\n        const mm = String(month).padStart(2, '0');\n        const dd = String(day).padStart(2, '0');\n\n        let formattedDate: string;\n        if (dateFormat === 'MM-DD-YY') {\n            formattedDate = `${mm}/${dd}/${yy}`;\n        } else {\n            formattedDate = `${dd}/${mm}/${yy}`;\n        }\n\n        displayElement.textContent = formattedDate;\n    }\n\n    updateContextSelectorVisibility(): void {\n        const settings = state.get('userSettings');\n        const uniqueContextMode = settings.uniqueContextMode || false;\n\n        // Get context selector containers (both desktop and mobile)\n        const desktopContextContainer = document.getElementById('desktop-context-selector');\n        const mobileContextContainer = document.getElementById('mobile-context-selector');\n\n        if (uniqueContextMode) {\n            // Hide context selectors\n            if (desktopContextContainer) {\n                desktopContextContainer.style.display = 'none';\n            }\n            if (mobileContextContainer) {\n                mobileContextContainer.style.display = 'none';\n            }\n        } else {\n            // Show context selectors\n            if (desktopContextContainer) {\n                desktopContextContainer.style.display = '';\n            }\n            if (mobileContextContainer) {\n                mobileContextContainer.style.display = '';\n            }\n        }\n    }\n\n    updateBreadcrumbVisibility(): void {\n        const settings = state.get('userSettings');\n        const showBreadcrumb = settings.showBreadcrumb === true;\n\n        const breadcrumb = document.getElementById('drive-breadcrumb');\n        const mainSection = document.querySelector('.main-section');\n\n        // Show/hide breadcrumb\n        if (breadcrumb) {\n            breadcrumb.style.display = showBreadcrumb ? '' : 'none';\n        }\n\n        // Set data attribute that CSS will use to adjust spacing\n        if (mainSection) {\n            if (showBreadcrumb) {\n                mainSection.removeAttribute('data-hide-breadcrumb');\n            } else {\n                mainSection.setAttribute('data-hide-breadcrumb', 'true');\n            }\n        }\n    }\n\n    updateMarkdownEditorVisibility(): void {\n        const settings = state.get('userSettings');\n        const showMarkdownEditor = settings.showMarkdownEditor === true;\n\n        // Get the Quill toolbar\n        const toolbar = document.querySelector('.ql-toolbar') as HTMLElement | null;\n        if (toolbar) {\n            toolbar.style.display = showMarkdownEditor ? '' : 'none';\n        }\n\n        // The editor itself should remain enabled based on context selection,\n        // regardless of toolbar visibility\n        const context = state.get('selectedContext');\n        // Editor should be enabled if we have a context, regardless of toolbar visibility\n        markdownEditor.setDisabled(context ? false : true);\n    }\n\n    updateNewContextButtonVisibility(): void {\n        const settings = state.get('userSettings');\n        const hideNewContextButton = settings.hideNewContextButton === true;\n\n        // Get new context buttons (both desktop and mobile)\n        const desktopNewContextBtn = document.getElementById('desktop-new-context-btn');\n        const mobileNewContextBtn = document.getElementById('mobile-new-context-btn');\n\n        // Hide or show buttons\n        if (desktopNewContextBtn) {\n            desktopNewContextBtn.style.display = hideNewContextButton ? 'none' : '';\n        }\n        if (mobileNewContextBtn) {\n            mobileNewContextBtn.style.display = hideNewContextButton ? 'none' : '';\n        }\n    }\n\n    renderContextsEditList(): void {\n        const contextsList = state.get('contexts');\n        const container = document.getElementById('contexts-edit-list');\n\n        if (!container) return;\n\n        if (contextsList.length === 0) {\n            container.innerHTML = '<p class=\"has-text-centered has-text-grey-light py-5\">No contexts yet. Create your first context to get started!</p>';\n            return;\n        }\n\n        container.innerHTML = contextsList.map((ctx, _index) => {\n            // Normalize old hex colors to Bulma colors\n            const normalizedColor = this.normalizeToBulmaColor(ctx.color);\n\n            return `\n            <div class=\"is-flex is-align-items-center is-justify-content-space-between mb-3\"\n                 style=\"padding: 0.75rem 1rem; background: var(--bulma-scheme-main-bis); border-left: 3px solid var(--bulma-${normalizedColor}); border-radius: 6px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\">\n                <div class=\"is-flex is-align-items-center\" style=\"gap: 0.75rem; flex: 1; min-width: 0;\">\n                    <span style=\"display: block; width: 12px; height: 12px; background: var(--bulma-${normalizedColor}); border-radius: 50%; flex-shrink: 0;\"></span>\n                    <span style=\"font-size: 0.9rem; font-weight: 500; color: var(--bulma-text); overflow: hidden; text-overflow: ellipsis; white-space: nowrap;\">${ctx.name}</span>\n                </div>\n                <div class=\"is-flex is-align-items-center\" style=\"gap: 0.35rem;\">\n                    <button class=\"button is-small context-action-btn context-edit-btn\"\n                            onclick=\"window.showEditContextModal('${ctx.id}')\"\n                            title=\"Edit context\"\n                            style=\"padding: 0.35rem; border: none; background: transparent; border-radius: 50%; width: 32px; height: 32px;\">\n                        <span class=\"icon is-small\">\n                            <span class=\"material-symbols-outlined\" style=\"font-size: 18px; color: var(--bulma-grey);\">edit</span>\n                        </span>\n                    </button>\n                    <button class=\"button is-small context-action-btn context-delete-btn\"\n                            onclick=\"window.showDeleteContextModal('${ctx.id}', '${ctx.name.replace(/'/g, \"\\\\'\")}')\"\n                            title=\"Delete context\"\n                            style=\"padding: 0.35rem; border: none; background: transparent; border-radius: 50%; width: 32px; height: 32px;\">\n                        <span class=\"icon is-small\">\n                            <span class=\"material-symbols-outlined\" style=\"font-size: 18px; color: var(--bulma-grey);\">delete</span>\n                        </span>\n                    </button>\n                </div>\n            </div>\n        `;\n        }).join('');\n    }\n\n    getColorLabel(color: string): string {\n        const labels: { [key: string]: string } = {\n            'text': 'Text (Gray)',\n            'link': 'Link (Blue)',\n            'primary': 'Primary (Cyan)',\n            'info': 'Info (Light Blue)',\n            'success': 'Success (Green)',\n            'warning': 'Warning (Yellow)',\n            'danger': 'Danger (Red)'\n        };\n        return labels[color] || color;\n    }\n\n    setupColorButtons(): void {\n        const hiddenInput = document.getElementById('context-color') as HTMLInputElement | null;\n\n        // Get fresh button references each time\n        const buttons = document.querySelectorAll('#context-color-buttons .color-btn');\n        if (!buttons.length) return;\n\n        buttons.forEach(button => {\n            // Remove old listeners by cloning\n            const newButton = button.cloneNode(true);\n            button.parentNode!.replaceChild(newButton, button);\n        });\n\n        // Get fresh references after cloning\n        const colorButtons = document.querySelectorAll('#context-color-buttons .color-btn');\n\n        colorButtons.forEach(button => {\n            button.addEventListener('click', (e) => {\n                e.preventDefault();\n                const color = (button as HTMLElement).dataset.color;\n\n                // Update hidden input\n                if (hiddenInput && color) hiddenInput.value = color;\n\n                // Update active state - get fresh references again\n                const allButtons = document.querySelectorAll('#context-color-buttons .color-btn');\n                allButtons.forEach(btn => {\n                    (btn as HTMLElement).classList.remove('is-active');\n                    (btn as HTMLElement).style.border = '3px solid transparent';\n                    (btn as HTMLElement).style.borderRadius = '8px';\n                });\n\n                (button as HTMLElement).classList.add('is-active');\n                (button as HTMLElement).style.border = '3px solid var(--bulma-text)';\n                (button as HTMLElement).style.borderRadius = '8px';\n            });\n        });\n    }\n\n    selectColorButton(color: string): void {\n        const colorButtons = document.querySelectorAll('#context-color-buttons .color-btn');\n        const hiddenInput = document.getElementById('context-color') as HTMLInputElement | null;\n\n        if (hiddenInput) hiddenInput.value = color;\n\n        colorButtons.forEach(btn => {\n            (btn as HTMLElement).classList.remove('is-active');\n            (btn as HTMLElement).style.border = '3px solid transparent';\n            (btn as HTMLElement).style.borderRadius = '8px';\n\n            if ((btn as HTMLElement).dataset.color === color) {\n                (btn as HTMLElement).classList.add('is-active');\n                (btn as HTMLElement).style.border = `3px solid var(--bulma-text)`;\n                (btn as HTMLElement).style.borderRadius = '8px';\n            }\n        });\n    }\n\n    normalizeToBulmaColor(color: string): string {\n        // If it's already a Bulma color name, return it\n        const bulmaColors = ['text', 'link', 'primary', 'info', 'success', 'warning', 'danger'];\n        if (bulmaColors.includes(color)) {\n            return color;\n        }\n\n        // Map old hex colors to closest Bulma color\n        const hexToColor: { [key: string]: string } = {\n            '#485fc7': 'primary',\n            '#3e8ed0': 'info',\n            '#48c78e': 'success',\n            '#ffe08a': 'warning',\n            '#f14668': 'danger'\n        };\n\n        return hexToColor[color] || 'primary';\n    }\n\n    setupMobileNavigation(): void {\n        // Toggle sidebar (notes list)\n        this.elements.mobileNotesToggle?.addEventListener('click', () => {\n            this.toggleMobileSidebar();\n        });\n\n        // Toggle calendar\n        this.elements.mobileCalendarToggle?.addEventListener('click', () => {\n            this.toggleMobileCalendar();\n        });\n\n        // Close sidebar\n        this.elements.sidebarClose?.addEventListener('click', () => {\n            this.closeMobileSidebar();\n        });\n\n        // Close calendar\n        this.elements.calendarClose?.addEventListener('click', () => {\n            this.closeMobileCalendar();\n        });\n\n        // Close on overlay click\n        this.elements.sidebarOverlay?.addEventListener('click', () => {\n            this.closeMobileSidebar();\n        });\n\n        this.elements.calendarOverlay?.addEventListener('click', () => {\n            this.closeMobileCalendar();\n        });\n\n        // Close mobile panels when selecting a note\n        if (this.elements.notesList) {\n            this.elements.notesList.addEventListener('click', (e) => {\n                if ((e.target as HTMLElement).tagName === 'A' && window.innerWidth <= 768) {\n                    this.closeMobileSidebar();\n                }\n            });\n        }\n\n        // Clean up mobile panel states on resize\n        window.addEventListener('resize', () => {\n            if (window.innerWidth > 768) {\n                // Remove mobile panel classes and reset styles when returning to desktop\n                if (this.elements.sidebar) {\n                    this.elements.sidebar.classList.remove('mobile-panel', 'active');\n                    this.elements.sidebar.style.display = '';\n                }\n                if (this.elements.calendarPanel) {\n                    this.elements.calendarPanel.classList.remove('mobile-panel', 'active');\n                    this.elements.calendarPanel.style.display = '';\n                }\n                if (this.elements.sidebarOverlay) {\n                    this.elements.sidebarOverlay.classList.remove('active');\n                }\n                if (this.elements.calendarOverlay) {\n                    this.elements.calendarOverlay.classList.remove('active');\n                }\n                document.body.style.overflow = '';\n            }\n        });\n    }\n\n    toggleMobileSidebar(): void {\n        if (!this.elements.sidebar || !this.elements.sidebarOverlay) return;\n\n        // Only work on mobile screens\n        if (window.innerWidth > 768) return;\n\n        const isActive = this.elements.sidebar.classList.contains('mobile-panel');\n\n        if (!isActive) {\n            // Add mobile-panel class and show\n            this.elements.sidebar.classList.add('mobile-panel');\n            this.elements.sidebar.style.display = 'flex';\n        }\n\n        // Toggle active state\n        this.elements.sidebar.classList.toggle('active');\n        this.elements.sidebarOverlay.classList.toggle('active');\n\n        // Prevent body scroll when panel is open\n        if (this.elements.sidebar.classList.contains('active')) {\n            document.body.style.overflow = 'hidden';\n        } else {\n            document.body.style.overflow = '';\n        }\n    }\n\n    closeMobileSidebar(): void {\n        if (!this.elements.sidebar || !this.elements.sidebarOverlay) return;\n\n        this.elements.sidebar.classList.remove('active');\n        this.elements.sidebarOverlay.classList.remove('active');\n        document.body.style.overflow = '';\n    }\n\n    toggleMobileCalendar(): void {\n        if (!this.elements.calendarPanel || !this.elements.calendarOverlay) return;\n\n        // Only work on mobile screens\n        if (window.innerWidth > 768) return;\n\n        const isActive = this.elements.calendarPanel.classList.contains('mobile-panel');\n\n        if (!isActive) {\n            // Add mobile-panel class and show\n            this.elements.calendarPanel.classList.add('mobile-panel');\n            this.elements.calendarPanel.style.display = 'flex';\n        }\n\n        // Toggle active state\n        this.elements.calendarPanel.classList.toggle('active');\n        this.elements.calendarOverlay.classList.toggle('active');\n\n        // Prevent body scroll when panel is open\n        if (this.elements.calendarPanel.classList.contains('active')) {\n            document.body.style.overflow = 'hidden';\n        } else {\n            document.body.style.overflow = '';\n        }\n    }\n\n    closeMobileCalendar(): void {\n        if (!this.elements.calendarPanel || !this.elements.calendarOverlay) return;\n\n        this.elements.calendarPanel.classList.remove('active');\n        this.elements.calendarOverlay.classList.remove('active');\n        document.body.style.overflow = '';\n    }\n\n    updateBreadcrumb(): void {\n        const context = state.get('selectedContext');\n        const selectedDate = state.get('selectedDate');\n        const settings = state.get('userSettings');\n        const timezone = settings.timezone || 'UTC';\n        const dateFormat = settings.dateFormat || 'DD-MM-YY';\n\n        if (this.elements.breadcrumbContextName && context) {\n            this.elements.breadcrumbContextName.textContent = context;\n        }\n\n        if (this.elements.breadcrumbDateName && selectedDate) {\n            // Format date the same way as notes list\n            const [year, month, day] = selectedDate.split('-').map(Number);\n            const dateObj = new Date(year, month - 1, day);\n\n            // Get the day name in English\n            const dayName = dateObj.toLocaleDateString('en-US', {\n                weekday: 'long',\n                timeZone: timezone\n            });\n\n            // Format date based on user preference\n            const yy = String(year).substring(2); // Get last 2 digits of year\n            const mm = String(month).padStart(2, '0');\n            const dd = String(day).padStart(2, '0');\n\n            let dateStr: string;\n            if (dateFormat === 'MM-DD-YY') {\n                dateStr = `${mm}-${dd}-${yy}`;\n            } else {\n                dateStr = `${dd}-${mm}-${yy}`;\n            }\n\n            // Format: \"Monday, 24-10-25.md\" or \"Monday, 10-24-25.md\" depending on dateFormat\n            const formattedDate = `${dayName}, ${dateStr}.md`;\n            this.elements.breadcrumbDateName.textContent = formattedDate;\n        }\n    }\n\n    openFullscreenNote(): void {\n        const context = state.get('selectedContext');\n        const selectedDate = state.get('selectedDate');\n\n        if (!context || !selectedDate) return;\n\n        // Format date for display\n        const settings = state.get('userSettings');\n        const timezone = settings.timezone || 'UTC';\n        const dateFormat = settings.dateFormat || 'DD-MM-YY';\n\n        const [year, month, day] = selectedDate.split('-').map(Number);\n        const dateObj = new Date(year, month - 1, day);\n\n        const dayName = dateObj.toLocaleDateString('en-US', {\n            weekday: 'long',\n            timeZone: timezone\n        });\n\n        const yy = String(year).substring(2);\n        const mm = String(month).padStart(2, '0');\n        const dd = String(day).padStart(2, '0');\n\n        let dateStr: string;\n        if (dateFormat === 'MM-DD-YY') {\n            dateStr = `${mm}-${dd}-${yy}`;\n        } else {\n            dateStr = `${dd}-${mm}-${yy}`;\n        }\n\n        const formattedDate = `${dayName}, ${dateStr}.md`;\n\n        // Get modal elements\n        const modal = document.getElementById('fullscreen-note-modal');\n        const dateEl = document.getElementById('fullscreen-note-date');\n        const editorEl = document.getElementById('fullscreen-note-editor');\n\n        if (!modal || !dateEl || !editorEl) return;\n\n        // Set date\n        dateEl.textContent = formattedDate;\n\n        // Get current note content using the markdown editor\n        const content = markdownEditor.getContent();\n\n        // Create a read-only Quill instance for fullscreen\n        if ((window as any).Quill) {\n            // Clear previous instance if exists\n            editorEl.innerHTML = '';\n\n            const fullscreenQuill = new (window as any).Quill(editorEl, {\n                theme: 'snow',\n                readOnly: true,\n                modules: {\n                    toolbar: false\n                }\n            });\n\n            fullscreenQuill.root.innerHTML = content;\n\n            // Style the editor\n            fullscreenQuill.root.style.fontSize = '16px';\n            fullscreenQuill.root.style.lineHeight = '1.6';\n        } else {\n            // Fallback if Quill not loaded\n            editorEl.innerHTML = content;\n        }\n\n        // Show modal\n        modal.classList.add('is-active');\n\n        // Add escape key listener\n        const escapeHandler = (e: KeyboardEvent) => {\n            if (e.key === 'Escape') {\n                this.closeFullscreenNote();\n                document.removeEventListener('keydown', escapeHandler);\n            }\n        };\n        document.addEventListener('keydown', escapeHandler);\n    }\n\n    closeFullscreenNote(): void {\n        const modal = document.getElementById('fullscreen-note-modal');\n        if (modal) {\n            modal.classList.remove('is-active');\n        }\n    }\n}\n\nexport const ui = new UIManager();\n\n// Expose globally for browser compatibility and HTML onclick handlers\nif (typeof window !== 'undefined') {\n    (window as any).ui = ui;\n\n    // Context modal handlers\n    (window as any).showNewContextModal = () => ui.showContextModal();\n    (window as any).closeContextModal = () => ui.closeContextModal();\n\n    (window as any).createContext = async () => {\n        const nameInput = document.getElementById('context-name') as HTMLInputElement | null;\n        const colorInput = document.getElementById('context-color') as HTMLInputElement | null;\n\n        const name = nameInput?.value.trim();\n        const color = colorInput?.value;\n\n        if (!name) return;\n\n        await contexts.createContext(name, color);\n        ui.closeContextModal();\n\n        await notes.loadNotesList(name);\n        const selectedDate = state.get('selectedDate');\n        if (selectedDate) {\n            await notes.loadNote(name, selectedDate);\n        }\n    };\n\n    // Settings modal handlers\n    (window as any).showSettingsModal = () => ui.showSettingsModal();\n    (window as any).closeSettingsModal = () => ui.closeSettingsModal();\n\n    (window as any).saveSettings = async () => {\n        const saveBtn = document.getElementById('settings-save-btn') as HTMLButtonElement | null;\n        const saveIcon = document.getElementById('settings-save-icon');\n        const saveSpinner = document.getElementById('settings-save-spinner');\n        const saveText = document.getElementById('settings-save-text');\n        const cancelBtn = document.getElementById('settings-cancel-btn') as HTMLButtonElement | null;\n\n        const weekStartSelect = document.getElementById('week-start-select') as HTMLSelectElement | null;\n        const timezoneSelect = document.getElementById('timezone-select') as HTMLSelectElement | null;\n        const dateFormatSelect = document.getElementById('date-format-select') as HTMLSelectElement | null;\n        const uniqueContextModeSwitch = document.getElementById('unique-context-mode-switch') as HTMLInputElement | null;\n        const showBreadcrumbSwitch = document.getElementById('show-breadcrumb-switch') as HTMLInputElement | null;\n        const showMarkdownEditorSwitch = document.getElementById('show-markdown-editor-switch') as HTMLInputElement | null;\n        const hideNewContextButtonSwitch = document.getElementById('hide-new-context-button-switch') as HTMLInputElement | null;\n        const currentSettings = state.get('userSettings');\n\n        const weekStart = parseInt(weekStartSelect?.value || '0');\n        const timezone = timezoneSelect?.value || 'UTC';\n        const dateFormat = dateFormatSelect?.value || 'DD-MM-YY';\n        const uniqueContextMode = uniqueContextModeSwitch?.checked || false;\n        const showBreadcrumb = showBreadcrumbSwitch?.checked === true;\n        const showMarkdownEditor = showMarkdownEditorSwitch?.checked === true;\n        const hideNewContextButton = hideNewContextButtonSwitch?.checked === true;\n        const theme = currentSettings.theme || 'dark';\n\n        // Show loading state\n        if (saveBtn) saveBtn.disabled = true;\n        if (cancelBtn) cancelBtn.disabled = true;\n        if (saveIcon) (saveIcon as HTMLElement).style.display = 'none';\n        if (saveSpinner) (saveSpinner as HTMLElement).style.display = 'inline-block';\n        if (saveText) saveText.textContent = 'Saving...';\n\n        try {\n            await api.updateSettings({ theme, weekStart, timezone, dateFormat, uniqueContextMode, showBreadcrumb, showMarkdownEditor, hideNewContextButton });\n\n            state.set('userSettings', { theme, weekStart, timezone, dateFormat, uniqueContextMode, showBreadcrumb, showMarkdownEditor, hideNewContextButton });\n            calendar.render();\n\n            // Show success state briefly\n            if (saveText) saveText.textContent = 'Saved!';\n            if (saveSpinner) (saveSpinner as HTMLElement).style.display = 'none';\n            if (saveIcon) {\n                (saveIcon as HTMLElement).style.display = 'inline-flex';\n                const iconEl = saveIcon.querySelector('.material-symbols-outlined');\n                if (iconEl) iconEl.textContent = 'check_circle';\n            }\n\n            // Wait a bit before closing to show success\n            await new Promise(resolve => setTimeout(resolve, 500));\n\n            ui.closeSettingsModal();\n\n            // Re-render notes list to update date format\n            ui.renderNotesList();\n\n            // Update UI based on unique context mode\n            ui.updateContextSelectorVisibility();\n\n            // Update breadcrumb and markdown editor visibility\n            ui.updateBreadcrumbVisibility();\n            ui.updateMarkdownEditorVisibility();\n\n            // Update new context button visibility\n            ui.updateNewContextButtonVisibility();\n\n            // If unique context mode is enabled, select first context\n            if (uniqueContextMode) {\n                const contextsList = state.get('contexts');\n                if (contextsList && contextsList.length > 0) {\n                    contexts.selectContext(contextsList[0].name);\n                    notes.setTodayDate();\n                    notes.loadNotesList(contextsList[0].name);\n                }\n            }\n        } catch (error) {\n            console.error('Failed to save settings:', error);\n            notifications.error('Failed to save settings');\n\n            // Reset button state on error\n            if (saveText) saveText.textContent = 'Save';\n            if (saveSpinner) (saveSpinner as HTMLElement).style.display = 'none';\n            if (saveIcon) {\n                (saveIcon as HTMLElement).style.display = 'inline-flex';\n                const iconEl = saveIcon.querySelector('.material-symbols-outlined');\n                if (iconEl) iconEl.textContent = 'check';\n            }\n        } finally {\n            // Re-enable buttons\n            if (saveBtn) saveBtn.disabled = false;\n            if (cancelBtn) cancelBtn.disabled = false;\n        }\n    };\n\n    // Onboarding modal handlers\n    (window as any).closeOnboardingModal = () => ui.closeOnboardingModal();\n\n    // Delete note modal handlers\n    (window as any).closeDeleteNoteModal = () => ui.closeDeleteNoteModal();\n\n    (window as any).confirmDeleteNote = async () => {\n        const modal = document.getElementById('delete-note-modal') as HTMLElement & { dataset: { context?: string; date?: string } } | null;\n        if (!modal) return;\n\n        const context = modal.dataset.context;\n        const dateStr = modal.dataset.date;\n\n        if (context && dateStr) {\n            // Close modal first\n            ui.closeDeleteNoteModal();\n\n            // Delete note immediately (notes module will handle UI updates)\n            await notes.deleteNote(context, dateStr);\n        }\n    };\n\n    // Edit context modal handlers\n    (window as any).showEditContextModal = (contextId: string) => {\n        const contextsList = state.get('contexts');\n        const context = contextsList.find(c => c.id === contextId);\n        if (!context) return;\n\n        const modal = document.getElementById('edit-context-modal') as HTMLElement & { dataset: { contextId?: string } } | null;\n        const nameInput = document.getElementById('edit-context-name') as HTMLInputElement | null;\n        const colorValue = document.getElementById('edit-context-color-value') as HTMLInputElement | null;\n        const colorsContainer = document.getElementById('edit-context-colors');\n\n        if (!modal || !nameInput || !colorValue || !colorsContainer) return;\n\n        // Set values\n        nameInput.value = context.name;\n        const normalizedColor = ui.normalizeToBulmaColor(context.color);\n        colorValue.value = normalizedColor;\n\n        // Render color buttons\n        const colors = ['text', 'link', 'primary', 'info', 'success', 'warning', 'danger'];\n        colorsContainer.innerHTML = colors.map(color => {\n            const isActive = normalizedColor === color;\n            const borderStyle = isActive ? 'border: 3px solid var(--bulma-text)' : 'border: 3px solid transparent';\n            return `\n                <button type=\"button\" class=\"button color-btn ${isActive ? 'is-active' : ''}\"\n                        data-color=\"${color}\"\n                        onclick=\"window.selectEditContextColor('${color}')\"\n                        title=\"${ui.getColorLabel(color)}\"\n                        style=\"width: 32px; height: 32px; padding: 3px; ${borderStyle}; border-radius: 6px;\">\n                    <span style=\"display: block; width: 100%; height: 100%; background: var(--bulma-${color}); border-radius: 4px;\"></span>\n                </button>\n            `;\n        }).join('');\n\n        // Store context ID and show modal\n        modal.dataset.contextId = contextId;\n        modal.classList.add('is-active');\n    };\n\n    (window as any).selectEditContextColor = (color: string) => {\n        const colorValue = document.getElementById('edit-context-color-value') as HTMLInputElement | null;\n        if (!colorValue) return;\n\n        colorValue.value = color;\n\n        // Update button states\n        const buttons = document.querySelectorAll('#edit-context-colors .color-btn');\n        buttons.forEach(btn => {\n            const btnColor = (btn as HTMLElement).dataset.color;\n            if (btnColor === color) {\n                btn.classList.add('is-active');\n                (btn as HTMLElement).style.border = '3px solid var(--bulma-text)';\n            } else {\n                btn.classList.remove('is-active');\n                (btn as HTMLElement).style.border = '3px solid transparent';\n            }\n        });\n    };\n\n    (window as any).closeEditContextModal = () => {\n        const modal = document.getElementById('edit-context-modal') as HTMLElement & { dataset: { contextId?: string } } | null;\n        if (modal) {\n            modal.classList.remove('is-active');\n            delete modal.dataset.contextId;\n        }\n    };\n\n    (window as any).confirmEditContext = async () => {\n        const modal = document.getElementById('edit-context-modal') as HTMLElement & { dataset: { contextId?: string } } | null;\n        if (!modal) return;\n\n        const contextId = modal.dataset.contextId;\n        const nameInput = document.getElementById('edit-context-name') as HTMLInputElement | null;\n        const colorValue = document.getElementById('edit-context-color-value') as HTMLInputElement | null;\n\n        if (!contextId || !nameInput || !colorValue) return;\n\n        const name = nameInput.value.trim();\n        const color = colorValue.value;\n\n        if (!name) {\n            alert('Please enter a context name');\n            return;\n        }\n\n        // Close modal\n        (window as any).closeEditContextModal();\n\n        // Update context\n        await contexts.updateContext(contextId, name, color);\n\n        // Refresh UI\n        ui.renderContextsEditList();\n        ui.renderContextsSelect();\n    };\n\n    // Delete context modal handlers\n    (window as any).showDeleteContextModal = (contextId: string, contextName: string) => {\n        const modal = document.getElementById('delete-context-modal') as HTMLElement & { dataset: { contextId?: string } } | null;\n        const nameElement = document.getElementById('delete-context-name');\n\n        if (modal && nameElement) {\n            nameElement.textContent = contextName;\n            modal.dataset.contextId = contextId;\n            modal.classList.add('is-active');\n        }\n    };\n\n    (window as any).closeDeleteContextModal = () => {\n        const modal = document.getElementById('delete-context-modal') as HTMLElement & { dataset: { contextId?: string } } | null;\n        if (modal) {\n            modal.classList.remove('is-active');\n            delete modal.dataset.contextId;\n        }\n    };\n\n    (window as any).confirmDeleteContext = async () => {\n        const modal = document.getElementById('delete-context-modal') as HTMLElement & { dataset: { contextId?: string } } | null;\n        if (!modal) return;\n\n        const contextId = modal.dataset.contextId;\n\n        if (contextId) {\n            // Close modal first\n            (window as any).closeDeleteContextModal();\n\n            // Delete context (will also delete all its notes)\n            await contexts.deleteContext(contextId);\n\n            // Refresh UI\n            ui.renderContextsEditList();\n            ui.renderContextsSelect();\n        }\n    };\n}\n","/**\n * Main Application Entry Point\n * Initializes and coordinates all modules\n */\n\nimport { state } from './utils/state'\nimport { cache } from './utils/cache'\nimport { api } from './services/api'\nimport { events, EVENT } from './utils/events'\nimport { auth } from './services/auth'\nimport { notes } from './services/notes'\nimport { contexts } from './services/contexts'\nimport { calendar } from './components/Calendar'\nimport { markdownEditor } from './components/Editor'\nimport { notifications } from './components/Notifications'\nimport { ui } from './components/UI'\n\ndeclare global {\n  interface Window {\n    __APP__?: Application\n    __GOOGLE_CLIENT_ID__?: string\n    __DEBUG__?: any\n  }\n}\n\nclass Application {\n  async init(googleClientId: string): Promise<void> {\n    console.log('[MAIN] Initializing with client ID:', googleClientId)\n\n    // Initialize cache\n    try {\n      await cache.init()\n      console.log('Cache initialized')\n    } catch (err) {\n      console.warn('IndexedDB not available', err)\n    }\n\n    // Setup event handlers\n    this.setupEventHandlers()\n\n    // Initialize UI Manager\n    ui.init()\n\n    // Initialize Markdown Editor\n    await markdownEditor.init('markdown-editor-container', (content: string) => {\n      notes.handleNoteInput(content)\n    })\n\n    // Check authentication\n    const isAuthenticated = await auth.checkAuth()\n\n    if (isAuthenticated) {\n      await this.showApp()\n    } else {\n      // Hide app and show auth section\n      const appSection = document.getElementById('app-section')\n      const authSection = document.getElementById('auth-section')\n      if (appSection) appSection.classList.remove('visible')\n      if (authSection) authSection.classList.add('visible')\n    }\n\n    // Make body visible after determining which section to show\n    document.body.classList.add('loaded')\n\n    // Initialize Google OAuth client (async, will wait for script to load)\n    auth.initGoogleClient(googleClientId).catch(error => {\n      console.error('[MAIN] Failed to initialize Google client:', error)\n    })\n  }\n\n  private setupEventHandlers(): void {\n    // Session expired handling\n    events.on('session-expired' as any, (e: CustomEvent) => {\n      if (e.detail.isNoteRequest) {\n        notifications.warning(\n          'Session expired. Your notes are saved locally and will sync when you sign in again.',\n          {\n            title: 'Session Expired',\n            duration: 10000\n          }\n        )\n      }\n    })\n\n    // Note events\n    events.on(EVENT.NOTE_LOADED, (e: CustomEvent) => {\n      markdownEditor.setContent(e.detail.content)\n    })\n\n    events.on(EVENT.NOTE_SAVED, () => {\n      console.log('[Note] Saved')\n    })\n\n    // Context events\n    events.on(EVENT.CONTEXT_CHANGED, async (e: CustomEvent) => {\n      const context = e.detail.context\n\n      // Force flush any pending editor changes\n      markdownEditor.forceFlush()\n\n      // Wait for flush to process\n      await new Promise(resolve => setTimeout(resolve, 100))\n\n      if (context) {\n        let selectedDate = state.get('selectedDate')\n        if (!selectedDate) {\n          selectedDate = (state as any).get('today') as string\n        }\n\n        // Load notes list for context\n        await notes.loadNotesList(context)\n\n        calendar.render()\n        if (selectedDate) {\n          notes.ensureNoteInList(context, selectedDate)\n          await notes.loadNote(context, selectedDate)\n        }\n      } else {\n        markdownEditor.setContent('')\n      }\n    })\n\n    // Date events\n    events.on(EVENT.DATE_CHANGED, async (e: CustomEvent) => {\n      const dateStr = e.detail.date\n      const context = state.get('selectedContext')\n\n      // Force flush pending changes\n      markdownEditor.forceFlush()\n      await new Promise(resolve => setTimeout(resolve, 100))\n\n      if (context) {\n        const currentContext = state.get('selectedContext')\n        const currentDate = state.get('selectedDate')\n\n        if (currentContext !== context || currentDate !== dateStr) {\n          console.log('[MAIN] Context/date changed during handler, skipping')\n          return\n        }\n\n        await notes.loadNote(context, dateStr)\n      }\n    })\n\n    // Auth events\n    events.on('auth-success' as any, async () => {\n      await this.showApp()\n    })\n\n    events.on('auth-logout' as any, () => {\n      markdownEditor.setContent('')\n    })\n\n    // UI events\n    events.on(EVENT.SHOW_ERROR, (e: CustomEvent) => {\n      if (e.detail.message) {\n        notifications.error(e.detail.message)\n      }\n    })\n\n    events.on(EVENT.SHOW_SUCCESS, (e: CustomEvent) => {\n      if (e.detail.message) {\n        notifications.success(e.detail.message)\n      }\n    })\n  }\n\n  private async showApp(): Promise<void> {\n    console.log('[MAIN] showApp called')\n\n    // Hide landing loader\n    const loader = document.getElementById('landing-loader')\n    if (loader) loader.classList.remove('visible')\n\n    // Show app section\n    const appSection = document.getElementById('app-section')\n    const authSection = document.getElementById('auth-section')\n    if (appSection) appSection.classList.add('visible')\n    if (authSection) authSection.classList.remove('visible')\n\n    try {\n      // Load contexts\n      console.log('[MAIN] Loading contexts...')\n      await contexts.loadContexts()\n\n      // Sync server time\n      this.syncServerTime()\n\n      // Set today's date\n      notes.setTodayDate()\n\n      // Render calendar\n      calendar.render()\n\n      // Auto-select last used context\n      const lastContext = contexts.restoreLastContext()\n      console.log('[MAIN] Last context:', lastContext)\n\n      if (lastContext) {\n        // Load notes list\n        await notes.loadNotesList(lastContext)\n\n        // Get today's date\n        const todayDate = (state as any).get('today') as string\n\n        // Ensure today's note exists in the list\n        notes.ensureNoteInList(lastContext, todayDate)\n\n        // Load today's note (create if doesn't exist)\n        await notes.loadNote(lastContext, todayDate)\n      }\n\n      console.log('[MAIN] App initialization complete')\n    } catch (error) {\n      console.error('[MAIN] Error initializing app:', error)\n      notifications.error('Failed to initialize app. Please refresh the page.', {\n        title: 'Initialization Error',\n        duration: 0\n      })\n    }\n  }\n\n  private async syncServerTime(): Promise<void> {\n    try {\n      const settings = state.get('userSettings')\n      const timezone = settings.timezone || 'UTC'\n      const clientTime = Date.now()\n\n      const data = await api.getServerTime(timezone)\n      const serverTime = (data.offset || 0) * 1000\n      const roundTripTime = Date.now() - clientTime\n      const offset = serverTime - clientTime + roundTripTime / 2\n\n      state.set('serverTimeOffset', offset)\n    } catch (error) {\n      console.error('Failed to sync server time:', error)\n    }\n\n    // Resync every minute\n    setTimeout(() => this.syncServerTime(), 60000)\n  }\n\n}\n\n// Initialize app when DOM is ready\nconst app = new Application()\n\n// Expose for window.onload and inline scripts\nwindow.__APP__ = app\n\n// Expose modules for debugging (development only)\nif (typeof window !== 'undefined' && window.location.hostname === 'localhost') {\n  window.__DEBUG__ = {\n    app,\n    state,\n    events,\n    notes,\n    contexts,\n    calendar,\n    auth,\n    api,\n    cache,\n    markdownEditor,\n    notifications,\n    ui\n  }\n  console.log('Debug mode enabled. Access modules via window.__DEBUG__')\n}\n\n// Auto-initialize\n;(async () => {\n  // Wait for template to inject GoogleClientID\n  await new Promise(resolve => setTimeout(resolve, 0))\n\n  // Get client ID from template (will be replaced by Jet)\n  const clientIdMeta = document.querySelector('meta[name=\"google-client-id\"]')\n  const googleClientId = clientIdMeta?.getAttribute('content') || window.__GOOGLE_CLIENT_ID__\n\n  if (googleClientId) {\n    await app.init(googleClientId)\n  } else {\n    console.error('Google Client ID not found')\n  }\n})()\n\nexport default app\n"],"names":["state","constructor","__publicField","this","_state","currentUser","userSettings","theme","weekStart","timezone","dateFormat","uniqueContextMode","showBreadcrumb","showMarkdownEditor","hideNewContextButton","selectedContext","selectedDate","contexts","notes","notesWithDates","currentCalendarMonth","Date","getMonth","currentCalendarYear","getFullYear","isLoggingOut","syncStatus","pending","syncing","serverTimeOffset","_listeners","Map","_computed","get","key","has","set","value","oldValue","_notify","update","changes","Object","entries","forEach","subscribe","callback","Set","add","listeners","delete","subscribeMany","keys","unsubscribers","map","unsub","computed","fn","getState","newValue","error","wildcardListeners","s","now","parts","Intl","DateTimeFormat","timeZone","year","month","day","formatToParts","find","p","type","concat","window","__STATE__","cache","init","Promise","resolve","reject","request","indexedDB","open","dbName","version","onerror","onsuccess","db","result","onupgradeneeded","e","target","objectStoreNames","contains","createObjectStore","keyPath","saveNote","note","id","context","date","pendingWrites","_localTimestamp","_cachedAt","updated_at","toISOString","scheduleBatchWrite","writeTimer","clearTimeout","setTimeout","flushPendingWrites","BATCH_DELAY","size","notesToWrite","Array","from","values","clear","tx","transaction","store","objectStore","put","oncomplete","saveNoteImmediate","getNote","saveNotes","getNotesByContext","getAll","allNotes","filter","n","saveContexts","isArray","ctx","getContexts","deleteNote","EventBus","EventTarget","emit","eventName","detail","dispatchEvent","CustomEvent","on","listener","addEventListener","removeEventListener","once","handler","event","events","EVENT","api","endpoint","options","response","fetch","headers","credentials","ok","data","json","catch","status","isNoteRequest","includes","message","Error","checkAuth","authenticated","login","accessToken","expiresIn","method","body","JSON","stringify","access_token","expires_in","loginWithCode","code","logout","createContext","updateContext","deleteContext","encodeURIComponent","getNotesList","limit","offset","encodedContext","encodedDate","updateSettings","settings","getServerTime","auth","user","initGoogleClient","clientId","initializationPromise","codeClient","checkGoogleLoaded","_b","_a","google","accounts","oauth2","initCodeClient","client_id","scope","ux_mode","handleAuthCodeResponse","loader","document","getElementById","classList","remove","success","signIn","requestCode","signOut","then","err","localStorage","sessionStorage","location","href","reload","clearAllCaches","deleteRequest","deleteDatabase","cacheNames","caches","all","cacheName","signInWithGoogle","loadNote","loadToken","currentLoadToken","cachedNote","content","currentNoteContent","serverUpdatedAt","getTime","cachedUpdatedAt","updateNoteInList","loadNotesList","serverNotes","cachedNotes","noteMap","mergedNotes","sort","a","b","localeCompare","refreshNotesList","updatedNotes","ensureNoteInList","some","newNote","user_id","created_at","updatedNotesWithDates","handleNoteInput","saveTimeout","capturedContext","capturedDate","currentContext","currentDate","selectDate","dateStr","selectToken","currentSelectToken","dateParts","split","parseInt","setTodayDate","Number","getCurrentNoteContent","d","length","nextNote","loadContexts","cachedContexts","navigator","onLine","name","color","newContext","updatedContexts","contextId","currentContexts","c","oldContext","setItem","selectContext","contextName","getSelectedContext","getContextColor","restoreLastContext","firstContext","lastContext","getItem","calendar","render","today","dayNames","dayNamesDefault","slice","monthYearEl","textContent","monthNames","adjustedFirstDay","getDay","daysInMonth","getDate","daysInPrevMonth","grid","html","join","i","String","padStart","classes","push","totalCells","remainingCells","innerHTML","querySelectorAll","dayEl","dataset","prevMonth","nextMonth","goToToday","markdownEditor","containerId","onChange","container","onChangeCallback","ensureQuillLoaded","editor","loadQuill","initQuill","Quill","css","createElement","rel","head","appendChild","script","src","onload","editorElement","modules","toolbar","header","list","placeholder","formats","isUpdating","markdown","getMarkdown","root","getText","trim","applyToolbarVisibility","querySelector","style","display","enable","delta","getContents","currentList","listCounter","ops","op","insert","text","attrs","attributes","trimEnd","repeat","pop","line","substring","lastIndexOf","blockquote","formattedText","bold","italic","strike","link","setContent","contentVersion","updateTimeout","disable","markdownToDelta","setContents","setText","lines","index","headerMatch","match","level","bulletMatch","parseInlineMarkdown","numberedMatch","taskMatch","quoteMatch","startsWith","regex","lastIndex","exec","getContent","setDisabled","disabled","pointerEvents","opacity","editorRoot","setPlaceholderMessage","focus","forceFlush","hasPendingChanges","notifications","className","setAttribute","show","title","duration","defaultDuration","dismissible","onAction","actionLabel","random","notification","element","children","maxVisible","queue","warning","info","escapeHtml","closeBtn","dismiss","actionBtn","requestAnimationFrame","timeout","parentNode","removeChild","processQueue","visibleCount","next","shift","clearAll","div","ui","elements","lastKnownDate","INITIAL_RENDER_COUNT","renderedNotesCount","cacheElements","setupEventListeners","setupStateSubscriptions","setupUserDropdown","setupMobileNavigation","startClock","authSection","appSection","contextSelect","contextColorIndicator","mobileContextSelect","mobileContextColorIndicator","datePicker","breadcrumbContextName","breadcrumbDateName","markdownEditorContainer","saveIndicator","notesList","userEmail","currentTime","contextModal","settingsModal","onboardingModal","syncStatusText","themeToggleMenu","themeToggleSwitch","weekStartSelect","timezoneSelect","mobileNotesToggle","mobileCalendarToggle","sidebar","calendarPanel","sidebarOverlay","calendarOverlay","sidebarClose","calendarClose","editorFullscreenBtn","openFullscreenNote","editorDeleteBtn","dayName","toLocaleDateString","weekday","yy","mm","dd","formattedDateStr","formattedDate","showDeleteNoteModal","_c","async","_d","_e","_f","preventDefault","newTheme","documentElement","getAttribute","setTheme","_g","checked","setupKeyboardShortcuts","modKey","platform","toUpperCase","indexOf","metaKey","ctrlKey","deleteModal","closeDeleteNoteModal","closeAllModals","userDropdown","userDropdownButton","settingsMenuItem","signoutMenuItem","stopPropagation","toggle","showSettingsModal","renderContextsSelect","renderNotesList","_context","updateBreadcrumb","newDate","updateDatePickerDisplay","updateEditorDeleteButton","updateContextIndicator","updateEditorState","email","updateContextSelectorVisibility","updateBreadcrumbVisibility","updateMarkdownEditorVisibility","updateNewContextButtonVisibility","contextsList","optionsHTML","opt","selectedIndex","normalizedColor","normalizeToBulmaColor","background","notesToRender","hasMore","isActive","Math","min","loadMoreBtn","updateSaveIndicator","updateSyncStatus","updateThemeIcon","themeIcon","showApp","_skipAnimation","hasNoContexts","__ENV__","hideApp","showError","msg","showSuccess","showWarning","showInfo","showContextModal","nameInput","colorInput","setupColorButtons","selectColorButton","closeContextModal","dateFormatSelect","uniqueContextModeSwitch","showBreadcrumbSwitch","showMarkdownEditorSwitch","hideNewContextButtonSwitch","accordionContent","accordionIcon","iconElement","renderContextsEditList","saveBtn","saveIcon","saveSpinner","saveText","closeSettingsModal","closeOnboardingModal","modal","updateCurrentDateTime","setInterval","timeOptions","hour","minute","second","hour12","dateOptions","timeString","toLocaleTimeString","dateString","displayElement","desktopContextContainer","mobileContextContainer","breadcrumb","mainSection","removeAttribute","desktopNewContextBtn","mobileNewContextBtn","_index","replace","getColorLabel","primary","danger","hiddenInput","buttons","button","newButton","cloneNode","replaceChild","btn","border","borderRadius","colorButtons","toggleMobileSidebar","toggleMobileCalendar","closeMobileSidebar","closeMobileCalendar","tagName","innerWidth","overflow","dateEl","editorEl","fullscreenQuill","readOnly","fontSize","lineHeight","escapeHandler","closeFullscreenNote","showNewContextModal","saveSettings","cancelBtn","currentSettings","iconEl","confirmDeleteNote","showEditContextModal","colorValue","colorsContainer","borderStyle","selectEditContextColor","closeEditContextModal","confirmEditContext","alert","showDeleteContextModal","nameElement","closeDeleteContextModal","confirmDeleteContext","app","googleClientId","setupEventHandlers","syncServerTime","todayDate","clientTime","serverTime","__APP__","hostname","__DEBUG__","clientIdMeta","__GOOGLE_CLIENT_ID__"],"mappings":"6OA0LO,MAAMA,EAAQ,IApJrB,MAKE,WAAAC,GAJQC,EAAAC,KAAA,UACAD,EAAAC,KAAA,cACAD,EAAAC,KAAA,aAGNA,KAAKC,OAAS,CAEZC,YAAa,KACbC,aAAc,CACZC,MAAO,OACPC,UAAW,EACXC,SAAU,MACVC,WAAY,WACZC,mBAAmB,EACnBC,gBAAgB,EAChBC,oBAAoB,EACpBC,sBAAsB,GAIxBC,gBAAiB,KACjBC,aAAc,KAGdC,SAAU,GACVC,MAAO,GACPC,eAAgB,GAGhBC,sBAAA,IAA0BC,MAAOC,WACjCC,qBAAA,IAAyBF,MAAOG,cAGhCC,cAAc,EACdC,WAAY,CAAEC,QAAS,EAAGC,SAAS,GAGnCC,iBAAkB,GAGpB1B,KAAK2B,eAAiBC,IACtB5B,KAAK6B,cAAgBD,GACvB,CAMA,GAAAE,CAAIC,GACF,OAAI/B,KAAK6B,UAAUG,IAAID,GACd/B,KAAK6B,UAAUC,IAAIC,EAAnB/B,CAAyBA,KAAKC,QAEhCD,KAAKC,OAAO8B,EACrB,CAKA,GAAAE,CAAwBF,EAAQG,GAC9B,MAAMC,EAAWnC,KAAKC,OAAO8B,GACzBI,IAAaD,IAEjBlC,KAAKC,OAAO8B,GAAOG,EACnBlC,KAAKoC,QAAQL,EAAKG,EAAOC,GAC3B,CAKA,MAAAE,CAAOC,GACLC,OAAOC,QAAQF,GAASG,QAAQ,EAAEV,EAAKG,MACrClC,KAAKiC,IAAIF,EAAiBG,IAE9B,CAOA,SAAAQ,CAAUX,EAAqBY,GAO7B,OANK3C,KAAK2B,WAAWK,IAAID,IACvB/B,KAAK2B,WAAWM,IAAIF,EAAK,IAAIa,KAE/B5C,KAAK2B,WAAWG,IAAIC,GAAMc,IAAIF,GAGvB,KACL,MAAMG,EAAY9C,KAAK2B,WAAWG,IAAIC,GAClCe,GACFA,EAAUC,OAAOJ,GAGvB,CAKA,aAAAK,CAAcC,EAAkBN,GAC9B,MAAMO,EAAgBD,EAAKE,IAAIpB,GAAO/B,KAAK0C,UAAUX,EAAKY,IAC1D,MAAO,IAAMO,EAAcT,QAAQW,GAASA,IAC9C,CAKA,QAAAC,CAAYtB,EAAauB,GACvBtD,KAAK6B,UAAUI,IAAIF,EAAKuB,EAC1B,CAKA,QAAAC,GACE,MAAO,IAAKvD,KAAKC,OACnB,CAKQ,OAAAmC,CAA4BL,EAAQyB,EAAuBrB,GACjE,MAAMW,EAAY9C,KAAK2B,WAAWG,IAAIC,GAClCe,GACFA,EAAUL,QAAQE,IAChB,IACIA,EAA8Ba,EAAUrB,EAC5C,OAASsB,GAET,IAKJ,MAAMC,EAAoB1D,KAAK2B,WAAWG,IAAI,KAC1C4B,GACFA,EAAkBjB,QAAQE,IACxB,IACIA,EAA8BZ,EAAKyB,EAAiBrB,EACxD,OAASsB,GAET,GAGN,GAOF5D,EAAMwD,SAAS,QAAUM,IACvB,MAAMrD,EAAWqD,EAAExD,aAAaG,UAAY,MACtCsD,EAAM,IAAI1C,KAAKA,KAAK0C,MAAQD,EAAEjC,kBAS9BmC,EAPY,IAAIC,KAAKC,eAAe,QAAS,CACjDC,SAAU1D,EACV2D,KAAM,UACNC,MAAO,UACPC,IAAK,YAGiBC,cAAcR,GAChCK,EAAOJ,EAAMQ,QAAqB,SAAXC,EAAEC,MAAkBrC,MAC3CgC,EAAQL,EAAMQ,QAAqB,UAAXC,EAAEC,MAAmBrC,MAC7CiC,EAAMN,EAAMQ,QAAqB,QAAXC,EAAEC,MAAiBrC,MAE/C,MAAO,GAAGsC,OAAAP,EAAI,KAAIO,OAAAN,EAAK,KAAIM,OAAAL,KAIP,oBAAXM,SACPA,OAAeC,UAAY7E,GC4CxB,MAAM8E,EAAQ,IA7Od,MAAA,WAAA7E,GACGC,EAAAC,KAAA,KAAyB,MACzBD,EAAAC,KAAA,SAAS,gBACTD,EAAAC,KAAA,UAAU,GAGVD,EAAAC,KAAA,oBAAoB4B,KACpB7B,EAAAC,KAAA,aAA4B,MACnBD,EAAAC,KAAA,cAAc,IAAA,CAE/B,UAAM4E,GACJ,OAAO,IAAIC,QAAQ,CAACC,EAASC,KAC3B,MAAMC,EAAUC,UAAUC,KAAKlF,KAAKmF,OAAQnF,KAAKoF,SAEjDJ,EAAQK,QAAU,IAAMN,EAAOC,EAAQvB,OAEvCuB,EAAQM,UAAY,KAClBtF,KAAKuF,GAAKP,EAAQQ,OAClBV,KAGFE,EAAQS,gBAAmBC,IACzB,MAAMH,EAAMG,EAAEC,OAA4BH,OAErCD,EAAGK,iBAAiBC,SAAS,UAChCN,EAAGO,kBAAkB,QAAS,CAAEC,QAAS,OAGtCR,EAAGK,iBAAiBC,SAAS,aAChCN,EAAGO,kBAAkB,WAAY,CAAEC,QAAS,SAIpD,CAEA,cAAMC,CAASC,GACb,IAAKjG,KAAKuF,GAAI,OAEd,MAAMW,EAAK,GAAG1B,OAAAyB,EAAKE,QAAO,KAAI3B,OAAAyB,EAAKG,MAGnCpG,KAAKqG,cAAcpE,IAAIiE,EAAI,IACtBD,EACHC,KACAI,gBAAiBpF,KAAK0C,MACtB2C,UAAWrF,KAAK0C,MAChB4C,WAAYP,EAAKO,aAAA,IAAkBtF,MAAOuF,gBAI5CzG,KAAK0G,oBACP,CAEQ,kBAAAA,GACF1G,KAAK2G,YACPC,aAAa5G,KAAK2G,YAGpB3G,KAAK2G,WAAalC,OAAOoC,WAAW,KAClC7G,KAAK8G,sBACJ9G,KAAK+G,YACV,CAEA,wBAAcD,GACZ,IAAK9G,KAAKuF,IAAkC,IAA5BvF,KAAKqG,cAAcW,KAAY,OAE/C,MAAMC,EAAeC,MAAMC,KAAKnH,KAAKqG,cAAce,UACnDpH,KAAKqG,cAAcgB,QAEnB,MAAMC,EAAKtH,KAAKuF,GAAGgC,YAAY,CAAC,SAAU,aACpCC,EAAQF,EAAGG,YAAY,SAM7B,OAJAR,EAAaxE,QAAQwD,IACnBuB,EAAME,IAAIzB,KAGL,IAAIpB,QAAQ,CAACC,EAASC,KAC3BuC,EAAGK,WAAa,KAEd7C,KAEFwC,EAAGjC,QAAU,IAAMN,EAAOuC,EAAG7D,QAEjC,CAGA,uBAAMmE,CAAkB3B,GACtB,IAAKjG,KAAKuF,GAAI,OAEd,MAAM+B,EAAKtH,KAAKuF,GAAGgC,YAAY,CAAC,SAAU,aACpCC,EAAQF,EAAGG,YAAY,SACvBvB,EAAK,GAAG1B,OAAAyB,EAAKE,QAAO,KAAI3B,OAAAyB,EAAKG,MAUnC,OARAoB,EAAME,IAAI,IACLzB,EACHC,KACAI,gBAAiBpF,KAAK0C,MACtB2C,UAAWrF,KAAK0C,MAChB4C,WAAYP,EAAKO,aAAA,IAAkBtF,MAAOuF,gBAGrC,IAAI5B,QAAQ,CAACC,EAASC,KAC3BuC,EAAGK,WAAa,IAAM7C,IACtBwC,EAAGjC,QAAU,IAAMN,EAAOuC,EAAG7D,QAEjC,CAEA,aAAMoE,CAAQ1B,EAAiBC,GAC7B,IAAKpG,KAAKuF,GAAI,OAAO,KAErB,MACMiC,EADKxH,KAAKuF,GAAGgC,YAAY,CAAC,SAAU,YACzBE,YAAY,SACvBvB,EAAK,GAAG1B,OAAA2B,EAAO,KAAI3B,OAAA4B,GAEzB,OAAO,IAAIvB,QAASC,IAClB,MAAME,EAAUwC,EAAM1F,IAAIoE,GAC1BlB,EAAQM,UAAY,IAAMR,EAAQE,EAAQQ,QAAU,MACpDR,EAAQK,QAAU,IAAMP,EAAQ,OAEpC,CAEA,eAAMgD,CAAU/G,GACd,IAAKf,KAAKuF,GAAI,OAEd,MAAM+B,EAAKtH,KAAKuF,GAAGgC,YAAY,CAAC,SAAU,aACpCC,EAAQF,EAAGG,YAAY,SACvB7D,EAAM1C,KAAK0C,MAajB,OAXA7C,EAAM0B,QAAQwD,IACZ,MAAMC,EAAK,GAAG1B,OAAAyB,EAAKE,QAAO,KAAI3B,OAAAyB,EAAKG,MACnCoB,EAAME,IAAI,IACLzB,EACHC,KACAI,gBAAiB1C,EACjB2C,UAAW3C,EACX4C,WAAYP,EAAKO,aAAA,IAAkBtF,MAAOuF,kBAIvC,IAAI5B,QAAQ,CAACC,EAASC,KAC3BuC,EAAGK,WAAa,IAAM7C,IACtBwC,EAAGjC,QAAU,IAAMN,EAAOuC,EAAG7D,QAEjC,CAEA,uBAAMsE,CAAkB5B,GACtB,IAAKnG,KAAKuF,GAAI,MAAO,GAErB,MACMiC,EADKxH,KAAKuF,GAAGgC,YAAY,CAAC,SAAU,YACzBE,YAAY,SAE7B,OAAO,IAAI5C,QAASC,IAClB,MAAME,EAAUwC,EAAMQ,SACtBhD,EAAQM,UAAY,KAClB,MAAM2C,EAAWjD,EAAQQ,QAAU,GACnCV,EAAQmD,EAASC,OAAOC,GAAKA,EAAEhC,UAAYA,KAE7CnB,EAAQK,QAAU,IAAMP,EAAQ,KAEpC,CAEA,kBAAMsD,CAAatH,GACjB,IAAKd,KAAKuF,GAAI,OAGd,IAAKzE,IAAaoG,MAAMmB,QAAQvH,GAE9B,OAGF,MAAMwG,EAAKtH,KAAKuF,GAAGgC,YAAY,CAAC,YAAa,aACvCC,EAAQF,EAAGG,YAAY,YAS7B,OAPA3G,EAAS2B,QAAQ6F,IACfd,EAAME,IAAI,IACLY,EACHhC,gBAAiBpF,KAAK0C,UAInB,IAAIiB,QAAQ,CAACC,EAASC,KAC3BuC,EAAGK,WAAa,IAAM7C,IACtBwC,EAAGjC,QAAU,IAAMN,EAAOuC,EAAG7D,QAEjC,CAEA,iBAAM8E,GACJ,IAAKvI,KAAKuF,GAAI,MAAO,GAErB,MACMiC,EADKxH,KAAKuF,GAAGgC,YAAY,CAAC,YAAa,YAC5BE,YAAY,YAE7B,OAAO,IAAI5C,QAASC,IAClB,MAAME,EAAUwC,EAAMQ,SACtBhD,EAAQM,UAAY,IAAMR,EAAQE,EAAQQ,QAAU,IACpDR,EAAQK,QAAU,IAAMP,EAAQ,KAEpC,CAEA,gBAAM0D,CAAWrC,EAAiBC,GAChC,IAAKpG,KAAKuF,GAAI,OAEd,MAAMW,EAAK,GAAG1B,OAAA2B,EAAO,KAAI3B,OAAA4B,GAGzBpG,KAAKqG,cAActD,OAAOmD,GAE1B,MAAMoB,EAAKtH,KAAKuF,GAAGgC,YAAY,CAAC,SAAU,aAK1C,OAJcD,EAAGG,YAAY,SAEvB1E,OAAOmD,GAEN,IAAIrB,QAAQ,CAACC,EAASC,KAC3BuC,EAAGK,WAAa,KAEd7C,KAEFwC,EAAGjC,QAAU,IAAMN,EAAOuC,EAAG7D,QAEjC,CAEA,WAAM4D,GACJ,IAAKrH,KAAKuF,GAAI,OAEd,MAAM+B,EAAKtH,KAAKuF,GAAGgC,YAAY,CAAC,QAAS,YAAa,aAKtD,OAHAD,EAAGG,YAAY,SAASJ,QACxBC,EAAGG,YAAY,YAAYJ,QAEpB,IAAIxC,QAAQ,CAACC,EAASC,KAC3BuC,EAAGK,WAAa,IAAM7C,IACtBwC,EAAGjC,QAAU,IAAMN,EAAOuC,EAAG7D,QAEjC,GCpMF,MAAMgF,UAAiBC,YAIrB,IAAAC,CAA0BC,EAAcC,GACtC7I,KAAK8I,cAAc,IAAIC,YAAYH,EAAW,CAAEC,WAClD,CAKA,EAAAG,CACEJ,EACAjG,GAEA,MAAMsG,EAAWtG,EAEjB,OADA3C,KAAKkJ,iBAAiBN,EAAWK,GAC1B,IAAMjJ,KAAKmJ,oBAAoBP,EAAWK,EACnD,CAKA,IAAAG,CACER,EACAjG,GAEA,MAAMsG,EAAWtG,EACX0G,EAAWC,IACfL,EAASK,GACTtJ,KAAKmJ,oBAAoBP,EAAWS,IAGtC,OADArJ,KAAKkJ,iBAAiBN,EAAWS,GAC1B,IAAMrJ,KAAKmJ,oBAAoBP,EAAWS,EACnD,EAGK,MAAME,EAAS,IAAId,EAGbe,EAGE,cAHFA,EAIC,aAJDA,EAaM,kBAbNA,EAcM,kBAdNA,EAiBG,eAjBHA,EAoBC,aApBDA,EAqBG,eC6ET,MAAMC,EAAM,IA1JZ,MAIL,aAAMzE,CAAiB0E,EAAkBC,EAAuB,IAC9D,IACE,MAAMC,QAAiBC,MAAMH,EAAU,IAClCC,EACHG,QAAS,IACJH,EAAQG,QACX,eAAgB,oBAElBC,YAAa,gBAGf,IAAKH,EAASI,GAAI,CAChB,MAAMC,QAAaL,EAASM,OAAOC,MAAM,KAAA,CAAO,IAEhD,GAAwB,MAApBP,EAASQ,QAAsC,MAApBR,EAASQ,OAAgB,CACtD,IAAKvK,EAAMiC,IAAI,gBAAiB,CAE9B,MAAMuI,EAAgBX,EAASY,SAAS,cAClCC,EAAUF,EACZ,sFACA,uCAEJd,EAAOZ,KAAKa,EAAkB,CAAEe,YAChChB,EAAOZ,KAAK,kBAA0B,CAAE0B,iBAC1C,CAEA,MADAxK,EAAMoC,IAAI,cAAe,MACnB,IAAIuI,MAAM,kBAClB,CAEA,MAAM,IAAIA,MAAMP,EAAKxG,OAAS,8BAA8Be,SAAS4F,QACvE,CAEA,aAAaR,EAASM,MACxB,OAASzG,GASP,MARK5D,EAAMiC,IAAI,iBAET2B,aAAiB+G,QAAU/G,EAAM8G,QAAQD,SAAS,oBACpDf,EAAOZ,KAAKa,EAAkB,CAC5Be,QAAS9G,EAAM8G,SAAW,sBAI1B9G,CACR,CACF,CAGA,eAAMgH,GACJ,IACE,MAAMb,QAAiBC,MAAM,gBAE7B,aADmBD,EAASM,MAE9B,OAASzG,GAEP,MAAO,CAAEiH,eAAe,EAC1B,CACF,CAEA,WAAMC,CAAMC,EAAqBC,GAC/B,aAAa7K,KAAKgF,QAAuB,kBAAmB,CAC1D8F,OAAQ,OACRC,KAAMC,KAAKC,UAAU,CACnBC,aAAcN,EACdO,WAAYN,GAAa,QAG/B,CAEA,mBAAMO,CAAcC,GAClB,aAAarL,KAAKgF,QAAuB,kBAAmB,CAC1D8F,OAAQ,OACRC,KAAMC,KAAKC,UAAU,CAAEI,UAE3B,CAEA,YAAMC,SACEtL,KAAKgF,QAAQ,mBAAoB,CACrC8F,OAAQ,QAEZ,CAGA,iBAAMvC,GACJ,aAAavI,KAAKgF,QAA0B,gBAC9C,CAEA,mBAAMuG,CAActB,GAClB,aAAajK,KAAKgF,QAAiB,gBAAiB,CAClD8F,OAAQ,OACRC,KAAMC,KAAKC,UAAUhB,IAEzB,CAEA,mBAAMuB,CAActF,EAAY+D,GAC9B,aAAajK,KAAKgF,QAAiB,iBAAiBR,OAAA0B,GAAM,CACxD4E,OAAQ,MACRC,KAAMC,KAAKC,UAAUhB,IAEzB,CAEA,mBAAMwB,CAAcvF,SACZlG,KAAKgF,QAAQ,iBAAiBR,OAAA0B,GAAM,CACxC4E,OAAQ,UAEZ,CAGA,aAAMjD,CAAQ1B,EAAiBC,GAC7B,aAAapG,KAAKgF,QAChB,sBAAsBR,OAAAkH,mBAAmBvF,GAAQ,UAAS3B,OAAA4B,GAE9D,CAEA,cAAMJ,CAASiE,GACb,aAAajK,KAAKgF,QAAc,aAAc,CAC5C8F,OAAQ,OACRC,KAAMC,KAAKC,UAAUhB,IAEzB,CAEA,kBAAM0B,CAAaxF,EAAiByF,EAAQ,GAAIC,EAAS,GACvD,aAAa7L,KAAKgF,QAChB,2BAA2BR,OAAAkH,mBAAmBvF,GAAQ,WAAU3B,SAAK,YAAWA,OAAAqH,GAEpF,CAEA,gBAAMrD,CAAWrC,EAAiBC,GAChC,MAAM0F,EAAiBJ,mBAAmBvF,GACpC4F,EAAcL,mBAAmBtF,SAEjCpG,KAAKgF,QAAQ,cAAcR,OAAAsH,EAAc,KAAItH,OAAAuH,GAAe,CAChEjB,OAAQ,UAEZ,CAGA,oBAAMkB,CAAeC,GACnB,aAAajM,KAAKgF,QAAsB,gBAAiB,CACvD8F,OAAQ,MACRC,KAAMC,KAAKC,UAAUgB,IAEzB,CAGA,mBAAMC,CAAc5L,GAClB,MAAMsJ,QAAiBC,MAAM,sBAAsBrF,OAAAkH,mBAAmBpL,KACtE,aAAasJ,EAASM,MACxB,GCkFK,MAAMiC,EAAO,IAzOpB,MAAA,WAAArM,GACUC,EAAAC,KAAA,aAAgC,MAChCD,EAAAC,KAAA,wBAA8C,KAAA,CAEtD,eAAMyK,GACJ,MAAMR,QAAaR,EAAIgB,YAEvB,SAAIR,EAAKS,gBAAiBT,EAAKmC,QAC7BvM,EAAMwC,OAAO,CACXnC,YAAa+J,EAAKmC,KAClBjM,aAAc8J,EAAKmC,KAAKH,UAAY,CAClC7L,MAAO,OACPC,UAAW,EACXC,SAAU,MACVC,WAAY,WACZC,mBAAmB,EACnBC,gBAAgB,EAChBC,oBAAoB,EACpBC,sBAAsB,MAGnB,EAIX,CAEA,sBAAM0L,CAAiBC,GAErB,OAAItM,KAAKuM,sBACAvM,KAAKuM,sBAIVvM,KAAKwM,WACA3H,QAAQC,WAIjB9E,KAAKuM,sBAAwB,IAAI1H,QAAQ,CAACC,EAASC,KAEjD,MAAM0H,EAAoB,aACxB,GAAI,OAAAC,EAAA,OAAAC,EAAAlI,OAAOmI,aAAP,EAAAD,EAAeE,mBAAUC,OAC3B,IAEE9M,KAAKwM,WAAa/H,OAAOmI,OAAOC,SAASC,OAAOC,eAAe,CAC7DC,UAAWV,EACXW,MAAO,4FACPC,QAAS,QACTvK,SAAWiH,GAAa5J,KAAKmN,uBAAuBvD,KAGtD9E,GACF,OAASrB,GAEPsB,EAAOtB,EACT,MAGAoD,WAAW4F,EAAmB,MAKlCA,IAGA5F,WAAW,KACJ7G,KAAKwM,YACRzH,EAAO,IAAIyF,MAAM,8CAElB,OAGExK,KAAKuM,sBACd,CAEA,4BAAMY,CAAuBvD,GAC3B,MAAMwD,EAASC,SAASC,eAAe,kBAEvC,GAAI1D,EAASnG,MAKX,OAJI2J,GAAQA,EAAOG,UAAUC,OAAO,gBACpCjE,EAAOZ,KAAKa,EAAkB,CAC5Be,QAAS,iBAAmBX,EAASnG,QAKzC,IAAKmG,EAASyB,KAKZ,OAJI+B,GAAQA,EAAOG,UAAUC,OAAO,gBACpCjE,EAAOZ,KAAKa,EAAkB,CAC5Be,QAAS,mCAKb,IAEE,MAAMN,QAAaR,EAAI2B,cAAcxB,EAASyB,MAE1CpB,EAAKwD,SAAWxD,EAAKmC,MAIvBvM,EAAMwC,OAAO,CACXnC,YAAa+J,EAAKmC,KAClBjM,aAAc8J,EAAKmC,KAAKH,UAAY,CAClC7L,MAAO,OACPC,UAAW,EACXC,SAAU,MACVC,WAAY,WACZC,mBAAmB,EACnBC,gBAAgB,EAChBC,oBAAoB,EACpBC,sBAAsB,KAM1B4I,EAAOZ,KAAK,eAAuB,MAE/ByE,GAAQA,EAAOG,UAAUC,OAAO,WACpCjE,EAAOZ,KAAKa,EAAkB,CAC5Be,QAASN,EAAKxG,OAAS,iBAG7B,OAASA,GACH2J,GAAQA,EAAOG,UAAUC,OAAO,WACpC,MAAMjD,EAAU9G,aAAiB+G,MAAQ/G,EAAM8G,QAAU,gBACzDhB,EAAOZ,KAAKa,EAAkB,CAC5Be,QAAS,iBAAmBA,GAEhC,CACF,CAEA,YAAMmD,GAEJ,MAAMN,EAASC,SAASC,eAAe,kBACnCF,GAAQA,EAAOG,UAAU1K,IAAI,WAEjC,IAIE,SAFM7C,KAAKuM,uBAENvM,KAAKwM,WACR,MAAM,IAAIhC,MAAM,iCAIlBxK,KAAKwM,WAAWmB,aAClB,OAASlK,GAEH2J,GAAQA,EAAOG,UAAUC,OAAO,WACpCjE,EAAOZ,KAAKa,EAAkB,CAC5Be,QAAS,iEAEb,CACF,CAEA,OAAAqD,GAIE/D,MAAM,mBAAoB,CACxBiB,OAAQ,OACRf,YAAa,gBAEZ8D,KAAK,QAGL1D,MAAM2D,OAMT,IACEC,aAAa1G,QACb2G,eAAe3G,OACjB,OAAS3B,GAET,CAIAmB,WAAW,KACTpC,OAAOwJ,SAASC,KAAO,IAEvBrH,WAAW,IAAMpC,OAAOwJ,SAASE,SAAU,MAC1C,GACL,CAEA,oBAAMC,GACJ,IAEE,MAAMjJ,EAAS,eACTkJ,EAAgBpJ,UAAUqJ,eAAenJ,GAc/C,SAZM,IAAIN,QAAeC,IACvBuJ,EAAc/I,UAAY,KAExBR,KAEFuJ,EAAchJ,QAAU,KAEtBP,OAKA,WAAYL,OAAQ,CACtB,MAAM8J,QAAmBC,OAAOvL,aAC1B4B,QAAQ4J,IACZF,EAAWpL,IAAIuL,GAENF,OAAOzL,OAAO2L,IAI3B,CAGAX,aAAa1G,QACb2G,eAAe3G,OAEjB,OAAS5D,GAGT,CACF,GAMoB,oBAAXgB,SACRA,OAAekK,iBAAmB,IAAMxC,EAAKuB,UC0IzC,MAAM3M,EAAQ,IAlZrB,MAAA,WAAAjB,GACUC,EAAAC,KAAA,cAA6B,MAC7BD,EAAAC,KAAA,qBAAqB,IACrBD,EAAAC,KAAA,mBAAmB,GACnBD,EAAAC,KAAA,qBAAqB,EAAA,CAE7B,cAAM4O,CAASzI,EAAiBC,GAC9B,IAAKD,IAAYC,EACf,OAAO,KAIT,MAAMyI,IAAc7O,KAAK8O,iBAInBC,QAAmBpK,EAAMkD,QAAQ1B,EAASC,GAGhD,GAAIyI,IAAc7O,KAAK8O,iBAErB,OAAO,KAGLC,GAAcA,EAAWC,SAE3BhP,KAAKiP,mBAAqBF,EAAWC,QACrCzF,EAAOZ,KAAKa,EAAmB,CAC7BrD,UACAC,OACA4I,QAAShP,KAAKiP,uBAIhBjP,KAAKiP,mBAAqB,GAC1B1F,EAAOZ,KAAKa,EAAmB,CAC7BrD,UACAC,OACA4I,QAAS,MAKb,IACE,MAAM/I,KAAEA,SAAewD,EAAI5B,QAAQ1B,EAASC,GAG5C,GAAIyI,IAAc7O,KAAK8O,iBAErB,OAAO,KAIT,MAAMI,EAAkBjJ,EAAKO,WAAa,IAAItF,KAAK+E,EAAKO,YAAY2I,UAAY,EAC1EC,SAAkBL,WAAYvI,YAAa,IAAItF,KAAK6N,EAAWvI,YAAY2I,UAAY,EAgC7F,QA5BGJ,GACDG,EAAkBE,GACjBnJ,EAAK+I,UAAYD,EAAWC,WAG7BhP,KAAKiP,mBAAqBhJ,EAAK+I,SAAW,SAGpCrK,EAAMqB,SAAS,IAChBC,EACHE,UACAC,OACA4I,QAAS/I,EAAK+I,QACdxI,WAAYP,EAAKO,aAIduI,GAAcA,EAAWC,UAAY/I,EAAK+I,SAC7CzF,EAAOZ,KAAKa,EAAmB,CAC7BrD,UACAC,OACA4I,QAAShP,KAAKiP,sBAObhJ,CACT,OAASxC,GAEP,OAAIoL,IAAc7O,KAAK8O,iBAEd,MAIJC,GAEHxF,EAAOZ,KAAKa,EAAkB,CAC5Be,QAAS,0CAKNwE,EACT,CACF,CAEA,cAAM/I,CAASG,EAAiBC,EAAc4I,GAC5C,IAAK7I,IAAYC,EAAM,OAIvB,MAAMxC,GAAA,IAAU1C,MAAOuF,cACjBR,EAAO,CACXE,UACAC,OACA4I,UACAxI,WAAY5C,SAIRe,EAAMqB,SAASC,GACrBjG,KAAKiP,mBAAqBD,EAI1BzF,EAAOZ,KAAKa,EAAkB,CAAErD,UAASC,OAAM4I,YAG/ChP,KAAKqP,iBAAiBlJ,EAASC,EAAM4I,GAIrC,UACQvF,EAAIzD,SAAS,CAAEG,UAASC,OAAM4I,UAASxI,WAAY5C,GAE3D,OAASH,GAGT,CACF,CAEA,mBAAM6L,CAAcnJ,EAAiByF,EAAQ,GAAIC,EAAS,GACxD,IAAK1F,EAKH,OAJAtG,EAAMwC,OAAO,CACXtB,MAAO,GACPC,eAAgB,KAEX,GAGT,IACE,MACMuO,SADa9F,EAAIkC,aAAaxF,EAASyF,EAAOC,IAC3B9K,OAAS,GAG5ByO,QAAoB7K,EAAMoD,kBAAkB5B,GAG5CsJ,MAAc7N,IAGpB2N,EAAY9M,QAAQwD,IAClBwJ,EAAQxN,IAAIgE,EAAKG,KAAMH,KAIzBuJ,EAAY/M,QAAQwD,IACbwJ,EAAQzN,IAAIiE,EAAKG,OACpBqJ,EAAQxN,IAAIgE,EAAKG,KAAMH,KAK3B,MAAMyJ,EAAcxI,MAAMC,KAAKsI,EAAQrI,UAAUuI,KAAK,CAACC,EAAGC,IACjDA,EAAEzJ,KAAK0J,cAAcF,EAAExJ,OAG1BpF,EAAiB0O,EAAYvM,IAAI8C,GAAQA,EAAKG,MAOpD,OALAvG,EAAMwC,OAAO,CACXtB,MAAO2O,EACP1O,mBAGK0O,CACT,OAASjM,GAEP,MAAO,EACT,CACF,CAEA,sBAAMsM,CAAiB5J,SACfnG,KAAKsP,cAAcnJ,EAC3B,CAEA,gBAAAkJ,CAAiBlJ,EAAiBC,EAAc4I,GAC9C,MAGMgB,EAHQnQ,EAAMiC,IAAI,SAGGqB,IAAI8C,GACzBA,EAAKG,OAASA,GAAQH,EAAKE,UAAYA,EAClC,IACFF,EACH+I,UACAxI,YAAA,IAAgBtF,MAAOuF,eAGpBR,GAITpG,EAAMoC,IAAI,QAAS+N,EACrB,CAEA,gBAAAC,CAAiB9J,EAAiBC,SAChC,MAAMrF,EAAQlB,EAAMiC,IAAI,SAClBd,EAAiBnB,EAAMiC,IAAI,kBAKjC,IAFmBf,EAAMmP,KAAKjK,GAAQA,EAAKG,OAASA,GAEnC,CAEf,MAAM+J,EAAgB,CACpBjK,GAAI,QAAQ1B,OAAA2B,EAAO,KAAI3B,OAAA4B,GACvBgK,SAAS,OAAAzD,EAAA9M,EAAMiC,IAAI,yBAAgBoE,KAAM,GACzCC,UACAC,OACA4I,QAAS,GACTqB,YAAA,IAAgBnP,MAAOuF,cACvBD,YAAA,IAAgBtF,MAAOuF,eAInBuJ,EAAe,IAAIjP,EAAOoP,GAASR,KAAK,CAACC,EAAGC,IACzCA,EAAEzJ,KAAK0J,cAAcF,EAAExJ,OAI1BkK,EAAwB,IAAItP,EAAgBoF,GAGlDvG,EAAMwC,OAAO,CACXtB,MAAOiP,EACPhP,eAAgBsP,GAEpB,CACF,CAEA,eAAAC,CAAgBvB,GACVhP,KAAKwQ,aACP5J,aAAa5G,KAAKwQ,aAIpBxQ,KAAKiP,mBAAqBD,EAG1B,MAAMyB,EAAkB5Q,EAAMiC,IAAI,mBAC5B4O,EAAe7Q,EAAMiC,IAAI,gBAE1B2O,GAAoBC,IAGzB1Q,KAAKwQ,YAAc/L,OAAOoC,WAAW,KAEnC,MAAM8J,EAAiB9Q,EAAMiC,IAAI,mBAC3B8O,EAAc/Q,EAAMiC,IAAI,gBAI1B6O,IAAmBF,GAAmBG,IAAgBF,GAGxD1Q,KAAKgG,SAASyK,EAAiBC,EAAc1Q,KAAKiP,qBAMnD,KACL,CAEA,gBAAM4B,CAAWC,GAEf,MAAMC,IAAgB/Q,KAAKgR,mBAGrB7K,EAAUtG,EAAMiC,IAAI,mBAGpBmP,EAAYH,EAAQI,MAAM,KAC1BjN,EAAOkN,SAASF,EAAU,IAC1B/M,EAAQiN,SAASF,EAAU,IAAM,EAUvC,GAPApR,EAAMwC,OAAO,CACXxB,aAAciQ,EACd7P,qBAAsBiD,EACtB9C,oBAAqB6C,IAInB8M,IAAgB/Q,KAAKgR,qBAKzBzH,EAAOZ,KAAKa,EAAoB,CAAEpD,KAAM0K,IAGpC3K,GAAS,CAEX,GAAI4K,IAAgB/Q,KAAKgR,mBAEvB,OAIFhR,KAAKiQ,iBAAiB9J,EAAS2K,SACzB9Q,KAAK4O,SAASzI,EAAS2K,EAC/B,CACF,CAEA,YAAAM,GACE,MAAMN,EAAWjR,EAAciC,IAAI,UAC5BmC,EAAMC,GAAS4M,EAAQI,MAAM,KAAK/N,IAAIkO,QAE7CxR,EAAMwC,OAAO,CACXxB,aAAciQ,EACd7P,qBAAsBiD,EAAQ,EAC9B9C,oBAAqB6C,GAEzB,CAEA,qBAAAqN,GACE,OAAOtR,KAAKiP,kBACd,CAEA,gBAAMzG,CAAWrC,EAAiBC,GAChC,IAAKD,IAAYC,EAAM,OAKnBpG,KAAKwQ,cACP5J,aAAa5G,KAAKwQ,aAClBxQ,KAAKwQ,YAAc,YAKf7L,EAAM6D,WAAWrC,EAASC,GAGhC,MACM4J,EADQnQ,EAAMiC,IAAI,SACGoG,OAAOjC,KAAUA,EAAKG,OAASA,GAAQH,EAAKE,UAAYA,IAG7EmK,EADiBzQ,EAAMiC,IAAI,kBACYoG,OAAOqJ,GAAKA,IAAMnL,GAE/DvG,EAAMwC,OAAO,CACXtB,MAAOiP,EACPhP,eAAgBsP,IAKlB,GADqBzQ,EAAMiC,IAAI,kBACVsE,EAKnB,GAHApG,KAAKiP,mBAAqB,GAGtBe,EAAawB,OAAS,EAAG,CAE3B,MAAMC,EAAWzB,EAAa,SACxBhQ,KAAK6Q,WAAWY,EAASrL,KACjC,MAEEpG,KAAKoR,eACL7H,EAAOZ,KAAKa,EAAmB,CAC7BrD,UACAC,OACA4I,QAAS,KAMf,UACQvF,EAAIjB,WAAWrC,EAASC,EAEhC,OAAS3C,GAGT,CAGF,GClOK,MAAM3C,EAAW,IA7KxB,MACE,kBAAM4Q,GAEJ,MAAMC,QAAuBhN,EAAM4D,cAE/BoJ,EAAeH,OAAS,GAC1B3R,EAAMoC,IAAI,WAAY0P,GAIxB,IAEE,MAAM/H,QAAiBH,EAAIlB,cAGrBzH,GAAW,MAAA8I,OAAA,EAAAA,EAAU9I,WAAY,SAEjC6D,EAAMyD,aAAatH,GACzBjB,EAAMoC,IAAI,WAAYnB,GACtByI,EAAOZ,KAAKa,EAAuB,CAAE1I,SAAAA,GACvC,OAAS2C,GAGuB,IAA1BkO,EAAeH,QAAiBI,UAAUC,QAC5CtI,EAAOZ,KAAKa,EAAkB,CAC5Be,QAAS,6CAIf,CACF,CAEA,mBAAMgB,CAAcuG,EAAcC,SAChC,MAAMC,EAAsB,CAC1B9L,GAAI,QAAQ1B,OAAAtD,KAAK0C,OACjBwM,SAAS,OAAAzD,EAAA9M,EAAMiC,IAAI,yBAAgBoE,KAAM,GACzC4L,OACAC,MAAOA,GAAS,UAChB1B,YAAA,IAAgBnP,MAAOuF,eAKnBwL,EAAkB,IADApS,EAAMiC,IAAI,YACWkQ,SAEvCrN,EAAMyD,aAAa6J,GACzBpS,EAAMoC,IAAI,WAAYgQ,GACtBpS,EAAMoC,IAAI,kBAAmB6P,GAG7B,UACQrI,EAAI8B,cAAc,CAAEuG,OAAMC,gBAG1B/R,KAAK0R,cACb,OAASjO,GAGT,CAEA,OAAOuO,CACT,CAEA,mBAAMxG,CAAc0G,EAAmBJ,EAAcC,GACnD,UACQtI,EAAI+B,cAAc0G,EAAW,CAAEJ,OAAMC,UAG3C,MAAMI,EAAkBtS,EAAMiC,IAAI,YAC5BmQ,EAAkBE,EAAgBhP,IAAIiP,GAAMA,EAAElM,KAAOgM,EAAY,IAAKE,EAAGN,OAAMC,SAAUK,SAEzFzN,EAAMyD,aAAa6J,GACzBpS,EAAMoC,IAAI,WAAYgQ,GAGtB,MAAMrR,EAAkBf,EAAMiC,IAAI,mBAC5BuQ,EAAaF,EAAgB9N,KAAK+N,GAAKA,EAAElM,KAAOgM,GAOtD,OANItR,WAAoByR,WAAYP,QAClCjS,EAAMoC,IAAI,kBAAmB6P,GAC7B/D,aAAauE,QAAQ,cAAeR,IAGtCvI,EAAOZ,KAAKa,EAAoB,CAAEe,QAAS,kCACpC,CACT,OAAS9G,GAEP,OADA8F,EAAOZ,KAAKa,EAAkB,CAAEe,QAAS,8BAClC,CACT,CACF,CAEA,mBAAMkB,CAAcyG,GAClB,UACQzI,EAAIgC,cAAcyG,GAExB,MACMD,EADkBpS,EAAMiC,IAAI,YACMoG,OAAOkK,GAAKA,EAAElM,KAAOgM,SAEvDvN,EAAMyD,aAAa6J,GACzBpS,EAAMoC,IAAI,WAAYgQ,GAEtB1I,EAAOZ,KAAKa,EAAoB,CAAEe,QAAS,gCAC7C,OAAS9G,GACP8F,EAAOZ,KAAKa,EAAkB,CAAEe,QAAS,4BAC3C,CACF,CAEA,aAAAgI,CAAcC,GACZ3S,EAAMoC,IAAI,kBAAmBuQ,GAC7BjJ,EAAOZ,KAAKa,EAAuB,CAAErD,QAASqM,IAG1CA,GACFzE,aAAauE,QAAQ,cAAeE,EAExC,CAEA,kBAAAC,GACE,OAAO5S,EAAMiC,IAAI,kBACnB,CAEA,eAAA4Q,CAAgBF,GACd,MACMrM,EADWtG,EAAMiC,IAAI,YACFuC,KAAK+N,GAAKA,EAAEN,OAASU,GAExCT,SAAQ5L,WAAS4L,QAAS,UAEhC,MADoB,CAAC,OAAQ,OAAQ,UAAW,OAAQ,UAAW,UAAW,UAC3DzH,SAASyH,GAASA,EAAQ,SAC/C,CAEA,kBAAAY,GACE,MAAM7R,EAAWjB,EAAMiC,IAAI,YAErBtB,EADWX,EAAMiC,IAAI,gBACQtB,oBAAqB,EAMxD,IAAKM,GAAgC,IAApBA,EAAS0Q,OAExB,OAAO,KAIT,GAAIhR,EAAmB,CACrB,MAAMoS,EAAe9R,EAAS,GAAGgR,KAGjC,OADA9R,KAAKuS,cAAcK,GACZA,CACT,CAEA,MAAMC,EAAc9E,aAAa+E,QAAQ,eAIzC,GAAID,EAAa,CAGf,GAFsB/R,EAASoP,KAAKkC,GAAKA,EAAEN,OAASe,GAKlD,OADA7S,KAAKuS,cAAcM,GACZA,CAEX,CAGA,MAAMD,EAAe9R,EAAS,GAAGgR,KAGjC,OADA9R,KAAKuS,cAAcK,GACZA,CACT,GC9CK,MAAMG,EAAW,IA/HxB,MAAA,WAAAjT,GACUC,EAAAC,KAAA,aAAa,CACnB,UACA,WACA,QACA,QACA,MACA,OACA,OACA,SACA,YACA,UACA,WACA,aAEMD,EAAAC,KAAA,kBAAkB,CAAC,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,OAAK,CAE1E,MAAAgT,GACE,MACM3S,EADWR,EAAMiC,IAAI,gBACAzB,WAAa,EAClC6D,EAAQrE,EAAMiC,IAAI,wBAClBmC,EAAOpE,EAAMiC,IAAI,uBACjBjB,EAAehB,EAAMiC,IAAI,gBACzBmR,EAASpT,EAAciC,IAAI,SAC3Bd,EAAiBnB,EAAMiC,IAAI,kBAE3BoR,EAAW,IACZlT,KAAKmT,gBAAgBC,MAAM/S,MAC3BL,KAAKmT,gBAAgBC,MAAM,EAAG/S,IAG7BgT,EAAchG,SAASC,eAAe,uBACxC+F,IACFA,EAAYC,YAAc,GAAG9O,OAAAxE,KAAKuT,WAAWrP,GAAM,KAAIM,OAAAP,IAGzD,MACMuP,GADkB,IAAItS,KAAK+C,EAAMC,EAAO,GAAGuP,SACLpT,EAAY,GAAK,EACvDqT,EAAc,IAAIxS,KAAK+C,EAAMC,EAAQ,EAAG,GAAGyP,UAC3CC,EAAkB,IAAI1S,KAAK+C,EAAMC,EAAO,GAAGyP,UAE3CE,EAAOxG,SAASC,eAAe,iBACrC,IAAKuG,EAAM,OAGX,IAAIC,EAAOZ,EAAS/P,IAAIgB,GAAO,oCAAoCK,OAAAL,EAAG,WAAU4P,KAAK,IAGrF,IAAA,IAASC,EAAIR,EAAmB,EAAGQ,GAAK,EAAGA,IAAK,CAE9CF,GAAQ,yCAAyCtP,OADrCoP,EAAkBI,EACsB,SACtD,CAGA,IAAA,IAAS7P,EAAM,EAAGA,GAAOuP,EAAavP,IAAO,CAC3C,MAAM2M,EAAU,GAAGtM,OAAAP,EAAI,KAAIO,OAAAyP,OAAO/P,EAAQ,GAAGgQ,SAAS,EAAG,KAAI,KAAI1P,OAAAyP,OAAO9P,GAAK+P,SAAS,EAAG,MACnFC,EAAU,CAAC,gBAEbrD,IAAYmC,GAAOkB,EAAQC,KAAK,SAChCtD,IAAYjQ,GAAcsT,EAAQC,KAAK,YACvCpT,EAAesJ,SAASwG,IAAUqD,EAAQC,KAAK,YAEnDN,GAAQ,eAAetP,SAAQuP,KAAK,KAAI,iBAAgBvP,OAAAsM,EAAO,MAAKtM,OAAAL,EAAG,SACzE,CAGA,MAAMkQ,EAAab,EAAmBE,EAChCY,EAAiBD,EAAa,GAAM,EAAI,EAAI,EAAKA,EAAa,EACpE,IAAA,IAASlQ,EAAM,EAAGA,GAAOmQ,EAAgBnQ,IACvC2P,GAAQ,yCAAyCtP,OAAAL,EAAG,UAGtD0P,EAAKU,UAAYT,EAGjBD,EAAKW,iBAAiB,mCAAmC/R,QAAQgS,IAC/DA,EAAMvL,iBAAiB,QAAS,KAC9B,MAAM4H,EAAW2D,EAAsBC,QAAQtO,KAC3C0K,GACF/P,EAAM8P,WAAWC,MAIzB,CAEA,SAAA6D,GACE,IAAIzQ,EAAQrE,EAAMiC,IAAI,wBAClBmC,EAAOpE,EAAMiC,IAAI,uBAErBoC,IACIA,EAAQ,IACVA,EAAQ,GACRD,KAGFpE,EAAMwC,OAAO,CACXpB,qBAAsBiD,EACtB9C,oBAAqB6C,IAGvBjE,KAAKgT,QACP,CAEA,SAAA4B,GACE,IAAI1Q,EAAQrE,EAAMiC,IAAI,wBAClBmC,EAAOpE,EAAMiC,IAAI,uBAErBoC,IACIA,EAAQ,KACVA,EAAQ,EACRD,KAGFpE,EAAMwC,OAAO,CACXpB,qBAAsBiD,EACtB9C,oBAAqB6C,IAGvBjE,KAAKgT,QACP,CAEA,SAAA6B,GACE,MAAM5B,EAASpT,EAAciC,IAAI,SACjCf,EAAM8P,WAAWoC,EACnB,GC0VK,MAAM6B,EAAiB,IAvc9B,MAAA,WAAAhV,GACUC,EAAAC,KAAA,YAAgC,MAChCD,EAAAC,KAAA,SAAc,MACdD,EAAAC,KAAA,gBAAoC,MACpCD,EAAAC,KAAA,mBAAuD,MACvDD,EAAAC,KAAA,cAAa,GACbD,EAAAC,KAAA,qBAAqB,IACrBD,EAAAC,KAAA,gBAA+B,MAC/BD,EAAAC,KAAA,iBAAiB,EAAA,CAEzB,UAAM4E,CAAKmQ,EAAqBC,GAC9BhV,KAAKiV,UAAY5H,SAASC,eAAeyH,GACpC/U,KAAKiV,YAKVjV,KAAKkV,iBAAmBF,EAIxBhV,KAAKiV,UAAUV,UACb,oGACJ,CAEA,uBAAMY,GAECnV,KAAKoV,eACFpV,KAAKqV,YACXrV,KAAKgT,SACLhT,KAAKsV,YAET,CAEA,eAAcD,GACZ,GAAI5Q,OAAO8Q,MAAO,OAGlB,MAAMC,EAAMnI,SAASoI,cAAc,QACnCD,EAAIE,IAAM,aACVF,EAAItH,KAAO,sCACXb,SAASsI,KAAKC,YAAYJ,GAG1B,MAAMK,EAASxI,SAASoI,cAAc,UACtCI,EAAOC,IAAM,oCACbzI,SAASsI,KAAKC,YAAYC,SAGpB,IAAIhR,QAAcC,IACtB+Q,EAAOE,OAAS,IAAMjR,KAE1B,CAEQ,MAAAkO,GACDhT,KAAKiV,YAEVjV,KAAKiV,UAAUV,UAAY,wGAM3BvU,KAAKgW,cAAgB3I,SAASC,eAAe,gBAC/C,CAEQ,SAAAgI,GACN,GAAK7Q,OAAO8Q,MAKZ,IACEvV,KAAKoV,OAAS,IAAI3Q,OAAO8Q,MAAMvV,KAAKgW,cAAe,CACjD5V,MAAO,OACP6V,QAAS,CACPC,QAAS,CACP,CAAC,CAAEC,OAAQ,CAAC,EAAG,EAAG,GAAG,KACrB,CAAC,OAAQ,SAAU,UACnB,CAAC,CAAEC,KAAM,WAAa,CAAEA,KAAM,WAC9B,CAAC,aAAc,cACf,CAAC,QACD,CAAC,WAGLC,YAAa,8BACbC,QAAS,CAAC,OAAQ,SAAU,SAAU,SAAU,OAAQ,aAAc,aAAc,UAItFtW,KAAKoV,OAAOpM,GAAG,cAAe,KAC5B,IAAIhJ,KAAKuW,YAELvW,KAAKkV,iBAAkB,CACzB,MAAMsB,EAAWxW,KAAKyW,cACtBzW,KAAKkV,iBAAiBsB,EACxB,IAIFxW,KAAKoV,OAAOsB,KAAKxN,iBAAiB,QAAS,KACJ,KAAjClJ,KAAKoV,OAAOuB,UAAUC,SACxB5W,KAAKoV,OAAOsB,KAAKhC,QAAQ2B,YAAc,MAK3CrW,KAAKoV,OAAOsB,KAAKxN,iBAAiB,OAAQ,KACH,KAAjClJ,KAAKoV,OAAOuB,UAAUC,SACxB5W,KAAKoV,OAAOsB,KAAKhC,QAAQ2B,YAAc,iCAK3CrW,KAAK6W,wBACP,OAASpT,GAET,CACF,CAEQ,sBAAAoT,SACN,MACMnW,GAAqD,IAD1Cb,EAAMiC,IAAI,gBACSpB,mBAE9BwV,EAAU,OAAAvJ,EAAA3M,KAAKiV,gBAAL,EAAAtI,EAAgBmK,cAAc,eAO9C,GANIZ,IACFA,EAAQa,MAAMC,QAAUtW,EAAqB,GAAK,QAKhDV,KAAKoV,OAAQ,CACf,MAAMjP,EAAUtG,EAAMiC,IAAI,mBAC1B9B,KAAKoV,OAAO6B,SAAO9Q,EACrB,CACF,CAEQ,WAAAsQ,GACN,IAAKzW,KAAKoV,OAAQ,MAAO,GAEzB,MAAM8B,EAAQlX,KAAKoV,OAAO+B,cAC1B,IAAIX,EAAW,GACXY,EAA6B,KAC7BC,EAAc,EAqElB,OAnEAH,EAAMI,IAAI7U,QAAS8U,IACjB,IAAKA,EAAGC,OAAQ,OAEhB,MAAMC,EAA4B,iBAAdF,EAAGC,OAAsBD,EAAGC,OAAS,GACnDE,EAAQH,EAAGI,YAAc,CAAA,EAG/B,GAAa,OAATF,EAEF,GAAIC,EAAMvB,OACRK,EAAWA,EAASoB,UACpBpB,EAAW,IAAIqB,OAAOH,EAAMvB,QAAU,IAAMK,EAAStF,MAAM,MAAM4G,MACjEtB,GAAY,YACd,GAESkB,EAAMtB,KAAM,CACfsB,EAAMtB,OAASgB,IACjBA,EAAcM,EAAMtB,KACpBiB,EAAc,GAEhB,MAAMU,EAAOvB,EAAStF,MAAM,MAAM4G,MAClCtB,EAAWA,EAASwB,UAAU,EAAGxB,EAASyB,YAAY,MAAQ,GAE3C,YAAfP,EAAMtB,KACRI,GAAY,GAAGhS,OAAA6S,IAAa,MAAK7S,OAAAuT,EAAI,MACb,WAAfL,EAAMtB,KACfI,GAAY,KAAKhS,OAAAuT,EAAI,MACG,UAAfL,EAAMtB,OACfI,GAAY,SAAShS,OAAAuT,EAAI,MAE7B,MAGE,GAFAX,EAAc,KACdC,EAAc,EACVK,EAAMQ,WAAY,CACpB,MAAMH,EAAOvB,EAAStF,MAAM,MAAM4G,MAClCtB,EAAWA,EAASwB,UAAU,EAAGxB,EAASyB,YAAY,MAAQ,GAC9DzB,GAAY,KAAKhS,OAAAuT,EAAI,KACvB,MAAWL,EAAM,cACflB,GAAY,UAEZA,GAAY,SAGX,CACL,IAAI2B,EAAgBV,EAGhBC,EAAMU,OACRD,EAAgB,KAAK3T,OAAA2T,EAAa,OAEhCT,EAAMW,SACRF,EAAgB,IAAI3T,OAAA2T,EAAa,MAE/BT,EAAMY,SACRH,EAAgB,KAAK3T,OAAA2T,EAAa,OAEhCT,EAAMrM,OACR8M,EAAgB,IAAK3T,OAAA2T,EAAa,MAEhCT,EAAMa,OACRJ,EAAgB,IAAI3T,OAAA2T,EAAa,MAAK3T,OAAAkT,EAAMa,KAAI,MAGlD/B,GAAY2B,CACd,IAGK3B,EAASI,MAClB,CAEA,gBAAM4B,CAAWxJ,GAIf,SAFMhP,KAAKmV,qBAENnV,KAAKoV,OAAQ,OAGlBpV,KAAKyY,iBACkBzY,KAAKyY,eAIxBzY,KAAK0Y,gBACP9R,aAAa5G,KAAK0Y,eAClB1Y,KAAK0Y,cAAgB,MAKvB1Y,KAAKoV,OAAOuD,UACZ3Y,KAAKuW,YAAa,EAElB,IACE,GAAKvH,EAGE,CAEL,MAAMkI,EAAQlX,KAAK4Y,gBAAgB5J,GACnChP,KAAKoV,OAAOyD,YAAY3B,GAGxBlX,KAAKiP,mBAAqBD,CAC5B,MATEhP,KAAKoV,OAAO0D,QAAQ,IACpB9Y,KAAKiP,mBAAqB,EAS9B,CAAA,QAEEjP,KAAK0Y,cAAgBjU,OAAOoC,WAAW,KAErC7G,KAAKuW,YAAa,EAClBvW,KAAK0Y,cAAgB,KAGL7Y,EAAMiC,IAAI,oBACX9B,KAAKoV,QAClBpV,KAAKoV,OAAO6B,QAAO,IAEpB,IACL,CACF,CAEQ,eAAA2B,CAAgBpC,GACtB,MAAMc,EAAiB,GACjByB,EAAQvC,EAAStF,MAAM,MAkE7B,OAhEA6H,EAAMtW,QAAQ,CAACsV,EAAMiB,KAEnB,MAAMC,EAAclB,EAAKmB,MAAM,qBAC/B,GAAID,EAAa,CACf,MAAME,EAAQF,EAAY,GAAGzH,OAG7B,OAFA8F,EAAIlD,KAAK,CAAEoD,OAAQyB,EAAY,UAC/B3B,EAAIlD,KAAK,CAAEoD,OAAQ,KAAMG,WAAY,CAAExB,OAAQgD,IAEjD,CAGA,MAAMC,EAAcrB,EAAKmB,MAAM,cAC/B,GAAIE,EAAa,CACf,MAAM3B,EAAOzX,KAAKqZ,oBAAoBD,EAAY,IAGlD,OAFA9B,EAAIlD,QAAQqD,QACZH,EAAIlD,KAAK,CAAEoD,OAAQ,KAAMG,WAAY,CAAEvB,KAAM,WAE/C,CAGA,MAAMkD,EAAgBvB,EAAKmB,MAAM,kBACjC,GAAII,EAAe,CACjB,MAAM7B,EAAOzX,KAAKqZ,oBAAoBC,EAAc,IAGpD,OAFAhC,EAAIlD,QAAQqD,QACZH,EAAIlD,KAAK,CAAEoD,OAAQ,KAAMG,WAAY,CAAEvB,KAAM,YAE/C,CAGA,MAAMmD,EAAYxB,EAAKmB,MAAM,2BAC7B,GAAIK,EAAW,CACb,MAAM9B,EAAOzX,KAAKqZ,oBAAoBE,EAAU,IAGhD,OAFAjC,EAAIlD,QAAQqD,QACZH,EAAIlD,KAAK,CAAEoD,OAAQ,KAAMG,WAAY,CAAEvB,KAAM,UAE/C,CAGA,MAAMoD,EAAazB,EAAKmB,MAAM,cAC9B,GAAIM,EAAY,CACd,MAAM/B,EAAOzX,KAAKqZ,oBAAoBG,EAAW,IAGjD,OAFAlC,EAAIlD,QAAQqD,QACZH,EAAIlD,KAAK,CAAEoD,OAAQ,KAAMG,WAAY,CAAEO,YAAY,IAErD,CAGA,GAAIH,EAAK0B,WAAW,OAClBnC,EAAIlD,KAAK,CAAEoD,OAAQ,KAAMG,WAAY,CAAE,cAAc,SADvD,CAMA,GAAII,EAAKnB,OAAQ,CACf,MAAMa,EAAOzX,KAAKqZ,oBAAoBtB,GACtCT,EAAIlD,QAAQqD,EACd,CAGIuB,EAAQD,EAAMvH,OAAS,GACzB8F,EAAIlD,KAAK,CAAEoD,OAAQ,MAVrB,IAcK,CAAEF,MACX,CAEQ,mBAAA+B,CAAoB5B,GAC1B,MAAMH,EAAiB,GAGjBoC,EAAQ,uFACd,IACIR,EADAS,EAAY,EAGhB,KAAsC,QAA9BT,EAAQQ,EAAME,KAAKnC,KAErByB,EAAMF,MAAQW,GAChBrC,EAAIlD,KAAK,CAAEoD,OAAQC,EAAKO,UAAU2B,EAAWT,EAAMF,SAIjDE,EAAM,GACR5B,EAAIlD,KAAK,CAAEoD,OAAQ0B,EAAM,GAAIvB,WAAY,CAAES,MAAM,KAG1Cc,EAAM,GACb5B,EAAIlD,KAAK,CAAEoD,OAAQ0B,EAAM,GAAIvB,WAAY,CAAEU,QAAQ,KAG5Ca,EAAM,GACb5B,EAAIlD,KAAK,CAAEoD,OAAQ0B,EAAM,GAAIvB,WAAY,CAAEW,QAAQ,KAG5CY,EAAM,GACb5B,EAAIlD,KAAK,CAAEoD,OAAQ0B,EAAM,GAAIvB,WAAY,CAAEtM,MAAM,KAG1C6N,EAAM,IACb5B,EAAIlD,KAAK,CAAEoD,OAAQ0B,EAAM,IAAKvB,WAAY,CAAEY,KAAMW,EAAM,OAG1DS,EAAYD,EAAMC,UAQpB,OAJIA,EAAYlC,EAAKjG,QACnB8F,EAAIlD,KAAK,CAAEoD,OAAQC,EAAKO,UAAU2B,KAG7BrC,EAAI9F,OAAS,EAAI8F,EAAM,CAAC,CAAEE,OAAQC,GAC3C,CAEA,UAAAoC,GACE,OAAO7Z,KAAKyW,aACd,CAEA,iBAAMqD,CAAYC,SAMhB,GAJKA,SACG/Z,KAAKmV,qBAGRnV,KAAKoV,OAAQ,OAClBpV,KAAKoV,OAAO6B,QAAQ8C,GAEpB,MAAM7D,EAAU,OAAAvJ,EAAA3M,KAAKiV,gBAAL,EAAAtI,EAAgBmK,cAAc,eAC1CZ,IACFA,EAAQa,MAAMiD,cAAgBD,EAAW,OAAS,OAClD7D,EAAQa,MAAMkD,QAAUF,EAAW,MAAQ,KAI7C,MAAMG,EAAala,KAAKoV,OAAOsB,KAC3BwD,GAAcH,EAChBG,EAAWxF,QAAQ2B,YAAc,uCACxB6D,IACTA,EAAWxF,QAAQ2B,YAAc,8BAErC,CAEA,qBAAA8D,CAAsB5P,GAEpBvK,KAAKmV,oBAAoBtH,KAAK,KAC5B,IAAK7N,KAAKoV,OAAQ,OAElB,MAAM8E,EAAala,KAAKoV,OAAOsB,KAC3BwD,IACFA,EAAWxF,QAAQ2B,YAAc9L,IAGvC,CAEA,KAAA6P,GACMpa,KAAKoV,QACPpV,KAAKoV,OAAOgF,OAEhB,CAMA,UAAAC,GACE,IAAKra,KAAKoV,QAAUpV,KAAKuW,WAAY,OAErC,MAAMC,EAAWxW,KAAKyW,cAGlBzW,KAAKkV,kBACPlV,KAAKkV,iBAAiBsB,EAE1B,CAKA,iBAAA8D,GAEE,IAAKta,KAAKoV,OAAQ,OAAO,EAGzB,OADuBpV,KAAKyW,gBACFzW,KAAKiP,kBACjC,GC7OK,MAAMsL,EAAgB,IAzN7B,MAOE,WAAAza,GANQC,EAAAC,KAAA,aACAD,EAAAC,KAAA,oBAAoB4B,KACpB7B,EAAAC,KAAA,QAAwB,IACfD,EAAAC,KAAA,aAAa,GACbD,EAAAC,KAAA,kBAAkB,KAGjCA,KAAKiV,UAAYjV,KAAK4E,MACxB,CAEQ,IAAAA,GAEN,MAAMqQ,EAAY5H,SAASoI,cAAc,OAMzC,OALAR,EAAU/O,GAAK,yBACf+O,EAAUuF,UAAY,yBACtBvF,EAAUwF,aAAa,OAAQ,UAC/BxF,EAAUwF,aAAa,aAAc,iBACrCpN,SAAStC,KAAK6K,YAAYX,GACnBA,CACT,CAKA,IAAAyF,CAAK/Q,GACH,MAAMpF,KACJA,EAAO,OAAAoW,MACPA,EAAApQ,QACAA,EAAAqQ,SACAA,EAAW5a,KAAK6a,gBAAAC,YAChBA,GAAc,EAAAC,SACdA,EAAAC,YACAA,EAAc,UACZrR,EAEEzD,EAAK,gBAAgB1B,OAAAtD,KAAK0C,MAAK,KAAIY,YAAKyW,UAExCC,EAA6B,CACjChV,KACA3B,OACAoW,QACApQ,UACAqQ,WACAE,cACAC,WACAC,cACAG,QAAS,MAKX,OADqBnb,KAAKiV,UAAUmG,SAAS5J,QACzBxR,KAAKqb,YACvBrb,KAAKsb,MAAMlH,KAAK8G,GACThV,IAGTlG,KAAKgT,OAAOkI,GACLhV,EACT,CAEQ,MAAA8M,CAAOkI,GACb,MAAMhV,GAAEA,OAAI3B,EAAAoW,MAAMA,EAAApQ,QAAOA,WAASqQ,EAAAE,YAAUA,EAAAC,SAAaA,EAAAC,YAAUA,GAAgBE,EAG7EC,EAAU9N,SAASoI,cAAc,OACvC0F,EAAQX,UAAY,mCAAmChW,OAAAD,GACvD4W,EAAQV,aAAa,OAAQ,SAC7BU,EAAQV,aAAa,YAAsB,UAATlW,EAAmB,YAAc,UACnE4W,EAAQzG,QAAQxO,GAAKA,EAwCrB,GA7BAiV,EAAQ5G,UAAY,4FAE0B/P,OAVhC,CACZiJ,QAAS,eACThK,MAAO,QACP8X,QAAS,UACTC,KAAM,QAM4CjX,GAAM,6EAGpDC,OAAAmW,EAAQ,mCAAmCnW,OAAAxE,KAAKyb,WAAWd,GAAM,UAAW,GAAE,gDAC5CnW,OAAAxE,KAAKyb,WAAWlR,GAAQ,gCAG5D/F,OAAAuW,EACI,6DAC8CvW,OAAAwW,EAAW,kBACzDxW,OAAAwW,EAAW,+BAGX,GACN,YAEExW,OAAAsW,EACI,2KAKA,GACN,UAIEA,EAAa,CACf,MAAMY,EAAWP,EAAQrE,cAAc,uBACvC,MAAA4E,GAAAA,EAAUxS,iBAAiB,QAAS,IAAMlJ,KAAK2b,QAAQzV,GACzD,CAEA,GAAI6U,EAAU,CACZ,MAAMa,EAAYT,EAAQrE,cAAc,wBACxC,MAAA8E,GAAAA,EAAW1S,iBAAiB,QAAS,KACnC6R,IACA/a,KAAK2b,QAAQzV,IAEjB,CAGAlG,KAAKiV,UAAUW,YAAYuF,GAC3BD,EAAaC,QAAUA,EACvBnb,KAAKua,cAActY,IAAIiE,EAAIgV,GAG3BW,sBAAsB,KACpBV,EAAQ5N,UAAU1K,IAAI,0BAIpB+X,GAAYA,EAAW,IACzBM,EAAaY,QAAUrX,OAAOoC,WAAW,KACvC7G,KAAK2b,QAAQzV,IACZ0U,GAEP,CAEA,OAAAe,CAAQzV,GACN,MAAMgV,EAAelb,KAAKua,cAAczY,IAAIoE,GAC5C,IAAKgV,EAAc,OAEnB,MAAMC,QAAEA,EAAAW,QAASA,GAAYZ,EAGzBY,GACFlV,aAAakV,GAIf,MAAAX,GAAAA,EAAS5N,UAAUC,OAAO,wBAC1B,MAAA2N,GAAAA,EAAS5N,UAAU1K,IAAI,uBAGvBgE,WAAW,YACLsU,WAASY,aACXZ,EAAQY,WAAWC,YAAYb,GAEjCnb,KAAKua,cAAcxX,OAAOmD,GAG1BlG,KAAKic,gBACJ,IACL,CAEQ,YAAAA,GACN,MAAMC,EAAelc,KAAKiV,UAAUmG,SAAS5J,OAC7C,GAAIxR,KAAKsb,MAAM9J,OAAS,GAAK0K,EAAelc,KAAKqb,WAAY,CAC3D,MAAMc,EAAOnc,KAAKsb,MAAMc,QACpBD,GACFnc,KAAKgT,OAAOmJ,EAEhB,CACF,CAGA,OAAA1O,CAAQlD,EAAiBZ,EAAwC,IAC/D,OAAO3J,KAAK0a,KAAK,CAAEnW,KAAM,UAAWgG,UAASoQ,MAAO,aAAchR,GACpE,CAEA,KAAAlG,CAAM8G,EAAiBZ,EAAwC,IAC7D,OAAO3J,KAAK0a,KAAK,CACfnW,KAAM,QACNgG,UACAoQ,MAAO,QACPC,SAAU,OACPjR,GAEP,CAEA,OAAA4R,CAAQhR,EAAiBZ,EAAwC,IAC/D,OAAO3J,KAAK0a,KAAK,CAAEnW,KAAM,UAAWgG,UAASoQ,MAAO,aAAchR,GACpE,CAEA,IAAA6R,CAAKjR,EAAiBZ,EAAwC,IAC5D,OAAO3J,KAAK0a,KAAK,CAAEnW,KAAM,OAAQgG,aAAYZ,GAC/C,CAGA,QAAA0S,GACErc,KAAKua,cAAc9X,QAAQyY,IACzBlb,KAAK2b,QAAQT,EAAahV,MAE5BlG,KAAKsb,MAAQ,EACf,CAGQ,UAAAG,CAAWhE,GACjB,MAAM6E,EAAMjP,SAASoI,cAAc,OAEnC,OADA6G,EAAIhJ,YAAcmE,EACX6E,EAAI/H,SACb,GCmvCK,MAAMgI,EAAK,IAt4CX,MAMH,WAAAzc,GALAC,EAAAC,KAAA,YACAD,EAAAC,KAAA,iBACAD,EAAAC,KAAA,wBACAD,EAAAC,KAAA,sBAGIA,KAAKwc,SAAW,CAAA,EAChBxc,KAAKyc,cAAgB,KAErBzc,KAAK0c,qBAAuB,GAC5B1c,KAAK2c,mBAAqB3c,KAAK0c,oBACnC,CAEA,IAAA9X,GACI5E,KAAK4c,gBACL5c,KAAK6c,sBACL7c,KAAK8c,0BACL9c,KAAK+c,oBACL/c,KAAKgd,wBACLhd,KAAKid,YACT,CAEA,aAAAL,GACI5c,KAAKwc,SAAW,CAEZU,YAAa7P,SAASC,eAAe,gBACrC6P,WAAY9P,SAASC,eAAe,eAGpC8P,cAAe/P,SAASC,eAAe,kBACvC+P,sBAAuBhQ,SAASC,eAAe,2BAG/CgQ,oBAAqBjQ,SAASC,eAAe,yBAC7CiQ,4BAA6BlQ,SAASC,eAAe,kCAGrDkQ,WAAYnQ,SAASC,eAAe,eAGpCmQ,sBAAuBpQ,SAASC,eAAe,2BAC/CoQ,mBAAoBrQ,SAASC,eAAe,wBAG5CqQ,wBAAyBtQ,SAASC,eAAe,6BACjDsQ,cAAevQ,SAASC,eAAe,kBAGvCuQ,UAAWxQ,SAASC,eAAe,cAGnCwQ,UAAWzQ,SAASC,eAAe,cAGnCyQ,YAAa1Q,SAASC,eAAe,gBACrCsD,YAAavD,SAASC,eAAe,gBAGrC0Q,aAAc3Q,SAASC,eAAe,iBACtC2Q,cAAe5Q,SAASC,eAAe,kBACvC4Q,gBAAiB7Q,SAASC,eAAe,oBAGzC/L,WAAY8L,SAASC,eAAe,eACpC6Q,eAAgB9Q,SAASC,eAAe,oBAGxC8Q,gBAAiB/Q,SAASC,eAAe,qBACzC+Q,kBAAmBhR,SAASC,eAAe,uBAG3CgR,gBAAiBjR,SAASC,eAAe,qBACzCiR,eAAgBlR,SAASC,eAAe,mBAGxCkR,kBAAmBnR,SAASC,eAAe,uBAC3CmR,qBAAsBpR,SAASC,eAAe,0BAC9CoR,QAASrR,SAASyJ,cAAc,YAChC6H,cAAetR,SAASyJ,cAAc,mBACtC8H,eAAgBvR,SAASC,eAAe,mBACxCuR,gBAAiBxR,SAASC,eAAe,oBACzCwR,aAAczR,SAASC,eAAe,iBACtCyR,cAAe1R,SAASC,eAAe,kBAE/C,CAEA,mBAAAuP,qBAEI,MAAMmC,EAAsB3R,SAASC,eAAe,yBAChD0R,GACAA,EAAoB9V,iBAAiB,QAAS,KAC1ClJ,KAAKif,uBAKb,MAAMC,EAAkB7R,SAASC,eAAe,0BAC5C4R,GACAA,EAAgBhW,iBAAiB,QAAS,KACtC,MAAM/C,EAAUtG,EAAMiC,IAAI,mBACpBgP,EAAUjR,EAAMiC,IAAI,gBAE1B,GAAIqE,GAAW2K,EAAS,CAEpB,MAAM7E,EAAWpM,EAAMiC,IAAI,gBACrBxB,EAAW2L,EAAS3L,UAAY,MAChCC,EAAa0L,EAAS1L,YAAc,YAEnC0D,EAAMC,EAAOC,GAAO2M,EAAQI,MAAM,KAAK/N,IAAIkO,QAI5C8N,EAHU,IAAIje,KAAK+C,EAAMC,EAAQ,EAAGC,GAGlBib,mBAAmB,QAAS,CAChDC,QAAS,OACTrb,SAAU1D,IAIRgf,EAAKrL,OAAOhQ,GAAM+T,UAAU,GAC5BuH,EAAKtL,OAAO/P,GAAOgQ,SAAS,EAAG,KAC/BsL,EAAKvL,OAAO9P,GAAK+P,SAAS,EAAG,KAEnC,IAAIuL,EAEAA,EADe,aAAflf,EACmB,GAAGiE,OAAA+a,EAAE,KAAI/a,OAAAgb,EAAE,KAAIhb,OAAA8a,GAEf,GAAG9a,OAAAgb,EAAE,KAAIhb,OAAA+a,EAAE,KAAI/a,OAAA8a,GAGtC,MAAMI,EAAgB,GAAGlb,OAAA2a,EAAO,MAAK3a,OAAAib,GAGrCzf,KAAK2f,oBAAoBxZ,EAAS2K,EAAS4O,EAC/C,IAMR,OAAA/S,EAAA3M,KAAKwc,SAASY,gBAAdzQ,EAA6BzD,iBAAiB,SAAWxD,IACrD,MAAMS,EAAWT,EAAEC,OAA6BzD,MAEhDpB,EAASyR,cAAcpM,KAK3B,OAAAuG,EAAA1M,KAAKwc,SAASc,sBAAd5Q,EAAmCxD,iBAAiB,SAAWxD,IAC3D,MAAMS,EAAWT,EAAEC,OAA6BzD,MAEhDpB,EAASyR,cAAcpM,KAI3B,OAAAyZ,EAAA5f,KAAKwc,SAASgB,aAAdoC,EAA0B1W,iBAAiB,SAAU2W,MAAOna,IACxD,MAAMoL,EAAWpL,EAAEC,OAA4BzD,MAE3BrC,EAAMiC,IAAI,kBACVgP,SAId/P,EAAM8P,WAAWC,KAI3B,OAAAgP,EAAAzS,SAASC,eAAe,gBAAxBwS,EAAuC5W,iBAAiB,QAAS,KAC7D6J,EAAS4B,cAGb,OAAAoL,EAAA1S,SAASC,eAAe,gBAAxByS,EAAuC7W,iBAAiB,QAAS,KAC7D6J,EAAS6B,cAIb,OAAAoL,EAAAhgB,KAAKwc,SAAS4B,kBAAd4B,EAA+B9W,iBAAiB,QAAS2W,MAAOna,IAC5DA,EAAEua,iBACF,MACMC,EAA4B,SADb7S,SAAS8S,gBAAgBC,aAAa,cAChB,QAAU,OACrDpgB,KAAKqgB,SAASH,GAEd,MAAMjU,EAAWpM,EAAMiC,IAAI,gBAC3BjC,EAAMoC,IAAI,eAAgB,IAAKgK,EAAU7L,MAAO8f,IAEhD,UACUzW,EAAIuC,eAAe,IAAKC,EAAU7L,MAAO8f,GACnD,OAASpS,GAET,IAGJ,OAAAwS,EAAAtgB,KAAKwc,SAAS6B,oBAAdiC,EAAiCpX,iBAAiB,SAAWxD,IACzD1F,KAAKqgB,SAAU3a,EAAEC,OAA4B4a,QAAU,OAAS,WAIpEvgB,KAAKwgB,wBACT,CAEA,sBAAAA,GACInT,SAASnE,iBAAiB,UAAYxD,UAClC,MACM+a,EADQ7O,UAAU8O,SAASC,cAAcC,QAAQ,QAAU,EAC1Clb,EAAEmb,QAAUnb,EAAEob,QAGrC,GAAIL,GAAoB,MAAV/a,EAAE3D,IAGZ,OAFA2D,EAAEua,sBACF,OAAAtT,EAAA3M,KAAKwc,SAASY,gBAAdzQ,EAA6ByN,SAKjC,GAAIqG,GAAoB,MAAV/a,EAAE3D,IAGZ,OAFA2D,EAAEua,sBACF1W,EAAOZ,KAAK,kBAAqB,GAKrC,GAAI8X,GAAoB,MAAV/a,EAAE3D,IACZ2D,EAAEua,sBAKN,GAAc,WAAVva,EAAE3D,IAAkB,CAEpB,MAAMgf,EAAc1T,SAASC,eAAe,qBAC5C,OAAI,MAAAyT,OAAA,EAAAA,EAAaxT,UAAU1H,SAAS,mBAChC7F,KAAKghB,4BAIThhB,KAAKihB,gBAET,GAER,CAEA,iBAAAlE,GACI,MAAMmE,EAAe7T,SAASC,eAAe,iBACvC6T,EAAqB9T,SAASC,eAAe,wBAC7C8T,EAAmB/T,SAASC,eAAe,sBAC3C+T,EAAkBhU,SAASC,eAAe,qBAE3C4T,GAAiBC,IAGtBA,EAAmBjY,iBAAiB,QAAUxD,IAC1CA,EAAEua,iBACFva,EAAE4b,kBACFJ,EAAa3T,UAAUgU,OAAO,eAIlC,MAAAH,GAAAA,EAAkBlY,iBAAiB,QAAUxD,IACzCA,EAAEua,iBACFiB,EAAa3T,UAAUC,OAAO,aAC9BxN,KAAKwhB,sBAIT,MAAAH,GAAAA,EAAiBnY,iBAAiB,QAAUxD,IACxCA,EAAEua,iBACFiB,EAAa3T,UAAUC,OAAO,aAC9BrB,EAAKyB,YAITP,SAASnE,iBAAiB,QAAUxD,IAC3Bwb,EAAarb,SAASH,EAAEC,SACzBub,EAAa3T,UAAUC,OAAO,eAKtCH,SAASnE,iBAAiB,UAAYxD,IACpB,WAAVA,EAAE3D,KAAoBmf,EAAa3T,UAAU1H,SAAS,cACtDqb,EAAa3T,UAAUC,OAAO,eAG1C,CAEA,uBAAAsP,GAEIjd,EAAM6C,UAAU,WAAY,KACxB1C,KAAKyhB,yBAIT5hB,EAAMmD,cAAc,CAAC,uBAAwB,uBAAwB,KACjE+P,EAASC,WAIbnT,EAAM6C,UAAU,QAAS,KACrB1C,KAAK0hB,kBACL3O,EAASC,WAIbnT,EAAM6C,UAAU,kBAAoBif,IAChC3hB,KAAK4hB,mBAEL5hB,KAAK2c,mBAAqB3c,KAAK0c,uBAInC7c,EAAM6C,UAAU,eAAiBmf,IACzB7hB,KAAKwc,SAASgB,YAAcqE,IAC5B7hB,KAAKwc,SAASgB,WAAWtb,MAAQ2f,EACjC7hB,KAAK8hB,wBAAwBD,IAEjC7hB,KAAK0hB,kBACL3O,EAASC,SACThT,KAAK4hB,mBACL5hB,KAAK+hB,6BAITliB,EAAM6C,UAAU,eAAgB,KAC5B,MAAM7B,EAAehB,EAAMiC,IAAI,gBAC3BjB,GACAb,KAAK8hB,wBAAwBjhB,GAEjCb,KAAK4hB,qBAIT/hB,EAAM6C,UAAU,kBAAoB9B,IAE5BZ,KAAKwc,SAASY,eAAiBxc,IAC/BZ,KAAKwc,SAASY,cAAclb,MAAQtB,GAEpCZ,KAAKwc,SAASc,qBAAuB1c,IACrCZ,KAAKwc,SAASc,oBAAoBpb,MAAQtB,GAE9CZ,KAAKgiB,yBACLhiB,KAAKiiB,sBAITpiB,EAAM6C,UAAU,cAAgB0J,IACxBpM,KAAKwc,SAASsB,WAAa1R,IAC3BpM,KAAKwc,SAASsB,UAAUxK,YAAclH,EAAK8V,OAAS,MAK5DriB,EAAM6C,UAAU,eAAiBuJ,IACzBA,EAAS7L,OACTJ,KAAKqgB,SAASpU,EAAS7L,OAG3BJ,KAAKmiB,kCAELniB,KAAKoiB,6BAELpiB,KAAKqiB,iCAELriB,KAAKsiB,oCAEb,CAEA,oBAAAb,GACI,MAAMc,EAAe1iB,EAAMiC,IAAI,YACzBlB,EAAkBf,EAAMiC,IAAI,mBAE5B0gB,EAAc,8CAChBD,EAAapf,IAAIiP,GACb,kBAAkB5N,OAAA4N,EAAEN,KAAI,kBAAiBtN,OAAA4N,EAAEL,OAAS,UAAS,MAAKvN,OAAA4N,EAAEN,KAAI,cAC1EiC,KAAK,IAGP/T,KAAKwc,SAASY,gBACdpd,KAAKwc,SAASY,cAAc7I,UAAYiO,EACpC5hB,IACAZ,KAAKwc,SAASY,cAAclb,MAAQtB,IAKxCZ,KAAKwc,SAASc,sBACdtd,KAAKwc,SAASc,oBAAoB/I,UAAYiO,EAC1C5hB,IACAZ,KAAKwc,SAASc,oBAAoBpb,MAAQtB,IAIlDZ,KAAKgiB,wBACT,CAEA,sBAAAA,GAEI,GAAIhiB,KAAKwc,SAASY,eAAiBpd,KAAKwc,SAASa,sBAAuB,CACpE,MAAMoF,EAAMziB,KAAKwc,SAASY,cAAczT,QAAQ3J,KAAKwc,SAASY,cAAcsF,eAE5E,IAAI,MAAAD,OAAA,EAAAA,EAAK/N,QAAQ3C,QAAuB,KAAd0Q,EAAIvgB,MAAc,CACxC,MAAMygB,EAAkB3iB,KAAK4iB,sBAAsBH,EAAI/N,QAAQ3C,OAC/D/R,KAAKwc,SAASa,sBAAsBtG,MAAM8L,WAAa,eAAere,OAAAme,EAAe,KACrF3iB,KAAKwc,SAASa,sBAAsBtG,MAAMkD,QAAU,GACxD,MACIja,KAAKwc,SAASa,sBAAsBtG,MAAM8L,WAAa,0BACvD7iB,KAAKwc,SAASa,sBAAsBtG,MAAMkD,QAAU,KAE5D,CAGA,GAAIja,KAAKwc,SAASc,qBAAuBtd,KAAKwc,SAASe,4BAA6B,CAChF,MAAMkF,EAAMziB,KAAKwc,SAASc,oBAAoB3T,QAAQ3J,KAAKwc,SAASc,oBAAoBoF,eAExF,IAAI,MAAAD,OAAA,EAAAA,EAAK/N,QAAQ3C,QAAuB,KAAd0Q,EAAIvgB,MAAc,CACxC,MAAMygB,EAAkB3iB,KAAK4iB,sBAAsBH,EAAI/N,QAAQ3C,OAC/D/R,KAAKwc,SAASe,4BAA4BxG,MAAM8L,WAAa,eAAere,OAAAme,EAAe,KAC3F3iB,KAAKwc,SAASe,4BAA4BxG,MAAMkD,QAAU,GAC9D,MACIja,KAAKwc,SAASe,4BAA4BxG,MAAM8L,WAAa,0BAC7D7iB,KAAKwc,SAASe,4BAA4BxG,MAAMkD,QAAU,KAElE,CACJ,CAEA,eAAAyH,GACI,MAAM7D,EAAYhe,EAAMiC,IAAI,SACtBjB,EAAehB,EAAMiC,IAAI,gBACzBmK,EAAWpM,EAAMiC,IAAI,gBACrBxB,EAAW2L,EAAS3L,UAAY,MAChCC,EAAa0L,EAAS1L,YAAc,WAE1C,IAAKP,KAAKwc,SAASqB,UAAW,OAE9B,GAAyB,IAArBA,EAAUrM,OAEV,YADAxR,KAAKwc,SAASqB,UAAUtJ,UAAY,4EAKxC,MAAMuO,EAAgBjF,EAAUzK,MAAM,EAAGpT,KAAK2c,oBACxCoG,EAAUlF,EAAUrM,OAASxR,KAAK2c,mBAExC3c,KAAKwc,SAASqB,UAAUtJ,UAAYuO,EAAc3f,IAAI8C,IAClD,MAAOhC,EAAMC,EAAOC,GAAO8B,EAAKG,KAAK8K,MAAM,KAAK/N,IAAIkO,QAI9C8N,EAHU,IAAIje,KAAK+C,EAAMC,EAAQ,EAAGC,GAGlBib,mBAAmB,QAAS,CAChDC,QAAS,OACTrb,SAAU1D,IAIRgf,EAAKrL,OAAOhQ,GAAM+T,UAAU,GAC5BuH,EAAKtL,OAAO/P,GAAOgQ,SAAS,EAAG,KAC/BsL,EAAKvL,OAAO9P,GAAK+P,SAAS,EAAG,KAEnC,IAAIpD,EAEAA,EADe,aAAfvQ,EACU,GAAGiE,OAAA+a,EAAE,KAAI/a,OAAAgb,EAAE,KAAIhb,OAAA8a,GAEf,GAAG9a,OAAAgb,EAAE,KAAIhb,OAAA+a,EAAE,KAAI/a,OAAA8a,GAI7B,MAAMI,EAAgB,GAAGlb,OAAA2a,EAAO,MAAK3a,OAAAsM,EAAO,OAEtCkS,EAAW/c,EAAKG,OAASvF,EAE/B,MAAO,kFAGc2D,SAAW,YAAc,GAAE,0CACvBA,OAAAyB,EAAKG,KAAI,sDAEpB5B,OAAAkb,EAAa,qEAI5B3L,KAAK,IAGJgP,IACA/iB,KAAKwc,SAASqB,UAAUtJ,WAAa,6WAMZ/P,OAAAye,KAAKC,IAAI,GAAIrF,EAAUrM,OAASxR,KAAK2c,oBAAmB,qFAOrF3c,KAAKwc,SAASqB,UAAUrJ,iBAAiB,gBAAgB/R,QAAQ8V,IAC7DA,EAAKrP,iBAAiB,QAAS2W,MAAOna,IAClCA,EAAEua,iBACF,MAAMnP,EAAWyH,EAAqB7D,QAAQtO,KAC9C,GAAI0K,EAAS,CAGT,GADoBjR,EAAMiC,IAAI,kBACVgP,EAEhB,aAEE/P,EAAM8P,WAAWC,EAC3B,MAKR,MAAMqS,EAAc9V,SAASC,eAAe,mBACxC6V,GACAA,EAAYja,iBAAiB,QAAS,KAClClJ,KAAK2c,oBAAsB,GAC3B3c,KAAK0hB,mBAGjB,CAEA,iBAAAO,GAEI,MAAM9b,EAAUtG,EAAMiC,IAAI,mBACpBygB,EAAe1iB,EAAMiC,IAAI,aAAe,GAG1CqE,EACA2O,EAAegF,aAAY,GAG3BhF,EAAeK,oBAAoBtH,KAAK,KACpCiH,EAAegF,aAAY,GAC3BhF,EAAe0D,WAAW,IAGE,IAAxB+J,EAAa/Q,QAEb3K,WAAW,KACPiO,EAAeqF,sBAAsB,6EACtC,OAMfna,KAAK+hB,0BACT,CAEA,wBAAAA,GACI,MAAM7C,EAAkB7R,SAASC,eAAe,0BAC1C0R,EAAsB3R,SAASC,eAAe,yBAE9CnH,EAAUtG,EAAMiC,IAAI,mBACpBjB,EAAehB,EAAMiC,IAAI,gBAG3BqE,GAAWtF,GACPqe,IAAiBA,EAAgBnI,MAAMC,QAAU,QACjDgI,IAAqBA,EAAoBjI,MAAMC,QAAU,UAEzDkI,IAAiBA,EAAgBnI,MAAMC,QAAU,QACjDgI,IAAqBA,EAAoBjI,MAAMC,QAAU,QAErE,CAEA,mBAAAoM,CAAoBhZ,GACXpK,KAAKwc,SAASoB,gBAEnB5d,KAAKwc,SAASoB,cAAcpD,UAAY,kBAAkBhW,OAAA4F,GAE3C,UAAXA,GACApK,KAAKwc,SAASoB,cAActK,YAAc,kBAC1CzM,WAAW,KACH7G,KAAKwc,SAASoB,gBACd5d,KAAKwc,SAASoB,cAActK,YAAc,KAE/C,MAEHtT,KAAKwc,SAASoB,cAActK,YAAc,GAElD,CAEA,gBAAA+P,EAAiB7hB,QAAEA,EAAAC,QAASA,IACnBzB,KAAKwc,SAASjb,YAAevB,KAAKwc,SAAS2B,iBAG5C3c,EAAU,GAAKC,GACfzB,KAAKwc,SAASjb,WAAWwV,MAAMC,QAAU,OAErCvV,GACAzB,KAAKwc,SAAS2B,eAAe7K,YAAc,WAAW9O,SAAO,SAAQA,OAAY,IAAZhD,EAAgB,IAAM,GAAE,OAC7FxB,KAAKwc,SAASjb,WAAWgM,UAAU1K,IAAI,cACvC7C,KAAKwc,SAASjb,WAAWgM,UAAUC,OAAO,gBAE1CxN,KAAKwc,SAAS2B,eAAe7K,YAAc,GAAG9O,SAAO,SAAQA,OAAY,IAAZhD,EAAgB,IAAM,GAAE,iBACrFxB,KAAKwc,SAASjb,WAAWgM,UAAU1K,IAAI,cACvC7C,KAAKwc,SAASjb,WAAWgM,UAAUC,OAAO,gBAI9C3G,WAAW,KACH7G,KAAKwc,SAASjb,aACdvB,KAAKwc,SAASjb,WAAWwV,MAAMC,QAAU,OACzChX,KAAKwc,SAASjb,WAAWgM,UAAUC,OAAO,aAAc,gBAE7D,KAEX,CAEA,QAAA6S,CAASjgB,GACLiN,SAAS8S,gBAAgB1F,aAAa,aAAcra,GAChDJ,KAAKwc,SAAS6B,oBACdre,KAAKwc,SAAS6B,kBAAkBkC,QAAoB,SAAVngB,GAE9CJ,KAAKsjB,kBACLvV,aAAauE,QAAQ,QAASlS,EAClC,CAEA,eAAAkjB,SACI,MAAMljB,EAAQiN,SAAS8S,gBAAgBC,aAAa,cAC9CmD,EAAY,OAAA5W,EAAA3M,KAAKwc,SAAS4B,0BAAiBtH,cAAc,8BAC3DyM,IACAA,EAAUjQ,YAAwB,SAAVlT,EAAmB,aAAe,YAElE,CAEA,OAAAojB,CAAQC,GAA0B,GAK9B,IAAKzjB,KAAKwc,SAASU,cAAgBld,KAAKwc,SAASW,WAE7C,OAIJ,MAAM/P,EAASC,SAASC,eAAe,kBACnCF,GAEAA,EAAOG,UAAUC,OAAO,WAK5BxN,KAAKwc,SAASU,YAAY3P,UAAUC,OAAO,WAG3CxN,KAAKwc,SAASW,WAAW5P,UAAU1K,IAAI,WAKvC7C,KAAKmiB,kCAGLniB,KAAKoiB,6BACLpiB,KAAKqiB,iCAGLriB,KAAKsiB,mCAKL,MAAMoB,EAAiB7jB,EAAciC,IAAI,kBACS,gBAA3B2C,OAAekf,SASjBD,IAEjB7c,WAAW,WACP,OAAA8F,EAAA3M,KAAKwc,SAAS0B,kBAAdvR,EAA+BY,UAAU1K,IAAI,cAC9C,IAIX,CAEA,OAAA+gB,GACS5jB,KAAKwc,SAASU,aAAgBld,KAAKwc,SAASW,aAGjDnd,KAAKwc,SAASW,WAAW5P,UAAUC,OAAO,WAC1CxN,KAAKwc,SAASU,YAAY3P,UAAU1K,IAAI,WAC5C,CAEA,SAAAghB,CAAUtZ,EAA2EZ,EAA+B,IAEhH,IAAIgR,EAAQ,QACRC,EAAW,IACXkJ,EAAM,GAEa,iBAAZvZ,GAEPoQ,EAAQpQ,EAAQoQ,OAAS,QACzBmJ,EAAMvZ,EAAQA,SAAW,oBACzBqQ,EAAWrQ,EAAQqQ,UAAY,KAE/BkJ,EAAMvZ,GAINuZ,EAAIxZ,SAAS,YAAcwZ,EAAIxZ,SAAS,cACxCqQ,EAAQ,mBACRC,EAAW,KAGfL,EAAc9W,MAAMqgB,EAAK,CAAEnJ,QAAOC,cAAajR,GACnD,CAEA,WAAAoa,CAAYxZ,EAAiBZ,EAA+B,IACxD4Q,EAAc9M,QAAQlD,EAAS,CAAEqQ,SAAU,OAASjR,GACxD,CAEA,WAAAqa,CAAYzZ,EAAiBZ,EAA+B,IACxD4Q,EAAcgB,QAAQhR,EAAS,CAAEqQ,SAAU,OAASjR,GACxD,CAEA,QAAAsa,CAAS1Z,EAAiBZ,EAA+B,IACrD4Q,EAAciB,KAAKjR,EAAS,CAAEqQ,SAAU,OAASjR,GACrD,CAGA,gBAAAua,SACI,OAAAvX,EAAA3M,KAAKwc,SAASwB,eAAdrR,EAA4BY,UAAU1K,IAAI,aAC1C,MAAMshB,EAAY9W,SAASC,eAAe,gBACpC8W,EAAa/W,SAASC,eAAe,iBACvC6W,MAAqBjiB,MAAQ,IAC7BkiB,MAAuBliB,MAAQ,WAGnClC,KAAKqkB,oBAGLrkB,KAAKskB,kBAAkB,WAEvB,MAAAH,GAAAA,EAAW/J,OACf,CAEA,iBAAAmK,SACI,OAAA5X,EAAA3M,KAAKwc,SAASwB,eAAdrR,EAA4BY,UAAUC,OAAO,YACjD,CAEA,iBAAAgU,SACI,MAAMvV,EAAWpM,EAAMiC,IAAI,gBAEvB9B,KAAKwc,SAAS8B,kBACdte,KAAKwc,SAAS8B,gBAAgBpc,MAAQ+R,OAAOhI,EAAS5L,YAEtDL,KAAKwc,SAAS+B,iBACdve,KAAKwc,SAAS+B,eAAerc,MAAQ+J,EAAS3L,UAElD,MAAMkkB,EAAmBnX,SAASC,eAAe,sBAC7CkX,IACAA,EAAiBtiB,MAAQ+J,EAAS1L,YAAc,YAEpD,MAAMkkB,EAA0BpX,SAASC,eAAe,8BACpDmX,IACAA,EAAwBlE,QAAUtU,EAASzL,oBAAqB,GAEpE,MAAMkkB,EAAuBrX,SAASC,eAAe,0BACjDoX,IACAA,EAAqBnE,SAAsC,IAA5BtU,EAASxL,gBAE5C,MAAMkkB,EAA2BtX,SAASC,eAAe,+BACrDqX,IACAA,EAAyBpE,SAA0C,IAAhCtU,EAASvL,oBAEhD,MAAMkkB,EAA6BvX,SAASC,eAAe,kCACvDsX,IACAA,EAA2BrE,SAA4C,IAAlCtU,EAAStL,sBAIlD,MAAMkkB,EAAmBxX,SAASC,eAAe,8BAC3CwX,EAAgBzX,SAASC,eAAe,2BAK9C,GAJIuX,IACAA,EAAiB9N,MAAMC,QAAU,OACjC6N,EAAiB9N,MAAMkD,QAAU,KAEjC6K,EAAe,CACf,MAAMC,EAAcD,EAAchO,cAAc,8BAC5CiO,MAAyBzR,YAAc,cAC/C,CAGAtT,KAAKglB,yBAGL,MAAMC,EAAU5X,SAASC,eAAe,qBAClC4X,EAAW7X,SAASC,eAAe,sBACnC6X,EAAc9X,SAASC,eAAe,yBACtC8X,EAAW/X,SAASC,eAAe,sBAGzC,GADI2X,MAAiBlL,UAAW,GAC5BmL,EAAU,CACVA,EAASnO,MAAMC,QAAU,cACzB,MAAM+N,EAAcG,EAASpO,cAAc,8BACvCiO,MAAyBzR,YAAc,QAC/C,CACI6R,IAAaA,EAAYpO,MAAMC,QAAU,QACzCoO,MAAmB9R,YAAc,QAErC,OAAA3G,EAAA3M,KAAKwc,SAASyB,gBAAdtR,EAA6BY,UAAU1K,IAAI,YAC/C,CAEA,kBAAAwiB,SAEI,MAAMR,EAAmBxX,SAASC,eAAe,8BAC3CwX,EAAgBzX,SAASC,eAAe,2BAK9C,GAJIuX,IACAA,EAAiB9N,MAAMC,QAAU,OACjC6N,EAAiB9N,MAAMkD,QAAU,KAEjC6K,EAAe,CACf,MAAMC,EAAcD,EAAchO,cAAc,8BAC5CiO,MAAyBzR,YAAc,cAC/C,CAEA,OAAA3G,EAAA3M,KAAKwc,SAASyB,gBAAdtR,EAA6BY,UAAUC,OAAO,YAClD,CAEA,oBAAA8X,SACI,OAAA3Y,EAAA3M,KAAKwc,SAAS0B,kBAAdvR,EAA+BY,UAAUC,OAAO,YAEpD,CAEA,mBAAAmS,CAAoBxZ,EAAiBC,EAAcsZ,GAC/C,MAAM6F,EAAQlY,SAASC,eAAe,qBAChC/C,EAAU8C,SAASC,eAAe,uBAEpCiY,GAAShb,IAETgb,EAAM7Q,QAAQvO,QAAUA,EACxBof,EAAM7Q,QAAQtO,KAAOA,EAGrBmE,EAAQ+I,YAAc,gDAAgD9O,OAAAkb,EAAa,KAEnF6F,EAAMhY,UAAU1K,IAAI,aAE5B,CAEA,oBAAAme,GACI,MAAMuE,EAAQlY,SAASC,eAAe,qBAClCiY,IACAA,EAAMhY,UAAUC,OAAO,oBAChB+X,EAAM7Q,QAAQvO,eACdof,EAAM7Q,QAAQtO,KAE7B,CAEA,cAAA6a,GACIjhB,KAAKukB,oBACLvkB,KAAKqlB,qBACLrlB,KAAKslB,uBACLtlB,KAAKghB,sBACT,CAGA,UAAA/D,GACIjd,KAAKwlB,wBACLC,YAAY,IAAMzlB,KAAKwlB,wBAAyB,IACpD,CAEA,qBAAAA,GACI,MACMllB,EADWT,EAAMiC,IAAI,gBACDxB,UAAY,MAChCoB,EAAmB7B,EAAMiC,IAAI,oBAC7B8B,EAAM,IAAI1C,KAAKA,KAAK0C,MAAQlC,GAE5BgkB,EAA0C,CAC5CC,KAAM,UACNC,OAAQ,UACRC,OAAQ,UACRC,QAAQ,EACR9hB,SAAU1D,GAGRylB,EAA0C,CAC5C1G,QAAS,OACTpb,KAAM,UACNC,MAAO,OACPC,IAAK,UACLH,SAAU1D,GAGR0lB,EAAapiB,EAAIqiB,mBAAmB,QAASP,GAC7CQ,EAAatiB,EAAIwb,mBAAmB,QAAS2G,GAE/C/lB,KAAKwc,SAASuB,cACd/d,KAAKwc,SAASuB,YAAYzK,YAAc0S,GAExChmB,KAAKwc,SAAS5L,cACd5Q,KAAKwc,SAAS5L,YAAY0C,YAAc4S,GAI5C,MAAMtV,EAAe/Q,EAAciC,IAAI,SACnC9B,KAAKyc,eAAiBzc,KAAKyc,gBAAkB7L,GAC7CmC,EAASC,SAEbhT,KAAKyc,cAAgB7L,CACzB,CAEA,uBAAAkR,CAAwBhR,GACpB,MAAMqV,EAAiB9Y,SAASC,eAAe,uBAC/C,IAAK6Y,IAAmBrV,EAAS,OAEjC,MACMvQ,EADWV,EAAMiC,IAAI,gBACCvB,YAAc,YAEnC0D,EAAMC,EAAOC,GAAO2M,EAAQI,MAAM,KAAK/N,IAAIkO,QAG5CiO,EAAKrL,OAAOhQ,GAAM+T,UAAU,GAC5BuH,EAAKtL,OAAO/P,GAAOgQ,SAAS,EAAG,KAC/BsL,EAAKvL,OAAO9P,GAAK+P,SAAS,EAAG,KAEnC,IAAIwL,EAEAA,EADe,aAAfnf,EACgB,GAAGiE,OAAA+a,EAAE,KAAI/a,OAAAgb,EAAE,KAAIhb,OAAA8a,GAEf,GAAG9a,OAAAgb,EAAE,KAAIhb,OAAA+a,EAAE,KAAI/a,OAAA8a,GAGnC6G,EAAe7S,YAAcoM,CACjC,CAEA,+BAAAyC,GACI,MACM3hB,EADWX,EAAMiC,IAAI,gBACQtB,oBAAqB,EAGlD4lB,EAA0B/Y,SAASC,eAAe,4BAClD+Y,EAAyBhZ,SAASC,eAAe,2BAEnD9M,GAEI4lB,IACAA,EAAwBrP,MAAMC,QAAU,QAExCqP,IACAA,EAAuBtP,MAAMC,QAAU,UAIvCoP,IACAA,EAAwBrP,MAAMC,QAAU,IAExCqP,IACAA,EAAuBtP,MAAMC,QAAU,IAGnD,CAEA,0BAAAoL,GACI,MACM3hB,GAA6C,IADlCZ,EAAMiC,IAAI,gBACKrB,eAE1B6lB,EAAajZ,SAASC,eAAe,oBACrCiZ,EAAclZ,SAASyJ,cAAc,iBAGvCwP,IACAA,EAAWvP,MAAMC,QAAUvW,EAAiB,GAAK,QAIjD8lB,IACI9lB,EACA8lB,EAAYC,gBAAgB,wBAE5BD,EAAY9L,aAAa,uBAAwB,QAG7D,CAEA,8BAAA4H,GACI,MACM3hB,GAAqD,IAD1Cb,EAAMiC,IAAI,gBACSpB,mBAG9BwV,EAAU7I,SAASyJ,cAAc,eACnCZ,IACAA,EAAQa,MAAMC,QAAUtW,EAAqB,GAAK,QAKtD,MAAMyF,EAAUtG,EAAMiC,IAAI,mBAE1BgT,EAAegF,aAAY3T,EAC/B,CAEA,gCAAAmc,GACI,MACM3hB,GAAyD,IAD9Cd,EAAMiC,IAAI,gBACWnB,qBAGhC8lB,EAAuBpZ,SAASC,eAAe,2BAC/CoZ,EAAsBrZ,SAASC,eAAe,0BAGhDmZ,IACAA,EAAqB1P,MAAMC,QAAUrW,EAAuB,OAAS,IAErE+lB,IACAA,EAAoB3P,MAAMC,QAAUrW,EAAuB,OAAS,GAE5E,CAEA,sBAAAqkB,GACI,MAAMzC,EAAe1iB,EAAMiC,IAAI,YACzBmT,EAAY5H,SAASC,eAAe,sBAErC2H,IAEuB,IAAxBsN,EAAa/Q,OAKjByD,EAAUV,UAAYgO,EAAapf,IAAI,CAACmF,EAAKqe,KAEzC,MAAMhE,EAAkB3iB,KAAK4iB,sBAAsBta,EAAIyJ,OAEvD,MAAO,+NAE2GvN,OAAAme,EAAe,sRAEvCne,SAAe,sNAC8CA,OAAA8D,EAAIwJ,KAAI,oRAIvGtN,OAAA8D,EAAIpC,GAAE,omBAQJ1B,OAAA8D,EAAIpC,GAAE,QAAO1B,OAAA8D,EAAIwJ,KAAK8U,QAAQ,KAAM,OAAM,8fAUrG7S,KAAK,IAnCJkB,EAAUV,UAAY,uHAoC9B,CAEA,aAAAsS,CAAc9U,GAUV,MAT0C,CACtC0F,KAAQ,cACRc,KAAQ,cACRuO,QAAW,iBACXtL,KAAQ,oBACR/N,QAAW,kBACX8N,QAAW,mBACXwL,OAAU,gBAEAhV,IAAUA,CAC5B,CAEA,iBAAAsS,GACI,MAAM2C,EAAc3Z,SAASC,eAAe,iBAGtC2Z,EAAU5Z,SAASmH,iBAAiB,qCAC1C,IAAKyS,EAAQzV,OAAQ,OAErByV,EAAQxkB,QAAQykB,IAEZ,MAAMC,EAAYD,EAAOE,WAAU,GACnCF,EAAOnL,WAAYsL,aAAaF,EAAWD,KAI1B7Z,SAASmH,iBAAiB,qCAElC/R,QAAQykB,IACjBA,EAAOhe,iBAAiB,QAAUxD,IAC9BA,EAAEua,iBACF,MAAMlO,EAASmV,EAAuBxS,QAAQ3C,MAG1CiV,GAAejV,IAAOiV,EAAY9kB,MAAQ6P,GAG3B1E,SAASmH,iBAAiB,qCAClC/R,QAAQ6kB,IACdA,EAAoB/Z,UAAUC,OAAO,aACrC8Z,EAAoBvQ,MAAMwQ,OAAS,wBACnCD,EAAoBvQ,MAAMyQ,aAAe,QAG7CN,EAAuB3Z,UAAU1K,IAAI,aACrCqkB,EAAuBnQ,MAAMwQ,OAAS,8BACtCL,EAAuBnQ,MAAMyQ,aAAe,SAGzD,CAEA,iBAAAlD,CAAkBvS,GACd,MAAM0V,EAAepa,SAASmH,iBAAiB,qCACzCwS,EAAc3Z,SAASC,eAAe,iBAExC0Z,MAAyB9kB,MAAQ6P,GAErC0V,EAAahlB,QAAQ6kB,IAChBA,EAAoB/Z,UAAUC,OAAO,aACrC8Z,EAAoBvQ,MAAMwQ,OAAS,wBACnCD,EAAoBvQ,MAAMyQ,aAAe,MAErCF,EAAoB5S,QAAQ3C,QAAUA,IACtCuV,EAAoB/Z,UAAU1K,IAAI,aAClCykB,EAAoBvQ,MAAMwQ,OAAS,8BACnCD,EAAoBvQ,MAAMyQ,aAAe,QAGtD,CAEA,qBAAA5E,CAAsB7Q,GAGlB,GADoB,CAAC,OAAQ,OAAQ,UAAW,OAAQ,UAAW,UAAW,UAC9DzH,SAASyH,GACrB,OAAOA,EAYX,MAR8C,CAC1C,UAAW,UACX,UAAW,OACX,UAAW,UACX,UAAW,UACX,UAAW,UAGGA,IAAU,SAChC,CAEA,qBAAAiL,mBAEI,OAAArQ,EAAA3M,KAAKwc,SAASgC,oBAAd7R,EAAiCzD,iBAAiB,QAAS,KACvDlJ,KAAK0nB,wBAIT,OAAAhb,EAAA1M,KAAKwc,SAASiC,uBAAd/R,EAAoCxD,iBAAiB,QAAS,KAC1DlJ,KAAK2nB,yBAIT,OAAA/H,EAAA5f,KAAKwc,SAASsC,eAAdc,EAA4B1W,iBAAiB,QAAS,KAClDlJ,KAAK4nB,uBAIT,OAAA9H,EAAA9f,KAAKwc,SAASuC,gBAAde,EAA6B5W,iBAAiB,QAAS,KACnDlJ,KAAK6nB,wBAIT,OAAA9H,EAAA/f,KAAKwc,SAASoC,iBAAdmB,EAA8B7W,iBAAiB,QAAS,KACpDlJ,KAAK4nB,uBAGT,OAAA5H,EAAAhgB,KAAKwc,SAASqC,kBAAdmB,EAA+B9W,iBAAiB,QAAS,KACrDlJ,KAAK6nB,wBAIL7nB,KAAKwc,SAASqB,WACd7d,KAAKwc,SAASqB,UAAU3U,iBAAiB,QAAUxD,IACL,MAArCA,EAAEC,OAAuBmiB,SAAmBrjB,OAAOsjB,YAAc,KAClE/nB,KAAK4nB,uBAMjBnjB,OAAOyE,iBAAiB,SAAU,KAC1BzE,OAAOsjB,WAAa,MAEhB/nB,KAAKwc,SAASkC,UACd1e,KAAKwc,SAASkC,QAAQnR,UAAUC,OAAO,eAAgB,UACvDxN,KAAKwc,SAASkC,QAAQ3H,MAAMC,QAAU,IAEtChX,KAAKwc,SAASmC,gBACd3e,KAAKwc,SAASmC,cAAcpR,UAAUC,OAAO,eAAgB,UAC7DxN,KAAKwc,SAASmC,cAAc5H,MAAMC,QAAU,IAE5ChX,KAAKwc,SAASoC,gBACd5e,KAAKwc,SAASoC,eAAerR,UAAUC,OAAO,UAE9CxN,KAAKwc,SAASqC,iBACd7e,KAAKwc,SAASqC,gBAAgBtR,UAAUC,OAAO,UAEnDH,SAAStC,KAAKgM,MAAMiR,SAAW,KAG3C,CAEA,mBAAAN,GACI,IAAK1nB,KAAKwc,SAASkC,UAAY1e,KAAKwc,SAASoC,eAAgB,OAG7D,GAAIna,OAAOsjB,WAAa,IAAK,OAEZ/nB,KAAKwc,SAASkC,QAAQnR,UAAU1H,SAAS,kBAItD7F,KAAKwc,SAASkC,QAAQnR,UAAU1K,IAAI,gBACpC7C,KAAKwc,SAASkC,QAAQ3H,MAAMC,QAAU,QAI1ChX,KAAKwc,SAASkC,QAAQnR,UAAUgU,OAAO,UACvCvhB,KAAKwc,SAASoC,eAAerR,UAAUgU,OAAO,UAG1CvhB,KAAKwc,SAASkC,QAAQnR,UAAU1H,SAAS,UACzCwH,SAAStC,KAAKgM,MAAMiR,SAAW,SAE/B3a,SAAStC,KAAKgM,MAAMiR,SAAW,EAEvC,CAEA,kBAAAJ,GACS5nB,KAAKwc,SAASkC,SAAY1e,KAAKwc,SAASoC,iBAE7C5e,KAAKwc,SAASkC,QAAQnR,UAAUC,OAAO,UACvCxN,KAAKwc,SAASoC,eAAerR,UAAUC,OAAO,UAC9CH,SAAStC,KAAKgM,MAAMiR,SAAW,GACnC,CAEA,oBAAAL,GACI,IAAK3nB,KAAKwc,SAASmC,gBAAkB3e,KAAKwc,SAASqC,gBAAiB,OAGpE,GAAIpa,OAAOsjB,WAAa,IAAK,OAEZ/nB,KAAKwc,SAASmC,cAAcpR,UAAU1H,SAAS,kBAI5D7F,KAAKwc,SAASmC,cAAcpR,UAAU1K,IAAI,gBAC1C7C,KAAKwc,SAASmC,cAAc5H,MAAMC,QAAU,QAIhDhX,KAAKwc,SAASmC,cAAcpR,UAAUgU,OAAO,UAC7CvhB,KAAKwc,SAASqC,gBAAgBtR,UAAUgU,OAAO,UAG3CvhB,KAAKwc,SAASmC,cAAcpR,UAAU1H,SAAS,UAC/CwH,SAAStC,KAAKgM,MAAMiR,SAAW,SAE/B3a,SAAStC,KAAKgM,MAAMiR,SAAW,EAEvC,CAEA,mBAAAH,GACS7nB,KAAKwc,SAASmC,eAAkB3e,KAAKwc,SAASqC,kBAEnD7e,KAAKwc,SAASmC,cAAcpR,UAAUC,OAAO,UAC7CxN,KAAKwc,SAASqC,gBAAgBtR,UAAUC,OAAO,UAC/CH,SAAStC,KAAKgM,MAAMiR,SAAW,GACnC,CAEA,gBAAApG,GACI,MAAMzb,EAAUtG,EAAMiC,IAAI,mBACpBjB,EAAehB,EAAMiC,IAAI,gBACzBmK,EAAWpM,EAAMiC,IAAI,gBACrBxB,EAAW2L,EAAS3L,UAAY,MAChCC,EAAa0L,EAAS1L,YAAc,WAM1C,GAJIP,KAAKwc,SAASiB,uBAAyBtX,IACvCnG,KAAKwc,SAASiB,sBAAsBnK,YAAcnN,GAGlDnG,KAAKwc,SAASkB,oBAAsB7c,EAAc,CAElD,MAAOoD,EAAMC,EAAOC,GAAOtD,EAAaqQ,MAAM,KAAK/N,IAAIkO,QAIjD8N,EAHU,IAAIje,KAAK+C,EAAMC,EAAQ,EAAGC,GAGlBib,mBAAmB,QAAS,CAChDC,QAAS,OACTrb,SAAU1D,IAIRgf,EAAKrL,OAAOhQ,GAAM+T,UAAU,GAC5BuH,EAAKtL,OAAO/P,GAAOgQ,SAAS,EAAG,KAC/BsL,EAAKvL,OAAO9P,GAAK+P,SAAS,EAAG,KAEnC,IAAIpD,EAEAA,EADe,aAAfvQ,EACU,GAAGiE,OAAA+a,EAAE,KAAI/a,OAAAgb,EAAE,KAAIhb,OAAA8a,GAEf,GAAG9a,OAAAgb,EAAE,KAAIhb,OAAA+a,EAAE,KAAI/a,OAAA8a,GAI7B,MAAMI,EAAgB,GAAGlb,OAAA2a,EAAO,MAAK3a,OAAAsM,EAAO,OAC5C9Q,KAAKwc,SAASkB,mBAAmBpK,YAAcoM,CACnD,CACJ,CAEA,kBAAAT,GACI,MAAM9Y,EAAUtG,EAAMiC,IAAI,mBACpBjB,EAAehB,EAAMiC,IAAI,gBAE/B,IAAKqE,IAAYtF,EAAc,OAG/B,MAAMoL,EAAWpM,EAAMiC,IAAI,gBACrBxB,EAAW2L,EAAS3L,UAAY,MAChCC,EAAa0L,EAAS1L,YAAc,YAEnC0D,EAAMC,EAAOC,GAAOtD,EAAaqQ,MAAM,KAAK/N,IAAIkO,QAGjD8N,EAFU,IAAIje,KAAK+C,EAAMC,EAAQ,EAAGC,GAElBib,mBAAmB,QAAS,CAChDC,QAAS,OACTrb,SAAU1D,IAGRgf,EAAKrL,OAAOhQ,GAAM+T,UAAU,GAC5BuH,EAAKtL,OAAO/P,GAAOgQ,SAAS,EAAG,KAC/BsL,EAAKvL,OAAO9P,GAAK+P,SAAS,EAAG,KAEnC,IAAIpD,EAEAA,EADe,aAAfvQ,EACU,GAAGiE,OAAA+a,EAAE,KAAI/a,OAAAgb,EAAE,KAAIhb,OAAA8a,GAEf,GAAG9a,OAAAgb,EAAE,KAAIhb,OAAA+a,EAAE,KAAI/a,OAAA8a,GAG7B,MAAMI,EAAgB,GAAGlb,OAAA2a,EAAO,MAAK3a,OAAAsM,EAAO,OAGtCyU,EAAQlY,SAASC,eAAe,yBAChC2a,EAAS5a,SAASC,eAAe,wBACjC4a,EAAW7a,SAASC,eAAe,0BAEzC,IAAKiY,IAAU0C,IAAWC,EAAU,OAGpCD,EAAO3U,YAAcoM,EAGrB,MAAM1Q,EAAU8F,EAAe+E,aAG/B,GAAKpV,OAAe8Q,MAAO,CAEvB2S,EAAS3T,UAAY,GAErB,MAAM4T,EAAkB,IAAK1jB,OAAe8Q,MAAM2S,EAAU,CACxD9nB,MAAO,OACPgoB,UAAU,EACVnS,QAAS,CACLC,SAAS,KAIjBiS,EAAgBzR,KAAKnC,UAAYvF,EAGjCmZ,EAAgBzR,KAAKK,MAAMsR,SAAW,OACtCF,EAAgBzR,KAAKK,MAAMuR,WAAa,KAC5C,MAEIJ,EAAS3T,UAAYvF,EAIzBuW,EAAMhY,UAAU1K,IAAI,aAGpB,MAAM0lB,EAAiB7iB,IACL,WAAVA,EAAE3D,MACF/B,KAAKwoB,sBACLnb,SAASlE,oBAAoB,UAAWof,KAGhDlb,SAASnE,iBAAiB,UAAWqf,EACzC,CAEA,mBAAAC,GACI,MAAMjD,EAAQlY,SAASC,eAAe,yBAClCiY,GACAA,EAAMhY,UAAUC,OAAO,YAE/B,GAMkB,oBAAX/I,SACNA,OAAe8X,GAAKA,EAGpB9X,OAAegkB,oBAAsB,IAAMlM,EAAG2H,mBAC9Czf,OAAe8f,kBAAoB,IAAMhI,EAAGgI,oBAE5C9f,OAAe8G,cAAgBsU,UAC5B,MAAMsE,EAAY9W,SAASC,eAAe,gBACpC8W,EAAa/W,SAASC,eAAe,iBAErCwE,QAAOqS,WAAWjiB,MAAM0U,OACxB7E,EAAQ,MAAAqS,OAAA,EAAAA,EAAYliB,MAE1B,IAAK4P,EAAM,aAELhR,EAASyK,cAAcuG,EAAMC,GACnCwK,EAAGgI,0BAEGxjB,EAAMuO,cAAcwC,GAC1B,MAAMjR,EAAehB,EAAMiC,IAAI,gBAC3BjB,SACME,EAAM6N,SAASkD,EAAMjR,IAKlC4D,OAAe+c,kBAAoB,IAAMjF,EAAGiF,oBAC5C/c,OAAe4gB,mBAAqB,IAAM9I,EAAG8I,qBAE7C5gB,OAAeikB,aAAe7I,UAC3B,MAAMoF,EAAU5X,SAASC,eAAe,qBAClC4X,EAAW7X,SAASC,eAAe,sBACnC6X,EAAc9X,SAASC,eAAe,yBACtC8X,EAAW/X,SAASC,eAAe,sBACnCqb,EAAYtb,SAASC,eAAe,uBAEpCgR,EAAkBjR,SAASC,eAAe,qBAC1CiR,EAAiBlR,SAASC,eAAe,mBACzCkX,EAAmBnX,SAASC,eAAe,sBAC3CmX,EAA0BpX,SAASC,eAAe,8BAClDoX,EAAuBrX,SAASC,eAAe,0BAC/CqX,EAA2BtX,SAASC,eAAe,+BACnDsX,EAA6BvX,SAASC,eAAe,kCACrDsb,EAAkB/oB,EAAMiC,IAAI,gBAE5BzB,EAAY8Q,UAAS,MAAAmN,OAAA,EAAAA,EAAiBpc,QAAS,KAC/C5B,SAAWie,WAAgBrc,QAAS,MACpC3B,SAAaikB,WAAkBtiB,QAAS,WACxC1B,SAAoBikB,WAAyBlE,WAAW,EACxD9f,GAAmD,WAAlCikB,WAAsBnE,SACvC7f,GAA2D,WAAtCikB,WAA0BpE,SAC/C5f,GAA+D,WAAxCikB,WAA4BrE,SACnDngB,EAAQwoB,EAAgBxoB,OAAS,OAGnC6kB,MAAiBlL,UAAW,GAC5B4O,MAAqB5O,UAAW,GAChCmL,IAAWA,EAAyBnO,MAAMC,QAAU,QACpDmO,IAAcA,EAA4BpO,MAAMC,QAAU,gBAC1DoO,MAAmB9R,YAAc,aAErC,IASI,SARM7J,EAAIuC,eAAe,CAAE5L,QAAOC,YAAWC,WAAUC,aAAYC,oBAAmBC,iBAAgBC,qBAAoBC,yBAE1Hd,EAAMoC,IAAI,eAAgB,CAAE7B,QAAOC,YAAWC,WAAUC,aAAYC,oBAAmBC,iBAAgBC,qBAAoBC,yBAC3HoS,EAASC,SAGLoS,MAAmB9R,YAAc,UACjC6R,IAAcA,EAA4BpO,MAAMC,QAAU,QAC1DkO,EAAU,CACTA,EAAyBnO,MAAMC,QAAU,cAC1C,MAAM6R,EAAS3D,EAASpO,cAAc,8BAClC+R,MAAevV,YAAc,eACrC,CAqBA,SAlBM,IAAIzO,QAAQC,GAAW+B,WAAW/B,EAAS,MAEjDyX,EAAG8I,qBAGH9I,EAAGmF,kBAGHnF,EAAG4F,kCAGH5F,EAAG6F,6BACH7F,EAAG8F,iCAGH9F,EAAG+F,mCAGC9hB,EAAmB,CACnB,MAAM+hB,EAAe1iB,EAAMiC,IAAI,YAC3BygB,GAAgBA,EAAa/Q,OAAS,IACtC1Q,EAASyR,cAAcgQ,EAAa,GAAGzQ,MACvC/Q,EAAMqQ,eACNrQ,EAAMuO,cAAciT,EAAa,GAAGzQ,MAE5C,CACJ,OAASrO,GAOL,GALA8W,EAAc9W,MAAM,2BAGhB2hB,MAAmB9R,YAAc,QACjC6R,IAAcA,EAA4BpO,MAAMC,QAAU,QAC1DkO,EAAU,CACTA,EAAyBnO,MAAMC,QAAU,cAC1C,MAAM6R,EAAS3D,EAASpO,cAAc,8BAClC+R,MAAevV,YAAc,QACrC,CACJ,CAAA,QAEQ2R,MAAiBlL,UAAW,GAC5B4O,MAAqB5O,UAAW,EACxC,GAIHtV,OAAe6gB,qBAAuB,IAAM/I,EAAG+I,uBAG/C7gB,OAAeuc,qBAAuB,IAAMzE,EAAGyE,uBAE/Cvc,OAAeqkB,kBAAoBjJ,UAChC,MAAM0F,EAAQlY,SAASC,eAAe,qBACtC,IAAKiY,EAAO,OAEZ,MAAMpf,EAAUof,EAAM7Q,QAAQvO,QACxB2K,EAAUyU,EAAM7Q,QAAQtO,KAE1BD,GAAW2K,IAEXyL,EAAGyE,6BAGGjgB,EAAMyH,WAAWrC,EAAS2K,KAKvCrM,OAAeskB,qBAAwB7W,IACpC,MACM/L,EADetG,EAAMiC,IAAI,YACFuC,KAAK+N,GAAKA,EAAElM,KAAOgM,GAChD,IAAK/L,EAAS,OAEd,MAAMof,EAAQlY,SAASC,eAAe,sBAChC6W,EAAY9W,SAASC,eAAe,qBACpC0b,EAAa3b,SAASC,eAAe,4BACrC2b,EAAkB5b,SAASC,eAAe,uBAEhD,KAAKiY,GAAUpB,GAAc6E,GAAeC,GAAiB,OAG7D9E,EAAUjiB,MAAQiE,EAAQ2L,KAC1B,MAAM6Q,EAAkBpG,EAAGqG,sBAAsBzc,EAAQ4L,OACzDiX,EAAW9mB,MAAQygB,EAInBsG,EAAgB1U,UADD,CAAC,OAAQ,OAAQ,UAAW,OAAQ,UAAW,UAAW,UACtCpR,IAAI4O,IACnC,MAAMiR,EAAWL,IAAoB5Q,EAC/BmX,EAAclG,EAAW,sCAAwC,gCACvE,MAAO,mEAC6Cxe,OAAAwe,EAAW,YAAc,GAAE,2CACrDxe,SAAK,wEACuBA,OAAAuN,EAAK,yCACtCvN,OAAA+X,EAAGsK,cAAc9U,GAAM,+EACkBvN,OAAA0kB,EAAW,iIACiB1kB,OAAAuN,EAAK,8EAGhGgC,KAAK,IAGRwR,EAAM7Q,QAAQxC,UAAYA,EAC1BqT,EAAMhY,UAAU1K,IAAI,cAGvB4B,OAAe0kB,uBAA0BpX,IACtC,MAAMiX,EAAa3b,SAASC,eAAe,4BAC3C,IAAK0b,EAAY,OAEjBA,EAAW9mB,MAAQ6P,EAGH1E,SAASmH,iBAAiB,mCAClC/R,QAAQ6kB,IACMA,EAAoB5S,QAAQ3C,QAC7BA,GACbuV,EAAI/Z,UAAU1K,IAAI,aACjBykB,EAAoBvQ,MAAMwQ,OAAS,gCAEpCD,EAAI/Z,UAAUC,OAAO,aACpB8Z,EAAoBvQ,MAAMwQ,OAAS,4BAK/C9iB,OAAe2kB,sBAAwB,KACpC,MAAM7D,EAAQlY,SAASC,eAAe,sBAClCiY,IACAA,EAAMhY,UAAUC,OAAO,oBAChB+X,EAAM7Q,QAAQxC,YAI5BzN,OAAe4kB,mBAAqBxJ,UACjC,MAAM0F,EAAQlY,SAASC,eAAe,sBACtC,IAAKiY,EAAO,OAEZ,MAAMrT,EAAYqT,EAAM7Q,QAAQxC,UAC1BiS,EAAY9W,SAASC,eAAe,qBACpC0b,EAAa3b,SAASC,eAAe,4BAE3C,IAAK4E,IAAciS,IAAc6E,EAAY,OAE7C,MAAMlX,EAAOqS,EAAUjiB,MAAM0U,OACvB7E,EAAQiX,EAAW9mB,MAEpB4P,GAMJrN,OAAe2kB,8BAGVtoB,EAAS0K,cAAc0G,EAAWJ,EAAMC,GAG9CwK,EAAGyI,yBACHzI,EAAGkF,wBAZC6H,MAAM,gCAgBb7kB,OAAe8kB,uBAAyB,CAACrX,EAAmBM,KACzD,MAAM+S,EAAQlY,SAASC,eAAe,wBAChCkc,EAAcnc,SAASC,eAAe,uBAExCiY,GAASiE,IACTA,EAAYlW,YAAcd,EAC1B+S,EAAM7Q,QAAQxC,UAAYA,EAC1BqT,EAAMhY,UAAU1K,IAAI,eAI3B4B,OAAeglB,wBAA0B,KACtC,MAAMlE,EAAQlY,SAASC,eAAe,wBAClCiY,IACAA,EAAMhY,UAAUC,OAAO,oBAChB+X,EAAM7Q,QAAQxC,YAI5BzN,OAAeilB,qBAAuB7J,UACnC,MAAM0F,EAAQlY,SAASC,eAAe,wBACtC,IAAKiY,EAAO,OAEZ,MAAMrT,EAAYqT,EAAM7Q,QAAQxC,UAE5BA,IAECzN,OAAeglB,gCAGV3oB,EAAS2K,cAAcyG,GAG7BqK,EAAGyI,yBACHzI,EAAGkF,0BC//Cf,MAAMkI,EAAM,IA5NZ,MACE,UAAM/kB,CAAKglB,GAIT,UACQjlB,EAAMC,MAEd,OAASkJ,GAET,CAGA9N,KAAK6pB,qBAGLtN,EAAG3X,aAGGkQ,EAAelQ,KAAK,4BAA8BoK,IACtDjO,EAAMwP,gBAAgBvB,KAMxB,SAF8B7C,EAAK1B,kBAG3BzK,KAAKwjB,cACN,CAEL,MAAMrG,EAAa9P,SAASC,eAAe,eACrC4P,EAAc7P,SAASC,eAAe,gBACxC6P,GAAYA,EAAW5P,UAAUC,OAAO,WACxC0P,GAAaA,EAAY3P,UAAU1K,IAAI,UAC7C,CAGAwK,SAAStC,KAAKwC,UAAU1K,IAAI,UAG5BsJ,EAAKE,iBAAiBud,GAAgBzf,MAAM1G,MAG9C,CAEQ,kBAAAomB,GAENtgB,EAAOP,GAAG,kBAA2BtD,IAC/BA,EAAEmD,OAAOwB,eACXkQ,EAAcgB,QACZ,sFACA,CACEZ,MAAO,kBACPC,SAAU,QAOlBrR,EAAOP,GAAGQ,EAAoB9D,IAC5BoP,EAAe0D,WAAW9S,EAAEmD,OAAOmG,WAGrCzF,EAAOP,GAAGQ,EAAkB,QAK5BD,EAAOP,GAAGQ,EAAuBqW,MAAOna,IACtC,MAAMS,EAAUT,EAAEmD,OAAO1C,QAQzB,GALA2O,EAAeuF,mBAGT,IAAIxV,QAAQC,GAAW+B,WAAW/B,EAAS,MAE7CqB,EAAS,CACX,IAAItF,EAAehB,EAAMiC,IAAI,gBACxBjB,IACHA,EAAgBhB,EAAciC,IAAI,gBAI9Bf,EAAMuO,cAAcnJ,GAE1B4M,EAASC,SACLnS,IACFE,EAAMkP,iBAAiB9J,EAAStF,SAC1BE,EAAM6N,SAASzI,EAAStF,GAElC,MACEiU,EAAe0D,WAAW,MAK9BjP,EAAOP,GAAGQ,EAAoBqW,MAAOna,IACnC,MAAMoL,EAAUpL,EAAEmD,OAAOzC,KACnBD,EAAUtG,EAAMiC,IAAI,mBAM1B,GAHAgT,EAAeuF,mBACT,IAAIxV,QAAQC,GAAW+B,WAAW/B,EAAS,MAE7CqB,EAAS,CACX,MAAMwK,EAAiB9Q,EAAMiC,IAAI,mBAC3B8O,EAAc/Q,EAAMiC,IAAI,gBAE9B,GAAI6O,IAAmBxK,GAAWyK,IAAgBE,EAEhD,aAGI/P,EAAM6N,SAASzI,EAAS2K,EAChC,IAIFvH,EAAOP,GAAG,eAAuB6W,gBACzB7f,KAAKwjB,YAGbja,EAAOP,GAAG,cAAsB,KAC9B8L,EAAe0D,WAAW,MAI5BjP,EAAOP,GAAGQ,EAAmB9D,IACvBA,EAAEmD,OAAO0B,SACXgQ,EAAc9W,MAAMiC,EAAEmD,OAAO0B,WAIjChB,EAAOP,GAAGQ,EAAqB9D,IACzBA,EAAEmD,OAAO0B,SACXgQ,EAAc9M,QAAQ/H,EAAEmD,OAAO0B,UAGrC,CAEA,aAAciZ,GAIZ,MAAMpW,EAASC,SAASC,eAAe,kBACnCF,GAAQA,EAAOG,UAAUC,OAAO,WAGpC,MAAM2P,EAAa9P,SAASC,eAAe,eACrC4P,EAAc7P,SAASC,eAAe,gBACxC6P,GAAYA,EAAW5P,UAAU1K,IAAI,WACrCqa,GAAaA,EAAY3P,UAAUC,OAAO,WAE9C,UAGQ1M,EAAS4Q,eAGf1R,KAAK8pB,iBAGL/oB,EAAMqQ,eAGN2B,EAASC,SAGT,MAAMH,EAAc/R,EAAS6R,qBAG7B,GAAIE,EAAa,OAET9R,EAAMuO,cAAcuD,GAG1B,MAAMkX,EAAalqB,EAAciC,IAAI,SAGrCf,EAAMkP,iBAAiB4C,EAAakX,SAG9BhpB,EAAM6N,SAASiE,EAAakX,EACpC,CAGF,OAAStmB,GAEP8W,EAAc9W,MAAM,qDAAsD,CACxEkX,MAAO,uBACPC,SAAU,GAEd,CACF,CAEA,oBAAckP,GACZ,IACE,MACMxpB,EADWT,EAAMiC,IAAI,gBACDxB,UAAY,MAChC0pB,EAAa9oB,KAAK0C,MAGlBqmB,EAAkC,YADrBxgB,EAAIyC,cAAc5L,IACZuL,QAAU,GAE7BA,EAASoe,EAAaD,GADN9oB,KAAK0C,MAAQomB,GACsB,EAEzDnqB,EAAMoC,IAAI,mBAAoB4J,EAChC,OAASpI,GAET,CAGAoD,WAAW,IAAM7G,KAAK8pB,iBAAkB,IAC1C,GAQFrlB,OAAOylB,QAAUP,EAGK,oBAAXllB,QAAuD,cAA7BA,OAAOwJ,SAASkc,WACnD1lB,OAAO2lB,UAAY,CACjBT,MACA9pB,QACA0J,SACAxI,QACAD,WACAiS,WACA5G,OACA1C,MACA9E,QACAmQ,iBACAyF,gBACAgC,OAGJ,iBAKQ,IAAI1X,QAAQC,GAAW+B,WAAW/B,EAAS,IAGjD,MAAMulB,EAAehd,SAASyJ,cAAc,iCACtC8S,GAAiB,MAAAS,OAAA,EAAAA,EAAcjK,aAAa,aAAc3b,OAAO6lB,qBAEnEV,SACID,EAAI/kB,KAAKglB,EAInB,EAhBA"}