{"version":3,"file":"main-B-MbmeT6.js","sources":["../../../src/services/api.ts","../../../src/services/auth.ts","../../../src/services/notes.ts","../../../src/services/contexts.ts","../../../src/components/Calendar.ts","../../../src/components/Editor.ts","../../../src/components/Notifications.ts","../../../src/components/ui/colors.ts","../../../src/components/UI.ts","../../../src/components/ui/elements.ts","../../../src/main.ts"],"sourcesContent":["/**\n * API Client Module\n * Handles all backend communication\n */\n\nimport { state } from '@/utils/state'\nimport { events, EVENT } from '@/utils/events'\nimport type { User, Context, Note, UserSettings } from '@/types'\n\ninterface AuthResponse {\n  authenticated: boolean\n  user?: User\n}\n\ninterface LoginResponse {\n  success: boolean\n  user?: User\n  error?: string\n}\n\ninterface NoteResponse {\n  note: Note\n}\n\ninterface NotesListResponse {\n  notes: Note[]\n  total?: number\n}\n\ninterface ContextsResponse {\n  contexts: Context[]\n}\n\ninterface ServerTimeResponse {\n  timestamp: number  // Unix timestamp in seconds\n  timezone: string\n  iso: string\n}\n\nexport class APIClient {\n  // Base URL is empty string since we use relative paths\n  // private baseUrl = ''\n\n  async request<T = any>(endpoint: string, options: RequestInit = {}): Promise<T> {\n    try {\n      const response = await fetch(endpoint, {\n        ...options,\n        headers: {\n          ...options.headers,\n          'Content-Type': 'application/json'\n        },\n        credentials: 'same-origin'\n      })\n\n      if (!response.ok) {\n        const data = await response.json().catch(() => ({})) as { error?: string }\n\n        if (response.status === 401 || response.status === 403) {\n          if (!state.get('isLoggingOut')) {\n            // Check if this is a note-related request\n            const isNoteRequest = endpoint.includes('/api/notes')\n            const message = isNoteRequest\n              ? 'Session expired. Your notes are saved locally and will sync when you sign in again.'\n              : 'Session expired. Please login again.'\n\n            events.emit(EVENT.SHOW_ERROR, { message })\n            events.emit('session-expired' as any, { isNoteRequest })\n          }\n          state.set('currentUser', null)\n          throw new Error('Session expired')\n        }\n\n        throw new Error(data.error || `Request failed with status ${response.status}`)\n      }\n\n      return await response.json()\n    } catch (error) {\n      if (!state.get('isLoggingOut')) {\n        // Don't show error notification if it's already been handled\n        if (error instanceof Error && !error.message.includes('Session expired')) {\n          events.emit(EVENT.SHOW_ERROR, {\n            message: error.message || 'An error occurred'\n          })\n        }\n      }\n      throw error\n    }\n  }\n\n  // Auth endpoints\n  async checkAuth(): Promise<AuthResponse> {\n    try {\n      const response = await fetch('/api/auth/me')\n      const data = await response.json()\n      return data\n    } catch (error) {\n      console.error('Auth check failed:', error)\n      return { authenticated: false }\n    }\n  }\n\n  async login(accessToken: string, expiresIn?: number): Promise<LoginResponse> {\n    return await this.request<LoginResponse>('/api/auth/login', {\n      method: 'POST',\n      body: JSON.stringify({\n        access_token: accessToken,\n        expires_in: expiresIn || 3600\n      })\n    })\n  }\n\n  async loginWithCode(code: string): Promise<LoginResponse> {\n    return await this.request<LoginResponse>('/api/auth/login', {\n      method: 'POST',\n      body: JSON.stringify({ code })\n    })\n  }\n\n  async loginWithToken(idToken: string): Promise<LoginResponse> {\n    return await this.request<LoginResponse>('/api/auth/login', {\n      method: 'POST',\n      body: JSON.stringify({ id_token: idToken })\n    })\n  }\n\n  async logout(): Promise<void> {\n    await this.request('/api/auth/logout', {\n      method: 'POST'\n    })\n  }\n\n  // Contexts endpoints\n  async getContexts(): Promise<ContextsResponse> {\n    return await this.request<ContextsResponse>('/api/contexts')\n  }\n\n  async createContext(data: { name: string; color?: string }): Promise<Context> {\n    return await this.request<Context>('/api/contexts', {\n      method: 'POST',\n      body: JSON.stringify(data)\n    })\n  }\n\n  async updateContext(id: string, data: { name?: string; color?: string }): Promise<Context> {\n    return await this.request<Context>(`/api/contexts/${id}`, {\n      method: 'PUT',\n      body: JSON.stringify(data)\n    })\n  }\n\n  async deleteContext(id: string): Promise<void> {\n    await this.request(`/api/contexts/${id}`, {\n      method: 'DELETE'\n    })\n  }\n\n  // Notes endpoints\n  async getNote(context: string, date: string): Promise<NoteResponse> {\n    return await this.request<NoteResponse>(\n      `/api/notes?context=${encodeURIComponent(context)}&date=${date}`\n    )\n  }\n\n  async saveNote(data: { context: string; date: string; content: string; updated_at?: string }): Promise<Note> {\n    return await this.request<Note>('/api/notes', {\n      method: 'POST',\n      body: JSON.stringify(data)\n    })\n  }\n\n  async getNotesList(context: string, limit = 50, offset = 0): Promise<NotesListResponse> {\n    return await this.request<NotesListResponse>(\n      `/api/notes/list?context=${encodeURIComponent(context)}&limit=${limit}&offset=${offset}`\n    )\n  }\n\n  async deleteNote(context: string, date: string): Promise<void> {\n    const encodedContext = encodeURIComponent(context)\n    const encodedDate = encodeURIComponent(date)\n\n    await this.request(`/api/notes/${encodedContext}/${encodedDate}`, {\n      method: 'DELETE'\n    })\n  }\n\n  // Settings endpoints\n  async updateSettings(settings: Partial<UserSettings>): Promise<UserSettings> {\n    return await this.request<UserSettings>('/api/settings', {\n      method: 'PUT',\n      body: JSON.stringify(settings)\n    })\n  }\n\n  // Time sync\n  async getServerTime(timezone: string): Promise<ServerTimeResponse> {\n    const response = await fetch(`/api/time?timezone=${encodeURIComponent(timezone)}`)\n    return await response.json()\n  }\n}\n\nexport const api = new APIClient()\n","/**\n * Authentication Module\n * Handles Google OAuth and session management\n */\n\nimport { state } from '@/utils/state'\nimport { api } from './api'\nimport { events, EVENT } from '@/utils/events'\n\n// Google OAuth types\ndeclare global {\n  interface Window {\n    google?: {\n      accounts: {\n        id: {\n          initialize: (config: OneTapConfig) => void\n          prompt: (callback?: (notification: PromptNotification) => void) => void\n          cancel: () => void\n        }\n        oauth2: {\n          initCodeClient: (config: {\n            client_id: string\n            scope: string\n            ux_mode: string\n            access_type?: string\n            prompt?: string\n            callback: (response: { code?: string; error?: string }) => void\n          }) => {\n            requestCode: () => void\n          }\n        }\n      }\n    }\n  }\n}\n\ninterface OneTapConfig {\n  client_id: string\n  callback: (response: { credential?: string; select_by?: string }) => void\n  auto_select?: boolean\n  cancel_on_tap_outside?: boolean\n  context?: 'signin' | 'signup' | 'use'\n}\n\ninterface PromptNotification {\n  isDisplayMoment: () => boolean\n  isDisplayed: () => boolean\n  isNotDisplayed: () => boolean\n  getNotDisplayedReason: () => string\n  isSkippedMoment: () => boolean\n  getSkippedReason: () => string\n  isDismissedMoment: () => boolean\n  getDismissedReason: () => string\n}\n\ninterface CodeClient {\n  requestCode: () => void\n}\n\ninterface AuthCodeResponse {\n  code?: string\n  error?: string\n}\n\nclass AuthManager {\n  private codeClient: CodeClient | null = null\n  private initializationPromise: Promise<void> | null = null\n  private oneTapInitialized: boolean = false\n\n  async checkAuth(): Promise<boolean> {\n    const data = await api.checkAuth()\n\n    if (data.authenticated && data.user) {\n      state.update({\n        currentUser: data.user,\n        userSettings: data.user.settings || {\n          theme: 'dark',\n          weekStart: 0,\n          timezone: 'UTC',\n          dateFormat: 'DD-MM-YY',\n          uniqueContextMode: false,\n          showBreadcrumb: false,\n          showMarkdownEditor: false,\n          hideNewContextButton: false\n        }\n      })\n      return true\n    }\n\n    return false\n  }\n\n  private initOneTap(clientId: string): void {\n    if (this.oneTapInitialized || !window.google?.accounts?.id) {\n      return\n    }\n\n    try {\n      // Initialize One Tap - this will show a prompt if user is already signed in to Google\n      window.google.accounts.id.initialize({\n        client_id: clientId,\n        callback: (response) => this.handleOneTapResponse(response),\n        auto_select: false, // Don't auto-select to give user control\n        cancel_on_tap_outside: true,\n        context: 'signin'\n      })\n\n      // Trigger One Tap prompt (will only show if conditions are met)\n      window.google.accounts.id.prompt((notification) => {\n        if (notification.isNotDisplayed()) {\n          console.log('[AUTH] One Tap not displayed:', notification.getNotDisplayedReason())\n        } else if (notification.isSkippedMoment()) {\n          console.log('[AUTH] One Tap skipped:', notification.getSkippedReason())\n        }\n      })\n\n      this.oneTapInitialized = true\n      console.log('[AUTH] One Tap initialized')\n    } catch (error) {\n      console.error('[AUTH] Failed to initialize One Tap:', error)\n    }\n  }\n\n  private async handleOneTapResponse(response: { credential?: string; select_by?: string }): Promise<void> {\n    if (!response.credential) {\n      console.error('[AUTH] One Tap: No credential received')\n      return\n    }\n\n    console.log('[AUTH] One Tap sign-in detected')\n    const loader = document.getElementById('landing-loader')\n    if (loader) loader.classList.add('visible')\n\n    try {\n      // Validate the credential token with our backend\n      const data = await api.loginWithToken(response.credential)\n\n      if (data.success && data.user) {\n        console.log('[AUTH] One Tap login successful')\n        state.update({\n          currentUser: data.user,\n          hasNoContexts: (data.user as any).hasNoContexts || false,\n          userSettings: data.user.settings || {\n            theme: 'dark',\n            weekStart: 0,\n            timezone: 'UTC',\n            dateFormat: 'DD-MM-YY',\n            uniqueContextMode: false,\n            showBreadcrumb: false,\n            showMarkdownEditor: false,\n            hideNewContextButton: false\n          }\n        })\n        events.emit('auth-success' as any, {})\n      } else {\n        if (loader) loader.classList.remove('visible')\n        console.error('[AUTH] One Tap login failed:', data.error)\n      }\n    } catch (error) {\n      if (loader) loader.classList.remove('visible')\n      console.error('[AUTH] One Tap login error:', error)\n    }\n  }\n\n  async initGoogleClient(clientId: string): Promise<void> {\n    // Return existing initialization promise if already in progress\n    if (this.initializationPromise) {\n      return this.initializationPromise\n    }\n\n    // Return immediately if already initialized\n    if (this.codeClient) {\n      return Promise.resolve()\n    }\n\n    // Create initialization promise\n    this.initializationPromise = new Promise((resolve, reject) => {\n      // Wait for Google API to be loaded\n      const checkGoogleLoaded = () => {\n        if (window.google?.accounts?.oauth2) {\n          try {\n            // Use initCodeClient to get authorization code (which provides refresh token)\n            this.codeClient = window.google.accounts.oauth2.initCodeClient({\n              client_id: clientId,\n              scope: 'https://www.googleapis.com/auth/drive.file https://www.googleapis.com/auth/userinfo.email',\n              ux_mode: 'popup',\n              callback: (response) => this.handleAuthCodeResponse(response)\n            } as any)\n            console.log('[AUTH] Google code client initialized successfully')\n\n            // Initialize One Tap for smooth re-authentication\n            this.initOneTap(clientId)\n\n            resolve()\n          } catch (error) {\n            console.error('[AUTH] Failed to initialize Google client:', error)\n            reject(error)\n          }\n        } else {\n          // Retry after a short delay\n          setTimeout(checkGoogleLoaded, 100)\n        }\n      }\n\n      // Start checking\n      checkGoogleLoaded()\n\n      // Set a timeout to prevent infinite waiting\n      setTimeout(() => {\n        if (!this.codeClient) {\n          reject(new Error('Google API failed to load within timeout'))\n        }\n      }, 10000) // 10 second timeout\n    })\n\n    return this.initializationPromise\n  }\n\n  async handleAuthCodeResponse(response: AuthCodeResponse): Promise<void> {\n    const loader = document.getElementById('landing-loader')\n\n    if (response.error) {\n      if (loader) loader.classList.remove('visible')\n      events.emit(EVENT.SHOW_ERROR, {\n        message: 'OAuth failed: ' + response.error\n      })\n      return\n    }\n\n    if (!response.code) {\n      if (loader) loader.classList.remove('visible')\n      events.emit(EVENT.SHOW_ERROR, {\n        message: 'OAuth failed: No code received'\n      })\n      return\n    }\n\n    try {\n      // Send authorization code to backend to exchange for tokens\n      const data = await api.loginWithCode(response.code)\n\n      if (data.success && data.user) {\n        console.log('[AUTH] Login successful, updating state')\n        console.log('[AUTH] Received hasNoContexts:', (data.user as any).hasNoContexts)\n\n        state.update({\n          currentUser: data.user,\n          hasNoContexts: (data.user as any).hasNoContexts || false,\n          userSettings: data.user.settings || {\n            theme: 'dark',\n            weekStart: 0,\n            timezone: 'UTC',\n            dateFormat: 'DD-MM-YY',\n            uniqueContextMode: false,\n            showBreadcrumb: false,\n            showMarkdownEditor: false,\n            hideNewContextButton: false\n          }\n        })\n\n        console.log('[AUTH] Emitting auth-success event')\n        // Emit event for UI to react (loader will be hidden by showApp)\n        events.emit('auth-success' as any, {})\n      } else {\n        if (loader) loader.classList.remove('visible')\n        events.emit(EVENT.SHOW_ERROR, {\n          message: data.error || 'Login failed'\n        })\n      }\n    } catch (error) {\n      if (loader) loader.classList.remove('visible')\n      const message = error instanceof Error ? error.message : 'Unknown error'\n      events.emit(EVENT.SHOW_ERROR, {\n        message: 'Login failed: ' + message\n      })\n    }\n  }\n\n  async signIn(): Promise<void> {\n    // Show loading indicator immediately\n    const loader = document.getElementById('landing-loader')\n    if (loader) loader.classList.add('visible')\n\n    try {\n      // Wait for initialization to complete if not already done\n      await this.initializationPromise\n\n      if (!this.codeClient) {\n        throw new Error('Google client not initialized')\n      }\n\n      // Request authorization code (will trigger popup)\n      this.codeClient.requestCode()\n    } catch (error) {\n      console.error('[AUTH] Sign in failed:', error)\n      if (loader) loader.classList.remove('visible')\n      events.emit(EVENT.SHOW_ERROR, {\n        message: 'Failed to initialize Google sign-in. Please refresh the page.'\n      })\n    }\n  }\n\n  signOut(): void {\n    console.log('[AUTH] Starting logout...')\n\n    // Clear all client-side storage synchronously\n    try {\n      localStorage.clear()\n      sessionStorage.clear()\n      console.log('[AUTH] Client storage cleared')\n    } catch (e) {\n      console.error('[AUTH] Storage clear error:', e)\n    }\n\n    // Navigate to logout endpoint - server will handle session cleanup and redirect\n    console.log('[AUTH] Navigating to logout endpoint...')\n    window.location.href = '/api/auth/logout'\n  }\n\n  async clearAllCaches(): Promise<void> {\n    try {\n      // Clear IndexedDB\n      const dbName = 'DailyNotesDB'\n      const deleteRequest = indexedDB.deleteDatabase(dbName)\n\n      await new Promise<void>((resolve) => {\n        deleteRequest.onsuccess = () => {\n          console.log('[AUTH] IndexedDB cleared')\n          resolve()\n        }\n        deleteRequest.onerror = () => {\n          console.warn('[AUTH] Failed to clear IndexedDB')\n          resolve() // Continue even if this fails\n        }\n      })\n\n      // Clear all Service Worker caches\n      if ('caches' in window) {\n        const cacheNames = await caches.keys()\n        await Promise.all(\n          cacheNames.map(cacheName => {\n            console.log('[AUTH] Deleting cache:', cacheName)\n            return caches.delete(cacheName)\n          })\n        )\n        console.log('[AUTH] All Service Worker caches cleared')\n      }\n\n      // Unregister all service workers\n      if ('serviceWorker' in navigator) {\n        const registrations = await navigator.serviceWorker.getRegistrations()\n        await Promise.all(\n          registrations.map(registration => {\n            console.log('[AUTH] Unregistering service worker')\n            return registration.unregister()\n          })\n        )\n        console.log('[AUTH] All service workers unregistered')\n      }\n\n      // Clear cookies\n      document.cookie.split(';').forEach(cookie => {\n        const eqPos = cookie.indexOf('=')\n        const name = eqPos > -1 ? cookie.substring(0, eqPos).trim() : cookie.trim()\n        // Set cookie to expire in the past\n        document.cookie = `${name}=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/`\n        document.cookie = `${name}=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/;domain=${window.location.hostname}`\n      })\n      console.log('[AUTH] Cookies cleared')\n\n      // Clear localStorage and sessionStorage\n      localStorage.clear()\n      sessionStorage.clear()\n      console.log('[AUTH] Storage cleared')\n    } catch (error) {\n      console.error('[AUTH] Error clearing caches:', error)\n      // Don't throw - we still want to complete logout\n    }\n  }\n}\n\nexport const auth = new AuthManager()\n\n// Expose auth functions globally for onclick handlers in HTML\nif (typeof window !== 'undefined') {\n  (window as any).signInWithGoogle = () => auth.signIn()\n}\n","/**\n * Notes Module\n * Handles note loading, saving, and listing\n */\n\nimport { state } from '@/utils/state'\nimport { api } from './api'\nimport { cache } from '@/utils/cache'\nimport { events, EVENT } from '@/utils/events'\nimport type { Note } from '@/types'\n\nclass NotesManager {\n  private saveTimeout: number | null = null\n  private currentNoteContent = ''\n  private currentLoadToken = 0 // Token to cancel old load operations\n  private currentSelectToken = 0 // Token to cancel old date selection operations\n\n  async loadNote(context: string, date: string): Promise<Note | null> {\n    if (!context || !date) {\n      return null\n    }\n\n    // Increment token to cancel any previous load operations\n    const loadToken = ++this.currentLoadToken\n    console.log(`[Notes] loadNote started - token: ${loadToken}, context: ${context}, date: ${date}`)\n\n    // Try local cache first (instant load)\n    const cachedNote = await cache.getNote(context, date)\n\n    // Validate token before emitting cached content\n    if (loadToken !== this.currentLoadToken) {\n      console.log(`[Notes] Load cancelled (cache) - token ${loadToken} is stale`)\n      return null\n    }\n\n    if (cachedNote && cachedNote.content) {\n      // Only emit if cache has actual content\n      this.currentNoteContent = cachedNote.content\n      events.emit(EVENT.NOTE_LOADED, {\n        context,\n        date,\n        content: this.currentNoteContent\n      })\n    } else {\n      // No cached note or empty content - show blank editor immediately\n      this.currentNoteContent = ''\n      events.emit(EVENT.NOTE_LOADED, {\n        context,\n        date,\n        content: ''\n      })\n    }\n\n    // Then load from server in background\n    try {\n      const { note } = await api.getNote(context, date)\n\n      // Validate token before applying server data\n      if (loadToken !== this.currentLoadToken) {\n        console.log(`[Notes] Load cancelled (server) - token ${loadToken} is stale`)\n        return null\n      }\n\n      // Determine which version is more recent\n      const serverUpdatedAt = note.updated_at ? new Date(note.updated_at).getTime() : 0\n      const cachedUpdatedAt = cachedNote?.updated_at ? new Date(cachedNote.updated_at).getTime() : 0\n\n      // Only update if server has newer content OR cache is empty\n      const shouldUpdateFromServer =\n        !cachedNote ||\n        serverUpdatedAt > cachedUpdatedAt ||\n        (note.content && !cachedNote.content)\n\n      if (shouldUpdateFromServer) {\n        this.currentNoteContent = note.content || ''\n\n        // Update cache with server data\n        await cache.saveNote({\n          ...note,\n          context,\n          date,\n          content: note.content,\n          updated_at: note.updated_at\n        })\n\n        // Only emit if content actually changed\n        if (!cachedNote || cachedNote.content !== note.content) {\n          events.emit(EVENT.NOTE_LOADED, {\n            context,\n            date,\n            content: this.currentNoteContent\n          })\n        }\n      } else {\n        console.log('[Notes] Cache is newer than server, keeping cached version')\n      }\n\n      return note\n    } catch (error) {\n      // Validate token before handling error\n      if (loadToken !== this.currentLoadToken) {\n        console.log(`[Notes] Load cancelled (error) - token ${loadToken} is stale`)\n        return null\n      }\n\n      // If cached version exists, user already sees it\n      if (!cachedNote) {\n        console.error('Failed to load note:', error)\n        events.emit(EVENT.SHOW_ERROR, {\n          message: 'Failed to load note. Working offline.'\n        })\n      } else {\n        console.warn('[Notes] Server unavailable, using cached version')\n      }\n      return cachedNote\n    }\n  }\n\n  async saveNote(context: string, date: string, content: string): Promise<void> {\n    if (!context || !date) return\n\n    console.log(`[Notes] saveNote called - context: ${context}, date: ${date}, content length: ${content.length}`)\n\n    const now = new Date().toISOString()\n    const note = {\n      context,\n      date,\n      content,\n      updated_at: now\n    }\n\n    // 1. Save to local cache immediately (optimistic)\n    await cache.saveNote(note as Note)\n    this.currentNoteContent = content\n\n    console.log(`[Notes] Saved to cache and updated currentNoteContent`)\n\n    events.emit(EVENT.NOTE_SAVED, { context, date, content })\n\n    // 2. Update note in the list (update content, keep position)\n    this.updateNoteInList(context, date, content)\n\n    // 3. Sync to server immediately (backend will handle Drive sync)\n    console.log(`[Notes] Syncing to server - content length: ${content.length}`)\n    try {\n      await api.saveNote({ context, date, content, updated_at: now })\n      console.log(`[Notes] Successfully synced to server`)\n    } catch (error) {\n      console.error('[Notes] Failed to sync to server:', error)\n      // Note is still saved locally in cache, will retry on next app load\n    }\n  }\n\n  async loadNotesList(context: string, limit = 50, offset = 0): Promise<Note[]> {\n    if (!context) {\n      state.update({\n        notes: [],\n        notesWithDates: []\n      })\n      return []\n    }\n\n    try {\n      const data = await api.getNotesList(context, limit, offset)\n      const serverNotes = data.notes || []\n\n      // Get cached notes from IndexedDB for this context\n      const cachedNotes = await cache.getNotesByContext(context)\n\n      // Merge: prioritize server notes, but include cached notes not on server\n      const noteMap = new Map<string, Note>()\n\n      // Add all server notes first (authoritative)\n      serverNotes.forEach(note => {\n        noteMap.set(note.date, note)\n      })\n\n      // Add cached notes that don't exist on server (local-only or pending sync)\n      cachedNotes.forEach(note => {\n        if (!noteMap.has(note.date)) {\n          noteMap.set(note.date, note)\n        }\n      })\n\n      // Convert back to array and sort by date (newest first)\n      const mergedNotes = Array.from(noteMap.values()).sort((a, b) => {\n        return b.date.localeCompare(a.date)\n      })\n\n      const notesWithDates = mergedNotes.map(note => note.date)\n\n      state.update({\n        notes: mergedNotes,\n        notesWithDates\n      })\n\n      return mergedNotes\n    } catch (error) {\n      console.error('Failed to load notes list:', error)\n      return []\n    }\n  }\n\n  async refreshNotesList(context: string): Promise<void> {\n    await this.loadNotesList(context)\n  }\n\n  updateNoteInList(context: string, date: string, content: string): void {\n    const notes = state.get('notes')\n\n    // Find and update the note\n    const updatedNotes = notes.map(note => {\n      if (note.date === date && note.context === context) {\n        return {\n          ...note,\n          content: content,\n          updated_at: new Date().toISOString()\n        }\n      }\n      return note\n    })\n\n    // Update state\n    state.set('notes', updatedNotes)\n  }\n\n  ensureNoteInList(context: string, date: string): void {\n    const notes = state.get('notes')\n    const notesWithDates = state.get('notesWithDates')\n\n    // Check if note already exists in the list\n    const noteExists = notes.some(note => note.date === date)\n\n    if (!noteExists) {\n      // Create a placeholder note in the list\n      const newNote: Note = {\n        id: `temp-${context}-${date}`,\n        user_id: state.get('currentUser')?.id || '',\n        context: context,\n        date: date,\n        content: '',\n        created_at: new Date().toISOString(),\n        updated_at: new Date().toISOString()\n      }\n\n      // Add to notes list and sort by date (newest first)\n      const updatedNotes = [...notes, newNote].sort((a, b) => {\n        return b.date.localeCompare(a.date)\n      })\n\n      // Add to dates list\n      const updatedNotesWithDates = [...notesWithDates, date]\n\n      // Update state\n      state.update({\n        notes: updatedNotes,\n        notesWithDates: updatedNotesWithDates\n      })\n    }\n  }\n\n  handleNoteInput(content: string): void {\n    if (this.saveTimeout) {\n      clearTimeout(this.saveTimeout)\n    }\n\n    // Update current content IMMEDIATELY to track user input\n    this.currentNoteContent = content\n\n    // Capture current context and date at the time of input\n    const capturedContext = state.get('selectedContext')\n    const capturedDate = state.get('selectedDate')\n\n    if (!capturedContext || !capturedDate) return\n\n    // Debounce save - reduced from 1000ms to 500ms for better UX\n    this.saveTimeout = window.setTimeout(() => {\n      // Re-validate that context and date haven't changed\n      const currentContext = state.get('selectedContext')\n      const currentDate = state.get('selectedDate')\n\n      // Only save if context/date haven't changed\n      // We don't check content anymore because currentNoteContent is updated immediately\n      if (currentContext === capturedContext && currentDate === capturedDate) {\n        console.log(`[Notes] Saving note - context: ${capturedContext}, date: ${capturedDate}`)\n        // Use the LATEST content from currentNoteContent, not the captured one\n        this.saveNote(capturedContext, capturedDate, this.currentNoteContent)\n      } else {\n        console.log(\n          `[Notes] Save cancelled - context/date changed from ${capturedContext}/${capturedDate} to ${currentContext}/${currentDate}`\n        )\n      }\n    }, 500)\n  }\n\n  async selectDate(dateStr: string): Promise<void> {\n    // Increment token to cancel any previous select operations\n    const selectToken = ++this.currentSelectToken\n    console.log(`[Notes] selectDate started - token: ${selectToken}, date: ${dateStr}`)\n\n    const context = state.get('selectedContext')\n\n    // Parse the date\n    const dateParts = dateStr.split('-')\n    const year = parseInt(dateParts[0])\n    const month = parseInt(dateParts[1]) - 1\n\n    // Update calendar month to show the selected date\n    state.update({\n      selectedDate: dateStr,\n      currentCalendarMonth: month,\n      currentCalendarYear: year\n    })\n\n    // Validate token before proceeding\n    if (selectToken !== this.currentSelectToken) {\n      console.log(`[Notes] selectDate cancelled - token ${selectToken} is stale`)\n      return\n    }\n\n    events.emit(EVENT.DATE_CHANGED, { date: dateStr })\n\n    // Load note for this date\n    if (context) {\n      // Validate token again before loading\n      if (selectToken !== this.currentSelectToken) {\n        console.log(`[Notes] selectDate cancelled before load - token ${selectToken} is stale`)\n        return\n      }\n\n      // Create note in local list immediately if it doesn't exist\n      this.ensureNoteInList(context, dateStr)\n      await this.loadNote(context, dateStr)\n    }\n  }\n\n  setTodayDate(): void {\n    const dateStr = (state as any).get('today') as string\n    const [year, month] = dateStr.split('-').map(Number)\n\n    state.update({\n      selectedDate: dateStr,\n      currentCalendarMonth: month - 1,\n      currentCalendarYear: year\n    })\n  }\n\n  getCurrentNoteContent(): string {\n    return this.currentNoteContent\n  }\n\n  async deleteNote(context: string, date: string): Promise<void> {\n    if (!context || !date) return\n\n    console.log(`[Notes] Deleting note - context: ${context}, date: ${date}`)\n\n    // Cancel any pending save operations for this note\n    if (this.saveTimeout) {\n      clearTimeout(this.saveTimeout)\n      this.saveTimeout = null\n      console.log('[Notes] Cancelled pending save operation')\n    }\n\n    // 1. Remove from local cache immediately (optimistic)\n    await cache.deleteNote(context, date)\n\n    // 2. Remove from the notes list in state\n    const notes = state.get('notes')\n    const updatedNotes = notes.filter(note => !(note.date === date && note.context === context))\n\n    const notesWithDates = state.get('notesWithDates')\n    const updatedNotesWithDates = notesWithDates.filter(d => d !== date)\n\n    state.update({\n      notes: updatedNotes,\n      notesWithDates: updatedNotesWithDates\n    })\n\n    // 3. If the deleted note was currently selected, clear the editor and select another note\n    const selectedDate = state.get('selectedDate')\n    if (selectedDate === date) {\n      // Clear current note content IMMEDIATELY to prevent race conditions\n      this.currentNoteContent = ''\n\n      // Select the most recent note or today\n      if (updatedNotes.length > 0) {\n        // Select the first note (most recent)\n        const nextNote = updatedNotes[0]\n        await this.selectDate(nextNote.date)\n      } else {\n        // No notes left, select today and clear editor\n        this.setTodayDate()\n        events.emit(EVENT.NOTE_LOADED, {\n          context,\n          date,\n          content: ''\n        })\n      }\n    }\n\n    // 4. Sync deletion to server immediately (backend will handle Drive sync)\n    try {\n      await api.deleteNote(context, date)\n      console.log('[Notes] Note deleted from server')\n    } catch (error) {\n      console.error('[Notes] Failed to delete note from server:', error)\n      // Note is still deleted locally, server will sync on next app load\n    }\n\n    console.log('[Notes] Note deleted locally and synced')\n  }\n}\n\nexport const notes = new NotesManager()\n","/**\n * Contexts Module\n * Handles context (project) management\n */\n\nimport { state } from '@/utils/state'\nimport { api } from './api'\nimport { cache } from '@/utils/cache'\nimport { events, EVENT } from '@/utils/events'\nimport type { Context } from '@/types'\n\nclass ContextsManager {\n  async loadContexts(): Promise<void> {\n    // Try local cache first (instant)\n    const cachedContexts = await cache.getContexts()\n    console.log('[CONTEXTS] Cached contexts:', cachedContexts)\n    if (cachedContexts.length > 0) {\n      state.set('contexts', cachedContexts)\n    }\n\n    // Load from server in background\n    try {\n      console.log('[CONTEXTS] Fetching contexts from server...')\n      const response = await api.getContexts()\n      console.log('[CONTEXTS] Server response:', response)\n      // Handle null/undefined contexts gracefully\n      const contexts = response?.contexts || []\n      console.log('[CONTEXTS] Parsed contexts:', contexts)\n      await cache.saveContexts(contexts)\n      state.set('contexts', contexts)\n      events.emit(EVENT.CONTEXTS_LOADED, { contexts })\n    } catch (error) {\n      console.error('[CONTEXTS] Failed to load contexts from server:', error)\n      // Only show error if we have no contexts at all AND it's a real network error\n      if (cachedContexts.length === 0 && !navigator.onLine) {\n        events.emit(EVENT.SHOW_ERROR, {\n          message: 'Failed to load contexts. Working offline.'\n        })\n      }\n      // If online but failed, don't show error - user might just have 0 contexts\n    }\n  }\n\n  async createContext(name: string, color?: string): Promise<Context> {\n    const newContext: Context = {\n      id: `temp-${Date.now()}`,\n      user_id: state.get('currentUser')?.id || '',\n      name,\n      color: color || 'primary',\n      created_at: new Date().toISOString()\n    }\n\n    // 1. Update UI immediately (optimistic)\n    const currentContexts = state.get('contexts')\n    const updatedContexts = [...currentContexts, newContext]\n\n    await cache.saveContexts(updatedContexts)\n    state.set('contexts', updatedContexts)\n    state.set('selectedContext', name)\n\n    // 2. Sync to server immediately\n    try {\n      await api.createContext({ name, color })\n      console.log('[CONTEXTS] Successfully synced new context to server')\n      // Reload contexts to get server-assigned ID\n      await this.loadContexts()\n    } catch (error) {\n      console.error('[CONTEXTS] Failed to sync context to server:', error)\n      // Context is still saved locally, will retry on next app load\n    }\n\n    return newContext\n  }\n\n  async updateContext(contextId: string, name: string, color: string): Promise<boolean> {\n    try {\n      await api.updateContext(contextId, { name, color })\n\n      // Update local state\n      const currentContexts = state.get('contexts')\n      const updatedContexts = currentContexts.map(c => (c.id === contextId ? { ...c, name, color } : c))\n\n      await cache.saveContexts(updatedContexts)\n      state.set('contexts', updatedContexts)\n\n      // Update selected context if it was the one being edited\n      const selectedContext = state.get('selectedContext')\n      const oldContext = currentContexts.find(c => c.id === contextId)\n      if (selectedContext === oldContext?.name) {\n        state.set('selectedContext', name)\n        localStorage.setItem('lastContext', name)\n      }\n\n      events.emit(EVENT.SHOW_SUCCESS, { message: 'Context updated successfully' })\n      return true\n    } catch (error) {\n      events.emit(EVENT.SHOW_ERROR, { message: 'Failed to update context' })\n      return false\n    }\n  }\n\n  async deleteContext(contextId: string): Promise<void> {\n    try {\n      await api.deleteContext(contextId)\n\n      const currentContexts = state.get('contexts')\n      const updatedContexts = currentContexts.filter(c => c.id !== contextId)\n\n      await cache.saveContexts(updatedContexts)\n      state.set('contexts', updatedContexts)\n\n      events.emit(EVENT.SHOW_SUCCESS, { message: 'Context deleted successfully' })\n    } catch (error) {\n      events.emit(EVENT.SHOW_ERROR, { message: 'Failed to delete context' })\n    }\n  }\n\n  selectContext(contextName: string | null): void {\n    state.set('selectedContext', contextName)\n    events.emit(EVENT.CONTEXT_CHANGED, { context: contextName })\n\n    // Save last used context to localStorage\n    if (contextName) {\n      localStorage.setItem('lastContext', contextName)\n    }\n  }\n\n  getSelectedContext(): string | null {\n    return state.get('selectedContext')\n  }\n\n  getContextColor(contextName: string): string {\n    const contexts = state.get('contexts')\n    const context = contexts.find(c => c.name === contextName)\n    // Normalize old hex colors\n    const color = context?.color || 'primary'\n    const bulmaColors = ['text', 'link', 'primary', 'info', 'success', 'warning', 'danger']\n    return bulmaColors.includes(color) ? color : 'primary'\n  }\n\n  restoreLastContext(): string | null {\n    const contexts = state.get('contexts')\n    const settings = state.get('userSettings')\n    const uniqueContextMode = settings.uniqueContextMode || false\n\n    console.log('[CONTEXTS] restoreLastContext - contexts:', contexts)\n    console.log('[CONTEXTS] uniqueContextMode:', uniqueContextMode)\n\n    // If no contexts available, return null\n    if (!contexts || contexts.length === 0) {\n      console.log('[CONTEXTS] No contexts available')\n      return null\n    }\n\n    // If unique context mode is enabled, always select first context\n    if (uniqueContextMode) {\n      const firstContext = contexts[0].name\n      console.log('[CONTEXTS] Unique context mode - selecting first context:', firstContext)\n      this.selectContext(firstContext)\n      return firstContext\n    }\n\n    const lastContext = localStorage.getItem('lastContext')\n    console.log('[CONTEXTS] lastContext from localStorage:', lastContext)\n\n    // Try to restore last used context\n    if (lastContext) {\n      const contextExists = contexts.some(c => c.name === lastContext)\n      console.log('[CONTEXTS] lastContext exists?', contextExists)\n      if (contextExists) {\n        console.log('[CONTEXTS] Selecting last context:', lastContext)\n        this.selectContext(lastContext)\n        return lastContext\n      }\n    }\n\n    // If no last context or it doesn't exist, select first context\n    const firstContext = contexts[0].name\n    console.log('[CONTEXTS] Selecting first context:', firstContext)\n    this.selectContext(firstContext)\n    return firstContext\n  }\n}\n\nexport const contexts = new ContextsManager()\n","/**\n * Calendar Module\n * Handles calendar rendering and navigation\n */\n\nimport { state } from '@/utils/state'\nimport { notes } from '@/services/notes'\n\nclass Calendar {\n  private monthNames = [\n    'January',\n    'February',\n    'March',\n    'April',\n    'May',\n    'June',\n    'July',\n    'August',\n    'September',\n    'October',\n    'November',\n    'December'\n  ]\n  private dayNamesDefault = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat']\n\n  render(): void {\n    const settings = state.get('userSettings')\n    const weekStart = settings.weekStart || 0\n    const month = state.get('currentCalendarMonth')\n    const year = state.get('currentCalendarYear')\n    const selectedDate = state.get('selectedDate')\n    const today = (state as any).get('today') as string\n    const notesWithDates = state.get('notesWithDates')\n\n    const dayNames = [\n      ...this.dayNamesDefault.slice(weekStart),\n      ...this.dayNamesDefault.slice(0, weekStart)\n    ]\n\n    const monthYearEl = document.getElementById('calendar-month-year')\n    if (monthYearEl) {\n      monthYearEl.textContent = `${this.monthNames[month]} ${year}`\n    }\n\n    const firstDayOfMonth = new Date(year, month, 1).getDay()\n    const adjustedFirstDay = (firstDayOfMonth - weekStart + 7) % 7\n    const daysInMonth = new Date(year, month + 1, 0).getDate()\n    const daysInPrevMonth = new Date(year, month, 0).getDate()\n\n    const grid = document.getElementById('calendar-grid')\n    if (!grid) return\n\n    // Render day headers\n    let html = dayNames.map(day => `<div class=\"calendar-day-header\">${day}</div>`).join('')\n\n    // Render previous month's trailing days\n    for (let i = adjustedFirstDay - 1; i >= 0; i--) {\n      const day = daysInPrevMonth - i\n      html += `<div class=\"calendar-day other-month\">${day}</div>`\n    }\n\n    // Render current month's days\n    for (let day = 1; day <= daysInMonth; day++) {\n      const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`\n      const classes = ['calendar-day']\n\n      if (dateStr === today) classes.push('today')\n      if (dateStr === selectedDate) classes.push('selected')\n      if (notesWithDates.includes(dateStr)) classes.push('has-note')\n\n      html += `<div class=\"${classes.join(' ')}\" data-date=\"${dateStr}\">${day}</div>`\n    }\n\n    // Render next month's leading days\n    const totalCells = adjustedFirstDay + daysInMonth\n    const remainingCells = totalCells % 7 === 0 ? 0 : 7 - (totalCells % 7)\n    for (let day = 1; day <= remainingCells; day++) {\n      html += `<div class=\"calendar-day other-month\">${day}</div>`\n    }\n\n    grid.innerHTML = html\n\n    // Add click handlers\n    grid.querySelectorAll('.calendar-day:not(.other-month)').forEach(dayEl => {\n      dayEl.addEventListener('click', () => {\n        const dateStr = (dayEl as HTMLElement).dataset.date\n        if (dateStr) {\n          notes.selectDate(dateStr)\n        }\n      })\n    })\n  }\n\n  prevMonth(): void {\n    let month = state.get('currentCalendarMonth')\n    let year = state.get('currentCalendarYear')\n\n    month--\n    if (month < 0) {\n      month = 11\n      year--\n    }\n\n    state.update({\n      currentCalendarMonth: month,\n      currentCalendarYear: year\n    })\n\n    this.render()\n  }\n\n  nextMonth(): void {\n    let month = state.get('currentCalendarMonth')\n    let year = state.get('currentCalendarYear')\n\n    month++\n    if (month > 11) {\n      month = 0\n      year++\n    }\n\n    state.update({\n      currentCalendarMonth: month,\n      currentCalendarYear: year\n    })\n\n    this.render()\n  }\n\n  goToToday(): void {\n    const today = (state as any).get('today') as string\n    notes.selectDate(today)\n  }\n}\n\nexport const calendar = new Calendar()\n","/**\n * Markdown Editor Module\n * Modern WYSIWYG markdown editor using Quill\n */\n\nimport { state } from '@/utils/state'\n\n// Quill types\ndeclare global {\n  interface Window {\n    Quill?: any\n  }\n}\n\ninterface QuillDelta {\n  ops: QuillOp[]\n}\n\ninterface QuillOp {\n  insert: string | object\n  attributes?: Record<string, any>\n}\n\nclass MarkdownEditor {\n  private container: HTMLElement | null = null\n  private editor: any = null\n  private editorElement: HTMLElement | null = null\n  private onChangeCallback: ((content: string) => void) | null = null\n  private isUpdating = false\n  private currentNoteContent = ''\n  private updateTimeout: number | null = null\n  private contentVersion = 0 // Track version to ignore stale events\n\n  async init(containerId: string, onChange: (content: string) => void): Promise<void> {\n    this.container = document.getElementById(containerId)\n    if (!this.container) {\n      console.error('[MarkdownEditor] Container not found:', containerId)\n      return\n    }\n\n    this.onChangeCallback = onChange\n\n    // Don't load Quill yet - wait until actually needed (lazy loading)\n    // This saves ~300KB on initial page load\n    this.container.innerHTML =\n      '<div style=\"padding: 1rem; color: var(--bulma-text-light); opacity: 0.6;\">Editor loading...</div>'\n  }\n\n  async ensureQuillLoaded(): Promise<void> {\n    // Only load Quill when first needed\n    if (!this.editor) {\n      await this.loadQuill()\n      this.render()\n      this.initQuill()\n    }\n  }\n\n  private async loadQuill(): Promise<void> {\n    if (window.Quill) return\n\n    // Load Quill CSS locally\n    const css = document.createElement('link')\n    css.rel = 'stylesheet'\n    css.href = '/static/vendor/quill/quill.snow.css'\n    document.head.appendChild(css)\n\n    // Load Quill JS locally\n    const script = document.createElement('script')\n    script.src = '/static/vendor/quill/quill.min.js'\n    document.head.appendChild(script)\n\n    // Wait for Quill to load\n    await new Promise<void>(resolve => {\n      script.onload = () => resolve()\n    })\n  }\n\n  private render(): void {\n    if (!this.container) return\n\n    this.container.innerHTML = `\n      <div class=\"quill-editor-wrapper\">\n        <div id=\"quill-editor\"></div>\n      </div>\n    `\n\n    this.editorElement = document.getElementById('quill-editor')\n  }\n\n  private initQuill(): void {\n    if (!window.Quill) {\n      console.error('[MarkdownEditor] Quill not loaded')\n      return\n    }\n\n    try {\n      this.editor = new window.Quill(this.editorElement, {\n        theme: 'snow',\n        modules: {\n          toolbar: [\n            [{ header: [1, 2, 3, false] }],\n            ['bold', 'italic', 'underline'],\n            [{ list: 'ordered' }, { list: 'bullet' }],\n            ['link']\n          ]\n        },\n        placeholder: 'Start writing your notes...',\n        formats: ['bold', 'italic', 'underline', 'strike', 'header', 'list', 'code-block', 'blockquote', 'link']\n      })\n\n      // Listen for text changes\n      this.editor.on('text-change', () => {\n        if (this.isUpdating) return\n\n        if (this.onChangeCallback) {\n          const markdown = this.getMarkdown()\n          this.onChangeCallback(markdown)\n        }\n      })\n\n      // Force placeholder to hide on focus when editor is empty\n      this.editor.root.addEventListener('focus', () => {\n        if (this.editor.getText().trim() === '') {\n          this.editor.root.dataset.placeholder = ''\n        }\n      })\n\n      // Restore placeholder on blur if editor is still empty\n      this.editor.root.addEventListener('blur', () => {\n        if (this.editor.getText().trim() === '') {\n          this.editor.root.dataset.placeholder = 'Start writing your notes...'\n        }\n      })\n\n      // Apply toolbar visibility based on user settings after initialization\n      this.applyToolbarVisibility()\n    } catch (error) {\n      console.error('[MarkdownEditor] Error initializing editor:', error)\n    }\n  }\n\n  private applyToolbarVisibility(): void {\n    const settings = state.get('userSettings')\n    const showMarkdownEditor = settings.showMarkdownEditor === true\n\n    const toolbar = this.container?.querySelector('.ql-toolbar') as HTMLElement\n    if (toolbar) {\n      toolbar.style.display = showMarkdownEditor ? '' : 'none'\n    }\n\n    // Editor enabled state should be based on context selection only\n    // Toolbar visibility is separate from editor interactivity\n    if (this.editor) {\n      const context = state.get('selectedContext')\n      this.editor.enable(context ? true : false)\n    }\n  }\n\n  private getMarkdown(): string {\n    if (!this.editor) return ''\n\n    const delta = this.editor.getContents()\n    let markdown = ''\n    let currentList: string | null = null\n    let listCounter = 0\n\n    delta.ops.forEach((op: QuillOp) => {\n      if (!op.insert) return\n\n      const text = typeof op.insert === 'string' ? op.insert : ''\n      const attrs = op.attributes || {}\n\n      // Handle newlines with formatting\n      if (text === '\\n') {\n        // Check for headers\n        if (attrs.header) {\n          markdown = markdown.trimEnd()\n          markdown = '#'.repeat(attrs.header) + ' ' + markdown.split('\\n').pop()\n          markdown += '\\n\\n'\n        }\n        // Check for lists\n        else if (attrs.list) {\n          if (attrs.list !== currentList) {\n            currentList = attrs.list\n            listCounter = 1\n          }\n          const line = markdown.split('\\n').pop()!\n          markdown = markdown.substring(0, markdown.lastIndexOf('\\n') + 1)\n\n          if (attrs.list === 'ordered') {\n            markdown += `${listCounter++}. ${line}\\n`\n          } else if (attrs.list === 'bullet') {\n            markdown += `- ${line}\\n`\n          } else if (attrs.list === 'check') {\n            markdown += `- [ ] ${line}\\n`\n          }\n        } else {\n          currentList = null\n          listCounter = 0\n          if (attrs.blockquote) {\n            const line = markdown.split('\\n').pop()!\n            markdown = markdown.substring(0, markdown.lastIndexOf('\\n') + 1)\n            markdown += `> ${line}\\n`\n          } else if (attrs['code-block']) {\n            markdown += '\\n```\\n'\n          } else {\n            markdown += '\\n'\n          }\n        }\n      } else {\n        let formattedText = text\n\n        // Apply inline formatting\n        if (attrs.bold) {\n          formattedText = `**${formattedText}**`\n        }\n        if (attrs.italic) {\n          formattedText = `*${formattedText}*`\n        }\n        if (attrs.underline) {\n          formattedText = `__${formattedText}__`\n        }\n        if (attrs.strike) {\n          formattedText = `~~${formattedText}~~`\n        }\n        if (attrs.code) {\n          formattedText = `\\`${formattedText}\\``\n        }\n        if (attrs.link) {\n          formattedText = `[${formattedText}](${attrs.link})`\n        }\n\n        markdown += formattedText\n      }\n    })\n\n    return markdown.trim()\n  }\n\n  async setContent(content: string): Promise<void> {\n    // Lazy load Quill when content is set\n    await this.ensureQuillLoaded()\n\n    if (!this.editor) return\n\n    // Increment version to invalidate any pending events from previous setContent calls\n    this.contentVersion++\n    const currentVersion = this.contentVersion\n    console.log('[Editor] setContent called - version:', currentVersion, 'content length:', content.length)\n\n    // Clear any pending update timeout\n    if (this.updateTimeout) {\n      clearTimeout(this.updateTimeout)\n      this.updateTimeout = null\n    }\n\n    // CRITICAL: Disable the editor completely to prevent ANY text-change events\n    // This is more robust than just setting a flag\n    this.editor.disable()\n    this.isUpdating = true\n\n    try {\n      if (!content) {\n        this.editor.setText('')\n        this.currentNoteContent = ''\n      } else {\n        // Convert markdown to Quill Delta\n        const delta = this.markdownToDelta(content)\n        this.editor.setContents(delta)\n\n        // Track the current content for comparison\n        this.currentNoteContent = content\n      }\n    } finally {\n      // Re-enable editor after a delay to ensure all Quill internal events complete\n      this.updateTimeout = window.setTimeout(() => {\n        console.log('[Editor] Unlocking editor - version:', currentVersion)\n        this.isUpdating = false\n        this.updateTimeout = null\n\n        // Only re-enable if we have a context\n        const context = state.get('selectedContext')\n        if (context && this.editor) {\n          this.editor.enable(true)\n        }\n      }, 600)\n    }\n  }\n\n  private markdownToDelta(markdown: string): QuillDelta {\n    const ops: QuillOp[] = []\n    const lines = markdown.split('\\n')\n\n    lines.forEach((line, index) => {\n      // Headers\n      const headerMatch = line.match(/^(#{1,3})\\s+(.+)$/)\n      if (headerMatch) {\n        const level = headerMatch[1].length\n        ops.push({ insert: headerMatch[2] })\n        ops.push({ insert: '\\n', attributes: { header: level } })\n        return\n      }\n\n      // Bullet list\n      const bulletMatch = line.match(/^-\\s+(.+)$/)\n      if (bulletMatch) {\n        const text = this.parseInlineMarkdown(bulletMatch[1])\n        ops.push(...text)\n        ops.push({ insert: '\\n', attributes: { list: 'bullet' } })\n        return\n      }\n\n      // Numbered list\n      const numberedMatch = line.match(/^\\d+\\.\\s+(.+)$/)\n      if (numberedMatch) {\n        const text = this.parseInlineMarkdown(numberedMatch[1])\n        ops.push(...text)\n        ops.push({ insert: '\\n', attributes: { list: 'ordered' } })\n        return\n      }\n\n      // Task list\n      const taskMatch = line.match(/^-\\s+\\[([ x])\\]\\s+(.+)$/)\n      if (taskMatch) {\n        const text = this.parseInlineMarkdown(taskMatch[2])\n        ops.push(...text)\n        ops.push({ insert: '\\n', attributes: { list: 'check' } })\n        return\n      }\n\n      // Blockquote\n      const quoteMatch = line.match(/^>\\s+(.+)$/)\n      if (quoteMatch) {\n        const text = this.parseInlineMarkdown(quoteMatch[1])\n        ops.push(...text)\n        ops.push({ insert: '\\n', attributes: { blockquote: true } })\n        return\n      }\n\n      // Code block\n      if (line.startsWith('```')) {\n        ops.push({ insert: '\\n', attributes: { 'code-block': true } })\n        return\n      }\n\n      // Regular text with inline formatting\n      if (line.trim()) {\n        const text = this.parseInlineMarkdown(line)\n        ops.push(...text)\n      }\n\n      // Add newline if not last line\n      if (index < lines.length - 1) {\n        ops.push({ insert: '\\n' })\n      }\n    })\n\n    return { ops }\n  }\n\n  private parseInlineMarkdown(text: string): QuillOp[] {\n    const ops: QuillOp[] = []\n\n    // Parse inline formatting: bold, italic, underline, strike, code, links\n    const regex = /(\\*\\*([^*]+)\\*\\*)|(\\*([^*]+)\\*)|(~~([^~]+)~~)|(__([^_]+)__)|(`([^`]+)`)|(\\[([^\\]]+)\\]\\(([^)]+)\\))/g\n    let lastIndex = 0\n    let match: RegExpExecArray | null\n\n    while ((match = regex.exec(text)) !== null) {\n      // Add text before match\n      if (match.index > lastIndex) {\n        ops.push({ insert: text.substring(lastIndex, match.index) })\n      }\n\n      // Bold\n      if (match[1]) {\n        ops.push({ insert: match[2], attributes: { bold: true } })\n      }\n      // Italic\n      else if (match[3]) {\n        ops.push({ insert: match[4], attributes: { italic: true } })\n      }\n      // Strike\n      else if (match[5]) {\n        ops.push({ insert: match[6], attributes: { strike: true } })\n      }\n      // Underline\n      else if (match[7]) {\n        ops.push({ insert: match[8], attributes: { underline: true } })\n      }\n      // Code\n      else if (match[9]) {\n        ops.push({ insert: match[10], attributes: { code: true } })\n      }\n      // Link\n      else if (match[11]) {\n        ops.push({ insert: match[12], attributes: { link: match[13] } })\n      }\n\n      lastIndex = regex.lastIndex\n    }\n\n    // Add remaining text\n    if (lastIndex < text.length) {\n      ops.push({ insert: text.substring(lastIndex) })\n    }\n\n    return ops.length > 0 ? ops : [{ insert: text }]\n  }\n\n  getContent(): string {\n    return this.getMarkdown()\n  }\n\n  async setDisabled(disabled: boolean): Promise<void> {\n    // Only load editor if we're enabling it\n    if (!disabled) {\n      await this.ensureQuillLoaded()\n    }\n\n    if (!this.editor) return\n    this.editor.enable(!disabled)\n\n    const toolbar = this.container?.querySelector('.ql-toolbar') as HTMLElement\n    if (toolbar) {\n      toolbar.style.pointerEvents = disabled ? 'none' : 'auto'\n      toolbar.style.opacity = disabled ? '0.5' : '1'\n    }\n\n    // Update placeholder based on disabled state\n    const editorRoot = this.editor.root\n    if (editorRoot && disabled) {\n      editorRoot.dataset.placeholder = 'Select a context to start writing...'\n    } else if (editorRoot) {\n      editorRoot.dataset.placeholder = 'Start writing your notes...'\n    }\n  }\n\n  setPlaceholderMessage(message: string): void {\n    // Ensure Quill is loaded first\n    this.ensureQuillLoaded().then(() => {\n      if (!this.editor) return\n\n      const editorRoot = this.editor.root\n      if (editorRoot) {\n        editorRoot.dataset.placeholder = message\n      }\n    })\n  }\n\n  focus(): void {\n    if (this.editor) {\n      this.editor.focus()\n    }\n  }\n\n  /**\n   * Force flush any pending changes immediately\n   * Used before context/date changes to prevent data loss\n   */\n  forceFlush(): void {\n    if (!this.editor || this.isUpdating) return\n\n    const markdown = this.getMarkdown()\n\n    // Clear any pending debounced save\n    if (this.onChangeCallback) {\n      this.onChangeCallback(markdown)\n    }\n  }\n\n  /**\n   * Check if there are pending changes\n   */\n  hasPendingChanges(): boolean {\n    // If there's no editor, no pending changes\n    if (!this.editor) return false\n\n    const currentContent = this.getMarkdown()\n    return currentContent !== this.currentNoteContent\n  }\n}\n\nexport const markdownEditor = new MarkdownEditor()\n","/**\n * Professional Notification System\n * Handles toast notifications with queuing, stacking, and animations\n */\n\ninterface NotificationOptions {\n  type?: 'success' | 'error' | 'warning' | 'info'\n  title?: string\n  message: string\n  duration?: number\n  dismissible?: boolean\n  onAction?: () => void\n  actionLabel?: string\n}\n\ninterface Notification extends NotificationOptions {\n  id: string\n  element: HTMLElement | null\n  timeout?: number\n}\n\nclass NotificationManager {\n  private container: HTMLElement\n  private notifications = new Map<string, Notification>()\n  private queue: Notification[] = []\n  private readonly maxVisible = 3\n  private readonly defaultDuration = 5000\n\n  constructor() {\n    this.container = this.init()\n  }\n\n  private init(): HTMLElement {\n    // Create notification container\n    const container = document.createElement('div')\n    container.id = 'notification-container'\n    container.className = 'notification-container'\n    container.setAttribute('role', 'region')\n    container.setAttribute('aria-label', 'Notifications')\n    document.body.appendChild(container)\n    return container\n  }\n\n  /**\n   * Show a notification\n   */\n  show(options: NotificationOptions): string {\n    const {\n      type = 'info',\n      title,\n      message,\n      duration = this.defaultDuration,\n      dismissible = true,\n      onAction,\n      actionLabel = 'Action'\n    } = options\n\n    const id = `notification-${Date.now()}-${Math.random()}`\n\n    const notification: Notification = {\n      id,\n      type,\n      title,\n      message,\n      duration,\n      dismissible,\n      onAction,\n      actionLabel,\n      element: null\n    }\n\n    // Add to queue if at max capacity\n    const visibleCount = this.container.children.length\n    if (visibleCount >= this.maxVisible) {\n      this.queue.push(notification)\n      return id\n    }\n\n    this.render(notification)\n    return id\n  }\n\n  private render(notification: Notification): void {\n    const { id, type, title, message, duration, dismissible, onAction, actionLabel } = notification\n\n    // Create notification element\n    const element = document.createElement('div')\n    element.className = `notification-toast notification-${type}`\n    element.setAttribute('role', 'alert')\n    element.setAttribute('aria-live', type === 'error' ? 'assertive' : 'polite')\n    element.dataset.id = id\n\n    // Icon mapping\n    const icons = {\n      success: 'check_circle',\n      error: 'error',\n      warning: 'warning',\n      info: 'info'\n    }\n\n    // Build HTML\n    element.innerHTML = `\n      <div class=\"notification-icon\">\n        <span class=\"material-symbols-outlined\">${icons[type!]}</span>\n      </div>\n      <div class=\"notification-content\">\n        ${title ? `<div class=\"notification-title\">${this.escapeHtml(title)}</div>` : ''}\n        <div class=\"notification-message\">${this.escapeHtml(message)}</div>\n      </div>\n      ${\n        onAction\n          ? `\n        <button class=\"notification-action\" aria-label=\"${actionLabel}\">\n          ${actionLabel}\n        </button>\n      `\n          : ''\n      }\n      ${\n        dismissible\n          ? `\n        <button class=\"notification-close\" aria-label=\"Close notification\">\n          <span class=\"material-symbols-outlined\">close</span>\n        </button>\n      `\n          : ''\n      }\n    `\n\n    // Add event listeners\n    if (dismissible) {\n      const closeBtn = element.querySelector('.notification-close')\n      closeBtn?.addEventListener('click', () => this.dismiss(id))\n    }\n\n    if (onAction) {\n      const actionBtn = element.querySelector('.notification-action')\n      actionBtn?.addEventListener('click', () => {\n        onAction()\n        this.dismiss(id)\n      })\n    }\n\n    // Add to DOM with animation\n    this.container.appendChild(element)\n    notification.element = element\n    this.notifications.set(id, notification)\n\n    // Trigger animation\n    requestAnimationFrame(() => {\n      element.classList.add('notification-visible')\n    })\n\n    // Auto-dismiss after duration\n    if (duration && duration > 0) {\n      notification.timeout = window.setTimeout(() => {\n        this.dismiss(id)\n      }, duration)\n    }\n  }\n\n  dismiss(id: string): void {\n    const notification = this.notifications.get(id)\n    if (!notification) return\n\n    const { element, timeout } = notification\n\n    // Clear timeout\n    if (timeout) {\n      clearTimeout(timeout)\n    }\n\n    // Animate out\n    element?.classList.remove('notification-visible')\n    element?.classList.add('notification-hiding')\n\n    // Remove from DOM after animation\n    setTimeout(() => {\n      if (element?.parentNode) {\n        element.parentNode.removeChild(element)\n      }\n      this.notifications.delete(id)\n\n      // Show next queued notification\n      this.processQueue()\n    }, 300)\n  }\n\n  private processQueue(): void {\n    const visibleCount = this.container.children.length\n    if (this.queue.length > 0 && visibleCount < this.maxVisible) {\n      const next = this.queue.shift()\n      if (next) {\n        this.render(next)\n      }\n    }\n  }\n\n  // Convenience methods\n  success(message: string, options: Partial<NotificationOptions> = {}): string {\n    return this.show({ type: 'success', message, title: 'Success', ...options })\n  }\n\n  error(message: string, options: Partial<NotificationOptions> = {}): string {\n    return this.show({\n      type: 'error',\n      message,\n      title: 'Error',\n      duration: 7000, // Longer for errors\n      ...options\n    })\n  }\n\n  warning(message: string, options: Partial<NotificationOptions> = {}): string {\n    return this.show({ type: 'warning', message, title: 'Warning', ...options })\n  }\n\n  info(message: string, options: Partial<NotificationOptions> = {}): string {\n    return this.show({ type: 'info', message, ...options })\n  }\n\n  // Clear all notifications\n  clearAll(): void {\n    this.notifications.forEach(notification => {\n      this.dismiss(notification.id)\n    })\n    this.queue = []\n  }\n\n  // Utility: Escape HTML\n  private escapeHtml(text: string): string {\n    const div = document.createElement('div')\n    div.textContent = text\n    return div.innerHTML\n  }\n}\n\n// Create singleton instance\nexport const notifications = new NotificationManager()\n","/**\n * Color Utilities\n */\n\nexport function getColorLabel(color: string): string {\n    const labels: { [key: string]: string } = {\n        'text': 'Text (Gray)',\n        'link': 'Link (Blue)',\n        'primary': 'Primary (Cyan)',\n        'info': 'Info (Light Blue)',\n        'success': 'Success (Green)',\n        'warning': 'Warning (Yellow)',\n        'danger': 'Danger (Red)'\n    }\n    return labels[color] || color\n}\n\nexport function normalizeToBulmaColor(color: string): string {\n    // If it's already a Bulma color name, return it\n    const bulmaColors = ['text', 'link', 'primary', 'info', 'success', 'warning', 'danger']\n    if (bulmaColors.includes(color)) {\n        return color\n    }\n\n    // Map old hex colors to closest Bulma color\n    const hexToColor: { [key: string]: string } = {\n        '#485fc7': 'primary',\n        '#3e8ed0': 'info',\n        '#48c78e': 'success',\n        '#ffe08a': 'warning',\n        '#f14668': 'danger'\n    }\n\n    return hexToColor[color] || 'primary'\n}\n\nexport function setupColorButtons(hiddenInputId: string, containerId: string): void {\n    const hiddenInput = document.getElementById(hiddenInputId) as HTMLInputElement | null\n\n    // Get fresh button references each time\n    const buttons = document.querySelectorAll(`#${containerId} .color-btn`)\n    if (!buttons.length) return\n\n    buttons.forEach(button => {\n        // Remove old listeners by cloning\n        const newButton = button.cloneNode(true) as Element\n        const parent = button.parentNode\n        if (parent) {\n            parent.replaceChild(newButton, button)\n        }\n    })\n\n    // Get fresh references after cloning\n    const colorButtons = document.querySelectorAll(`#${containerId} .color-btn`)\n\n    colorButtons.forEach(button => {\n        button.addEventListener('click', (e) => {\n            e.preventDefault()\n            const color = (button as HTMLElement).dataset.color\n\n            // Update hidden input\n            if (hiddenInput && color) hiddenInput.value = color\n\n            // Update active state - get fresh references again\n            const allButtons = document.querySelectorAll(`#${containerId} .color-btn`)\n            allButtons.forEach(btn => {\n                const element = btn as HTMLElement\n                element.classList.remove('is-active')\n                element.style.border = '3px solid transparent'\n                element.style.borderRadius = '8px'\n            })\n\n            const element = button as HTMLElement\n            element.classList.add('is-active')\n            element.style.border = '3px solid var(--bulma-text)'\n            element.style.borderRadius = '8px'\n        })\n    })\n}\n\nexport function selectColorButton(color: string, containerId: string, hiddenInputId: string): void {\n    const colorButtons = document.querySelectorAll(`#${containerId} .color-btn`)\n    const hiddenInput = document.getElementById(hiddenInputId) as HTMLInputElement | null\n\n    if (hiddenInput) hiddenInput.value = color\n\n    colorButtons.forEach(btn => {\n        const element = btn as HTMLElement\n        element.classList.remove('is-active')\n        element.style.border = '3px solid transparent'\n        element.style.borderRadius = '8px'\n\n        if (element.dataset.color === color) {\n            element.classList.add('is-active')\n            element.style.border = `3px solid var(--bulma-text)`\n            element.style.borderRadius = '8px'\n        }\n    })\n}\n","/**\n * UI Module\n * Handles all UI rendering and user interactions\n */\n\nimport { state } from '@/utils/state'\nimport { contexts } from '@/services/contexts'\nimport { calendar } from '@/components/Calendar'\nimport { notes } from '@/services/notes'\nimport { events } from '@/utils/events'\nimport { api } from '@/services/api'\nimport { notifications } from '@/components/Notifications'\nimport { markdownEditor } from '@/components/Editor'\nimport { auth } from '@/services/auth'\nimport { cacheElements } from './ui/elements'\nimport { normalizeToBulmaColor, getColorLabel, setupColorButtons, selectColorButton } from './ui/colors'\nimport type { UIElements, SyncStatusOptions, NotificationOptions } from './ui/types'\n\nexport class UIManager {\n    elements: UIElements;\n    lastKnownDate: string | null;\n    INITIAL_RENDER_COUNT: number;\n    renderedNotesCount: number;\n    clockStarted: boolean;\n\n    constructor() {\n        this.elements = {} as UIElements;\n        this.lastKnownDate = null;\n        // Virtual scrolling optimization\n        this.INITIAL_RENDER_COUNT = 50; // Only render first 50 notes initially\n        this.renderedNotesCount = this.INITIAL_RENDER_COUNT;\n        this.clockStarted = false;\n    }\n\n    init(): void {\n        this.elements = cacheElements()\n        this.setupEventListeners()\n        this.setupStateSubscriptions()\n        this.setupUserDropdown()\n        this.setupMobileNavigation()\n        // Clock will start after server time sync in showApp()\n    }\n\n    setupEventListeners(): void {\n        // Editor fullscreen button\n        const editorFullscreenBtn = document.getElementById('editor-fullscreen-btn');\n        if (editorFullscreenBtn) {\n            editorFullscreenBtn.addEventListener('click', () => {\n                this.openFullscreenNote();\n            });\n        }\n\n        // Editor delete button\n        const editorDeleteBtn = document.getElementById('editor-delete-note-btn');\n        if (editorDeleteBtn) {\n            editorDeleteBtn.addEventListener('click', () => {\n                const context = state.get('selectedContext');\n                const dateStr = state.get('selectedDate');\n\n                if (context && dateStr) {\n                    // Get formatted date for display\n                    const settings = state.get('userSettings');\n                    const timezone = settings.timezone || 'UTC';\n                    const dateFormat = settings.dateFormat || 'DD-MM-YY';\n\n                    const [year, month, day] = dateStr.split('-').map(Number);\n                    const dateObj = new Date(year, month - 1, day);\n\n                    // Get the day name\n                    const dayName = dateObj.toLocaleDateString('en-US', {\n                        weekday: 'long',\n                        timeZone: timezone\n                    });\n\n                    // Format date\n                    const yy = String(year).substring(2);\n                    const mm = String(month).padStart(2, '0');\n                    const dd = String(day).padStart(2, '0');\n\n                    let formattedDateStr: string;\n                    if (dateFormat === 'MM-DD-YY') {\n                        formattedDateStr = `${mm}-${dd}-${yy}`;\n                    } else {\n                        formattedDateStr = `${dd}-${mm}-${yy}`;\n                    }\n\n                    const formattedDate = `${dayName}, ${formattedDateStr}`;\n\n                    // Show modal\n                    this.showDeleteNoteModal(context, dateStr, formattedDate);\n                }\n            });\n        }\n\n        // Context selection (desktop)\n        // Just update state - the CONTEXT_CHANGED event handler will do the rest\n        this.elements.contextSelect?.addEventListener('change', (e) => {\n            const context = (e.target as HTMLSelectElement).value;\n            console.log('[UI] Desktop context selector changed:', context);\n            contexts.selectContext(context);\n        });\n\n        // Context selection (mobile)\n        // Just update state - the CONTEXT_CHANGED event handler will do the rest\n        this.elements.mobileContextSelect?.addEventListener('change', (e) => {\n            const context = (e.target as HTMLSelectElement).value;\n            console.log('[UI] Mobile context selector changed:', context);\n            contexts.selectContext(context);\n        });\n\n        // Date picker\n        this.elements.datePicker?.addEventListener('change', async (e) => {\n            const dateStr = (e.target as HTMLInputElement).value;\n            // Check if this date is already selected\n            const currentDate = state.get('selectedDate');\n            if (currentDate === dateStr) {\n                console.log('[UI] Date picker: date already selected, skipping:', dateStr);\n                return;\n            }\n            await notes.selectDate(dateStr);\n        });\n\n        // Calendar navigation\n        document.getElementById('prev-month')?.addEventListener('click', () => {\n            calendar.prevMonth();\n        });\n\n        document.getElementById('next-month')?.addEventListener('click', () => {\n            calendar.nextMonth();\n        });\n\n        // Theme toggle\n        this.elements.themeToggleMenu?.addEventListener('click', async (e) => {\n            e.preventDefault();\n            const currentTheme = document.documentElement.getAttribute('data-theme');\n            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';\n            this.setTheme(newTheme);\n\n            const settings = state.get('userSettings');\n            state.set('userSettings', { ...settings, theme: newTheme });\n\n            try {\n                await api.updateSettings({ ...settings, theme: newTheme });\n            } catch (err) {\n                console.error('Failed to save theme:', err);\n            }\n        });\n\n        this.elements.themeToggleSwitch?.addEventListener('change', (e) => {\n            this.setTheme((e.target as HTMLInputElement).checked ? 'dark' : 'light');\n        });\n\n        // Keyboard shortcuts\n        this.setupKeyboardShortcuts();\n    }\n\n    setupKeyboardShortcuts(): void {\n        document.addEventListener('keydown', (e) => {\n            const isMac = navigator.platform.toUpperCase().indexOf('MAC') >= 0;\n            const modKey = isMac ? e.metaKey : e.ctrlKey;\n\n            // Cmd/Ctrl+K: Focus context selector\n            if (modKey && e.key === 'k') {\n                e.preventDefault();\n                this.elements.contextSelect?.focus();\n                return;\n            }\n\n            // Cmd/Ctrl+S: Force sync\n            if (modKey && e.key === 's') {\n                e.preventDefault();\n                events.emit('sync-force' as any, undefined);\n                return;\n            }\n\n            // Cmd/Ctrl+/: Focus editor (handled by markdown editor)\n            if (modKey && e.key === '/') {\n                e.preventDefault();\n                return;\n            }\n\n            // Escape: Close modals\n            if (e.key === 'Escape') {\n                // Check if delete modal is open (highest priority)\n                const deleteModal = document.getElementById('delete-note-modal');\n                if (deleteModal?.classList.contains('is-active')) {\n                    this.closeDeleteNoteModal();\n                    return;\n                }\n\n                this.closeAllModals();\n                return;\n            }\n        });\n    }\n\n    setupUserDropdown(): void {\n        const userDropdown = document.getElementById('user-dropdown');\n        const userDropdownButton = document.getElementById('user-dropdown-button');\n        const settingsMenuItem = document.getElementById('settings-menu-item');\n        const signoutMenuItem = document.getElementById('signout-menu-item');\n\n        if (!userDropdown || !userDropdownButton) return;\n\n        // Toggle dropdown\n        userDropdownButton.addEventListener('click', (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            userDropdown.classList.toggle('is-active');\n        });\n\n        // Settings click\n        settingsMenuItem?.addEventListener('click', (e) => {\n            e.preventDefault();\n            userDropdown.classList.remove('is-active');\n            this.showSettingsModal();\n        });\n\n        // Sign out click\n        signoutMenuItem?.addEventListener('click', (e) => {\n            e.preventDefault();\n            userDropdown.classList.remove('is-active');\n            auth.signOut();\n        });\n\n        // Close when clicking outside\n        document.addEventListener('click', (e) => {\n            if (!userDropdown.contains(e.target as Node)) {\n                userDropdown.classList.remove('is-active');\n            }\n        });\n\n        // Close on escape\n        document.addEventListener('keydown', (e) => {\n            if (e.key === 'Escape' && userDropdown.classList.contains('is-active')) {\n                userDropdown.classList.remove('is-active');\n            }\n        });\n    }\n\n    setupStateSubscriptions(): void {\n        // Re-render UI when contexts change\n        state.subscribe('contexts', () => {\n            this.renderContextsSelect();\n        });\n\n        // Update calendar when month/year changes\n        state.subscribeMany(['currentCalendarMonth', 'currentCalendarYear'], () => {\n            calendar.render();\n        });\n\n        // Update UI when notes list changes\n        state.subscribe('notes', () => {\n            this.renderNotesList();\n            calendar.render();\n        });\n\n        // Update breadcrumb when context changes\n        state.subscribe('selectedContext', (_context) => {\n            this.updateBreadcrumb();\n            // Reset virtual scrolling when switching contexts\n            this.renderedNotesCount = this.INITIAL_RENDER_COUNT;\n        });\n\n        // Update date picker when selected date changes\n        state.subscribe('selectedDate', (newDate) => {\n            if (this.elements.datePicker && newDate) {\n                this.elements.datePicker.value = newDate as string;\n                this.updateDatePickerDisplay(newDate as string);\n            }\n            this.renderNotesList(); // Update active state\n            calendar.render();\n            this.updateBreadcrumb();\n            this.updateEditorDeleteButton(); // Update delete button visibility\n        });\n\n        // Update date picker display when date format changes\n        state.subscribe('userSettings', () => {\n            const selectedDate = state.get('selectedDate');\n            if (selectedDate) {\n                this.updateDatePickerDisplay(selectedDate);\n            }\n            this.updateBreadcrumb();\n        });\n\n        // Update context indicator when selected context changes\n        state.subscribe('selectedContext', (selectedContext) => {\n            // Update the select dropdown values (both desktop and mobile)\n            if (this.elements.contextSelect && selectedContext) {\n                this.elements.contextSelect.value = selectedContext;\n            }\n            if (this.elements.mobileContextSelect && selectedContext) {\n                this.elements.mobileContextSelect.value = selectedContext;\n            }\n            this.updateContextIndicator();\n            this.updateEditorState();\n        });\n\n        // Update user email when user changes\n        state.subscribe('currentUser', (user) => {\n            if (this.elements.userEmail && user) {\n                this.elements.userEmail.textContent = user.email || '';\n            }\n        });\n\n        // Update theme when settings change\n        state.subscribe('userSettings', (settings) => {\n            if (settings.theme) {\n                this.setTheme(settings.theme);\n            }\n            // Update context selector visibility based on uniqueContextMode\n            this.updateContextSelectorVisibility();\n            // Update breadcrumb visibility\n            this.updateBreadcrumbVisibility();\n            // Update markdown editor visibility\n            this.updateMarkdownEditorVisibility();\n            // Update new context button visibility\n            this.updateNewContextButtonVisibility();\n        });\n    }\n\n    renderContextsSelect(): void {\n        const contextsList = state.get('contexts');\n        const selectedContext = state.get('selectedContext');\n\n        const optionsHTML = '<option value=\"\">Select context...</option>' +\n            contextsList.map(c =>\n                `<option value=\"${c.name}\" data-color=\"${c.color || 'primary'}\">${c.name}</option>`\n            ).join('');\n\n        // Update desktop selector\n        if (this.elements.contextSelect) {\n            this.elements.contextSelect.innerHTML = optionsHTML;\n            if (selectedContext) {\n                this.elements.contextSelect.value = selectedContext;\n            }\n        }\n\n        // Update mobile selector\n        if (this.elements.mobileContextSelect) {\n            this.elements.mobileContextSelect.innerHTML = optionsHTML;\n            if (selectedContext) {\n                this.elements.mobileContextSelect.value = selectedContext;\n            }\n        }\n\n        this.updateContextIndicator();\n    }\n\n    updateContextIndicator(): void {\n        // Update desktop indicator\n        if (this.elements.contextSelect && this.elements.contextColorIndicator) {\n            const opt = this.elements.contextSelect.options[this.elements.contextSelect.selectedIndex] as HTMLOptionElement;\n\n            if (opt?.dataset.color && opt.value !== '') {\n                const normalizedColor = normalizeToBulmaColor(opt.dataset.color);\n                this.elements.contextColorIndicator.style.background = `var(--bulma-${normalizedColor})`;\n                this.elements.contextColorIndicator.style.opacity = '1';\n            } else {\n                this.elements.contextColorIndicator.style.background = 'var(--bulma-grey-light)';\n                this.elements.contextColorIndicator.style.opacity = '0.3';\n            }\n        }\n\n        // Update mobile indicator\n        if (this.elements.mobileContextSelect && this.elements.mobileContextColorIndicator) {\n            const opt = this.elements.mobileContextSelect.options[this.elements.mobileContextSelect.selectedIndex] as HTMLOptionElement;\n\n            if (opt?.dataset.color && opt.value !== '') {\n                const normalizedColor = normalizeToBulmaColor(opt.dataset.color);\n                this.elements.mobileContextColorIndicator.style.background = `var(--bulma-${normalizedColor})`;\n                this.elements.mobileContextColorIndicator.style.opacity = '1';\n            } else {\n                this.elements.mobileContextColorIndicator.style.background = 'var(--bulma-grey-light)';\n                this.elements.mobileContextColorIndicator.style.opacity = '0.3';\n            }\n        }\n    }\n\n    renderNotesList(): void {\n        const notesList = state.get('notes');\n        const selectedDate = state.get('selectedDate');\n        const settings = state.get('userSettings');\n        const timezone = settings.timezone || 'UTC';\n        const dateFormat = settings.dateFormat || 'DD-MM-YY';\n\n        if (!this.elements.notesList) return;\n\n        if (notesList.length === 0) {\n            this.elements.notesList.innerHTML = '<li class=\"has-text-centered py-6 has-text-grey-light\">No notes yet</li>';\n            return;\n        }\n\n        // Virtual scrolling: only render visible notes\n        const notesToRender = notesList.slice(0, this.renderedNotesCount);\n        const hasMore = notesList.length > this.renderedNotesCount;\n\n        this.elements.notesList.innerHTML = notesToRender.map(note => {\n            const [year, month, day] = note.date.split('-').map(Number);\n            const dateObj = new Date(year, month - 1, day);\n\n            // Get the day name in English\n            const dayName = dateObj.toLocaleDateString('en-US', {\n                weekday: 'long',\n                timeZone: timezone\n            });\n\n            // Format date based on user preference\n            const yy = String(year).substring(2); // Get last 2 digits of year\n            const mm = String(month).padStart(2, '0');\n            const dd = String(day).padStart(2, '0');\n\n            let dateStr: string;\n            if (dateFormat === 'MM-DD-YY') {\n                dateStr = `${mm}-${dd}-${yy}`;\n            } else {\n                dateStr = `${dd}-${mm}-${yy}`;\n            }\n\n            // Format: \"Monday, 24-10-25.md\" or \"Monday, 10-24-25.md\" depending on dateFormat\n            const formattedDate = `${dayName}, ${dateStr}.md`;\n\n            const isActive = note.date === selectedDate;\n\n            return `\n                <li>\n                    <a\n                        class=\"${isActive ? 'is-active' : ''}\"\n                        data-date=\"${note.date}\"\n                    >\n                        ${formattedDate}\n                    </a>\n                </li>\n            `;\n        }).join('');\n\n        // Add \"Load More\" button if there are more notes\n        if (hasMore) {\n            this.elements.notesList.innerHTML += `\n                <li class=\"has-text-centered py-3\">\n                    <button class=\"button is-small is-ghost\" id=\"load-more-notes\" style=\"opacity: 0.7;\">\n                        <span class=\"icon\">\n                            <span class=\"material-symbols-outlined\">expand_more</span>\n                        </span>\n                        <span>Load ${Math.min(50, notesList.length - this.renderedNotesCount)} more</span>\n                    </button>\n                </li>\n            `;\n        }\n\n        // Add click handlers for notes\n        this.elements.notesList.querySelectorAll('a[data-date]').forEach(link => {\n            link.addEventListener('click', async (e) => {\n                e.preventDefault(); // Prevent default link behavior\n                const dateStr = (link as HTMLElement).dataset.date;\n                if (dateStr) {\n                    // Check if this date is already selected\n                    const currentDate = state.get('selectedDate');\n                    if (currentDate === dateStr) {\n                        console.log('[UI] Date already selected, skipping:', dateStr);\n                        return;\n                    }\n                    await notes.selectDate(dateStr);\n                }\n            });\n        });\n\n        // Add click handler for \"Load More\" button\n        const loadMoreBtn = document.getElementById('load-more-notes');\n        if (loadMoreBtn) {\n            loadMoreBtn.addEventListener('click', () => {\n                this.renderedNotesCount += 50;\n                this.renderNotesList();\n            });\n        }\n    }\n\n    updateEditorState(): void {\n        // Editor state is now managed by the markdown editor module\n        const context = state.get('selectedContext');\n        const contextsList = state.get('contexts') || [];\n\n        // Update editor state based on context\n        if (context) {\n            markdownEditor.setDisabled(false);\n        } else {\n            // First ensure Quill is loaded before setting placeholder\n            markdownEditor.ensureQuillLoaded().then(() => {\n                markdownEditor.setDisabled(true);\n                markdownEditor.setContent('');\n\n                // If there are no contexts at all, show a message to create the first one\n                if (contextsList.length === 0) {\n                    // Wait a bit to ensure setDisabled has applied\n                    setTimeout(() => {\n                        markdownEditor.setPlaceholderMessage('Click + to create your first context and start writing notes.');\n                    }, 100);\n                }\n            });\n        }\n\n        // Show/hide delete button based on context\n        this.updateEditorDeleteButton();\n    }\n\n    updateEditorDeleteButton(): void {\n        const editorDeleteBtn = document.getElementById('editor-delete-note-btn');\n        const editorFullscreenBtn = document.getElementById('editor-fullscreen-btn');\n\n        const context = state.get('selectedContext');\n        const selectedDate = state.get('selectedDate');\n\n        // Show buttons only if we have both context and selected date\n        if (context && selectedDate) {\n            if (editorDeleteBtn) editorDeleteBtn.style.display = 'flex';\n            if (editorFullscreenBtn) editorFullscreenBtn.style.display = 'flex';\n        } else {\n            if (editorDeleteBtn) editorDeleteBtn.style.display = 'none';\n            if (editorFullscreenBtn) editorFullscreenBtn.style.display = 'none';\n        }\n    }\n\n    updateSaveIndicator(status: string): void {\n        if (!this.elements.saveIndicator) return;\n\n        this.elements.saveIndicator.className = `save-indicator ${status}`;\n\n        if (status === 'saved') {\n            this.elements.saveIndicator.textContent = 'Saved locally ✓';\n            setTimeout(() => {\n                if (this.elements.saveIndicator) {\n                    this.elements.saveIndicator.textContent = '';\n                }\n            }, 2000);\n        } else {\n            this.elements.saveIndicator.textContent = '';\n        }\n    }\n\n    updateSyncStatus({ pending, syncing }: SyncStatusOptions): void {\n        if (!this.elements.syncStatus || !this.elements.syncStatusText) return;\n\n        // Show sync indicator when there are pending operations or actively syncing\n        if (pending > 0 || syncing) {\n            this.elements.syncStatus.style.display = 'flex';\n\n            if (syncing) {\n                this.elements.syncStatusText.textContent = `Syncing ${pending} note${pending !== 1 ? 's' : ''}...`;\n                this.elements.syncStatus.classList.add('is-syncing');\n                this.elements.syncStatus.classList.remove('is-pending');\n            } else {\n                this.elements.syncStatusText.textContent = `${pending} note${pending !== 1 ? 's' : ''} pending sync`;\n                this.elements.syncStatus.classList.add('is-pending');\n                this.elements.syncStatus.classList.remove('is-syncing');\n            }\n        } else {\n            // Hide after successful sync with a brief delay\n            setTimeout(() => {\n                if (this.elements.syncStatus) {\n                    this.elements.syncStatus.style.display = 'none';\n                    this.elements.syncStatus.classList.remove('is-syncing', 'is-pending');\n                }\n            }, 1000);\n        }\n    }\n\n    setTheme(theme: string): void {\n        document.documentElement.setAttribute('data-theme', theme);\n        if (this.elements.themeToggleSwitch) {\n            this.elements.themeToggleSwitch.checked = theme === 'dark';\n        }\n        this.updateThemeIcon();\n        localStorage.setItem('theme', theme);\n    }\n\n    updateThemeIcon(): void {\n        const theme = document.documentElement.getAttribute('data-theme');\n        const themeIcon = this.elements.themeToggleMenu?.querySelector('.material-symbols-outlined');\n        if (themeIcon) {\n            themeIcon.textContent = theme === 'dark' ? 'light_mode' : 'dark_mode';\n        }\n    }\n\n    showApp(_skipAnimation: boolean = false): void {\n        console.log('[UI] showApp called');\n        console.log('[UI] authSection:', this.elements.authSection);\n        console.log('[UI] appSection:', this.elements.appSection);\n\n        if (!this.elements.authSection || !this.elements.appSection) {\n            console.error('[UI] Missing elements!');\n            return;\n        }\n\n        // Hide loader if visible\n        const loader = document.getElementById('landing-loader');\n        if (loader) {\n            console.log('[UI] Hiding loader');\n            loader.classList.remove('visible');\n        }\n\n        // Simple: hide auth, show app\n        console.log('[UI] Hiding auth section');\n        this.elements.authSection.classList.remove('visible');\n\n        console.log('[UI] Showing app section');\n        this.elements.appSection.classList.add('visible');\n\n        console.log('[UI] App section display:', window.getComputedStyle(this.elements.appSection).display);\n\n        // Update context selector visibility based on settings\n        this.updateContextSelectorVisibility();\n\n        // Update breadcrumb and markdown editor visibility\n        this.updateBreadcrumbVisibility();\n        this.updateMarkdownEditorVisibility();\n\n        // Update new context button visibility\n        this.updateNewContextButtonVisibility();\n\n        // Update editor state (to show proper placeholder message)\n        this.updateEditorState();\n\n        // Start clock (after server time sync is complete)\n        this.startClock();\n\n        // Check if user has no contexts (new user or deleted all contexts)\n        // We use hasNoContexts from the backend response, NOT from local state\n        // because local state might not be loaded yet\n        const hasNoContexts = (state as any).get('hasNoContexts');\n\n        console.log('[UI] showApp - hasNoContexts:', hasNoContexts);\n\n        // Show onboarding modal when user has no contexts\n        // This happens when:\n        // - New user (never created a context)\n        // - User deleted all their contexts\n        if (hasNoContexts) {\n            console.log('[UI] Showing onboarding modal');\n            setTimeout(() => {\n                this.elements.onboardingModal?.classList.add('is-active');\n            }, 500);\n        } else {\n            console.log('[UI] NOT showing onboarding modal');\n        }\n    }\n\n    hideApp(): void {\n        if (!this.elements.authSection || !this.elements.appSection) return;\n\n        // Simple: hide app, show auth\n        this.elements.appSection.classList.remove('visible');\n        this.elements.authSection.classList.add('visible');\n    }\n\n    showError(message: string | { title?: string; message?: string; duration?: number }, options: NotificationOptions = {}): void {\n        // Handle different error types\n        let title = 'Error';\n        let duration = 7000;\n        let msg = '';\n\n        if (typeof message === 'object') {\n            // Structured error\n            title = message.title || 'Error';\n            msg = message.message || 'An error occurred';\n            duration = message.duration || 7000;\n        } else {\n            msg = message;\n        }\n\n        // Check if it's a network error\n        if (msg.includes('network') || msg.includes('offline')) {\n            title = 'Connection Error';\n            duration = 10000; // Longer for network issues\n        }\n\n        notifications.error(msg, { title, duration, ...options });\n    }\n\n    showSuccess(message: string, options: NotificationOptions = {}): void {\n        notifications.success(message, { duration: 3000, ...options });\n    }\n\n    showWarning(message: string, options: NotificationOptions = {}): void {\n        notifications.warning(message, { duration: 5000, ...options });\n    }\n\n    showInfo(message: string, options: NotificationOptions = {}): void {\n        notifications.info(message, { duration: 4000, ...options });\n    }\n\n    // Modal methods\n    showContextModal(): void {\n        this.elements.contextModal?.classList.add('is-active');\n        const nameInput = document.getElementById('context-name') as HTMLInputElement | null;\n        const colorInput = document.getElementById('context-color') as HTMLInputElement | null;\n        if (nameInput) nameInput.value = '';\n        if (colorInput) colorInput.value = 'primary';\n\n        // Setup color buttons handlers\n        setupColorButtons('context-color', 'context-color-buttons');\n\n        // Reset to primary\n        selectColorButton('primary', 'context-color-buttons', 'context-color');\n\n        nameInput?.focus();\n    }\n\n    closeContextModal(): void {\n        this.elements.contextModal?.classList.remove('is-active');\n    }\n\n    showSettingsModal(): void {\n        const settings = state.get('userSettings');\n\n        if (this.elements.weekStartSelect) {\n            this.elements.weekStartSelect.value = String(settings.weekStart);\n        }\n        if (this.elements.timezoneSelect) {\n            this.elements.timezoneSelect.value = settings.timezone;\n        }\n        const dateFormatSelect = document.getElementById('date-format-select') as HTMLSelectElement | null;\n        if (dateFormatSelect) {\n            dateFormatSelect.value = settings.dateFormat || 'DD-MM-YY';\n        }\n        const uniqueContextModeSwitch = document.getElementById('unique-context-mode-switch') as HTMLInputElement | null;\n        if (uniqueContextModeSwitch) {\n            uniqueContextModeSwitch.checked = settings.uniqueContextMode || false;\n        }\n        const showBreadcrumbSwitch = document.getElementById('show-breadcrumb-switch') as HTMLInputElement | null;\n        if (showBreadcrumbSwitch) {\n            showBreadcrumbSwitch.checked = settings.showBreadcrumb === true;\n        }\n        const showMarkdownEditorSwitch = document.getElementById('show-markdown-editor-switch') as HTMLInputElement | null;\n        if (showMarkdownEditorSwitch) {\n            showMarkdownEditorSwitch.checked = settings.showMarkdownEditor === true;\n        }\n        const hideNewContextButtonSwitch = document.getElementById('hide-new-context-button-switch') as HTMLInputElement | null;\n        if (hideNewContextButtonSwitch) {\n            hideNewContextButtonSwitch.checked = settings.hideNewContextButton === true;\n        }\n\n        // Reset accordion to collapsed state\n        const accordionContent = document.getElementById('contexts-accordion-content') as HTMLElement | null;\n        const accordionIcon = document.getElementById('contexts-accordion-icon');\n        if (accordionContent) {\n            accordionContent.style.display = 'none';\n            accordionContent.style.opacity = '1'; // Reset opacity\n        }\n        if (accordionIcon) {\n            const iconElement = accordionIcon.querySelector('.material-symbols-outlined');\n            if (iconElement) iconElement.textContent = 'expand_more';\n        }\n\n        // Render contexts list\n        this.renderContextsEditList();\n\n        // Reset save button state\n        const saveBtn = document.getElementById('settings-save-btn') as HTMLButtonElement | null;\n        const saveIcon = document.getElementById('settings-save-icon');\n        const saveSpinner = document.getElementById('settings-save-spinner') as HTMLElement | null;\n        const saveText = document.getElementById('settings-save-text');\n\n        if (saveBtn) saveBtn.disabled = false;\n        if (saveIcon) {\n            saveIcon.style.display = 'inline-flex';\n            const iconElement = saveIcon.querySelector('.material-symbols-outlined');\n            if (iconElement) iconElement.textContent = 'check';\n        }\n        if (saveSpinner) saveSpinner.style.display = 'none';\n        if (saveText) saveText.textContent = 'Save';\n\n        this.elements.settingsModal?.classList.add('is-active');\n    }\n\n    closeSettingsModal(): void {\n        // Reset accordion to collapsed state before closing\n        const accordionContent = document.getElementById('contexts-accordion-content') as HTMLElement | null;\n        const accordionIcon = document.getElementById('contexts-accordion-icon');\n        if (accordionContent) {\n            accordionContent.style.display = 'none';\n            accordionContent.style.opacity = '1'; // Reset opacity\n        }\n        if (accordionIcon) {\n            const iconElement = accordionIcon.querySelector('.material-symbols-outlined');\n            if (iconElement) iconElement.textContent = 'expand_more';\n        }\n\n        this.elements.settingsModal?.classList.remove('is-active');\n    }\n\n    closeOnboardingModal(): void {\n        this.elements.onboardingModal?.classList.remove('is-active');\n        // No need to store in localStorage anymore since we use backend isFirstLogin flag\n    }\n\n    showDeleteNoteModal(context: string, date: string, formattedDate: string): void {\n        const modal = document.getElementById('delete-note-modal') as HTMLElement & { dataset: { context?: string; date?: string } } | null;\n        const message = document.getElementById('delete-note-message');\n\n        if (modal && message) {\n            // Store the note info for later use\n            modal.dataset.context = context;\n            modal.dataset.date = date;\n\n            // Update message with formatted date\n            message.textContent = `Are you sure you want to delete the note for ${formattedDate}?`;\n\n            modal.classList.add('is-active');\n        }\n    }\n\n    closeDeleteNoteModal(): void {\n        const modal = document.getElementById('delete-note-modal') as HTMLElement & { dataset: { context?: string; date?: string } } | null;\n        if (modal) {\n            modal.classList.remove('is-active');\n            delete modal.dataset.context;\n            delete modal.dataset.date;\n        }\n    }\n\n    closeAllModals(): void {\n        this.closeContextModal();\n        this.closeSettingsModal();\n        this.closeOnboardingModal();\n        this.closeDeleteNoteModal();\n    }\n\n    // Clock\n    startClock(): void {\n        if (this.clockStarted) {\n            console.log('[UI] Clock already started, skipping');\n            return;\n        }\n        this.clockStarted = true;\n        console.log('[UI] Starting clock with server time sync');\n        this.updateCurrentDateTime();\n        setInterval(() => this.updateCurrentDateTime(), 1000);\n    }\n\n    updateCurrentDateTime(): void {\n        const settings = state.get('userSettings');\n        const timezone = settings.timezone || 'UTC';\n        const dateFormat = settings.dateFormat || 'DD-MM-YY';\n        const serverTimeOffset = state.get('serverTimeOffset');\n        const now = new Date(Date.now() + serverTimeOffset);\n\n        // Determine locale based on user's date format preference\n        // MM-DD-YY: Use en-US (American format)\n        // DD-MM-YY: Use browser locale or fallback to en-GB (European format)\n        let locale: string;\n        if (dateFormat === 'MM-DD-YY') {\n            locale = 'en-US';\n        } else {\n            // Try to use the browser's locale, fallback to 'en-GB' if not available\n            locale = navigator.language || navigator.languages?.[0] || 'en-GB';\n        }\n\n        const timeOptions: Intl.DateTimeFormatOptions = {\n            hour: '2-digit',\n            minute: '2-digit',\n            second: '2-digit',\n            hour12: false,\n            timeZone: timezone\n        };\n\n        const dateOptions: Intl.DateTimeFormatOptions = {\n            weekday: 'long',\n            year: 'numeric',\n            month: 'long',\n            day: 'numeric',\n            timeZone: timezone\n        };\n\n        const timeString = now.toLocaleTimeString(locale, timeOptions);\n        const dateString = now.toLocaleDateString(locale, dateOptions);\n\n        // Desktop date with full format (weekday + date)\n        if (this.elements.currentTime) {\n            this.elements.currentTime.textContent = timeString;\n        }\n        if (this.elements.currentDate) {\n            this.elements.currentDate.textContent = dateString;\n        }\n\n        // Mobile date without weekday (shorter format)\n        const mobileDateOptions: Intl.DateTimeFormatOptions = {\n            year: 'numeric',\n            month: 'long',\n            day: 'numeric',\n            timeZone: timezone\n        };\n        const mobileDateString = now.toLocaleDateString(locale, mobileDateOptions);\n\n        if (this.elements.mobileCurrentTime) {\n            this.elements.mobileCurrentTime.textContent = timeString;\n        }\n        if (this.elements.mobileCurrentDate) {\n            this.elements.mobileCurrentDate.textContent = mobileDateString;\n        }\n\n        // Check if day changed and update calendar\n        const currentDate = (state as any).get('today') as string;\n        if (this.lastKnownDate && this.lastKnownDate !== currentDate) {\n            calendar.render();\n        }\n        this.lastKnownDate = currentDate as string | null;\n    }\n\n    updateDatePickerDisplay(dateStr: string): void {\n        const displayElement = document.getElementById('date-picker-display');\n        if (!displayElement || !dateStr) return;\n\n        const settings = state.get('userSettings');\n        const dateFormat = settings.dateFormat || 'DD-MM-YY';\n\n        const [year, month, day] = dateStr.split('-').map(Number);\n\n        // Format date based on user preference\n        const yy = String(year).substring(2); // Get last 2 digits of year\n        const mm = String(month).padStart(2, '0');\n        const dd = String(day).padStart(2, '0');\n\n        let formattedDate: string;\n        if (dateFormat === 'MM-DD-YY') {\n            formattedDate = `${mm}/${dd}/${yy}`;\n        } else {\n            formattedDate = `${dd}/${mm}/${yy}`;\n        }\n\n        displayElement.textContent = formattedDate;\n    }\n\n    updateContextSelectorVisibility(): void {\n        const settings = state.get('userSettings');\n        const uniqueContextMode = settings.uniqueContextMode || false;\n\n        // Get context selector containers (both desktop and mobile)\n        const desktopContextContainer = document.getElementById('desktop-context-selector');\n        const mobileContextContainer = document.getElementById('mobile-context-selector');\n\n        if (uniqueContextMode) {\n            // Hide context selectors\n            if (desktopContextContainer) {\n                desktopContextContainer.style.display = 'none';\n            }\n            if (mobileContextContainer) {\n                mobileContextContainer.style.display = 'none';\n            }\n        } else {\n            // Show context selectors\n            if (desktopContextContainer) {\n                desktopContextContainer.style.display = '';\n            }\n            if (mobileContextContainer) {\n                mobileContextContainer.style.display = '';\n            }\n        }\n    }\n\n    updateBreadcrumbVisibility(): void {\n        const settings = state.get('userSettings');\n        const showBreadcrumb = settings.showBreadcrumb === true;\n\n        const breadcrumb = document.getElementById('drive-breadcrumb');\n        const mainSection = document.querySelector('.main-section');\n\n        // Show/hide breadcrumb\n        if (breadcrumb) {\n            breadcrumb.style.display = showBreadcrumb ? '' : 'none';\n        }\n\n        // Set data attribute that CSS will use to adjust spacing\n        if (mainSection) {\n            if (showBreadcrumb) {\n                mainSection.removeAttribute('data-hide-breadcrumb');\n            } else {\n                mainSection.setAttribute('data-hide-breadcrumb', 'true');\n            }\n        }\n    }\n\n    updateMarkdownEditorVisibility(): void {\n        const settings = state.get('userSettings');\n        const showMarkdownEditor = settings.showMarkdownEditor === true;\n\n        // Get the Quill toolbar\n        const toolbar = document.querySelector('.ql-toolbar') as HTMLElement | null;\n        if (toolbar) {\n            toolbar.style.display = showMarkdownEditor ? '' : 'none';\n        }\n\n        // The editor itself should remain enabled based on context selection,\n        // regardless of toolbar visibility\n        const context = state.get('selectedContext');\n        // Editor should be enabled if we have a context, regardless of toolbar visibility\n        markdownEditor.setDisabled(context ? false : true);\n    }\n\n    updateNewContextButtonVisibility(): void {\n        const settings = state.get('userSettings');\n        const hideNewContextButton = settings.hideNewContextButton === true;\n\n        // Get new context buttons (both desktop and mobile)\n        const desktopNewContextBtn = document.getElementById('desktop-new-context-btn');\n        const mobileNewContextBtn = document.getElementById('mobile-new-context-btn');\n\n        // Hide or show buttons\n        if (desktopNewContextBtn) {\n            desktopNewContextBtn.style.display = hideNewContextButton ? 'none' : '';\n        }\n        if (mobileNewContextBtn) {\n            mobileNewContextBtn.style.display = hideNewContextButton ? 'none' : '';\n        }\n    }\n\n    renderContextsEditList(): void {\n        const contextsList = state.get('contexts');\n        const container = document.getElementById('contexts-edit-list');\n\n        if (!container) return;\n\n        if (contextsList.length === 0) {\n            container.innerHTML = '<p class=\"has-text-centered has-text-grey-light py-5\">No contexts yet. Create your first context to get started!</p>';\n            return;\n        }\n\n        container.innerHTML = contextsList.map((ctx, _index) => {\n            // Normalize old hex colors to Bulma colors\n            const normalizedColor = normalizeToBulmaColor(ctx.color);\n\n            return `\n            <div class=\"is-flex is-align-items-center is-justify-content-space-between mb-3\"\n                 style=\"padding: 0.75rem 1rem; background: var(--bulma-scheme-main-bis); border-left: 3px solid var(--bulma-${normalizedColor}); border-radius: 6px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\">\n                <div class=\"is-flex is-align-items-center\" style=\"gap: 0.75rem; flex: 1; min-width: 0;\">\n                    <span style=\"display: block; width: 12px; height: 12px; background: var(--bulma-${normalizedColor}); border-radius: 50%; flex-shrink: 0;\"></span>\n                    <span style=\"font-size: 0.9rem; font-weight: 500; color: var(--bulma-text); overflow: hidden; text-overflow: ellipsis; white-space: nowrap;\">${ctx.name}</span>\n                </div>\n                <div class=\"is-flex is-align-items-center\" style=\"gap: 0.35rem;\">\n                    <button class=\"button is-small context-action-btn context-edit-btn\"\n                            onclick=\"window.showEditContextModal('${ctx.id}')\"\n                            title=\"Edit context\"\n                            style=\"padding: 0.35rem; border: none; background: transparent; border-radius: 50%; width: 32px; height: 32px;\">\n                        <span class=\"icon is-small\">\n                            <span class=\"material-symbols-outlined\" style=\"font-size: 18px; color: var(--bulma-grey);\">edit</span>\n                        </span>\n                    </button>\n                    <button class=\"button is-small context-action-btn context-delete-btn\"\n                            onclick=\"window.showDeleteContextModal('${ctx.id}', '${ctx.name.replace(/'/g, \"\\\\'\")}')\"\n                            title=\"Delete context\"\n                            style=\"padding: 0.35rem; border: none; background: transparent; border-radius: 50%; width: 32px; height: 32px;\">\n                        <span class=\"icon is-small\">\n                            <span class=\"material-symbols-outlined\" style=\"font-size: 18px; color: var(--bulma-grey);\">delete</span>\n                        </span>\n                    </button>\n                </div>\n            </div>\n        `;\n        }).join('');\n    }\n\n\n    setupMobileNavigation(): void {\n        // Toggle sidebar (notes list)\n        this.elements.mobileNotesToggle?.addEventListener('click', () => {\n            this.toggleMobileSidebar();\n        });\n\n        // Toggle calendar\n        this.elements.mobileCalendarToggle?.addEventListener('click', () => {\n            this.toggleMobileCalendar();\n        });\n\n        // Close sidebar\n        this.elements.sidebarClose?.addEventListener('click', () => {\n            this.closeMobileSidebar();\n        });\n\n        // Close calendar\n        this.elements.calendarClose?.addEventListener('click', () => {\n            this.closeMobileCalendar();\n        });\n\n        // Close on overlay click\n        this.elements.sidebarOverlay?.addEventListener('click', () => {\n            this.closeMobileSidebar();\n        });\n\n        this.elements.calendarOverlay?.addEventListener('click', () => {\n            this.closeMobileCalendar();\n        });\n\n        // Close mobile panels when selecting a note\n        if (this.elements.notesList) {\n            this.elements.notesList.addEventListener('click', (e) => {\n                if ((e.target as HTMLElement).tagName === 'A' && window.innerWidth <= 768) {\n                    this.closeMobileSidebar();\n                }\n            });\n        }\n\n        // Clean up mobile panel states on resize\n        window.addEventListener('resize', () => {\n            if (window.innerWidth > 768) {\n                // Remove mobile panel classes and reset styles when returning to desktop\n                if (this.elements.sidebar) {\n                    this.elements.sidebar.classList.remove('mobile-panel', 'active');\n                    this.elements.sidebar.style.display = '';\n                }\n                if (this.elements.calendarPanel) {\n                    this.elements.calendarPanel.classList.remove('mobile-panel', 'active');\n                    this.elements.calendarPanel.style.display = '';\n                }\n                if (this.elements.sidebarOverlay) {\n                    this.elements.sidebarOverlay.classList.remove('active');\n                }\n                if (this.elements.calendarOverlay) {\n                    this.elements.calendarOverlay.classList.remove('active');\n                }\n                document.body.style.overflow = '';\n            }\n        });\n    }\n\n    toggleMobileSidebar(): void {\n        if (!this.elements.sidebar || !this.elements.sidebarOverlay) return;\n\n        // Only work on mobile screens\n        if (window.innerWidth > 768) return;\n\n        const isActive = this.elements.sidebar.classList.contains('mobile-panel');\n\n        if (!isActive) {\n            // Add mobile-panel class and show\n            this.elements.sidebar.classList.add('mobile-panel');\n            this.elements.sidebar.style.display = 'flex';\n        }\n\n        // Toggle active state\n        this.elements.sidebar.classList.toggle('active');\n        this.elements.sidebarOverlay.classList.toggle('active');\n\n        // Prevent body scroll when panel is open\n        if (this.elements.sidebar.classList.contains('active')) {\n            document.body.style.overflow = 'hidden';\n        } else {\n            document.body.style.overflow = '';\n        }\n    }\n\n    closeMobileSidebar(): void {\n        if (!this.elements.sidebar || !this.elements.sidebarOverlay) return;\n\n        this.elements.sidebar.classList.remove('active');\n        this.elements.sidebarOverlay.classList.remove('active');\n        document.body.style.overflow = '';\n    }\n\n    toggleMobileCalendar(): void {\n        if (!this.elements.calendarPanel || !this.elements.calendarOverlay) return;\n\n        // Only work on mobile screens\n        if (window.innerWidth > 768) return;\n\n        const isActive = this.elements.calendarPanel.classList.contains('mobile-panel');\n\n        if (!isActive) {\n            // Add mobile-panel class and show\n            this.elements.calendarPanel.classList.add('mobile-panel');\n            this.elements.calendarPanel.style.display = 'flex';\n        }\n\n        // Toggle active state\n        this.elements.calendarPanel.classList.toggle('active');\n        this.elements.calendarOverlay.classList.toggle('active');\n\n        // Prevent body scroll when panel is open\n        if (this.elements.calendarPanel.classList.contains('active')) {\n            document.body.style.overflow = 'hidden';\n        } else {\n            document.body.style.overflow = '';\n        }\n    }\n\n    closeMobileCalendar(): void {\n        if (!this.elements.calendarPanel || !this.elements.calendarOverlay) return;\n\n        this.elements.calendarPanel.classList.remove('active');\n        this.elements.calendarOverlay.classList.remove('active');\n        document.body.style.overflow = '';\n    }\n\n    updateBreadcrumb(): void {\n        const context = state.get('selectedContext');\n        const selectedDate = state.get('selectedDate');\n        const settings = state.get('userSettings');\n        const timezone = settings.timezone || 'UTC';\n        const dateFormat = settings.dateFormat || 'DD-MM-YY';\n\n        if (this.elements.breadcrumbContextName && context) {\n            this.elements.breadcrumbContextName.textContent = context;\n        }\n\n        if (this.elements.breadcrumbDateName && selectedDate) {\n            // Format date the same way as notes list\n            const [year, month, day] = selectedDate.split('-').map(Number);\n            const dateObj = new Date(year, month - 1, day);\n\n            // Get the day name in English\n            const dayName = dateObj.toLocaleDateString('en-US', {\n                weekday: 'long',\n                timeZone: timezone\n            });\n\n            // Format date based on user preference\n            const yy = String(year).substring(2); // Get last 2 digits of year\n            const mm = String(month).padStart(2, '0');\n            const dd = String(day).padStart(2, '0');\n\n            let dateStr: string;\n            if (dateFormat === 'MM-DD-YY') {\n                dateStr = `${mm}-${dd}-${yy}`;\n            } else {\n                dateStr = `${dd}-${mm}-${yy}`;\n            }\n\n            // Format: \"Monday, 24-10-25.md\" or \"Monday, 10-24-25.md\" depending on dateFormat\n            const formattedDate = `${dayName}, ${dateStr}.md`;\n            this.elements.breadcrumbDateName.textContent = formattedDate;\n\n            // Update mobile selected note date with .md extension (no day name)\n            if (this.elements.mobileSelectedNoteDate) {\n                this.elements.mobileSelectedNoteDate.textContent = `${dateStr}.md`;\n            }\n        }\n    }\n\n    openFullscreenNote(): void {\n        const context = state.get('selectedContext');\n        const selectedDate = state.get('selectedDate');\n\n        if (!context || !selectedDate) return;\n\n        // Format date for display\n        const settings = state.get('userSettings');\n        const timezone = settings.timezone || 'UTC';\n        const dateFormat = settings.dateFormat || 'DD-MM-YY';\n\n        const [year, month, day] = selectedDate.split('-').map(Number);\n        const dateObj = new Date(year, month - 1, day);\n\n        const dayName = dateObj.toLocaleDateString('en-US', {\n            weekday: 'long',\n            timeZone: timezone\n        });\n\n        const yy = String(year).substring(2);\n        const mm = String(month).padStart(2, '0');\n        const dd = String(day).padStart(2, '0');\n\n        let dateStr: string;\n        if (dateFormat === 'MM-DD-YY') {\n            dateStr = `${mm}-${dd}-${yy}`;\n        } else {\n            dateStr = `${dd}-${mm}-${yy}`;\n        }\n\n        const formattedDate = `${dayName}, ${dateStr}.md`;\n\n        // Get modal elements\n        const modal = document.getElementById('fullscreen-note-modal');\n        const dateEl = document.getElementById('fullscreen-note-date');\n        const editorEl = document.getElementById('fullscreen-note-editor');\n\n        if (!modal || !dateEl || !editorEl) return;\n\n        // Set date\n        dateEl.textContent = formattedDate;\n\n        // Get current note content using the markdown editor\n        const content = markdownEditor.getContent();\n\n        // Create a read-only Quill instance for fullscreen\n        if ((window as any).Quill) {\n            // Clear previous instance if exists\n            editorEl.innerHTML = '';\n\n            const fullscreenQuill = new (window as any).Quill(editorEl, {\n                theme: 'snow',\n                readOnly: true,\n                modules: {\n                    toolbar: false\n                }\n            });\n\n            fullscreenQuill.root.innerHTML = content;\n\n            // Style the editor\n            fullscreenQuill.root.style.fontSize = '16px';\n            fullscreenQuill.root.style.lineHeight = '1.6';\n        } else {\n            // Fallback if Quill not loaded\n            editorEl.innerHTML = content;\n        }\n\n        // Show modal\n        modal.classList.add('is-active');\n\n        // Add escape key listener\n        const escapeHandler = (e: KeyboardEvent) => {\n            if (e.key === 'Escape') {\n                this.closeFullscreenNote();\n                document.removeEventListener('keydown', escapeHandler);\n            }\n        };\n        document.addEventListener('keydown', escapeHandler);\n    }\n\n    closeFullscreenNote(): void {\n        const modal = document.getElementById('fullscreen-note-modal');\n        if (modal) {\n            modal.classList.remove('is-active');\n        }\n    }\n}\n\nexport const ui = new UIManager();\n\n// Expose globally for browser compatibility and HTML onclick handlers\nif (typeof window !== 'undefined') {\n    (window as any).ui = ui;\n\n    // Context modal handlers\n    (window as any).showNewContextModal = () => ui.showContextModal();\n    (window as any).closeContextModal = () => ui.closeContextModal();\n\n    (window as any).createContext = async () => {\n        const nameInput = document.getElementById('context-name') as HTMLInputElement | null;\n        const colorInput = document.getElementById('context-color') as HTMLInputElement | null;\n\n        const name = nameInput?.value.trim();\n        const color = colorInput?.value;\n\n        if (!name) return;\n\n        await contexts.createContext(name, color);\n        ui.closeContextModal();\n\n        await notes.loadNotesList(name);\n        const selectedDate = state.get('selectedDate');\n        if (selectedDate) {\n            await notes.loadNote(name, selectedDate);\n        }\n    };\n\n    // Settings modal handlers\n    (window as any).showSettingsModal = () => ui.showSettingsModal();\n    (window as any).closeSettingsModal = () => ui.closeSettingsModal();\n\n    (window as any).saveSettings = async () => {\n        const saveBtn = document.getElementById('settings-save-btn') as HTMLButtonElement | null;\n        const saveIcon = document.getElementById('settings-save-icon');\n        const saveSpinner = document.getElementById('settings-save-spinner');\n        const saveText = document.getElementById('settings-save-text');\n        const cancelBtn = document.getElementById('settings-cancel-btn') as HTMLButtonElement | null;\n\n        const weekStartSelect = document.getElementById('week-start-select') as HTMLSelectElement | null;\n        const timezoneSelect = document.getElementById('timezone-select') as HTMLSelectElement | null;\n        const dateFormatSelect = document.getElementById('date-format-select') as HTMLSelectElement | null;\n        const uniqueContextModeSwitch = document.getElementById('unique-context-mode-switch') as HTMLInputElement | null;\n        const showBreadcrumbSwitch = document.getElementById('show-breadcrumb-switch') as HTMLInputElement | null;\n        const showMarkdownEditorSwitch = document.getElementById('show-markdown-editor-switch') as HTMLInputElement | null;\n        const hideNewContextButtonSwitch = document.getElementById('hide-new-context-button-switch') as HTMLInputElement | null;\n        const currentSettings = state.get('userSettings');\n\n        const weekStart = parseInt(weekStartSelect?.value || '0');\n        const timezone = timezoneSelect?.value || 'UTC';\n        const dateFormat = dateFormatSelect?.value || 'DD-MM-YY';\n        const uniqueContextMode = uniqueContextModeSwitch?.checked || false;\n        const showBreadcrumb = showBreadcrumbSwitch?.checked === true;\n        const showMarkdownEditor = showMarkdownEditorSwitch?.checked === true;\n        const hideNewContextButton = hideNewContextButtonSwitch?.checked === true;\n        const theme = currentSettings.theme || 'dark';\n\n        // Show loading state\n        if (saveBtn) saveBtn.disabled = true;\n        if (cancelBtn) cancelBtn.disabled = true;\n        if (saveIcon) (saveIcon as HTMLElement).style.display = 'none';\n        if (saveSpinner) (saveSpinner as HTMLElement).style.display = 'inline-block';\n        if (saveText) saveText.textContent = 'Saving...';\n\n        try {\n            await api.updateSettings({ theme, weekStart, timezone, dateFormat, uniqueContextMode, showBreadcrumb, showMarkdownEditor, hideNewContextButton });\n\n            state.set('userSettings', { theme, weekStart, timezone, dateFormat, uniqueContextMode, showBreadcrumb, showMarkdownEditor, hideNewContextButton });\n            calendar.render();\n\n            // Show success state briefly\n            if (saveText) saveText.textContent = 'Saved!';\n            if (saveSpinner) (saveSpinner as HTMLElement).style.display = 'none';\n            if (saveIcon) {\n                (saveIcon as HTMLElement).style.display = 'inline-flex';\n                const iconEl = saveIcon.querySelector('.material-symbols-outlined');\n                if (iconEl) iconEl.textContent = 'check_circle';\n            }\n\n            // Wait a bit before closing to show success\n            await new Promise(resolve => setTimeout(resolve, 500));\n\n            ui.closeSettingsModal();\n\n            // Re-render notes list to update date format\n            ui.renderNotesList();\n\n            // Update UI based on unique context mode\n            ui.updateContextSelectorVisibility();\n\n            // Update breadcrumb and markdown editor visibility\n            ui.updateBreadcrumbVisibility();\n            ui.updateMarkdownEditorVisibility();\n\n            // Update new context button visibility\n            ui.updateNewContextButtonVisibility();\n\n            // If unique context mode is enabled, select first context\n            if (uniqueContextMode) {\n                const contextsList = state.get('contexts');\n                if (contextsList && contextsList.length > 0) {\n                    contexts.selectContext(contextsList[0].name);\n                    notes.setTodayDate();\n                    notes.loadNotesList(contextsList[0].name);\n                }\n            }\n        } catch (error) {\n            console.error('Failed to save settings:', error);\n            notifications.error('Failed to save settings');\n\n            // Reset button state on error\n            if (saveText) saveText.textContent = 'Save';\n            if (saveSpinner) (saveSpinner as HTMLElement).style.display = 'none';\n            if (saveIcon) {\n                (saveIcon as HTMLElement).style.display = 'inline-flex';\n                const iconEl = saveIcon.querySelector('.material-symbols-outlined');\n                if (iconEl) iconEl.textContent = 'check';\n            }\n        } finally {\n            // Re-enable buttons\n            if (saveBtn) saveBtn.disabled = false;\n            if (cancelBtn) cancelBtn.disabled = false;\n        }\n    };\n\n    // Onboarding modal handlers\n    (window as any).closeOnboardingModal = () => ui.closeOnboardingModal();\n\n    // Delete note modal handlers\n    (window as any).closeDeleteNoteModal = () => ui.closeDeleteNoteModal();\n\n    (window as any).confirmDeleteNote = async () => {\n        const modal = document.getElementById('delete-note-modal') as HTMLElement & { dataset: { context?: string; date?: string } } | null;\n        if (!modal) return;\n\n        const context = modal.dataset.context;\n        const dateStr = modal.dataset.date;\n\n        if (context && dateStr) {\n            // Close modal first\n            ui.closeDeleteNoteModal();\n\n            // Delete note immediately (notes module will handle UI updates)\n            await notes.deleteNote(context, dateStr);\n        }\n    };\n\n    // Edit context modal handlers\n    (window as any).showEditContextModal = (contextId: string) => {\n        const contextsList = state.get('contexts');\n        const context = contextsList.find(c => c.id === contextId);\n        if (!context) return;\n\n        const modal = document.getElementById('edit-context-modal') as HTMLElement & { dataset: { contextId?: string } } | null;\n        const nameInput = document.getElementById('edit-context-name') as HTMLInputElement | null;\n        const colorValue = document.getElementById('edit-context-color-value') as HTMLInputElement | null;\n        const colorsContainer = document.getElementById('edit-context-colors');\n\n        if (!modal || !nameInput || !colorValue || !colorsContainer) return;\n\n        // Set values\n        nameInput.value = context.name;\n        const normalizedColor = normalizeToBulmaColor(context.color);\n        colorValue.value = normalizedColor;\n\n        // Render color buttons\n        const colors = ['text', 'link', 'primary', 'info', 'success', 'warning', 'danger'];\n        colorsContainer.innerHTML = colors.map(color => {\n            const isActive = normalizedColor === color;\n            const borderStyle = isActive ? 'border: 3px solid var(--bulma-text)' : 'border: 3px solid transparent';\n            return `\n                <button type=\"button\" class=\"button color-btn ${isActive ? 'is-active' : ''}\"\n                        data-color=\"${color}\"\n                        onclick=\"window.selectEditContextColor('${color}')\"\n                        title=\"${getColorLabel(color)}\"\n                        style=\"width: 32px; height: 32px; padding: 3px; ${borderStyle}; border-radius: 6px;\">\n                    <span style=\"display: block; width: 100%; height: 100%; background: var(--bulma-${color}); border-radius: 4px;\"></span>\n                </button>\n            `;\n        }).join('');\n\n        // Store context ID and show modal\n        modal.dataset.contextId = contextId;\n        modal.classList.add('is-active');\n    };\n\n    (window as any).selectEditContextColor = (color: string) => {\n        const colorValue = document.getElementById('edit-context-color-value') as HTMLInputElement | null;\n        if (!colorValue) return;\n\n        colorValue.value = color;\n\n        // Update button states\n        const buttons = document.querySelectorAll('#edit-context-colors .color-btn');\n        buttons.forEach(btn => {\n            const btnColor = (btn as HTMLElement).dataset.color;\n            if (btnColor === color) {\n                btn.classList.add('is-active');\n                (btn as HTMLElement).style.border = '3px solid var(--bulma-text)';\n            } else {\n                btn.classList.remove('is-active');\n                (btn as HTMLElement).style.border = '3px solid transparent';\n            }\n        });\n    };\n\n    (window as any).closeEditContextModal = () => {\n        const modal = document.getElementById('edit-context-modal') as HTMLElement & { dataset: { contextId?: string } } | null;\n        if (modal) {\n            modal.classList.remove('is-active');\n            delete modal.dataset.contextId;\n        }\n    };\n\n    (window as any).confirmEditContext = async () => {\n        const modal = document.getElementById('edit-context-modal') as HTMLElement & { dataset: { contextId?: string } } | null;\n        if (!modal) return;\n\n        const contextId = modal.dataset.contextId;\n        const nameInput = document.getElementById('edit-context-name') as HTMLInputElement | null;\n        const colorValue = document.getElementById('edit-context-color-value') as HTMLInputElement | null;\n\n        if (!contextId || !nameInput || !colorValue) return;\n\n        const name = nameInput.value.trim();\n        const color = colorValue.value;\n\n        if (!name) {\n            alert('Please enter a context name');\n            return;\n        }\n\n        // Close modal\n        (window as any).closeEditContextModal();\n\n        // Update context\n        await contexts.updateContext(contextId, name, color);\n\n        // Refresh UI\n        ui.renderContextsEditList();\n        ui.renderContextsSelect();\n    };\n\n    // Delete context modal handlers\n    (window as any).showDeleteContextModal = (contextId: string, contextName: string) => {\n        const modal = document.getElementById('delete-context-modal') as HTMLElement & { dataset: { contextId?: string } } | null;\n        const nameElement = document.getElementById('delete-context-name');\n\n        if (modal && nameElement) {\n            nameElement.textContent = contextName;\n            modal.dataset.contextId = contextId;\n            modal.classList.add('is-active');\n        }\n    };\n\n    (window as any).closeDeleteContextModal = () => {\n        const modal = document.getElementById('delete-context-modal') as HTMLElement & { dataset: { contextId?: string } } | null;\n        if (modal) {\n            modal.classList.remove('is-active');\n            delete modal.dataset.contextId;\n        }\n    };\n\n    (window as any).confirmDeleteContext = async () => {\n        const modal = document.getElementById('delete-context-modal') as HTMLElement & { dataset: { contextId?: string } } | null;\n        if (!modal) return;\n\n        const contextId = modal.dataset.contextId;\n\n        if (contextId) {\n            // Close modal first\n            (window as any).closeDeleteContextModal();\n\n            // Delete context (will also delete all its notes)\n            await contexts.deleteContext(contextId);\n\n            // Refresh UI\n            ui.renderContextsEditList();\n            ui.renderContextsSelect();\n        }\n    };\n}\n","/**\n * DOM Element Caching\n */\n\nimport type { UIElements } from './types'\n\nexport function cacheElements(): UIElements {\n    return {\n        // Sections\n        authSection: document.getElementById('auth-section'),\n        appSection: document.getElementById('app-section'),\n\n        // Context\n        contextSelect: document.getElementById('context-select') as HTMLSelectElement | null,\n        contextColorIndicator: document.getElementById('context-color-indicator'),\n\n        // Mobile context\n        mobileContextSelect: document.getElementById('mobile-context-select') as HTMLSelectElement | null,\n        mobileContextColorIndicator: document.getElementById('mobile-context-color-indicator'),\n\n        // Date\n        datePicker: document.getElementById('date-picker') as HTMLInputElement | null,\n\n        // Breadcrumb\n        breadcrumbContextName: document.getElementById('breadcrumb-context-name'),\n        breadcrumbDateName: document.getElementById('breadcrumb-date-name'),\n\n        // Editor\n        markdownEditorContainer: document.getElementById('markdown-editor-container'),\n        saveIndicator: document.getElementById('save-indicator'),\n\n        // Notes list\n        notesList: document.getElementById('notes-list'),\n\n        // User\n        userEmail: document.getElementById('user-email'),\n\n        // Time\n        currentTime: document.getElementById('current-time'),\n        currentDate: document.getElementById('current-date'),\n\n        // Mobile Time\n        mobileCurrentTime: document.getElementById('mobile-current-time'),\n        mobileCurrentDate: document.getElementById('mobile-current-date'),\n        mobileSelectedNoteDate: document.getElementById('mobile-selected-note-date'),\n\n        // Modals\n        contextModal: document.getElementById('context-modal'),\n        settingsModal: document.getElementById('settings-modal'),\n        onboardingModal: document.getElementById('onboarding-modal'),\n\n        // Sync status\n        syncStatus: document.getElementById('sync-status'),\n        syncStatusText: document.getElementById('sync-status-text'),\n\n        // Theme\n        themeToggleMenu: document.getElementById('theme-toggle-menu'),\n        themeToggleSwitch: document.getElementById('theme-toggle-switch') as HTMLInputElement | null,\n\n        // Settings\n        weekStartSelect: document.getElementById('week-start-select') as HTMLSelectElement | null,\n        timezoneSelect: document.getElementById('timezone-select') as HTMLSelectElement | null,\n\n        // Mobile navigation\n        mobileNotesToggle: document.getElementById('mobile-notes-toggle'),\n        mobileCalendarToggle: document.getElementById('mobile-calendar-toggle'),\n        sidebar: document.querySelector('.sidebar') as HTMLElement | null,\n        calendarPanel: document.querySelector('.calendar-panel') as HTMLElement | null,\n        sidebarOverlay: document.getElementById('sidebar-overlay'),\n        calendarOverlay: document.getElementById('calendar-overlay'),\n        sidebarClose: document.getElementById('sidebar-close'),\n        calendarClose: document.getElementById('calendar-close'),\n    }\n}\n","/**\n * Main Application Entry Point\n * Initializes and coordinates all modules\n */\n\nimport { state } from '@utils/state'\nimport { cache } from '@utils/cache'\nimport { events, EVENT } from '@utils/events'\nimport { SyncQueue } from '@utils/sync'\nimport { api } from '@services/api'\nimport { auth } from '@services/auth'\nimport { notes } from '@services/notes'\nimport { contexts } from '@services/contexts'\nimport { calendar } from '@components/Calendar'\nimport { markdownEditor } from '@components/Editor'\nimport { notifications } from '@components/Notifications'\nimport { ui } from '@components/UI'\n\ndeclare global {\n  interface Window {\n    __APP__?: Application\n    __GOOGLE_CLIENT_ID__?: string\n    __DEBUG__?: any\n  }\n}\n\nclass Application {\n  private syncQueue: SyncQueue | null = null\n\n  async init(googleClientId: string): Promise<void> {\n    console.log('[MAIN] Initializing with client ID:', googleClientId)\n\n    // Initialize cache\n    try {\n      await cache.init()\n      console.log('Cache initialized')\n    } catch (err) {\n      console.warn('IndexedDB not available', err)\n    }\n\n    // Initialize sync queue\n    this.syncQueue = new SyncQueue(api)\n\n    // Setup event handlers\n    this.setupEventHandlers()\n\n    // Initialize UI Manager\n    ui.init()\n\n    // Initialize Markdown Editor\n    await markdownEditor.init('markdown-editor-container', (content: string) => {\n      notes.handleNoteInput(content)\n    })\n\n    // Check authentication\n    const isAuthenticated = await auth.checkAuth()\n\n    if (isAuthenticated) {\n      await this.showApp()\n    } else {\n      // Hide app and show auth section\n      const appSection = document.getElementById('app-section')\n      const authSection = document.getElementById('auth-section')\n      if (appSection) appSection.classList.remove('visible')\n      if (authSection) authSection.classList.add('visible')\n    }\n\n    // Make body visible after determining which section to show\n    document.body.classList.add('loaded')\n\n    // Initialize Google OAuth client (async, will wait for script to load)\n    auth.initGoogleClient(googleClientId).catch(error => {\n      console.error('[MAIN] Failed to initialize Google client:', error)\n    })\n  }\n\n  private setupEventHandlers(): void {\n    // Sync events\n    events.on('sync-add' as any, (e: CustomEvent) => {\n      this.syncQueue?.add(e.detail)\n    })\n\n    events.on('sync-force' as any, () => {\n      if (this.syncQueue && this.syncQueue.getPendingCount() > 0) {\n        this.syncQueue.process()\n      }\n    })\n\n    events.on(EVENT.SYNC_STATUS, (e: CustomEvent) => {\n      ui.updateSyncStatus(e.detail)\n    })\n\n    events.on(EVENT.OPERATION_SYNCED, (e: CustomEvent) => {\n      console.log('Synced to server:', e.detail.type)\n    })\n\n    events.on(EVENT.SYNC_ERROR, (e: CustomEvent) => {\n      const { error, maxRetriesReached, retryCount, maxRetries } = e.detail\n\n      if (maxRetriesReached) {\n        notifications.error(\n          'Failed to sync note after multiple attempts. Please check your connection.',\n          {\n            title: 'Sync Failed',\n            duration: 5000\n          }\n        )\n      } else if (retryCount) {\n        console.warn(`Sync retry ${retryCount}/${maxRetries}:`, error)\n      }\n    })\n\n    // Session expired handling\n    events.on('session-expired' as any, (e: CustomEvent) => {\n      if (e.detail.isNoteRequest) {\n        notifications.warning(\n          'Session expired. Your notes are saved locally and will sync when you sign in again.',\n          {\n            title: 'Session Expired',\n            duration: 10000\n          }\n        )\n      }\n    })\n\n    // Note events\n    events.on(EVENT.NOTE_LOADED, (e: CustomEvent) => {\n      markdownEditor.setContent(e.detail.content)\n    })\n\n    events.on(EVENT.NOTE_SAVED, () => {\n      console.log('[Note] Saved')\n    })\n\n    // Context events\n    events.on(EVENT.CONTEXT_CHANGED, async (e: CustomEvent) => {\n      const context = e.detail.context\n\n      // Force flush any pending editor changes\n      markdownEditor.forceFlush()\n\n      // Wait for flush to process\n      await new Promise(resolve => setTimeout(resolve, 100))\n\n      if (context) {\n        let selectedDate = state.get('selectedDate')\n        if (!selectedDate) {\n          selectedDate = (state as any).get('today') as string\n        }\n\n        // Load notes list for context\n        await notes.loadNotesList(context)\n\n        calendar.render()\n        if (selectedDate) {\n          notes.ensureNoteInList(context, selectedDate)\n          await notes.loadNote(context, selectedDate)\n        }\n      } else {\n        markdownEditor.setContent('')\n      }\n    })\n\n    // Date events\n    events.on(EVENT.DATE_CHANGED, async (e: CustomEvent) => {\n      const dateStr = e.detail.date\n      const context = state.get('selectedContext')\n\n      // Force flush pending changes\n      markdownEditor.forceFlush()\n      await new Promise(resolve => setTimeout(resolve, 100))\n\n      if (context) {\n        const currentContext = state.get('selectedContext')\n        const currentDate = state.get('selectedDate')\n\n        if (currentContext !== context || currentDate !== dateStr) {\n          console.log('[MAIN] Context/date changed during handler, skipping')\n          return\n        }\n\n        await notes.loadNote(context, dateStr)\n      }\n    })\n\n    // Auth events\n    events.on('auth-success' as any, async () => {\n      await this.showApp()\n    })\n\n    events.on('auth-logout' as any, () => {\n      markdownEditor.setContent('')\n    })\n\n    // UI events\n    events.on(EVENT.SHOW_ERROR, (e: CustomEvent) => {\n      if (e.detail.message) {\n        notifications.error(e.detail.message)\n      }\n    })\n\n    events.on(EVENT.SHOW_SUCCESS, (e: CustomEvent) => {\n      if (e.detail.message) {\n        notifications.success(e.detail.message)\n      }\n    })\n  }\n\n  private async showApp(): Promise<void> {\n    console.log('[MAIN] showApp called')\n\n    try {\n      // Load contexts\n      console.log('[MAIN] Loading contexts...')\n      await contexts.loadContexts()\n\n      // Sync server time (MUST complete before setting today's date or showing UI)\n      await this.syncServerTime()\n\n      // Set today's date\n      notes.setTodayDate()\n\n      // Render calendar\n      calendar.render()\n\n      // Auto-select last used context\n      const lastContext = contexts.restoreLastContext()\n      console.log('[MAIN] Last context:', lastContext)\n\n      if (lastContext) {\n        // Load notes list\n        await notes.loadNotesList(lastContext)\n\n        // Get today's date\n        const todayDate = (state as any).get('today') as string\n\n        // Ensure today's note exists in the list\n        notes.ensureNoteInList(lastContext, todayDate)\n\n        // Load today's note (create if doesn't exist)\n        await notes.loadNote(lastContext, todayDate)\n      }\n\n      // Show app UI and onboarding modal if needed (clock will start here with correct time)\n      ui.showApp()\n\n      console.log('[MAIN] App initialization complete')\n    } catch (error) {\n      console.error('[MAIN] Error initializing app:', error)\n      notifications.error('Failed to initialize app. Please refresh the page.', {\n        title: 'Initialization Error',\n        duration: 0\n      })\n    }\n  }\n\n  private async syncServerTime(): Promise<void> {\n    try {\n      const settings = state.get('userSettings')\n      const timezone = settings.timezone || 'UTC'\n      const clientTime = Date.now()\n\n      const data = await api.getServerTime(timezone)\n      const serverTime = (data.timestamp || 0) * 1000 // Backend returns timestamp, not offset\n      const roundTripTime = Date.now() - clientTime\n      const offset = serverTime - clientTime + roundTripTime / 2\n\n      console.log('[MAIN] Server time synced. Offset:', offset, 'ms')\n      state.set('serverTimeOffset', offset)\n    } catch (error) {\n      console.error('Failed to sync server time:', error)\n      // Set offset to 0 as fallback\n      state.set('serverTimeOffset', 0)\n    }\n\n    // Resync every minute\n    setTimeout(() => this.syncServerTime(), 60000)\n  }\n\n}\n\n// Initialize app when DOM is ready\nconst app = new Application()\n\n// Expose for window.onload and inline scripts\nwindow.__APP__ = app\n\n// Expose modules for debugging (development only)\nif (typeof window !== 'undefined' && window.location.hostname === 'localhost') {\n  window.__DEBUG__ = {\n    app,\n    state,\n    events,\n    notes,\n    contexts,\n    calendar,\n    auth,\n    api,\n    cache,\n    markdownEditor,\n    notifications,\n    ui\n  }\n  console.log('Debug mode enabled. Access modules via window.__DEBUG__')\n}\n\n// Auto-initialize\n;(async () => {\n  // Wait for template to inject GoogleClientID\n  await new Promise(resolve => setTimeout(resolve, 0))\n\n  // Get client ID from template (will be replaced by Jet)\n  const clientIdMeta = document.querySelector('meta[name=\"google-client-id\"]')\n  const googleClientId = clientIdMeta?.getAttribute('content') || window.__GOOGLE_CLIENT_ID__\n\n  if (googleClientId) {\n    await app.init(googleClientId)\n  } else {\n    console.error('Google Client ID not found')\n  }\n})()\n\nexport default app\n"],"names":["api","request","endpoint","options","response","fetch","headers","credentials","ok","data","json","catch","status","state","get","isNoteRequest","includes","message","events","emit","EVENT","SHOW_ERROR","set","Error","error","concat","checkAuth","console","authenticated","login","accessToken","expiresIn","this","method","body","JSON","stringify","access_token","expires_in","loginWithCode","code","loginWithToken","idToken","id_token","logout","getContexts","createContext","updateContext","id","deleteContext","getNote","context","date","encodeURIComponent","saveNote","getNotesList","limit","offset","deleteNote","encodedContext","encodedDate","updateSettings","settings","getServerTime","timezone","auth","constructor","__publicField","user","update","currentUser","userSettings","theme","weekStart","dateFormat","uniqueContextMode","showBreadcrumb","showMarkdownEditor","hideNewContextButton","initOneTap","clientId","oneTapInitialized","_b","_a","window","google","accounts","initialize","client_id","callback","handleOneTapResponse","auto_select","cancel_on_tap_outside","prompt","notification","isNotDisplayed","log","getNotDisplayedReason","isSkippedMoment","getSkippedReason","credential","loader","document","getElementById","classList","add","success","hasNoContexts","remove","initGoogleClient","initializationPromise","codeClient","Promise","resolve","reject","checkGoogleLoaded","oauth2","initCodeClient","scope","ux_mode","handleAuthCodeResponse","setTimeout","signIn","requestCode","signOut","localStorage","clear","sessionStorage","e","location","href","clearAllCaches","dbName","deleteRequest","indexedDB","deleteDatabase","onsuccess","onerror","warn","cacheNames","caches","keys","all","map","cacheName","delete","navigator","registrations","serviceWorker","getRegistrations","registration","unregister","cookie","split","forEach","eqPos","indexOf","name","substring","trim","hostname","signInWithGoogle","notes","loadNote","loadToken","currentLoadToken","cachedNote","cache","content","currentNoteContent","NOTE_LOADED","note","serverUpdatedAt","updated_at","Date","getTime","cachedUpdatedAt","length","now","toISOString","NOTE_SAVED","updateNoteInList","loadNotesList","notesWithDates","serverNotes","cachedNotes","getNotesByContext","noteMap","Map","has","mergedNotes","Array","from","values","sort","a","b","localeCompare","refreshNotesList","updatedNotes","ensureNoteInList","some","newNote","user_id","created_at","updatedNotesWithDates","handleNoteInput","saveTimeout","clearTimeout","capturedContext","capturedDate","currentContext","currentDate","selectDate","dateStr","selectToken","currentSelectToken","dateParts","year","parseInt","month","selectedDate","currentCalendarMonth","currentCalendarYear","DATE_CHANGED","setTodayDate","Number","getCurrentNoteContent","filter","d","nextNote","contexts","loadContexts","cachedContexts","saveContexts","CONTEXTS_LOADED","onLine","color","newContext","updatedContexts","contextId","currentContexts","c","selectedContext","oldContext","find","setItem","SHOW_SUCCESS","selectContext","contextName","CONTEXT_CHANGED","getSelectedContext","getContextColor","restoreLastContext","firstContext","lastContext","getItem","contextExists","calendar","render","today","dayNames","dayNamesDefault","slice","monthYearEl","textContent","monthNames","adjustedFirstDay","getDay","daysInMonth","getDate","daysInPrevMonth","grid","html","day","join","i","String","padStart","classes","push","totalCells","remainingCells","innerHTML","querySelectorAll","dayEl","addEventListener","dataset","prevMonth","nextMonth","goToToday","markdownEditor","init","containerId","onChange","container","onChangeCallback","ensureQuillLoaded","editor","loadQuill","initQuill","Quill","css","createElement","rel","head","appendChild","script","src","onload","editorElement","modules","toolbar","header","list","placeholder","formats","on","isUpdating","markdown","getMarkdown","root","getText","applyToolbarVisibility","querySelector","style","display","enable","delta","getContents","currentList","listCounter","ops","op","insert","text","attrs","attributes","trimEnd","repeat","pop","line","lastIndexOf","blockquote","formattedText","bold","italic","underline","strike","link","setContent","contentVersion","currentVersion","updateTimeout","disable","markdownToDelta","setContents","setText","lines","index","headerMatch","match","level","bulletMatch","parseInlineMarkdown","numberedMatch","taskMatch","quoteMatch","startsWith","regex","lastIndex","exec","getContent","setDisabled","disabled","pointerEvents","opacity","editorRoot","setPlaceholderMessage","then","focus","forceFlush","hasPendingChanges","notifications","className","setAttribute","show","type","title","duration","defaultDuration","dismissible","onAction","actionLabel","random","element","children","maxVisible","queue","warning","info","escapeHtml","closeBtn","dismiss","actionBtn","requestAnimationFrame","timeout","parentNode","removeChild","processQueue","visibleCount","next","shift","clearAll","div","normalizeToBulmaColor","ui","elements","lastKnownDate","INITIAL_RENDER_COUNT","renderedNotesCount","clockStarted","authSection","appSection","contextSelect","contextColorIndicator","mobileContextSelect","mobileContextColorIndicator","datePicker","breadcrumbContextName","breadcrumbDateName","markdownEditorContainer","saveIndicator","notesList","userEmail","currentTime","mobileCurrentTime","mobileCurrentDate","mobileSelectedNoteDate","contextModal","settingsModal","onboardingModal","syncStatus","syncStatusText","themeToggleMenu","themeToggleSwitch","weekStartSelect","timezoneSelect","mobileNotesToggle","mobileCalendarToggle","sidebar","calendarPanel","sidebarOverlay","calendarOverlay","sidebarClose","calendarClose","setupEventListeners","setupStateSubscriptions","setupUserDropdown","setupMobileNavigation","editorFullscreenBtn","openFullscreenNote","editorDeleteBtn","dayName","toLocaleDateString","weekday","timeZone","yy","mm","dd","formattedDateStr","formattedDate","showDeleteNoteModal","target","value","_c","async","_d","_e","_f","preventDefault","newTheme","documentElement","getAttribute","setTheme","err","_g","checked","setupKeyboardShortcuts","modKey","platform","toUpperCase","metaKey","ctrlKey","key","deleteModal","contains","closeDeleteNoteModal","closeAllModals","userDropdown","userDropdownButton","settingsMenuItem","signoutMenuItem","stopPropagation","toggle","showSettingsModal","subscribe","renderContextsSelect","subscribeMany","renderNotesList","_context","updateBreadcrumb","newDate","updateDatePickerDisplay","updateEditorDeleteButton","updateContextIndicator","updateEditorState","email","updateContextSelectorVisibility","updateBreadcrumbVisibility","updateMarkdownEditorVisibility","updateNewContextButtonVisibility","contextsList","optionsHTML","opt","selectedIndex","normalizedColor","background","notesToRender","hasMore","isActive","Math","min","loadMoreBtn","updateSaveIndicator","updateSyncStatus","pending","syncing","updateThemeIcon","themeIcon","showApp","_skipAnimation","getComputedStyle","startClock","hideApp","showError","msg","showSuccess","showWarning","showInfo","showContextModal","nameInput","colorInput","hiddenInputId","hiddenInput","buttons","button","newButton","cloneNode","parent","replaceChild","btn","border","borderRadius","setupColorButtons","colorButtons","selectColorButton","closeContextModal","dateFormatSelect","uniqueContextModeSwitch","showBreadcrumbSwitch","showMarkdownEditorSwitch","hideNewContextButtonSwitch","accordionContent","accordionIcon","iconElement","renderContextsEditList","saveBtn","saveIcon","saveSpinner","saveText","closeSettingsModal","closeOnboardingModal","modal","updateCurrentDateTime","setInterval","serverTimeOffset","locale","language","languages","timeOptions","hour","minute","second","hour12","dateOptions","timeString","toLocaleTimeString","dateString","mobileDateOptions","mobileDateString","displayElement","desktopContextContainer","mobileContextContainer","breadcrumb","mainSection","removeAttribute","desktopNewContextBtn","mobileNewContextBtn","ctx","_index","replace","toggleMobileSidebar","toggleMobileCalendar","closeMobileSidebar","closeMobileCalendar","tagName","innerWidth","overflow","dateEl","editorEl","fullscreenQuill","readOnly","fontSize","lineHeight","escapeHandler","closeFullscreenNote","removeEventListener","showNewContextModal","saveSettings","cancelBtn","currentSettings","iconEl","confirmDeleteNote","showEditContextModal","colorValue","colorsContainer","borderStyle","primary","danger","selectEditContextColor","closeEditContextModal","confirmEditContext","alert","showDeleteContextModal","nameElement","closeDeleteContextModal","confirmDeleteContext","app","googleClientId","syncQueue","SyncQueue","setupEventHandlers","detail","getPendingCount","process","SYNC_STATUS","OPERATION_SYNCED","SYNC_ERROR","maxRetriesReached","retryCount","maxRetries","syncServerTime","todayDate","clientTime","serverTime","timestamp","__APP__","__DEBUG__","clientIdMeta","__GOOGLE_CLIENT_ID__"],"mappings":"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"}